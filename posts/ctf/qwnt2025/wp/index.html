<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>第八届强网拟态决赛-Misc | 0raN9e&#39;s Blog</title>
<meta name="keywords" content="Misc">
<meta name="description" content="Misc
泄漏的时间与电码(三血)
把log和chal的加密脚本直接扔给ai
def solve():
    timings = [
        1.110270, 0.924169, 1.139244, 0.670085, 0.915054, 1.154452, 0.224613, 0.329060,
        0.774615, 0.279617, 0.954166, 0.430143, 0.414914, 1.224826, 1.310686, 1.265828,
        0.110950, 1.225669, 1.404647, 0.575287, 1.455927, 0.975492, 0.305642, 0.835893,
        1.245893, 0.569651, 1.060266, 0.149129, 0.844243, 1.294104, 0.079101, 0.914897,
        1.025389, 0.270495, 0.225577, 0.654189, 1.385665, 0.755860, 0.450597, 0.950750,
        0.839268, 1.015624, 0.895000, 0.794687, 1.064966, 1.200042, 0.559413, 0.980588,
        0.525959, 0.514992, 0.629261, 0.489585, 1.089786, 0.880690, 1.374392, 0.789075,
        0.814771, 1.455273, 1.050996, 0.234891, 1.074220, 0.099300, 1.319762, 0.935773,
        0.454985, 0.425895, 0.704892, 1.095786, 1.165433, 1.295589, 0.749113, 0.885320,
        1.244904, 0.659642, 0.635889, 0.435427, 0.520476, 0.870549, 0.890145, 1.125522,
        1.064915, 0.399210, 0.865873
    ]

    class LFSR:
        def __init__(self):
            self.lfsr = 0x92

        def step(self):
            bit = ((self.lfsr &gt;&gt; 0) ^ (self.lfsr &gt;&gt; 2) ^ (self.lfsr &gt;&gt; 3) ^ (self.lfsr &gt;&gt; 4)) &amp; 1
            self.lfsr = (self.lfsr &gt;&gt; 1) | (bit &lt;&lt; 7)
            return self.lfsr

    machine = LFSR()
    flag = &#34;&#34;
    inv_31 = pow(31, -1, 256)

    print(f&#34;{&#39;Time&#39;:&lt;12} | {&#39;Ops&#39;:&lt;5} | {&#39;Char&#39;:&lt;5}&#34;)
    print(&#34;-&#34; * 30)

    for t in timings:
        ops = round(t / 0.005)

        if ops % 2 == 0:
            base_ops = ops - 10
        else:
            base_ops = ops - 10 - 30

        val = ((base_ops - 85) * inv_31) &amp; 0xFF

        k = machine.step()
        char_code = val ^ k
        char = chr(char_code)

        flag &#43;= char
        # 打印时间对应关系
        print(f&#34;{t:&lt;12.6f} | {ops:&lt;5} | {char:&lt;5}&#34;)

    print(&#34;-&#34; * 30)
    print(f&#34;[&#43;]Recovered: \n{flag}&#34;)


if __name__ == &#34;__main__&#34;:
    solve()
">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/ctf/qwnt2025/wp/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/ctf/qwnt2025/wp/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="0raN9e&#39;s Blog (Alt + H)">0raN9e&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="首页">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/links/" title="友链">
                    <span>友链</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      第八届强网拟态决赛-Misc
    </h1>
    <div class="post-meta">

</div>
  </header> 
  <div class="post-content"><h1 id="misc">Misc<a hidden class="anchor" aria-hidden="true" href="#misc">#</a></h1>
<h2 id="泄漏的时间与电码三血">泄漏的时间与电码(三血)<a hidden class="anchor" aria-hidden="true" href="#泄漏的时间与电码三血">#</a></h2>
<p>把log和chal的加密脚本直接扔给ai</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solve</span>():
</span></span><span style="display:flex;"><span>    timings <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1.110270</span>, <span style="color:#ae81ff">0.924169</span>, <span style="color:#ae81ff">1.139244</span>, <span style="color:#ae81ff">0.670085</span>, <span style="color:#ae81ff">0.915054</span>, <span style="color:#ae81ff">1.154452</span>, <span style="color:#ae81ff">0.224613</span>, <span style="color:#ae81ff">0.329060</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0.774615</span>, <span style="color:#ae81ff">0.279617</span>, <span style="color:#ae81ff">0.954166</span>, <span style="color:#ae81ff">0.430143</span>, <span style="color:#ae81ff">0.414914</span>, <span style="color:#ae81ff">1.224826</span>, <span style="color:#ae81ff">1.310686</span>, <span style="color:#ae81ff">1.265828</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0.110950</span>, <span style="color:#ae81ff">1.225669</span>, <span style="color:#ae81ff">1.404647</span>, <span style="color:#ae81ff">0.575287</span>, <span style="color:#ae81ff">1.455927</span>, <span style="color:#ae81ff">0.975492</span>, <span style="color:#ae81ff">0.305642</span>, <span style="color:#ae81ff">0.835893</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1.245893</span>, <span style="color:#ae81ff">0.569651</span>, <span style="color:#ae81ff">1.060266</span>, <span style="color:#ae81ff">0.149129</span>, <span style="color:#ae81ff">0.844243</span>, <span style="color:#ae81ff">1.294104</span>, <span style="color:#ae81ff">0.079101</span>, <span style="color:#ae81ff">0.914897</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1.025389</span>, <span style="color:#ae81ff">0.270495</span>, <span style="color:#ae81ff">0.225577</span>, <span style="color:#ae81ff">0.654189</span>, <span style="color:#ae81ff">1.385665</span>, <span style="color:#ae81ff">0.755860</span>, <span style="color:#ae81ff">0.450597</span>, <span style="color:#ae81ff">0.950750</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0.839268</span>, <span style="color:#ae81ff">1.015624</span>, <span style="color:#ae81ff">0.895000</span>, <span style="color:#ae81ff">0.794687</span>, <span style="color:#ae81ff">1.064966</span>, <span style="color:#ae81ff">1.200042</span>, <span style="color:#ae81ff">0.559413</span>, <span style="color:#ae81ff">0.980588</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0.525959</span>, <span style="color:#ae81ff">0.514992</span>, <span style="color:#ae81ff">0.629261</span>, <span style="color:#ae81ff">0.489585</span>, <span style="color:#ae81ff">1.089786</span>, <span style="color:#ae81ff">0.880690</span>, <span style="color:#ae81ff">1.374392</span>, <span style="color:#ae81ff">0.789075</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0.814771</span>, <span style="color:#ae81ff">1.455273</span>, <span style="color:#ae81ff">1.050996</span>, <span style="color:#ae81ff">0.234891</span>, <span style="color:#ae81ff">1.074220</span>, <span style="color:#ae81ff">0.099300</span>, <span style="color:#ae81ff">1.319762</span>, <span style="color:#ae81ff">0.935773</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0.454985</span>, <span style="color:#ae81ff">0.425895</span>, <span style="color:#ae81ff">0.704892</span>, <span style="color:#ae81ff">1.095786</span>, <span style="color:#ae81ff">1.165433</span>, <span style="color:#ae81ff">1.295589</span>, <span style="color:#ae81ff">0.749113</span>, <span style="color:#ae81ff">0.885320</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1.244904</span>, <span style="color:#ae81ff">0.659642</span>, <span style="color:#ae81ff">0.635889</span>, <span style="color:#ae81ff">0.435427</span>, <span style="color:#ae81ff">0.520476</span>, <span style="color:#ae81ff">0.870549</span>, <span style="color:#ae81ff">0.890145</span>, <span style="color:#ae81ff">1.125522</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1.064915</span>, <span style="color:#ae81ff">0.399210</span>, <span style="color:#ae81ff">0.865873</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LFSR</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>lfsr <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x92</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">step</span>(self):
</span></span><span style="display:flex;"><span>            bit <span style="color:#f92672">=</span> ((self<span style="color:#f92672">.</span>lfsr <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">^</span> (self<span style="color:#f92672">.</span>lfsr <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">^</span> (self<span style="color:#f92672">.</span>lfsr <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">^</span> (self<span style="color:#f92672">.</span>lfsr <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">4</span>)) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>lfsr <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>lfsr <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">|</span> (bit <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">7</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>lfsr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    machine <span style="color:#f92672">=</span> LFSR()
</span></span><span style="display:flex;"><span>    flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    inv_31 <span style="color:#f92672">=</span> pow(<span style="color:#ae81ff">31</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">256</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span><span style="color:#e6db74">&#39;Time&#39;</span><span style="color:#e6db74">:</span><span style="color:#e6db74">&lt;12</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{</span><span style="color:#e6db74">&#39;Ops&#39;</span><span style="color:#e6db74">:</span><span style="color:#e6db74">&lt;5</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{</span><span style="color:#e6db74">&#39;Char&#39;</span><span style="color:#e6db74">:</span><span style="color:#e6db74">&lt;5</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">30</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> timings:
</span></span><span style="display:flex;"><span>        ops <span style="color:#f92672">=</span> round(t <span style="color:#f92672">/</span> <span style="color:#ae81ff">0.005</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ops <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            base_ops <span style="color:#f92672">=</span> ops <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            base_ops <span style="color:#f92672">=</span> ops <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        val <span style="color:#f92672">=</span> ((base_ops <span style="color:#f92672">-</span> <span style="color:#ae81ff">85</span>) <span style="color:#f92672">*</span> inv_31) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">=</span> machine<span style="color:#f92672">.</span>step()
</span></span><span style="display:flex;"><span>        char_code <span style="color:#f92672">=</span> val <span style="color:#f92672">^</span> k
</span></span><span style="display:flex;"><span>        char <span style="color:#f92672">=</span> chr(char_code)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        flag <span style="color:#f92672">+=</span> char
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 打印时间对应关系</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>t<span style="color:#e6db74">:</span><span style="color:#e6db74">&lt;12.6f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{</span>ops<span style="color:#e6db74">:</span><span style="color:#e6db74">&lt;5</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{</span>char<span style="color:#e6db74">:</span><span style="color:#e6db74">&lt;5</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">30</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[+]Recovered: </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>flag<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    solve()
</span></span></code></pre></div><p><img alt="2025-11-28123536" loading="lazy" src="../../images/qwnt/2025-11-28123536.png"></p>
<p><del>之后没思路无能狂怒了一天</del></p>
<p>官方hint的内容是ModR/M</p>
<p>已知给的chal的elf文件就说加密脚本直接在linux环境编译的，尝试反编译未找到可利用的内容，利用ai检索信息ModR/M，问了隐写得到了一个项目</p>
<p><a href="https://github.com/woodruffw/steg86">woodruffw/steg86: Hiding messages in x86 programs using semantic duals</a></p>
<p>猜测可能是，装一下环境</p>
<p><img alt="2025-11-28091510" loading="lazy" src="../../images/qwnt/2025-11-28091510.png"></p>
<p>得到了这个内容，把密文和字符表扔个ai</p>
<p><img alt="2025-11-28123949" loading="lazy" src="../../images/qwnt/2025-11-28123949.png"></p>
<p>Vim 编辑器进行宏操作验证的一个题目</p>
<h2 id="标准的绝密压缩三血">标准的绝密压缩(三血)<a hidden class="anchor" aria-hidden="true" href="#标准的绝密压缩三血">#</a></h2>
<p>题目给了一个流量包，</p>
<p>简单的tcp分析发现是有png的hex流的</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>tshark -r capture.pcapng -Y <span style="color:#e6db74">&#34;tcp&#34;</span> -T fields -e data &gt;<span style="color:#ae81ff">1</span>.txt
</span></span></code></pre></div><p>然后提取出所有的图片</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> binascii
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extract_pngs</span>(input_file):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(input_file, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        lines <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>readlines()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    reassembled_hex_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> lines:
</span></span><span style="display:flex;"><span>        line <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>strip()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> line:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            payload_bytes <span style="color:#f92672">=</span> binascii<span style="color:#f92672">.</span>unhexlify(line)
</span></span><span style="display:flex;"><span>            payload_str <span style="color:#f92672">=</span> payload_bytes<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> re<span style="color:#f92672">.</span><span style="color:#66d9ef">match</span>(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;^[0-9a-fA-F]+$&#39;</span>, payload_str):
</span></span><span style="display:flex;"><span>                reassembled_hex_string <span style="color:#f92672">+=</span> payload_str
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> (<span style="color:#a6e22e">UnicodeDecodeError</span>, binascii<span style="color:#f92672">.</span>Error):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        full_binary <span style="color:#f92672">=</span> binascii<span style="color:#f92672">.</span>unhexlify(reassembled_hex_string)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> binascii<span style="color:#f92672">.</span>Error:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Error converting reassembled string to binary. Check data integrity.&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    png_signature <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x89</span><span style="color:#e6db74">PNG</span><span style="color:#ae81ff">\r\n\x1a\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    parts <span style="color:#f92672">=</span> full_binary<span style="color:#f92672">.</span>split(png_signature)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i, part <span style="color:#f92672">in</span> enumerate(parts):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        png_data <span style="color:#f92672">=</span> png_signature <span style="color:#f92672">+</span> part
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        iend_marker <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;IEND&#39;</span>
</span></span><span style="display:flex;"><span>        iend_index <span style="color:#f92672">=</span> png_data<span style="color:#f92672">.</span>find(iend_marker)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> iend_index <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            end_of_file <span style="color:#f92672">=</span> iend_index <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>            png_data <span style="color:#f92672">=</span> png_data[:end_of_file]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            filename <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;extracted_</span><span style="color:#e6db74">{</span>count<span style="color:#e6db74">}</span><span style="color:#e6db74">.png&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> open(filename, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> out:
</span></span><span style="display:flex;"><span>                out<span style="color:#f92672">.</span>write(png_data)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;[+] Extracted: </span><span style="color:#e6db74">{</span>filename<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>            count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>extract_pngs(<span style="color:#e6db74">&#39;1.txt&#39;</span>)
</span></span></code></pre></div><p>提取出来发现是1kb规则的图片，看不出任何名堂，<del>于是放弃(中途三个小时去看了其他的)</del></p>
<p>最终还是回归png的，尝试了</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pngcheck extracted_*
</span></span></code></pre></div><p>30张图片都是有问题的，且都是可打印字符，那么就是朝着png想，翻了翻lunatic师傅的博客，检索到了可能是idat隐写，手动调整一下</p>
<p><img alt="2025-11-27184405" loading="lazy" src="../../images/qwnt/2025-11-27184405.png"></p>
<p>超绝震撼，把30条信息都提取出来，最后的信息是</p>
<pre tabindex="0"><code>Connection established. Hey, you online? It’s been a while since we last talked.
Yeah, I’m here. Busy as always. Feels like the days are getting shorter.
Tell me about it. I barely have time to sleep lately. Between maintenance logs and incident reports, I’m drowning.
Sounds rough. I’ve been buried in audits myself. Every time I finish one, another pops up.
Classic. Sometimes I wonder if the machines are easier to deal with than the people.
No kidding. At least machines don’t ask pointless questions.
True. Anyway, before I forget—how’s that side project you were working on? The one you wouldn’t shut up about months ago.
Still alive… barely. Progress is slow, but steady. You know me—I don’t give up easily.
Good. I hope it pays off one day.
Thanks. Alright… I’m guessing you didn’t ping me just to chat?
Well, half of it was. It’s been a while. But yes—I do have something for you today. Before sending the core cipher, I’ll transmit an encrypted archive first. It contains a sample text and the decryption rules.     
Okay. What’s special about this sample text?
And… inside the sample text, I used my favorite Herobrine legend—you know the one I always bring up.
Of course I know. The hidden original text from that weird old site, right?
What can I say—old habits die hard. Anyway, the important part: the sample packet and the core cipher are encrypted with the same password.
Got it. So if I can decrypt the sample, the real one should be straightforward.
Exactly. Send the sample when ready.
I’m ready. Go ahead.
UEsDBBQAAQAIABtFeFu1Ii0dcwAAAHwAAAAJAAAAcnVsZXMudHh07XuRBFDbojGKhAz59VaKEpwD6/rKaZnqUxf+NMH0rybWrAMPewZ/yGyLrMKQjNIcEbPAxjmP5oTh8fP77Vi1wnFwzN37BmrQ9SCkC27FC/xeqbgw/HWcDpgzsEoiNpqT9ZThrbAScyg5syfJmNactjelNVBLAwQUAAEACACGOXhbpdvG1ysBAAAVAgAACgAAAHNhbXBsZS50eHTA1fy4cMLZwZkTI1mEk88yOXy9rmbTbCNBQOo9hqKQPK6vjZVo9aCtTVflmkKYGV99+51qXbinmG7WGik5UvLJk9MKRosThBCDMHrmjibOCzjzNELwEgEyX8DjqJkSc8pIFwj+oRM3bb4i0GtRxbwqgsxCtgwiKdCVoXVdetN7RKLIQ7DD+Huv/ZptNdd0yRNHis9LEA3loB+IHZ+dK7IknqPh4lYF8JwAjx5/wwp0YAM6Bcec7uAvk6B5t1pEztm1rLl8TjniVz5/bBUTo1LjUXnar/pnm1NvE9EAuxz/s6b+O8/ew7/A4ItdNJGzDudh6YULfiV3pCTXFIbR4GCe4LwkohWZIlAjysA+zLRrgkTDoB10vWdNGdfoBAlLRoUdZ95mS7X5/bXV41BLAQI/ABQAAQAIABtFeFu1Ii0dcwAAAHwAAAAJACQAAAAAAAAAIAAAAAAAAABydWxlcy50eHQKACAAAAAAAAEAGABIv3f82lzcAQAAAAAAAAAAAAAAAAAAAABQSwECPwAUAAEACACGOXhbpdvG1ysBAAAVAgAACgAkAAAAAAAAACAAAACaAAAAc2FtcGxlLnR4dAoAIAAAAAAAAQAYAFP0sZjOXNwBAAAAAAAAAAAAAAAAAAAAAFBLBQYAAAAAAgACALcAAADtAQAAAAA=
got it. Decrypting… yeah, it works.
Good. That means the channel is stable.
Alright. Whenever you’re ready, send the real thing.
The core cipher will be transmitted through our secret channel. You remember how to decrypt it, right?
Of course. I’ve got the procedure ready. Start when you’re ready.
Done. Core cipher fully received. Integrity verified—no corruption.
Same to you. And hey… nice talking again.
Agreed. Take care.
Good. Keep things quiet for the next few days.
Yeah. Let’s not wait so long next time.
You too.
</code></pre><p>中间的解码可以拿到压缩包</p>
<p><img alt="2025-11-27184642" loading="lazy" src="../../images/qwnt/2025-11-27184642.png"></p>
<p>一眼明文攻击，这里回归文本</p>
<pre tabindex="0"><code>Okay. What’s special about this sample text?
And… inside the sample text, I used my favorite Herobrine legend—you know the one I always bring up.
Of course I know. The hidden original text from that weird old site, right?
What can I say—old habits die hard. Anyway, the important part: the sample packet and the core cipher are encrypted with the same password.
</code></pre><p>那么sample.txt就是需要社工的地方，找到对应文本内容</p>
<p><a href="https://minecraftcreepypasta.fandom.com/wiki/Him.Html">Him.Html | Minecraft CreepyPasta Wiki | Fandom</a></p>
<p>这里就是拷打ai进行网页社工找到了对应内容</p>
<pre tabindex="0"><code>Him.HTML was a website that a Steve face with realistic eyes and a jumble of numbers and letters. When sorted it said this: It has been reported that some victims of torture, during the act, would retreat into a fantasy world from which they could not WAKE UP. In this catatonic state, the victim lived in a world just like their normal one, except they weren&#39;t being tortured. The only way that they realized they needed to WAKE UP was a note they found in their fantasy world. It would tell them about their condition, and tell them to WAKE UP. Even then, it would often take months until they were ready to discard their fantasy world and PLEASE WAKE UP.
</code></pre><p>文件大小略有出路，最终的内容是</p>
<pre tabindex="0"><code>It has been reported that some victims of torture, during the act, would retreat into a fantasy world from which they could not WAKE UP. In this catatonic state, the victim lived in a world just like their normal one, except they weren&#39;t being tortured. The only way that they realized they needed to WAKE UP was a note they found in their fantasy world. It would tell them about their condition, and tell them to WAKE UP. Even then, it would often take months until they were ready to discard their fantasy world and PLEASE WAKE UP.
</code></pre><p>这里利用7z制作压缩包</p>
<p><img alt="2025-11-27185222" loading="lazy" src="../../images/qwnt/2025-11-27185222.png"></p>
<p>利用ARCHPR进行攻击解压同时得到密钥</p>
<pre tabindex="0"><code>[ b47e923c 5aeb49a7 a3cd7af0 ]
</code></pre><p>rule文本的内容是</p>
<pre tabindex="0"><code>1.you need to calc the md5 of port to decrypt the core data.
2.The cipher I put in the zip, in segments, has been deflated.
</code></pre><p><del>然后又陷入了深思</del></p>
<p>大致的思路利用对应的端口的MD5作为key解密内容</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span> tshark -r capture.pcapng -T fields -e tcp.srcport -e tcp.dstport -e tcp.payload &gt;<span style="color:#ae81ff">1</span>.txt
</span></span></code></pre></div><p>仔细分析一下内容(这里有点脑王争霸)，发现端口30012-30091之间的区别与前面png传输的内容，拼接起来是乱码，尝试发现是AES加密</p>
<p><img alt="2025-11-27145000" loading="lazy" src="../../images/qwnt/2025-11-27145000.png"></p>
<p>那么就可以写个脚本提取出所有的压缩包了</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">aes_ecb_decrypt</span>(key_utf8, cipher_hex):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    使用 UTF-8 编码的密钥字符串进行 AES ECB 解密
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    key_utf8: 普通字符串（如MD5的hex结果）
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    cipher_hex: 十六进制密文字符串
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    key_bytes <span style="color:#f92672">=</span> key_utf8<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)  <span style="color:#75715e"># 直接转成字节</span>
</span></span><span style="display:flex;"><span>    cipher_bytes <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(cipher_hex)  <span style="color:#75715e"># 密文hex转字节</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cipher <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(key_bytes, AES<span style="color:#f92672">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>    plaintext <span style="color:#f92672">=</span> cipher<span style="color:#f92672">.</span>decrypt(cipher_bytes)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> plaintext
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">unpad</span>(s):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;去除 PKCS7 填充&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    padding_len <span style="color:#f92672">=</span> s[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> padding_len <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">or</span> padding_len <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">16</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> s
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> s[:<span style="color:#f92672">-</span>padding_len]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse_traffic_data</span>(filename):
</span></span><span style="display:flex;"><span>    results <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(filename, <span style="color:#e6db74">&#39;r&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>            lines <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>readlines()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;读取文件: </span><span style="color:#e6db74">{</span>filename<span style="color:#e6db74">}</span><span style="color:#e6db74">, 共 </span><span style="color:#e6db74">{</span>len(lines)<span style="color:#e6db74">}</span><span style="color:#e6db74"> 行</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i, line <span style="color:#f92672">in</span> enumerate(lines, <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>            line <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>strip()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> line:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            parts <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> len(parts) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                src_port <span style="color:#f92672">=</span> int(parts[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#ae81ff">30012</span> <span style="color:#f92672">&lt;=</span> src_port <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">30091</span>:
</span></span><span style="display:flex;"><span>                    hex_data <span style="color:#f92672">=</span> parts[<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> src_port <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> results:
</span></span><span style="display:flex;"><span>                        results[src_port] <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    results[src_port]<span style="color:#f92672">.</span>append(hex_data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ValueError</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;找到 </span><span style="color:#e6db74">{</span>len(results)<span style="color:#e6db74">}</span><span style="color:#e6db74"> 个端口的数据</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;=&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">70</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 解密并保存</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> port <span style="color:#f92672">in</span> sorted(results<span style="color:#f92672">.</span>keys()):
</span></span><span style="display:flex;"><span>            encrypted_hex <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(results[port])
</span></span><span style="display:flex;"><span>            decrypt_and_save(port, encrypted_hex)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;=&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">70</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">FileNotFoundError</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;错误: 找不到文件 </span><span style="color:#e6db74">{</span>filename<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;错误: </span><span style="color:#e6db74">{</span>type(e)<span style="color:#f92672">.</span>__name__<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">import</span> traceback
</span></span><span style="display:flex;"><span>        traceback<span style="color:#f92672">.</span>print_exc()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decrypt_and_save</span>(port, encrypted_hex):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;解密单个端口的数据并保存为 ZIP&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">端口: </span><span style="color:#e6db74">{</span>port<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 1. 端口号 → MD5 → hex字符串作为密钥</span>
</span></span><span style="display:flex;"><span>        port_str <span style="color:#f92672">=</span> str(port)
</span></span><span style="display:flex;"><span>        md5_hash <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>md5(port_str<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;utf-8&#39;</span>))<span style="color:#f92672">.</span>hexdigest()
</span></span><span style="display:flex;"><span>        key_utf8 <span style="color:#f92672">=</span> md5_hash  <span style="color:#75715e"># MD5的hex结果作为UTF-8字符串密钥</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;端口字符串: &#39;</span><span style="color:#e6db74">{</span>port_str<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;MD5密钥 (hex): </span><span style="color:#e6db74">{</span>key_utf8<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;密钥长度: </span><span style="color:#e6db74">{</span>len(key_utf8)<span style="color:#e6db74">}</span><span style="color:#e6db74"> 字符&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 2. 解密</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;密文长度: </span><span style="color:#e6db74">{</span>len(encrypted_hex)<span style="color:#e6db74">}</span><span style="color:#e6db74"> 字符 (</span><span style="color:#e6db74">{</span>len(encrypted_hex) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> 字节)&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        decrypted <span style="color:#f92672">=</span> aes_ecb_decrypt(key_utf8, encrypted_hex)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;解密后长度: </span><span style="color:#e6db74">{</span>len(decrypted)<span style="color:#e6db74">}</span><span style="color:#e6db74"> 字节&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 3. 去除填充</span>
</span></span><span style="display:flex;"><span>        decrypted <span style="color:#f92672">=</span> unpad(decrypted)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;去填充后长度: </span><span style="color:#e6db74">{</span>len(decrypted)<span style="color:#e6db74">}</span><span style="color:#e6db74"> 字节&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 4. 检查 ZIP 文件头</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> decrypted[:<span style="color:#ae81ff">4</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;PK</span><span style="color:#ae81ff">\x03\x04</span><span style="color:#e6db74">&#39;</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;✓ 检测到 ZIP 文件头&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;⚠ 前4字节: </span><span style="color:#e6db74">{</span>decrypted[:<span style="color:#ae81ff">4</span>]<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74"> (ZIP应为 504b0304)&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 5. 保存为 ZIP 文件</span>
</span></span><span style="display:flex;"><span>        output_filename <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>port<span style="color:#e6db74">}</span><span style="color:#e6db74">.zip&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(output_filename, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>            f<span style="color:#f92672">.</span>write(decrypted)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;✓ 成功保存: </span><span style="color:#e6db74">{</span>output_filename<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;✗ 解密端口 </span><span style="color:#e6db74">{</span>port<span style="color:#e6db74">}</span><span style="color:#e6db74"> 失败: </span><span style="color:#e6db74">{</span>type(e)<span style="color:#f92672">.</span>__name__<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">import</span> traceback
</span></span><span style="display:flex;"><span>        traceback<span style="color:#f92672">.</span>print_exc()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    target_file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1.txt&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        target_file <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;=&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">70</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;AES 流量数据解密工具&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;=&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">70</span>)
</span></span><span style="display:flex;"><span>    print()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    parse_traffic_data(target_file)
</span></span></code></pre></div><p>得到对应的压缩包，这里仔细分析压缩包里的内容是4字节，应该是CRC爆破,有不可见字符参考lunatic师傅的脚本</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> zipfile
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> binascii
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CRC32Reverse</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, crc32, length, tbl<span style="color:#f92672">=</span>bytes(range(<span style="color:#ae81ff">256</span>)), poly<span style="color:#f92672">=</span><span style="color:#ae81ff">0xEDB88320</span>, accum<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>char_set <span style="color:#f92672">=</span> set(tbl)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>crc32 <span style="color:#f92672">=</span> crc32
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>length <span style="color:#f92672">=</span> length
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>poly <span style="color:#f92672">=</span> poly
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>accum <span style="color:#f92672">=</span> accum
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>table <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>table_reverse <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">init_tables</span>(self, poly, reverse<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> i <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                    i <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                    i <span style="color:#f92672">^=</span> poly
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    i <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>table<span style="color:#f92672">.</span>append(i)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> reverse:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>                found <span style="color:#f92672">=</span> [j <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>) <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>table[j] <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">24</span> <span style="color:#f92672">==</span> i]
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>table_reverse<span style="color:#f92672">.</span>append(tuple(found))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calc</span>(self, data, accum<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>        accum <span style="color:#f92672">=</span> <span style="color:#f92672">~</span>accum
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> b <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>            accum <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>table[(accum <span style="color:#f92672">^</span> b) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>] <span style="color:#f92672">^</span> ((accum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x00FFFFFF</span>)
</span></span><span style="display:flex;"><span>        accum <span style="color:#f92672">=</span> <span style="color:#f92672">~</span>accum
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> accum <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">find_reverse</span>(self, desired, accum):
</span></span><span style="display:flex;"><span>        solutions <span style="color:#f92672">=</span> set()
</span></span><span style="display:flex;"><span>        accum <span style="color:#f92672">=</span> <span style="color:#f92672">~</span>accum
</span></span><span style="display:flex;"><span>        stack <span style="color:#f92672">=</span> [(<span style="color:#f92672">~</span>desired,)]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> stack:
</span></span><span style="display:flex;"><span>            node <span style="color:#f92672">=</span> stack<span style="color:#f92672">.</span>pop()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>table_reverse[(node[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">24</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>]:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> len(node) <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span>:
</span></span><span style="display:flex;"><span>                    a <span style="color:#f92672">=</span> accum
</span></span><span style="display:flex;"><span>                    data <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>                    node <span style="color:#f92672">=</span> node[<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">+</span> (j,)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">3</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>                        data<span style="color:#f92672">.</span>append((a <span style="color:#f92672">^</span> node[i]) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>                        a <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>                        a <span style="color:#f92672">^=</span> self<span style="color:#f92672">.</span>table[node[i]]
</span></span><span style="display:flex;"><span>                    solutions<span style="color:#f92672">.</span>add(tuple(data))
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    stack<span style="color:#f92672">.</span>append(((node[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">^</span> self<span style="color:#f92672">.</span>table[j]) <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">8</span>,) <span style="color:#f92672">+</span> node[<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">+</span> (j,))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> solutions
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dfs</span>(self, length, outlist<span style="color:#f92672">=</span>[<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>]):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> length <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> outlist
</span></span><span style="display:flex;"><span>        tmp_list <span style="color:#f92672">=</span> [item <span style="color:#f92672">+</span> bytes([x]) <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> outlist <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>char_set]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>dfs(length <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, tmp_list)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_reverse</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>init_tables(self<span style="color:#f92672">.</span>poly)
</span></span><span style="display:flex;"><span>        desired <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>crc32
</span></span><span style="display:flex;"><span>        accum <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>accum
</span></span><span style="display:flex;"><span>        result_list <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>length <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">4</span>:
</span></span><span style="display:flex;"><span>            patches <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>find_reverse(desired, accum)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>dfs(self<span style="color:#f92672">.</span>length <span style="color:#f92672">-</span> <span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>                patch <span style="color:#f92672">=</span> list(item)
</span></span><span style="display:flex;"><span>                patches <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>find_reverse(desired, self<span style="color:#f92672">.</span>calc(patch, accum))
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> last4 <span style="color:#f92672">in</span> patches:
</span></span><span style="display:flex;"><span>                    patch<span style="color:#f92672">.</span>extend(last4)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>calc(patch, accum) <span style="color:#f92672">==</span> desired:
</span></span><span style="display:flex;"><span>                        result_list<span style="color:#f92672">.</span>append(bytes(patch))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>dfs(self<span style="color:#f92672">.</span>length):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>calc(item) <span style="color:#f92672">==</span> desired:
</span></span><span style="display:flex;"><span>                    result_list<span style="color:#f92672">.</span>append(bytes(item))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result_list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">crc32_reverse</span>(crc32, length, char_set<span style="color:#f92672">=</span>bytes(range(<span style="color:#ae81ff">256</span>)), poly<span style="color:#f92672">=</span><span style="color:#ae81ff">0xEDB88320</span>, accum<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> CRC32Reverse(crc32, length, char_set, poly, accum)<span style="color:#f92672">.</span>run_reverse()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">scan_zip_crc</span>(dirname, output_bin<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;output.bin&#34;</span>, brute_length<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>    results <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> root, dirs, files <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>walk(dirname):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> fname <span style="color:#f92672">in</span> files:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> fname<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#34;.zip&#34;</span>):
</span></span><span style="display:flex;"><span>                zip_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>abspath(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(root, fname))
</span></span><span style="display:flex;"><span>                zip_path <span style="color:#f92672">=</span> zip_path<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[+] 发现压缩包：</span><span style="color:#e6db74">{</span>zip_path<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">with</span> zipfile<span style="color:#f92672">.</span>ZipFile(zip_path) <span style="color:#66d9ef">as</span> z:
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">for</span> info <span style="color:#f92672">in</span> z<span style="color:#f92672">.</span>infolist():
</span></span><span style="display:flex;"><span>                            crc <span style="color:#f92672">=</span> info<span style="color:#f92672">.</span>CRC
</span></span><span style="display:flex;"><span>                            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  → 文件头：</span><span style="color:#e6db74">{</span>info<span style="color:#f92672">.</span>filename<span style="color:#e6db74">}</span><span style="color:#e6db74"> CRC32=</span><span style="color:#e6db74">{</span>crc<span style="color:#e6db74">:</span><span style="color:#e6db74">08X</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                            res <span style="color:#f92672">=</span> crc32_reverse(crc, brute_length)
</span></span><span style="display:flex;"><span>                            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;    逆推得到 </span><span style="color:#e6db74">{</span>len(res)<span style="color:#e6db74">}</span><span style="color:#e6db74"> 条结果&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                            results<span style="color:#f92672">.</span>extend(res)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[-] 无法读取 ZIP：</span><span style="color:#e6db74">{</span>zip_path<span style="color:#e6db74">}</span><span style="color:#e6db74">, 错误：</span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 写入 bin</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(output_bin, <span style="color:#e6db74">&#34;wb&#34;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> results:
</span></span><span style="display:flex;"><span>            f<span style="color:#f92672">.</span>write(r)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[+] 已写入 </span><span style="color:#e6db74">{</span>len(results)<span style="color:#e6db74">}</span><span style="color:#e6db74"> 条结果 → </span><span style="color:#e6db74">{</span>output_bin<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    scan_zip_crc(<span style="color:#e6db74">&#34;.&#34;</span>, output_bin<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;final_output.bin&#34;</span>, brute_length<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)
</span></span></code></pre></div><p>然后根据一开始的提示deflated了，那么我们inflate一下，搓个脚本得到了</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> zlib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;final_output.bin&#34;</span>, <span style="color:#e6db74">&#34;rb&#34;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>all_out <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 假设每块是 4 字节</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(data), <span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>    block <span style="color:#f92672">=</span> data[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># raw deflate 解压</span>
</span></span><span style="display:flex;"><span>        out <span style="color:#f92672">=</span> zlib<span style="color:#f92672">.</span>decompress(block, wbits<span style="color:#f92672">=-</span><span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>        all_out <span style="color:#f92672">+=</span> out
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>  <span style="color:#75715e"># 有些组合可能不是真正的 deflate 数据</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 最终拼接成一句话</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    print(all_out<span style="color:#f92672">.</span>decode())  <span style="color:#75715e"># 如果是 ASCII/UTF-8 文本</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">UnicodeDecodeError</span>:
</span></span><span style="display:flex;"><span>    print(all_out)  <span style="color:#75715e"># 如果包含非文本字节，直接打印 bytes</span>
</span></span></code></pre></div><p>得到了一个hash的值</p>
<p>分析一下hash，算是zipCrypto的特性，里面文本内容较短，在进行hash转储的时候会将内容全部放入到hash中进行加密，从开始的文本聊天得知，这边的密钥可以进行复用，在已知hash和key后可以hash反推压缩包得到flag的内容，脚本如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> binascii
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> zlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Tuple, Optional
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ZipCrypto</span>:
</span></span><span style="display:flex;"><span>    CRC32_POLYNOMIAL <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xEDB88320</span>
</span></span><span style="display:flex;"><span>    MAGIC_MULT <span style="color:#f92672">=</span> <span style="color:#ae81ff">134775813</span>
</span></span><span style="display:flex;"><span>    MAGIC_ADD <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, key0: int, key1: int, key2: int):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>keys <span style="color:#f92672">=</span> [key0, key1, key2]
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>crc_table <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_build_crc_table()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_build_crc_table</span>(self) <span style="color:#f92672">-&gt;</span> list:
</span></span><span style="display:flex;"><span>        table <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>            crc <span style="color:#f92672">=</span> i
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> crc <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                    crc <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>CRC32_POLYNOMIAL <span style="color:#f92672">^</span> (crc <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFF</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    crc <span style="color:#f92672">=</span> (crc <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFF</span>
</span></span><span style="display:flex;"><span>            table<span style="color:#f92672">.</span>append(crc)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> table
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_crc32</span>(self, old_crc: int, byte: int) <span style="color:#f92672">-&gt;</span> int:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (self<span style="color:#f92672">.</span>crc_table[(old_crc <span style="color:#f92672">^</span> byte) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>] <span style="color:#f92672">^</span> (old_crc <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span>)) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_update_keys</span>(self, plaintext_byte: int):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>keys[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_crc32(self<span style="color:#f92672">.</span>keys[<span style="color:#ae81ff">0</span>], plaintext_byte)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>keys[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>keys[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> (self<span style="color:#f92672">.</span>keys[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFF</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>keys[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>keys[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>MAGIC_MULT <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>MAGIC_ADD) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFF</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>keys[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_crc32(self<span style="color:#f92672">.</span>keys[<span style="color:#ae81ff">2</span>], (self<span style="color:#f92672">.</span>keys[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">24</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_decrypt_byte</span>(self) <span style="color:#f92672">-&gt;</span> int:
</span></span><span style="display:flex;"><span>        temp <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>keys[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">|</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFF</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ((temp <span style="color:#f92672">*</span> (temp <span style="color:#f92672">^</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decrypt</span>(self, ciphertext: bytes) <span style="color:#f92672">-&gt;</span> bytes:
</span></span><span style="display:flex;"><span>        plaintext <span style="color:#f92672">=</span> bytearray()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> cipher_byte <span style="color:#f92672">in</span> ciphertext:
</span></span><span style="display:flex;"><span>            keystream_byte <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_decrypt_byte()
</span></span><span style="display:flex;"><span>            plain_byte <span style="color:#f92672">=</span> cipher_byte <span style="color:#f92672">^</span> keystream_byte
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>_update_keys(plain_byte)
</span></span><span style="display:flex;"><span>            plaintext<span style="color:#f92672">.</span>append(plain_byte)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> bytes(plaintext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extract_encrypted_data</span>(pkzip_hash: str) <span style="color:#f92672">-&gt;</span> Optional[bytes]:
</span></span><span style="display:flex;"><span>    clean <span style="color:#f92672">=</span> pkzip_hash<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;$pkzip$&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;$/pkzip$&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#f92672">.</span>strip()
</span></span><span style="display:flex;"><span>    parts <span style="color:#f92672">=</span> clean<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;*&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    hex_data <span style="color:#f92672">=</span> max(
</span></span><span style="display:flex;"><span>        (p <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> parts <span style="color:#66d9ef">if</span> all(c <span style="color:#f92672">in</span> <span style="color:#e6db74">&#39;0123456789abcdefABCDEF&#39;</span> <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> p)),
</span></span><span style="display:flex;"><span>        key<span style="color:#f92672">=</span>len,
</span></span><span style="display:flex;"><span>        default<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> hex_data:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> binascii<span style="color:#f92672">.</span>unhexlify(hex_data)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> binascii<span style="color:#f92672">.</span>Error:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">try_decompress</span>(data: bytes) <span style="color:#f92672">-&gt;</span> Tuple[bool, bytes]:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># -15 表示 raw deflate（不含 zlib 头）</span>
</span></span><span style="display:flex;"><span>        decompressed <span style="color:#f92672">=</span> zlib<span style="color:#f92672">.</span>decompress(data, <span style="color:#f92672">-</span><span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>, decompressed
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> zlib<span style="color:#f92672">.</span>error:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>, data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">display_result</span>(data: bytes, label: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;内容&#34;</span>):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span><span style="color:#e6db74">&#39;=&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[</span><span style="color:#e6db74">{</span>label<span style="color:#e6db74">}</span><span style="color:#e6db74">]&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;=&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        text <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>        print(text)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">UnicodeDecodeError</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Raw: </span><span style="color:#e6db74">{</span>repr(data)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Hex: </span><span style="color:#e6db74">{</span>binascii<span style="color:#f92672">.</span>hexlify(data)<span style="color:#f92672">.</span>decode()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;=&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    TARGET_HASH <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;$pkzip$1*1*2*0*35*29*4135a7f*0*26*0*35*0413*c8358ce9e6858f166753637de145d0c841cee9efd7cf2008d13e551dd584b69cae5895c7df45f32fdfb51d0c0d273820239896d3e6*$/pkzip$&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    K0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xb47e923c</span>
</span></span><span style="display:flex;"><span>    K1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x5aeb49a7</span>
</span></span><span style="display:flex;"><span>    K2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xa3cd7af0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;ZIP Crypto 解密工具&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;密钥状态: K0=</span><span style="color:#e6db74">{</span>hex(K0)<span style="color:#e6db74">}</span><span style="color:#e6db74">, K1=</span><span style="color:#e6db74">{</span>hex(K1)<span style="color:#e6db74">}</span><span style="color:#e6db74">, K2=</span><span style="color:#e6db74">{</span>hex(K2)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    encrypted <span style="color:#f92672">=</span> extract_encrypted_data(TARGET_HASH)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> encrypted <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">[错误] 无法从 hash 中提取加密数据&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">[*] 提取到 </span><span style="color:#e6db74">{</span>len(encrypted)<span style="color:#e6db74">}</span><span style="color:#e6db74"> 字节加密数据&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;    前 20 字节: </span><span style="color:#e6db74">{</span>binascii<span style="color:#f92672">.</span>hexlify(encrypted[:<span style="color:#ae81ff">20</span>])<span style="color:#f92672">.</span>decode()<span style="color:#e6db74">}</span><span style="color:#e6db74">...&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    crypto <span style="color:#f92672">=</span> ZipCrypto(K0, K1, K2)
</span></span><span style="display:flex;"><span>    decrypted <span style="color:#f92672">=</span> crypto<span style="color:#f92672">.</span>decrypt(encrypted)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(decrypted) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">12</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">[错误] 解密数据过短（需要 &gt;12 字节）&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    actual_data <span style="color:#f92672">=</span> decrypted[<span style="color:#ae81ff">12</span>:]
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[*] 移除加密头后剩余 </span><span style="color:#e6db74">{</span>len(actual_data)<span style="color:#e6db74">}</span><span style="color:#e6db74"> 字节&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    display_result(actual_data, <span style="color:#e6db74">&#34;解密内容 (Stored)&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    is_compressed, final_data <span style="color:#f92672">=</span> try_decompress(actual_data)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> is_compressed:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">[!] 检测到 DEFLATE 压缩数据&#34;</span>)
</span></span><span style="display:flex;"><span>        display_result(final_data, <span style="color:#e6db74">&#34;解压后内容&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">[*] 数据未压缩（使用 Stored 方法）&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><p><img alt="2025-11-28173456" loading="lazy" src="../../images/qwnt/2025-11-28173456.png"></p>
<h2 id="返璞归真一血">返璞归真(一血)<a hidden class="anchor" aria-hidden="true" href="#返璞归真一血">#</a></h2>
<p>给的压缩包开头有提示hashisk3y</p>
<p>这里直接伪加密解压得到图片，利用foremost进行分离得到dmp,利用项目</p>
<p><a href="https://ollydbg.de/Paperbak/">PaperBack</a></p>
<p>进行分离拿到文本内容，这里是23字节，卡了一会，最后是猜测是RC4，将可能的hash值都运行下来，直接扔个ai分析得到flag</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> binascii
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. 密文</span>
</span></span><span style="display:flex;"><span>cipher_b64 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;jNX+xu2QKBm23AUlwClt+3xDkQcJGjM=&#34;</span>
</span></span><span style="display:flex;"><span>cipher_data <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(cipher_b64)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. 密钥池 (来源于你提供的文件 Hash)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 格式: (描述, MD5 Hex字符串)</span>
</span></span><span style="display:flex;"><span>candidates <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    (<span style="color:#e6db74">&#34;Hint String (hashisk3y)&#34;</span>, <span style="color:#e6db74">&#34;298e85501e91238426e2e542d9925232&#34;</span>),  <span style="color:#75715e"># MD5(&#34;hashisk3y&#34;)</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#e6db74">&#34;00000000.jpg&#34;</span>, <span style="color:#e6db74">&#34;001a62ee54d1c28a8b769ab5499011cb&#34;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#e6db74">&#34;00000698.bmp&#34;</span>, <span style="color:#e6db74">&#34;5166b497bb66913fc0e23fd82980538f&#34;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#e6db74">&#34;image.jpg&#34;</span>, <span style="color:#e6db74">&#34;652365effd5138036c26382004b8d6bd&#34;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#e6db74">&#34;返璞归真.zip&#34;</span>, <span style="color:#e6db74">&#34;369f792f2edf63102fe12e1951ec899f&#34;</span>)
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># RC4 实现</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rc4</span>(data, key):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 确保 key 是 bytes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> isinstance(key, str):
</span></span><span style="display:flex;"><span>        key <span style="color:#f92672">=</span> key<span style="color:#f92672">.</span>encode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    S <span style="color:#f92672">=</span> list(range(<span style="color:#ae81ff">256</span>))
</span></span><span style="display:flex;"><span>    j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    out <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># KSA</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">=</span> (j <span style="color:#f92672">+</span> S[i] <span style="color:#f92672">+</span> key[i <span style="color:#f92672">%</span> len(key)]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        S[i], S[j] <span style="color:#f92672">=</span> S[j], S[i]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># PRGA</span>
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">=</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> char <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>        i <span style="color:#f92672">=</span> (i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">=</span> (j <span style="color:#f92672">+</span> S[i]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        S[i], S[j] <span style="color:#f92672">=</span> S[j], S[i]
</span></span><span style="display:flex;"><span>        out<span style="color:#f92672">.</span>append(char <span style="color:#f92672">^</span> S[(S[i] <span style="color:#f92672">+</span> S[j]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> bytes(out)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;--- 开始 RC4 批量爆破 (尝试 </span><span style="color:#e6db74">{</span>len(candidates) <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> 种组合) ---&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>found <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> label, md5_hex <span style="color:#f92672">in</span> candidates:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 方式 A: 密钥就是 32位的 Hex 字符串 (例如 &#34;001a...&#34;)</span>
</span></span><span style="display:flex;"><span>    key_str <span style="color:#f92672">=</span> md5_hex
</span></span><span style="display:flex;"><span>    res_a <span style="color:#f92672">=</span> rc4(cipher_data, key_str)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 方式 B: 密钥是 Hex 转换后的 16位 原始字节 (例如 \x00\x1a...)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        key_bytes <span style="color:#f92672">=</span> binascii<span style="color:#f92672">.</span>unhexlify(md5_hex)
</span></span><span style="display:flex;"><span>        res_b <span style="color:#f92672">=</span> rc4(cipher_data, key_bytes)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        res_b <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 检查结果 A</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        text_a <span style="color:#f92672">=</span> res_a<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;flag&#34;</span> <span style="color:#f92672">in</span> text_a<span style="color:#f92672">.</span>lower() <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;ctf&#34;</span> <span style="color:#f92672">in</span> text_a<span style="color:#f92672">.</span>lower():
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">🔥🔥🔥 [SUCCESS] 找到 Flag! 🔥🔥🔥&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;来源: </span><span style="color:#e6db74">{</span>label<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;密钥类型: Hex String (32 chars)&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Key : </span><span style="color:#e6db74">{</span>key_str<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Flag: </span><span style="color:#e6db74">{</span>text_a<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            found <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>  <span style="color:#75715e"># 解码失败说明不是 flag</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 检查结果 B</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        text_b <span style="color:#f92672">=</span> res_b<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;flag&#34;</span> <span style="color:#f92672">in</span> text_b<span style="color:#f92672">.</span>lower() <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;ctf&#34;</span> <span style="color:#f92672">in</span> text_b<span style="color:#f92672">.</span>lower():
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">🔥🔥🔥 [SUCCESS] 找到 Flag! 🔥🔥🔥&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;来源: </span><span style="color:#e6db74">{</span>label<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;密钥类型: Raw Bytes (16 bytes)&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Key (Hex): </span><span style="color:#e6db74">{</span>md5_hex<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Flag: </span><span style="color:#e6db74">{</span>text_b<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            found <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> found:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;未能解出包含 &#39;flag&#39; 字样的结果。&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;调试输出 (看看有没有类似 flag 的乱码):&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 打印一下 hashisk3y 的结果看看样子</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Try 1: </span><span style="color:#e6db74">{</span>rc4(cipher_data, candidates[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>])<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>, <span style="color:#e6db74">&#39;ignore&#39;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><p><img alt="2025-11-28125207" loading="lazy" src="../../images/qwnt/2025-11-28125207.png"></p>
<h2 id="猫咪电台一血">猫咪电台(一血)<a hidden class="anchor" aria-hidden="true" href="#猫咪电台一血">#</a></h2>
<p>题目给了一个图片和一个wav</p>
<p><img alt="2025-11-28133936" loading="lazy" src="../../images/qwnt/2025-11-28133936.png"></p>
<p>图片里面应该有东西，分析一下lsb隐写，提取出来</p>
<p><img alt="2025-11-28164835" loading="lazy" src="../../images/qwnt/2025-11-28164835.png"></p>
<p>去掉开头fffe得到图片</p>
<p><img alt="1" loading="lazy" src="../../images/qwnt/%E7%8C%AB%E5%92%AA%E7%94%B5%E5%8F%B0.png"></p>
<p><img alt="2025-11-28165227" loading="lazy" src="../../images/qwnt/2025-11-28165227.png"></p>
<hr>
<p>wav用010分析后面有一个巨大的压缩包，分离出来。</p>
<p>根据文件夹的提示，以及尝试发现1.wav不是sstv后联想到是无线电的音频</p>
<p>问ai有哪些工具可以进行尝试</p>
<p><img alt="2025-11-28153035" loading="lazy" src="../../images/qwnt/2025-11-28153035.png"></p>
<p><img alt="2025-11-28152910" loading="lazy" src="../../images/qwnt/2025-11-28152910.png"></p>
<p>得到了part1 <code>R77YM30W1SFUN</code></p>
<p>这个密码可以解压得到2.wav</p>
<p>2.wav是个很杂的音，双声道</p>
<p><img alt="2025-11-28153304" loading="lazy" src="../../images/qwnt/2025-11-28153304.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 这条命令的意思是：新建一个文件，内容是 (通道1 - 通道2)</span>
</span></span><span style="display:flex;"><span>sox 2.wav -c <span style="color:#ae81ff">1</span> recovered.wav remix 1v0.5 2v-0.5
</span></span></code></pre></div><p>但还是杂音</p>
<p>回头看了一下文件的hz</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>file 2.wav
</span></span><span style="display:flex;"><span>2.wav: MBWF/RF64 audio, stereo <span style="color:#ae81ff">2400000</span> Hz
</span></span></code></pre></div><p><img alt="2025-11-28153715" loading="lazy" src="../../images/qwnt/2025-11-2853715.png"></p>
<p>跑出个脚本</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.io <span style="color:#f92672">import</span> wavfile
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.signal <span style="color:#f92672">import</span> resample_poly, decimate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auto_tune_and_demod</span>(filename):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[*] 正在读取高采样率文件 </span><span style="color:#e6db74">{</span>filename<span style="color:#e6db74">}</span><span style="color:#e6db74"> (可能需要一点时间)...&#34;</span>)
</span></span><span style="display:flex;"><span>    fs, data <span style="color:#f92672">=</span> wavfile<span style="color:#f92672">.</span>read(filename)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 确保是浮点数并归一化</span>
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>astype(np<span style="color:#f92672">.</span>float32)
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">/=</span> np<span style="color:#f92672">.</span>max(np<span style="color:#f92672">.</span>abs(data))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 组合成 IQ 信号</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 注意：视不同设备，Q 可能需要反转。如果听不清，可以把下行改为 data[:, 0] - 1j * data[:, 1]</span>
</span></span><span style="display:flex;"><span>    iq <span style="color:#f92672">=</span> data[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>j <span style="color:#f92672">*</span> data[:, <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[*] 原始采样率: </span><span style="color:#e6db74">{</span>fs<span style="color:#e6db74">}</span><span style="color:#e6db74"> Hz. 正在寻找最强信号频率...&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 1. 寻找最强频率 (FFT)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 取中间一段样本分析，避免头部尾部噪音</span>
</span></span><span style="display:flex;"><span>    n_fft <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>    start <span style="color:#f92672">=</span> len(iq) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    slice_iq <span style="color:#f92672">=</span> iq[start: start <span style="color:#f92672">+</span> n_fft]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    spectrum <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>fft<span style="color:#f92672">.</span>fftshift(np<span style="color:#f92672">.</span>fft<span style="color:#f92672">.</span>fft(slice_iq))
</span></span><span style="display:flex;"><span>    freqs <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>fft<span style="color:#f92672">.</span>fftshift(np<span style="color:#f92672">.</span>fft<span style="color:#f92672">.</span>fftfreq(len(slice_iq), <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> fs))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 忽略 DC (0Hz) 附近的峰值，因为那通常是硬件直流偏置</span>
</span></span><span style="display:flex;"><span>    dc_mask <span style="color:#f92672">=</span> (np<span style="color:#f92672">.</span>abs(freqs) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2000</span>)
</span></span><span style="display:flex;"><span>    valid_indices <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(dc_mask)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    peak_idx <span style="color:#f92672">=</span> valid_indices[<span style="color:#ae81ff">0</span>][np<span style="color:#f92672">.</span>argmax(np<span style="color:#f92672">.</span>abs(spectrum)[valid_indices])]
</span></span><span style="display:flex;"><span>    target_freq <span style="color:#f92672">=</span> freqs[peak_idx]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[!] 锁定最强信号频率: </span><span style="color:#e6db74">{</span>target_freq<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> Hz&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 2. 移频 (Frequency Shift)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 将目标频率移动到 0 Hz</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;[*] 正在调谐 (移频)...&#34;</span>)
</span></span><span style="display:flex;"><span>    t <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(len(iq)) <span style="color:#f92672">/</span> fs
</span></span><span style="display:flex;"><span>    shifted_iq <span style="color:#f92672">=</span> iq <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>j <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>pi <span style="color:#f92672">*</span> target_freq <span style="color:#f92672">*</span> t)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 3. 降采样 (Decimation)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 目标是 48kHz 音频，所以降采样因子 = 2.4M / 48k = 50</span>
</span></span><span style="display:flex;"><span>    target_fs <span style="color:#f92672">=</span> <span style="color:#ae81ff">48000</span>
</span></span><span style="display:flex;"><span>    decimation_factor <span style="color:#f92672">=</span> int(fs <span style="color:#f92672">/</span> target_fs)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[*] 正在降采样 (因子: </span><span style="color:#e6db74">{</span>decimation_factor<span style="color:#e6db74">}</span><span style="color:#e6db74">)...&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 使用 decimate 进行低通滤波 + 抽取</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># complex=True 处理复数</span>
</span></span><span style="display:flex;"><span>    downsampled_iq <span style="color:#f92672">=</span> decimate(shifted_iq, decimation_factor, ftype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;fir&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 4. NFM 解调</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;[*] 正在进行 NFM 解调...&#34;</span>)
</span></span><span style="display:flex;"><span>    phase <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>angle(downsampled_iq)
</span></span><span style="display:flex;"><span>    audio <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>diff(np<span style="color:#f92672">.</span>unwrap(phase))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 保存</span>
</span></span><span style="display:flex;"><span>    out_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;final_decoded.wav&#34;</span>
</span></span><span style="display:flex;"><span>    audio <span style="color:#f92672">=</span> audio <span style="color:#f92672">/</span> np<span style="color:#f92672">.</span>max(np<span style="color:#f92672">.</span>abs(audio)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">32767</span>
</span></span><span style="display:flex;"><span>    wavfile<span style="color:#f92672">.</span>write(out_name, target_fs, audio<span style="color:#f92672">.</span>astype(np<span style="color:#f92672">.</span>int16))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[+] 成功！已保存为: </span><span style="color:#e6db74">{</span>out_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;[!] 请播放该文件，如果是人声/拨号声，Flag就在其中！&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    auto_tune_and_demod(<span style="color:#e6db74">&#34;2.wav&#34;</span>)
</span></span></code></pre></div><p>发现中间是有类似sstv的东西的，用工具跑看看</p>
<p><img alt="2025-11-28154949" loading="lazy" src="../../images/qwnt/2025-11-28154949.png"></p>
<p>是图片不过需要去噪啊</p>
<p>然后写了一个稍微能看到一点的</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.io <span style="color:#f92672">import</span> wavfile
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.signal <span style="color:#f92672">import</span> resample_poly, decimate, butter, lfilter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">butter_bandpass</span>(lowcut, highcut, fs, order<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>):
</span></span><span style="display:flex;"><span>    nyq <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span> <span style="color:#f92672">*</span> fs
</span></span><span style="display:flex;"><span>    low <span style="color:#f92672">=</span> lowcut <span style="color:#f92672">/</span> nyq
</span></span><span style="display:flex;"><span>    high <span style="color:#f92672">=</span> highcut <span style="color:#f92672">/</span> nyq
</span></span><span style="display:flex;"><span>    b, a <span style="color:#f92672">=</span> butter(order, [low, high], btype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;band&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> b, a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">butter_bandpass_filter</span>(data, lowcut, highcut, fs, order<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>):
</span></span><span style="display:flex;"><span>    b, a <span style="color:#f92672">=</span> butter_bandpass(lowcut, highcut, fs, order<span style="color:#f92672">=</span>order)
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> lfilter(b, a, data)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auto_tune_and_demod</span>(filename):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[*] 正在读取高采样率文件 </span><span style="color:#e6db74">{</span>filename<span style="color:#e6db74">}</span><span style="color:#e6db74"> ...&#34;</span>)
</span></span><span style="display:flex;"><span>    fs, data <span style="color:#f92672">=</span> wavfile<span style="color:#f92672">.</span>read(filename)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 转为浮点并归一化</span>
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>astype(np<span style="color:#f92672">.</span>float32)
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">/=</span> np<span style="color:#f92672">.</span>max(np<span style="color:#f92672">.</span>abs(data))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 组合成 IQ 信号</span>
</span></span><span style="display:flex;"><span>    iq <span style="color:#f92672">=</span> data[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>j <span style="color:#f92672">*</span> data[:, <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[*] 原始采样率: </span><span style="color:#e6db74">{</span>fs<span style="color:#e6db74">}</span><span style="color:#e6db74"> Hz. 正在寻找最强信号频率...&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 1. 寻找最强频率</span>
</span></span><span style="display:flex;"><span>    n_fft <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>    start <span style="color:#f92672">=</span> len(iq) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    slice_iq <span style="color:#f92672">=</span> iq[start: start <span style="color:#f92672">+</span> n_fft]
</span></span><span style="display:flex;"><span>    spectrum <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>fft<span style="color:#f92672">.</span>fftshift(np<span style="color:#f92672">.</span>fft<span style="color:#f92672">.</span>fft(slice_iq))
</span></span><span style="display:flex;"><span>    freqs <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>fft<span style="color:#f92672">.</span>fftshift(np<span style="color:#f92672">.</span>fft<span style="color:#f92672">.</span>fftfreq(len(slice_iq), <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> fs))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 忽略 DC 附近的噪音</span>
</span></span><span style="display:flex;"><span>    dc_mask <span style="color:#f92672">=</span> (np<span style="color:#f92672">.</span>abs(freqs) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2000</span>)
</span></span><span style="display:flex;"><span>    valid_indices <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(dc_mask)
</span></span><span style="display:flex;"><span>    peak_idx <span style="color:#f92672">=</span> valid_indices[<span style="color:#ae81ff">0</span>][np<span style="color:#f92672">.</span>argmax(np<span style="color:#f92672">.</span>abs(spectrum)[valid_indices])]
</span></span><span style="display:flex;"><span>    target_freq <span style="color:#f92672">=</span> freqs[peak_idx]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[!] 锁定最强信号频率: </span><span style="color:#e6db74">{</span>target_freq<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> Hz&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 2. 移频</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;[*] 正在调谐 (移频)...&#34;</span>)
</span></span><span style="display:flex;"><span>    t <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(len(iq)) <span style="color:#f92672">/</span> fs
</span></span><span style="display:flex;"><span>    shifted_iq <span style="color:#f92672">=</span> iq <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>j <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>pi <span style="color:#f92672">*</span> target_freq <span style="color:#f92672">*</span> t)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 3. 降采样</span>
</span></span><span style="display:flex;"><span>    target_fs <span style="color:#f92672">=</span> <span style="color:#ae81ff">48000</span>
</span></span><span style="display:flex;"><span>    decimation_factor <span style="color:#f92672">=</span> int(fs <span style="color:#f92672">/</span> target_fs)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[*] 正在降采样 (因子: </span><span style="color:#e6db74">{</span>decimation_factor<span style="color:#e6db74">}</span><span style="color:#e6db74">)...&#34;</span>)
</span></span><span style="display:flex;"><span>    downsampled_iq <span style="color:#f92672">=</span> decimate(shifted_iq, decimation_factor, ftype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;fir&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 4. NFM 解调</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;[*] 正在进行 NFM 解调...&#34;</span>)
</span></span><span style="display:flex;"><span>    phase <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>angle(downsampled_iq)
</span></span><span style="display:flex;"><span>    audio <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>diff(np<span style="color:#f92672">.</span>unwrap(phase))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 5. SSTV 专用去噪 (带通滤波 1100Hz - 2500Hz)</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;[*] 正在应用 SSTV 专用滤波器 (1100Hz - 2500Hz)...&#34;</span>)
</span></span><span style="display:flex;"><span>    audio_filtered <span style="color:#f92672">=</span> butter_bandpass_filter(audio, <span style="color:#ae81ff">1100</span>, <span style="color:#ae81ff">2500</span>, target_fs, order<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 保存</span>
</span></span><span style="display:flex;"><span>    out_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;final_sstv_clean.wav&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 重新归一化</span>
</span></span><span style="display:flex;"><span>    audio_filtered <span style="color:#f92672">=</span> audio_filtered <span style="color:#f92672">/</span> np<span style="color:#f92672">.</span>max(np<span style="color:#f92672">.</span>abs(audio_filtered)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">32000</span>
</span></span><span style="display:flex;"><span>    wavfile<span style="color:#f92672">.</span>write(out_name, target_fs, audio_filtered<span style="color:#f92672">.</span>astype(np<span style="color:#f92672">.</span>int16))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[+] 成功！已生成干净的 SSTV 音频: </span><span style="color:#e6db74">{</span>out_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;[!] 提示: 解码时如果图片还是斜的，请尝试在软件里调整 &#39;Slant Correction&#39; 或 &#39;Auto Slant&#39;。&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    auto_tune_and_demod(<span style="color:#e6db74">&#34;2.wav&#34;</span>)
</span></span></code></pre></div><p><img alt="2025-11-28155414" loading="lazy" src="../../images/qwnt/2025-11-28155414.png"></p>
<p>出的时候试了好几次，最后应该是2nd part    <code>_C4T9L1V3S</code></p>
<pre tabindex="0"><code>flag{Ci4l10~R77YM30W1SFUN_C4T9L1V3S}
</code></pre><h1 id="后话">后话<a hidden class="anchor" aria-hidden="true" href="#后话">#</a></h1>
<p>赛中还研学了一下web层层加码，n4cl师傅payload一穿三太强了，可惜3.2过于恶心。</p>
<p>主办方过于富裕，线下比赛体感最好的一集，和很多SU的伙伴见面约饭了。这里还是宣传一波，欢迎各位有意加入战队的师傅们投递简历到SU<a href="https://forms.office.com/pages/responsepage.aspx?id=DQSIkWdsW0yxEjajBLZtrQAAAAAAAAAAAAO__of7UVlUQkYyQVNOWjVBVkxHSlFVT1ZZU0w5RTNWTC4u&amp;route=shorturl">su-team</a>。战队采用的是candidate过渡考察的机制，进入我们的Discord打几周之后考察转正(问了一下处在candidate的师傅们起初觉得我们可能审核比较严，闹大误会了)，祝SU全年起飞，偶尔摸鱼。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/misc/">Misc</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">0raN9e&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
